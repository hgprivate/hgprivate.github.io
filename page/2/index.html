<!doctypehtml><html lang=zh-CN><meta charset=UTF-8><meta content=width=device-width name=viewport><meta media="(prefers-color-scheme: light)" content=#222 name=theme-color><meta media="(prefers-color-scheme: dark)" content=#222 name=theme-color><meta content="Hexo 7.3.0" name=generator><link href=/images/apple-touch-icon-next.png rel=apple-touch-icon sizes=180x180><link href=/images/favicon-32x32-next.png rel=icon sizes=32x32 type=image/png><link href=/images/favicon-16x16-next.png rel=icon sizes=16x16 type=image/png><link color=#222 href=/images/logo.svg rel=mask-icon><link href=/css/main.css rel=stylesheet><link crossorigin=anonymous href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css integrity=sha256-XOqroi11tY4EFQMR9ZYwZWKj5ZXiftSx36RRuC3anlA= rel=stylesheet><link crossorigin=anonymous href=https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css integrity=sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE= rel=stylesheet><script class=next-config data-name=main type=application/json>{"hostname":"hshz21.gitee.io","root":"/","images":"/images","scheme":"Gemini","darkmode":true,"version":"8.20.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":false}}</script><script src=/js/config.js></script><meta content=豪哥博客 name=description><meta content=website property=og:type><meta content=豪哥博客 property=og:title><meta content=https://hshz21.gitee.io/page/2/index.html property=og:url><meta content=豪哥博客 property=og:site_name><meta content=豪哥博客 property=og:description><meta content=zh_CN property=og:locale><meta content=豪哥 property=article:author><meta content=HG property=article:tag><meta content=summary name=twitter:card><link href=https://hshz21.gitee.io/page/2/ rel=canonical><script class=next-config data-name=page type=application/json>{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/2/index.html","title":""}</script><script class=next-config data-name=calendar type=application/json>""</script><title>豪哥博客</title><noscript><link href=/css/noscript.css rel=stylesheet></noscript><body class=use-motion itemscope itemtype=http://schema.org/WebPage><div class=headband></div><main class=main><div class=column><header class=header itemscope itemtype=http://schema.org/WPHeader><div class=site-brand-container><div class=site-nav-toggle><div aria-label=切换导航栏 class=toggle role=button><span class=toggle-line></span><span class=toggle-line></span><span class=toggle-line></span></div></div><div class=site-meta><a class=brand href=/ rel=start> <i class=logo-line></i> <h1 class=site-title>豪哥博客</h1> <i class=logo-line></i> </a><p class=site-subtitle itemprop=description>豪哥博客</div><div class=site-nav-right><div class="toggle popup-trigger" aria-label=搜索 role=button><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class=site-nav><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href=/ rel=section><i class="fa fa-home fa-fw"></i>首页</a><li class="menu-item menu-item-tags"><a href=/tags/ rel=section><i class="fa fa-tags fa-fw"></i>标签</a><li class="menu-item menu-item-categories"><a href=/categories/ rel=section><i class="fa fa-th fa-fw"></i>分类</a><li class="menu-item menu-item-archives"><a href=/archives/ rel=section><i class="fa fa-archive fa-fw"></i>归档</a><li class="menu-item menu-item-search"><a class=popup-trigger role=button><i class="fa fa-search fa-fw"></i>搜索 </a></ul></nav><div class=search-pop-overlay><div class="popup search-popup"><div class=search-header><span class=search-icon> <i class="fa fa-search"></i> </span><div class=search-input-container><input autocapitalize=off autocomplete=off class=search-input maxlength=80 placeholder=搜索... spellcheck=false type=search></div><span class=popup-btn-close role=button> <i class="fa fa-times-circle"></i> </span></div><div class=search-result-container><div class=search-result-icon><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></header><aside class=sidebar><div class="sidebar-inner sidebar-overview-active"><ul class=sidebar-nav><li class=sidebar-nav-toc>文章目录<li class=sidebar-nav-overview>站点概览</ul><div class=sidebar-panel-container><!--noindex--><div class="post-toc-wrap sidebar-panel"></div><!--/noindex--><div class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop=author itemscope itemtype=http://schema.org/Person><img alt=豪哥 class=site-author-image itemprop=image src=/static/imgs/avatar.png><p class=site-author-name itemprop=name>豪哥<div class=site-description itemprop=description>豪哥博客</div></div><div class="site-state-wrap animated"><nav class=site-state><div class="site-state-item site-state-posts"><a href=/archives/> <span class=site-state-item-count>116</span> <span class=site-state-item-name>日志</span> </a></div><div class="site-state-item site-state-categories"><a href=/categories/> <span class=site-state-item-count>35</span> <span class=site-state-item-name>分类</span></a></div><div class="site-state-item site-state-tags"><a href=/tags/> <span class=site-state-item-count>128</span> <span class=site-state-item-name>标签</span></a></div></nav></div></div></div></div></aside></div><div class="main-inner index posts-expand"><div class=post-block><article class=post-content itemscope itemtype=http://schema.org/Article><link href=https://hshz21.gitee.io/2024/08/21/02-%E5%85%A8%E5%B1%80%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86/ itemprop=mainEntityOfPage><span hidden itemprop=author itemscope itemtype=http://schema.org/Person> <meta content=/static/imgs/avatar.png itemprop=image> <meta content=豪哥 itemprop=name> </span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization> <meta content=豪哥博客 itemprop=name> <meta content=豪哥博客 itemprop=description> </span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork> <meta content="undefined | 豪哥博客" itemprop=name> <meta itemprop=description> </span><header class=post-header><h2 itemprop="name headline" class=post-title><a class=post-title-link href=/2024/08/21/02-%E5%85%A8%E5%B1%80%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86/ itemprop=url>微服务业务功能系列-全局异常</a></h2><div class=post-meta-container><div class=post-meta><span class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-calendar"></i> </span> <span class=post-meta-item-text>发表于</span> <time itemprop="dateCreated datePublished" title="创建时间：2024-08-21 21:39:15" datetime=2024-08-21T21:39:15+08:00>2024-08-21</time> </span><span class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-calendar-check"></i> </span> <span class=post-meta-item-text>更新于</span> <time title="修改时间：2023-08-07 15:30:00" datetime=2023-08-07T15:30:00+08:00 itemprop=dateModified>2023-08-07</time> </span><span class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-folder"></i> </span> <span class=post-meta-item-text>分类于</span> <span itemprop=about itemscope itemtype=http://schema.org/Thing> <a href=/categories/%E5%BE%AE%E6%9C%8D%E5%8A%A1/ itemprop=url rel=index><span itemprop=name>微服务</span></a> </span> </span></div></div></header><div class=post-body itemprop=articleBody><h1 id=1、自定义异常><a class=headerlink href=#1、自定义异常 title=1、自定义异常></a>1、自定义异常</h1><figure class="highlight java"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br></pre><td class=code><pre><span class=line><span class=meta>@Data</span></span><br><span class=line><span class=keyword>public</span> <span class=keyword>class</span> <span class="title class_">SYTException</span> <span class=keyword>extends</span> <span class="title class_">RuntimeException</span>{</span><br><span class=line>    <span class=keyword>private</span> Integer code;</span><br><span class=line></span><br><span class=line>    <span class=keyword>public</span> <span class="title function_">SYTException</span><span class=params>(String msg, Integer code)</span>{</span><br><span class=line>        <span class=built_in>super</span>(msg);</span><br><span class=line>        <span class=built_in>this</span>.code = code;</span><br><span class=line>    }</span><br><span class=line>    <span class=keyword>public</span> <span class="title function_">SYTException</span><span class=params>(RCodeEnum rCodeEnum)</span>{</span><br><span class=line>        <span class=built_in>super</span>(rCodeEnum.getMsg());</span><br><span class=line>        <span class=built_in>this</span>.code = rCodeEnum.getCode();</span><br><span class=line>    }</span><br><span class=line>}</span><br></pre></table></figure><h1 id=2、全局统一异常处理><a class=headerlink href=#2、全局统一异常处理 title=2、全局统一异常处理></a>2、全局统一异常处理</h1><p>在全局统一异常处理类中可以添加自定义异常类，当在项目中抛出该设置的自定义异常时，会得到统一处理。<figure class="highlight java"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br></pre><td class=code><pre><span class=line><span class=meta>@ControllerAdvice</span></span><br><span class=line><span class=meta>@ResponseBody</span></span><br><span class=line><span class=keyword>public</span> <span class=keyword>class</span> <span class="title class_">GlobalExceptionHandler</span> {</span><br><span class=line>    <span class=meta>@ExceptionHandler(Exception.class)</span></span><br><span class=line>    <span class=keyword>public</span> R <span class="title function_">error</span><span class=params>(Exception e)</span>{</span><br><span class=line>        e.printStackTrace();</span><br><span class=line>        <span class=keyword>return</span> R.fail();</span><br><span class=line>    }</span><br><span class=line></span><br><span class=line>    <span class=meta>@ExceptionHandler(SYTException.class)</span></span><br><span class=line>    <span class=keyword>public</span> R <span class="title function_">error</span><span class=params>(SYTException e)</span>{</span><br><span class=line>        e.printStackTrace();</span><br><span class=line>        <span class=keyword>return</span> R.fail();</span><br><span class=line>    }</span><br><span class=line>}</span><br></pre></table></figure></div><footer class=post-footer><div class=post-eof></div></footer></article></div><div class=post-block><article class=post-content itemscope itemtype=http://schema.org/Article><link href=https://hshz21.gitee.io/2024/08/21/02-Session%E5%85%B1%E4%BA%AB%E9%97%AE%E9%A2%98/ itemprop=mainEntityOfPage><span hidden itemprop=author itemscope itemtype=http://schema.org/Person> <meta content=/static/imgs/avatar.png itemprop=image> <meta content=豪哥 itemprop=name> </span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization> <meta content=豪哥博客 itemprop=name> <meta content=豪哥博客 itemprop=description> </span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork> <meta content="undefined | 豪哥博客" itemprop=name> <meta itemprop=description> </span><header class=post-header><h2 itemprop="name headline" class=post-title><a class=post-title-link href=/2024/08/21/02-Session%E5%85%B1%E4%BA%AB%E9%97%AE%E9%A2%98/ itemprop=url>微服务问题系列-Session共享问题</a></h2><div class=post-meta-container><div class=post-meta><span class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-calendar"></i> </span> <span class=post-meta-item-text>发表于</span> <time itemprop="dateCreated datePublished" title="创建时间：2024-08-21 21:39:15" datetime=2024-08-21T21:39:15+08:00>2024-08-21</time> </span><span class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-calendar-check"></i> </span> <span class=post-meta-item-text>更新于</span> <time title="修改时间：2023-08-07 16:09:12" datetime=2023-08-07T16:09:12+08:00 itemprop=dateModified>2023-08-07</time> </span><span class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-folder"></i> </span> <span class=post-meta-item-text>分类于</span> <span itemprop=about itemscope itemtype=http://schema.org/Thing> <a href=/categories/%E5%BE%AE%E6%9C%8D%E5%8A%A1/ itemprop=url rel=index><span itemprop=name>微服务</span></a> </span> </span></div></div></header><div class=post-body itemprop=articleBody><h1 id=1、Session共享方案特点><a class=headerlink href=#1、Session共享方案特点 title=1、Session共享方案特点></a>1、Session共享方案特点</h1><p>session替代方案需满足：<ul><li>数据共享<li>内存存储<li>key/value结构</ul><h1 id=2、Session共享方案><a class=headerlink href=#2、Session共享方案 title=2、Session共享方案></a>2、Session共享方案</h1><h2 id=2-1、Tomcat><a class=headerlink href=#2-1、Tomcat title=2.1、Tomcat></a>2.1、Tomcat</h2><ul><li>tomcat通过配置实现session互相拷贝<ul><li>浪费内存空间，成本高。<li>同步时间较长，效率低。</ul></ul><h2 id=2-2、Redis（推荐）><a class=headerlink href=#2-2、Redis（推荐） title=2.2、Redis（推荐）></a>2.2、Redis（推荐）</h2><ul><li>验证码<ul><li>String类型。<li>key使用手机号。</ul><li>用户数据<ul><li>hash类型。<li>key使用随机token，且让浏览器保存，后期交互时都要带上。<li>30分钟有效期。<li>拦截器更新有效期，只有在用户超过30没有一次交流时才销毁。</ul></ul><h1 id=3、代码示例><a class=headerlink href=#3、代码示例 title=3、代码示例></a>3、代码示例</h1><h2 id=3-1、SpringSession整合Redis><a class=headerlink href=#3-1、SpringSession整合Redis title=3.1、SpringSession整合Redis></a>3.1、SpringSession整合Redis</h2><h3 id=3-1-1、引入依赖><a class=headerlink href=#3-1-1、引入依赖 title=3.1.1、引入依赖></a>3.1.1、引入依赖</h3><figure class="highlight xml"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br></pre><td class=code><pre><span class=line><span class=tag><<span class=name>dependency</span>></span></span><br><span class=line>    <span class=tag><<span class=name>groupId</span>></span>org.springframework.session<span class=tag>&LT/<span class=name>groupId</span>></span></span><br><span class=line>    <span class=tag><<span class=name>artifactId</span>></span>spring-session-data-redis<span class=tag>&LT/<span class=name>artifactId</span>></span></span><br><span class=line><span class=tag>&LT/<span class=name>dependency</span>></span></span><br></pre></table></figure><h3 id=3-1-2、配置><a class=headerlink href=#3-1-2、配置 title=3.1.2、配置></a>3.1.2、配置</h3><h4 id=3-1-2-1、application-yml><a class=headerlink href=#3-1-2-1、application-yml title=3.1.2.1、application.yml></a>3.1.2.1、application.yml</h4><figure class="highlight yml"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br></pre><td class=code><pre><span class=line><span class=attr>server:</span></span><br><span class=line>  <span class=attr>servlet:</span> </span><br><span class=line>    <span class=attr>session:</span></span><br><span class=line>      <span class=attr>timeout:</span> <span class=string>30m</span>	<span class=comment># 30分钟</span></span><br><span class=line><span class=attr>spring:</span></span><br><span class=line>  <span class=attr>session:</span></span><br><span class=line>    <span class=attr>store-type:</span> <span class=string>redis</span></span><br><span class=line>  <span class=attr>redis:</span></span><br><span class=line>    <span class=attr>host:</span> <span class=number>192.168</span><span class=number>.2</span><span class=number>.4</span></span><br><span class=line>    <span class=attr>port:</span> <span class=number>6379</span></span><br></pre></table></figure><h4 id=3-1-2-2、配置类><a class=headerlink href=#3-1-2-2、配置类 title=3.1.2.2、配置类></a>3.1.2.2、配置类</h4><figure class="highlight java"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br></pre><td class=code><pre><span class=line><span class=meta>@Configuration</span></span><br><span class=line><span class=keyword>public</span> <span class=keyword>class</span> <span class="title class_">GuLiMallSessionConfig</span> {</span><br><span class=line>    <span class=meta>@Bean</span></span><br><span class=line>    <span class=keyword>public</span> CookieSerializer <span class="title function_">cookieSerializer</span><span class=params>()</span>{</span><br><span class=line>        <span class=type>DefaultCookieSerializer</span> <span class=variable>cookieSerializer</span> <span class=operator>=</span> <span class=keyword>new</span> <span class="title class_">DefaultCookieSerializer</span>();</span><br><span class=line>        <span class=comment>// 明确的指定Cookie的作用域</span></span><br><span class=line>        cookieSerializer.setDomainName(<span class=string>"gulimall.com"</span>);</span><br><span class=line>        cookieSerializer.setCookieName(<span class=string>"GLMSESSION"</span>);</span><br><span class=line>        <span class=keyword>return</span> cookieSerializer;</span><br><span class=line>    }</span><br><span class=line></span><br><span class=line>    <span class=comment>/**</span></span><br><span class=line><span class=comment>     * 自定义序列化机制</span></span><br><span class=line><span class=comment>     * 这里方法名必须是：springSessionDefaultRedisSerializer</span></span><br><span class=line><span class=comment>     */</span></span><br><span class=line>    <span class=meta>@Bean</span></span><br><span class=line>    <span class=keyword>public</span> RedisSerializer&LTObject> <span class="title function_">springSessionDefaultRedisSerializer</span><span class=params>()</span>{</span><br><span class=line>        <span class=keyword>return</span> <span class=keyword>new</span> <span class="title class_">GenericJackson2JsonRedisSerializer</span>();</span><br><span class=line>    }</span><br><span class=line>}</span><br></pre></table></figure><h4 id=3-1-2-3、启动类上加注解><a class=headerlink href=#3-1-2-3、启动类上加注解 title=3.1.2.3、启动类上加注解></a>3.1.2.3、启动类上加注解</h4><p>启动类上需要加主机<code>@EnableRedisHttpSession</code>。<h3 id=3-1-3、使用示例><a class=headerlink href=#3-1-3、使用示例 title=3.1.3、使用示例></a>3.1.3、使用示例</h3><figure class="highlight java"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br></pre><td class=code><pre><span class=line><span class=meta>@PostMapping("/login")</span></span><br><span class=line><span class=keyword>public</span> String <span class="title function_">login</span><span class=params>(UserLoginVo userLoginVo, RedirectAttributes redirectAttributes, HttpSession session)</span>{</span><br><span class=line>    log.info(<span class=string>"--------------------登录 S--------------------"</span>);</span><br><span class=line>    <span class=type>R</span> <span class=variable>r</span> <span class=operator>=</span> memberFeignService.login(userLoginVo);</span><br><span class=line>    <span class=keyword>if</span>(r.getCode() == <span class=number>0</span>){</span><br><span class=line>        <span class=type>MemberRsepVo</span> <span class=variable>rsepVo</span> <span class=operator>=</span> r.getData(<span class=string>"data"</span>, <span class=keyword>new</span> <span class="title class_">TypeReference</span>&LTMemberRsepVo>() {});</span><br><span class=line>        session.setAttribute(AuthServerConstant.LOGIN_USER, rsepVo);</span><br><span class=line>        log.info(<span class=string>"MemberRsepVo - rsepVo："</span> + rsepVo.toString());</span><br><span class=line>        log.info(<span class=string>"--------------------登录 E--------------------"</span>);</span><br><span class=line>        <span class=keyword>return</span> <span class=string>"redirect:http://gulimall.com"</span>;</span><br><span class=line>    }<span class=keyword>else</span> {</span><br><span class=line>        HashMap&LTString, String> error = <span class=keyword>new</span> <span class="title class_">HashMap</span><>();</span><br><span class=line>        <span class=comment>// 获取错误信息</span></span><br><span class=line>        error.put(<span class=string>"msg"</span>, r.getData(<span class=string>"msg"</span>,<span class=keyword>new</span> <span class="title class_">TypeReference</span>&LTString>(){}));</span><br><span class=line>        redirectAttributes.addFlashAttribute(<span class=string>"errors"</span>, error);</span><br><span class=line>        log.info(<span class=string>"--------------------登录 E（error）--------------------"</span>);</span><br><span class=line>        <span class=keyword>return</span> <span class=string>"redirect:http://auth.gulimall.com/login.html"</span>;</span><br><span class=line>    }</span><br><span class=line>}</span><br></pre></table></figure></div><footer class=post-footer><div class=post-eof></div></footer></article></div><div class=post-block><article class=post-content itemscope itemtype=http://schema.org/Article><link href=https://hshz21.gitee.io/2024/08/21/01-%E5%85%A8%E5%B1%80%E7%BB%9F%E4%B8%80%E8%BF%94%E5%9B%9E%E5%80%BC/ itemprop=mainEntityOfPage><span hidden itemprop=author itemscope itemtype=http://schema.org/Person> <meta content=/static/imgs/avatar.png itemprop=image> <meta content=豪哥 itemprop=name> </span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization> <meta content=豪哥博客 itemprop=name> <meta content=豪哥博客 itemprop=description> </span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork> <meta content="undefined | 豪哥博客" itemprop=name> <meta itemprop=description> </span><header class=post-header><h2 itemprop="name headline" class=post-title><a class=post-title-link href=/2024/08/21/01-%E5%85%A8%E5%B1%80%E7%BB%9F%E4%B8%80%E8%BF%94%E5%9B%9E%E5%80%BC/ itemprop=url>微服务业务功能系列-全局统一返回值</a></h2><div class=post-meta-container><div class=post-meta><span class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-calendar"></i> </span> <span class=post-meta-item-text>发表于</span> <time itemprop="dateCreated datePublished" title="创建时间：2024-08-21 21:39:15" datetime=2024-08-21T21:39:15+08:00>2024-08-21</time> </span><span class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-calendar-check"></i> </span> <span class=post-meta-item-text>更新于</span> <time title="修改时间：2023-08-07 15:29:11" datetime=2023-08-07T15:29:11+08:00 itemprop=dateModified>2023-08-07</time> </span><span class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-folder"></i> </span> <span class=post-meta-item-text>分类于</span> <span itemprop=about itemscope itemtype=http://schema.org/Thing> <a href=/categories/%E5%BE%AE%E6%9C%8D%E5%8A%A1/ itemprop=url rel=index><span itemprop=name>微服务</span></a> </span> </span></div></div></header><div class=post-body itemprop=articleBody><h1 id=1、返回结果枚举类><a class=headerlink href=#1、返回结果枚举类 title=1、返回结果枚举类></a>1、返回结果枚举类</h1><p>RCodeEnum.java<figure class="highlight java"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br><span class=line>42</span><br><span class=line>43</span><br><span class=line>44</span><br><span class=line>45</span><br></pre><td class=code><pre><span class=line><span class=meta>@Getter</span></span><br><span class=line><span class=keyword>public</span> <span class=keyword>enum</span> <span class="title class_">RCodeEnum</span> {</span><br><span class=line>    SUCCESS(<span class=number>200</span>,<span class=string>"成功"</span>),</span><br><span class=line>    FAIL(<span class=number>201</span>, <span class=string>"失败"</span>),</span><br><span class=line>    PARAM_ERROR( <span class=number>202</span>, <span class=string>"参数不正确"</span>),</span><br><span class=line>    SERVICE_ERROR(<span class=number>203</span>, <span class=string>"服务异常"</span>),</span><br><span class=line>    DATA_ERROR(<span class=number>204</span>, <span class=string>"数据异常"</span>),</span><br><span class=line>    DATA_UPDATE_ERROR(<span class=number>205</span>, <span class=string>"数据版本异常"</span>),</span><br><span class=line></span><br><span class=line>    LOGIN_AUTH(<span class=number>208</span>, <span class=string>"未登陆"</span>),</span><br><span class=line>    PERMISSION(<span class=number>209</span>, <span class=string>"没有权限"</span>),</span><br><span class=line></span><br><span class=line>    CODE_ERROR(<span class=number>210</span>, <span class=string>"验证码错误"</span>),</span><br><span class=line><span class=comment>//    LOGIN_MOBLE_ERROR(211, "账号不正确"),</span></span><br><span class=line>    LOGIN_DISABLED_ERROR(<span class=number>212</span>, <span class=string>"改用户已被禁用"</span>),</span><br><span class=line>    REGISTER_MOBLE_ERROR(<span class=number>213</span>, <span class=string>"手机号已被使用"</span>),</span><br><span class=line>    LOGIN_AURH(<span class=number>214</span>, <span class=string>"需要登录"</span>),</span><br><span class=line>    LOGIN_ACL(<span class=number>215</span>, <span class=string>"没有权限"</span>),</span><br><span class=line></span><br><span class=line>    URL_ENCODE_ERROR( <span class=number>216</span>, <span class=string>"URL编码失败"</span>),</span><br><span class=line>    ILLEGAL_CALLBACK_REQUEST_ERROR( <span class=number>217</span>, <span class=string>"非法回调请求"</span>),</span><br><span class=line>    FETCH_ACCESSTOKEN_FAILD( <span class=number>218</span>, <span class=string>"获取accessToken失败"</span>),</span><br><span class=line>    FETCH_USERINFO_ERROR( <span class=number>219</span>, <span class=string>"获取用户信息失败"</span>),</span><br><span class=line>    <span class=comment>//LOGIN_ERROR( 23005, "登录失败"),</span></span><br><span class=line></span><br><span class=line>    PAY_RUN(<span class=number>220</span>, <span class=string>"支付中"</span>),</span><br><span class=line>    CANCEL_ORDER_FAIL(<span class=number>225</span>, <span class=string>"取消订单失败"</span>),</span><br><span class=line>    CANCEL_ORDER_NO(<span class=number>225</span>, <span class=string>"不能取消预约"</span>),</span><br><span class=line></span><br><span class=line>    HOSCODE_EXIST(<span class=number>230</span>, <span class=string>"医院编号已经存在"</span>),</span><br><span class=line>    NUMBER_NO(<span class=number>240</span>, <span class=string>"可预约号不足"</span>),</span><br><span class=line>    TIME_NO(<span class=number>250</span>, <span class=string>"当前时间不可以预约"</span>),</span><br><span class=line></span><br><span class=line>    SIGN_ERROR(<span class=number>300</span>, <span class=string>"签名错误"</span>),</span><br><span class=line>    HOSPITAL_OPEN(<span class=number>310</span>, <span class=string>"医院未开通，暂时不能访问"</span>),</span><br><span class=line>    HOSPITAL_LOCK(<span class=number>320</span>, <span class=string>"医院被锁定，暂时不能访问"</span>);</span><br><span class=line></span><br><span class=line>    <span class=keyword>private</span> Integer code;</span><br><span class=line>    <span class=keyword>private</span> String msg;</span><br><span class=line></span><br><span class=line>    <span class=keyword>private</span> <span class="title function_">RCodeEnum</span><span class=params>(Integer code, String msg)</span> {</span><br><span class=line>        <span class=built_in>this</span>.code = code;</span><br><span class=line>        <span class=built_in>this</span>.msg = msg;</span><br><span class=line>    }</span><br><span class=line>}</span><br></pre></table></figure><h1 id=2、返回结果类><a class=headerlink href=#2、返回结果类 title=2、返回结果类></a>2、返回结果类</h1><p>返回结果类 依赖于 返回结果枚举类（可选），返回结果类代码如下：<figure class="highlight java"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br><span class=line>42</span><br><span class=line>43</span><br><span class=line>44</span><br><span class=line>45</span><br><span class=line>46</span><br><span class=line>47</span><br><span class=line>48</span><br><span class=line>49</span><br><span class=line>50</span><br><span class=line>51</span><br><span class=line>52</span><br><span class=line>53</span><br><span class=line>54</span><br><span class=line>55</span><br><span class=line>56</span><br><span class=line>57</span><br><span class=line>58</span><br><span class=line>59</span><br><span class=line>60</span><br><span class=line>61</span><br><span class=line>62</span><br></pre><td class=code><pre><span class=line><span class=meta>@Data</span></span><br><span class=line><span class=meta>@ApiModel(value = "全局统一返回结果")</span></span><br><span class=line><span class=keyword>public</span> <span class=keyword>class</span> <span class="title class_">R</span>&LTT> {</span><br><span class=line>    <span class=meta>@ApiModelProperty(value = "返回码")</span></span><br><span class=line>    <span class=keyword>private</span> Integer code;</span><br><span class=line>    <span class=meta>@ApiModelProperty(value = "返回消息")</span></span><br><span class=line>    <span class=keyword>private</span> String msg;</span><br><span class=line>    <span class=meta>@ApiModelProperty(value = "返回数据")</span></span><br><span class=line>    <span class=keyword>private</span> T data;</span><br><span class=line></span><br><span class=line>    <span class=keyword>public</span> <span class="title function_">R</span><span class=params>()</span>{}</span><br><span class=line></span><br><span class=line>    <span class=keyword>protected</span> <span class=keyword>static</span> &LTT> R&LTT> <span class="title function_">build</span><span class=params>(T data)</span> {</span><br><span class=line>        R&LTT> r = <span class=keyword>new</span> <span class="title class_">R</span>&LTT>();</span><br><span class=line>        <span class=keyword>if</span> (data != <span class=literal>null</span>)</span><br><span class=line>            r.setData(data);</span><br><span class=line>        <span class=keyword>return</span> r;</span><br><span class=line>    }</span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>static</span> &LTT> R&LTT> <span class="title function_">build</span><span class=params>(T body, RCodeEnum rCodeEnum)</span> {</span><br><span class=line>        R&LTT> r = build(body);</span><br><span class=line>        r.setCode(rCodeEnum.getCode());</span><br><span class=line>        r.setMsg(rCodeEnum.getMsg());</span><br><span class=line>        <span class=keyword>return</span> r;</span><br><span class=line>    }</span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>static</span> &LTT> R&LTT> <span class="title function_">build</span><span class=params>(Integer code, String message)</span> {</span><br><span class=line>        R&LTT> r = build(<span class=literal>null</span>);</span><br><span class=line>        r.setCode(code);</span><br><span class=line>        r.setMsg(message);</span><br><span class=line>        <span class=keyword>return</span> r;</span><br><span class=line>    }</span><br><span class=line></span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>static</span>&LTT> R&LTT> <span class="title function_">ok</span><span class=params>()</span>{</span><br><span class=line>        <span class=keyword>return</span> R.ok(<span class=literal>null</span>);</span><br><span class=line>    }</span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>static</span>&LTT> R&LTT> <span class="title function_">ok</span><span class=params>(T data)</span>{</span><br><span class=line>        R&LTT> r = build(data);</span><br><span class=line>        <span class=keyword>return</span> build(data, RCodeEnum.SUCCESS);</span><br><span class=line>    }</span><br><span class=line></span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>static</span>&LTT> R&LTT> <span class="title function_">fail</span><span class=params>()</span>{</span><br><span class=line>        <span class=keyword>return</span> R.fail(<span class=literal>null</span>);</span><br><span class=line>    }</span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>static</span>&LTT> R&LTT> <span class="title function_">fail</span><span class=params>(T data)</span>{</span><br><span class=line>        R&LTT> r = build(data);</span><br><span class=line>        <span class=keyword>return</span> build(data, RCodeEnum.FAIL);</span><br><span class=line>    }</span><br><span class=line></span><br><span class=line>    <span class=keyword>public</span> R&LTT> <span class="title function_">msg</span><span class=params>(String msg)</span>{</span><br><span class=line>        <span class=built_in>this</span>.setMsg(msg);</span><br><span class=line>        <span class=keyword>return</span> <span class=built_in>this</span>;</span><br><span class=line>    }</span><br><span class=line>    <span class=keyword>public</span> R&LTT> <span class="title function_">code</span><span class=params>(Integer code)</span>{</span><br><span class=line>        <span class=built_in>this</span>.setCode(code);</span><br><span class=line>        <span class=keyword>return</span> <span class=built_in>this</span>;</span><br><span class=line>    }</span><br><span class=line>    <span class=keyword>public</span> <span class=type>boolean</span> <span class="title function_">isOk</span><span class=params>()</span> {</span><br><span class=line>        <span class=keyword>if</span>(<span class=built_in>this</span>.getCode().intValue() == RCodeEnum.SUCCESS.getCode().intValue()) {</span><br><span class=line>            <span class=keyword>return</span> <span class=literal>true</span>;</span><br><span class=line>        }</span><br><span class=line>        <span class=keyword>return</span> <span class=literal>false</span>;</span><br><span class=line>    }</span><br><span class=line>}</span><br></pre></table></figure></div><footer class=post-footer><div class=post-eof></div></footer></article></div><div class=post-block><article class=post-content itemscope itemtype=http://schema.org/Article><link href=https://hshz21.gitee.io/2024/08/21/01-%E8%B7%A8%E5%9F%9F%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86/ itemprop=mainEntityOfPage><span hidden itemprop=author itemscope itemtype=http://schema.org/Person> <meta content=/static/imgs/avatar.png itemprop=image> <meta content=豪哥 itemprop=name> </span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization> <meta content=豪哥博客 itemprop=name> <meta content=豪哥博客 itemprop=description> </span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork> <meta content="undefined | 豪哥博客" itemprop=name> <meta itemprop=description> </span><header class=post-header><h2 itemprop="name headline" class=post-title><a class=post-title-link href=/2024/08/21/01-%E8%B7%A8%E5%9F%9F%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86/ itemprop=url>微服务问题系列-处理跨域</a></h2><div class=post-meta-container><div class=post-meta><span class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-calendar"></i> </span> <span class=post-meta-item-text>发表于</span> <time itemprop="dateCreated datePublished" title="创建时间：2024-08-21 21:39:15" datetime=2024-08-21T21:39:15+08:00>2024-08-21</time> </span><span class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-calendar-check"></i> </span> <span class=post-meta-item-text>更新于</span> <time title="修改时间：2023-08-07 16:09:01" datetime=2023-08-07T16:09:01+08:00 itemprop=dateModified>2023-08-07</time> </span><span class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-folder"></i> </span> <span class=post-meta-item-text>分类于</span> <span itemprop=about itemscope itemtype=http://schema.org/Thing> <a href=/categories/%E5%BE%AE%E6%9C%8D%E5%8A%A1/ itemprop=url rel=index><span itemprop=name>微服务</span></a> </span> </span></div></div></header><div class=post-body itemprop=articleBody><h1 id=1、跨域问题><a class=headerlink href=#1、跨域问题 title=1、跨域问题></a>1、跨域问题</h1><p><strong>只要 访问协议、访问地址、端口号 三个地方有一个不一样就会出现跨域问题。</strong><h1 id=2、跨域解决方案><a class=headerlink href=#2、跨域解决方案 title=2、跨域解决方案></a>2、跨域解决方案</h1><h2 id=2-1、注解><a class=headerlink href=#2-1、注解 title=2.1、注解></a>2.1、注解</h2><p>可以在Controller控制器上加上注解<code>@CrossOrigin</code>即可，不过这种方案生产中不推荐，仅在开发测试阶段来使用。<h2 id=2-2、网关><a class=headerlink href=#2-2、网关 title=2.2、网关></a>2.2、网关</h2><p><strong>可以通过网关<code>SpringGateway</code>来解决跨域，生产中建议使用该解决方案。</strong><h3 id=2-2-1、配置文件方案><a class=headerlink href=#2-2-1、配置文件方案 title=2.2.1、配置文件方案></a>2.2.1、配置文件方案</h3><p>在配置文件中加入如下内容即可：<figure class="highlight yml"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br></pre><td class=code><pre><span class=line><span class=attr>spring:</span></span><br><span class=line>  <span class=attr>cloud:</span></span><br><span class=line>    <span class=attr>gateway:</span></span><br><span class=line>      <span class=attr>globalcors:</span> <span class=comment># 全局的跨域处理</span></span><br><span class=line>        <span class=attr>add-to-simple-url-handler-mapping:</span> <span class=literal>true</span> <span class=comment># 设置为true来解决options请求被拦截问题</span></span><br><span class=line>        <span class=attr>corsConfigurations:</span></span><br><span class=line>          <span class=string>'[/**]'</span><span class=string>:</span></span><br><span class=line>            <span class=attr>allowedOrigins:</span> <span class=comment># 允许哪些网站的跨域请求 </span></span><br><span class=line>              <span class=bullet>-</span> <span class=string>"http://localhost:8090"</span></span><br><span class=line>            <span class=attr>allowedMethods:</span> <span class=comment># 允许的跨域ajax的请求方式</span></span><br><span class=line>              <span class=bullet>-</span> <span class=string>"GET"</span></span><br><span class=line>              <span class=bullet>-</span> <span class=string>"POST"</span></span><br><span class=line>              <span class=bullet>-</span> <span class=string>"DELETE"</span></span><br><span class=line>              <span class=bullet>-</span> <span class=string>"PUT"</span></span><br><span class=line>              <span class=bullet>-</span> <span class=string>"OPTIONS"</span></span><br><span class=line>            <span class=attr>allowedHeaders:</span> <span class=string>"*"</span> <span class=comment># 允许在请求中携带的头信息</span></span><br><span class=line>            <span class=attr>allowCredentials:</span> <span class=literal>true</span> <span class=comment># 是否允许携带cookie</span></span><br><span class=line>            <span class=attr>maxAge:</span> <span class=number>360000</span> <span class=comment># 跨域检测有效期</span></span><br></pre></table></figure><p>路由转发配置内容示例如下：<figure class="highlight yml"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br></pre><td class=code><pre><span class=line><span class=attr>spring:</span></span><br><span class=line>  <span class=attr>cloud:</span></span><br><span class=line>    <span class=attr>nacos:</span> <span class=comment># nacos配置，可以选择nacos作为配置中心，维护更方便。</span></span><br><span class=line>      <span class=attr>discovery:</span></span><br><span class=line>        <span class=attr>server-addr:</span> <span class=number>127.0</span><span class=number>.0</span><span class=number>.1</span><span class=string>:8848</span></span><br><span class=line>        <span class=attr>namespace:</span> <span class=string>f2466630-4cfd-4f5c-975d-47b6a3d81a0a</span></span><br><span class=line>        <span class=attr>group:</span> <span class=string>syt-service</span></span><br><span class=line>    <span class=attr>gateway:</span></span><br><span class=line>      <span class=attr>routes:</span></span><br><span class=line>        <span class=bullet>-</span> <span class=attr>id:</span> <span class=string>syt-user-router</span></span><br><span class=line>          <span class=attr>uri:</span> <span class=string>lb://service-user</span></span><br><span class=line>          <span class=attr>predicates:</span></span><br><span class=line>            <span class=bullet>-</span> <span class=string>Path=/api/user/**</span></span><br><span class=line>          <span class=attr>filters:</span></span><br><span class=line>            <span class=bullet>-</span> <span class=string>RewritePath=/api/?(?&LTsegment>.*),</span> <span class=string>/$\{segment}</span></span><br><span class=line>        <span class=bullet>-</span> <span class=attr>id:</span> <span class=string>syt-hosp-router</span></span><br><span class=line>          <span class=attr>uri:</span> <span class=string>lb://service-hosp</span></span><br><span class=line>          <span class=attr>predicates:</span></span><br><span class=line>            <span class=bullet>-</span> <span class=string>Path=/api/hosp/**</span></span><br><span class=line>          <span class=attr>filters:</span></span><br><span class=line>            <span class=bullet>-</span> <span class=string>RewritePath=/api/?(?&LTsegment>.*),</span> <span class=string>/$\{segment}</span></span><br><span class=line>        <span class=bullet>-</span> <span class=attr>id:</span> <span class=string>syt-cmn-router</span></span><br><span class=line>          <span class=attr>uri:</span> <span class=string>lb://service-cmn</span></span><br><span class=line>          <span class=attr>predicates:</span></span><br><span class=line>            <span class=bullet>-</span> <span class=string>Path=/api/cmn/**</span></span><br><span class=line>          <span class=attr>filters:</span></span><br><span class=line>            <span class=bullet>-</span> <span class=string>RewritePath=/api/?(?&LTsegment>.*),</span> <span class=string>/$\{segment}</span></span><br></pre></table></figure><h3 id=2-2-2、配置类方案><a class=headerlink href=#2-2-2、配置类方案 title=2.2.2、配置类方案></a>2.2.2、配置类方案</h3><p>这里注意，配置类方案与配置文件方案 二选一即可。<figure class="highlight java"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br></pre><td class=code><pre><span class=line><span class=keyword>import</span> org.springframework.context.annotation.Bean;</span><br><span class=line><span class=keyword>import</span> org.springframework.context.annotation.Configuration;</span><br><span class=line><span class=keyword>import</span> org.springframework.web.cors.CorsConfiguration;</span><br><span class=line><span class=keyword>import</span> org.springframework.web.cors.reactive.CorsWebFilter;</span><br><span class=line><span class=keyword>import</span> org.springframework.web.cors.reactive.UrlBasedCorsConfigurationSource;</span><br><span class=line></span><br><span class=line><span class=meta>@Configuration</span></span><br><span class=line><span class=keyword>public</span> <span class=keyword>class</span> <span class="title class_">SYTCorsConfig</span> {</span><br><span class=line>    <span class=meta>@Bean</span></span><br><span class=line>    <span class=keyword>public</span> CorsWebFilter <span class="title function_">corsWebFilter</span><span class=params>()</span>{</span><br><span class=line>        <span class=type>CorsConfiguration</span> <span class=variable>corsConfiguration</span> <span class=operator>=</span> <span class=keyword>new</span> <span class="title class_">CorsConfiguration</span>();</span><br><span class=line>        corsConfiguration.addAllowedHeader(<span class=string>"*"</span>);</span><br><span class=line>        corsConfiguration.addAllowedMethod(<span class=string>"*"</span>);</span><br><span class=line>        corsConfiguration.addAllowedOrigin(<span class=string>"*"</span>);</span><br><span class=line>        <span class=comment>//corsConfiguration.setAllowCredentials(true);</span></span><br><span class=line>        <span class=type>UrlBasedCorsConfigurationSource</span> <span class=variable>configurationSource</span> <span class=operator>=</span> <span class=keyword>new</span> <span class="title class_">UrlBasedCorsConfigurationSource</span>();</span><br><span class=line>        configurationSource.registerCorsConfiguration(<span class=string>"/**"</span>, corsConfiguration);</span><br><span class=line>        <span class=keyword>return</span> <span class=keyword>new</span> <span class="title class_">CorsWebFilter</span>(configurationSource);</span><br><span class=line>    }</span><br><span class=line>}</span><br></pre></table></figure></div><footer class=post-footer><div class=post-eof></div></footer></article></div><div class=post-block><article class=post-content itemscope itemtype=http://schema.org/Article><link href=https://hshz21.gitee.io/2024/08/21/%E6%80%BB%E7%BA%BF%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/ itemprop=mainEntityOfPage><span hidden itemprop=author itemscope itemtype=http://schema.org/Person> <meta content=/static/imgs/avatar.png itemprop=image> <meta content=豪哥 itemprop=name> </span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization> <meta content=豪哥博客 itemprop=name> <meta content=豪哥博客 itemprop=description> </span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork> <meta content="undefined | 豪哥博客" itemprop=name> <meta itemprop=description> </span><header class=post-header><h2 itemprop="name headline" class=post-title><a class=post-title-link href=/2024/08/21/%E6%80%BB%E7%BA%BF%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/ itemprop=url>计算机系列-系统总线</a></h2><div class=post-meta-container><div class=post-meta><span class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-calendar"></i> </span> <span class=post-meta-item-text>发表于</span> <time itemprop="dateCreated datePublished" title="创建时间：2024-08-21 21:39:15" datetime=2024-08-21T21:39:15+08:00>2024-08-21</time> </span><span class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-calendar-check"></i> </span> <span class=post-meta-item-text>更新于</span> <time title="修改时间：2023-10-06 11:13:37" datetime=2023-10-06T11:13:37+08:00 itemprop=dateModified>2023-10-06</time> </span><span class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-folder"></i> </span> <span class=post-meta-item-text>分类于</span> <span itemprop=about itemscope itemtype=http://schema.org/Thing> <a href=/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA/ itemprop=url rel=index><span itemprop=name>计算机</span></a> </span> </span></div></div></header><div class=post-body itemprop=articleBody><h1 id=1、认识总线><a class=headerlink href=#1、认识总线 title=1、认识总线></a>1、认识总线</h1><h2 id=1-1、总线简介><a class=headerlink href=#1-1、总线简介 title=1.1、总线简介></a>1.1、总线简介</h2><p><strong>随着处理器和存储器速度越来越快，单总线（当然还有IBM PC总线）很难处理总线交通流量，故新一代总线出现了</strong>。<p>Pentium系统结构图如下所示：<p><img alt=大型Pentium系统结构图01 src=https://raw.githubusercontent.com/lucky2shh/blog-haogeblogs-image/master/2023/08/05/%E5%A4%A7%E5%9E%8BPentium%E7%B3%BB%E7%BB%9F%E7%BB%93%E6%9E%84%E5%9B%BE01.png?token=AIGEF3JXIXM7SQPAGRBS33DEZZVW4><p><strong>图中系统有8个总线（高速缓存、局部、内存、PCI、SCSI、USB、IDE和ISA），每个总线传输速度和功能都不同</strong>。操作系统必须了解所有总线的配置和管理。有两个主要总线，即早期的IBM PC ISA（Industry Standard Architecture）总线和它的后继者PCI（Peripheral Component Interconnect）总线。<h2 id=1-2、ISA-PCI总线><a class=headerlink href=#1-2、ISA-PCI总线 title=1.2、ISA/PCI总线></a>1.2、ISA/PCI总线</h2><h3 id=1-2-1、ISA总线><a class=headerlink href=#1-2-1、ISA总线 title=1.2.1、ISA总线></a>1.2.1、ISA总线</h3><p><strong>ISA总线就是原先的IBM PC/AT总线，以8.33MHz频率运行，可并行传送2字节，最大速率为16.67MB/s。它还可与老式的慢速I/O卡向后兼容。</strong><h3 id=1-2-2、PCI总线><a class=headerlink href=#1-2-2、PCI总线 title=1.2.2、PCI总线></a>1.2.2、PCI总线</h3><p><strong>PCI总线作为ISA总线后继者由Intel公司发布。它可在66MHz频率运行，可并行传送8字节，数据速率为528MB/s。</strong><blockquote><p>目前多数高速I/O设备采用PCI总线。由于有大量I/O卡采用PCI总线，甚至许多非Intel计算机也使用PCI总线。现在，使用称为PCI Express的PCI总线升级版的新计算机已经出现。</blockquote><p>在这种配置中，CPU通过局部总线与PCI桥芯片对话，而PCI桥芯片通过专门的存储总线与存储器对话，一般速率为100MHz。<p>Pentium系统在芯片上有1级高速缓存，在芯片外有一个非常大的2级高速缓存，它通过高速缓存总线与CPU连接。<h2 id=1-3、IDE-USB-SCSI总线><a class=headerlink href=#1-3、IDE-USB-SCSI总线 title=1.3、IDE/USB/SCSI总线></a>1.3、IDE/USB/SCSI总线</h2><p>系统中有三个专门的总线：IDE、USB和SCSI。<h3 id=1-3-1、IDE总线><a class=headerlink href=#1-3-1、IDE总线 title=1.3.1、IDE总线></a>1.3.1、IDE总线</h3><p><strong>IDE总线 将诸如 磁盘 和 CD-ROM 类的外部设备与系统相连接。IDE总线 是PC/AT的 磁盘控制器接口的副产品，现在几乎成了所有基于Pentium系统的硬盘标准，对于CD-ROM也经常是这样。</strong><h3 id=1-3-2、USB总线><a class=headerlink href=#1-3-2、USB总线 title=1.3.2、USB总线></a>1.3.2、USB总线</h3><h4 id=1-3-2-1、USB总线简介><a class=headerlink href=#1-3-2-1、USB总线简介 title=1.3.2.1、USB总线简介></a>1.3.2.1、USB总线简介</h4><p><strong>通用串行总线（Universal Serial Bus，USB）是用来将所有慢速I/O设备，诸如键盘和鼠标，与计算机连接。</strong><p>USB总线采用一种小型四针连接器，其中两针为USB设备提供电源。<h4 id=1-3-2-2、USB总线特点><a class=headerlink href=#1-3-2-2、USB总线特点 title=1.3.2.2、USB总线特点></a>1.3.2.2、USB总线特点</h4><p><strong>USB是一种集中式总线，其根设备每1ms轮询一次I/O设备，看是否有信息收发。</strong><blockquote><p>USB1.0可以处理总计为1.5MB/s的负载，而较新的USB2.0总线可以有60MB/s的速率。<p>所有USB设备共享一个USB设备驱动器，所以无须重新启动就可以给计算机添加USB设备。</blockquote><h3 id=1-3-3、SCSI总线><a class=headerlink href=#1-3-3、SCSI总线 title=1.3.3、SCSI总线></a>1.3.3、SCSI总线</h3><p><strong>SCSI（Small Computer System Interface）总线是一种高速总线，用在高速硬盘、扫描仪和其他需要较大带宽的设备上。它最高可达320MB/s。</strong><p>自从其发布以来，SCSI总线一直用在Macintosh系统上，在UNIX和一些基于Intel的系统中也很流行。<h3 id=1-3-4、IEEE-1394总线><a title="1.3.4、IEEE 1394总线" class=headerlink href=#1-3-4、IEEE-1394总线></a>1.3.4、IEEE 1394总线</h3><p><strong>EEE1394称为火线（FireWire），严格来说，火线是苹果公司具体实现1394的名称。</strong><p><strong>与USB一样，IEEE1394是串行总线，设计用于最快可达100MB/s的包传送中，它适合于将数码相机和类似的多媒体设备连接到计算机上。</strong><p>IEEE 1394与USB不同，不需要集中式控制器。<h3 id=1-3-5、总结><a class=headerlink href=#1-3-5、总结 title=1.3.5、总结></a>1.3.5、总结</h3><p><strong>要想使总线工作起来，需要让操作系统知道连接到计算机的外部设备有哪些，并对它们进行配置。</strong><p>这个特点 导致 Intel 和 微软 设计了一种名为 即插即用 的I/O系统。<blockquote><p>在即插即用之前，每块I/O卡有一个固定的中断请求级别和用于其I/O寄存器的固定地址，例如，键盘的中断级别是1，并使用0x60至0x64的I/O地址，软盘控制器是中断6级并使用0x3F0至0x3F7的I/O地址，而打印机是中断7级并使用0x378至0x37A的I/O地址等。<p>比如，用户买了一块声卡和调制解调卡，并且它们都是可以使用中断4的，但此时，问题发生了，两块卡互相冲突，结果不能在一起工作。解决方案是在每块I/O卡上提供DIP开关或跳接器，并指导用户对其进行设置以选择中断级别和I/O地址，使其不会与用户系统的任何其他部件冲突。</blockquote><p><strong>即插即用所做的工作是，系统自动地收集有关I/O设备的信息，集中赋予中断级别和I/O地址，然后通知每块卡所使用的数值。</strong>这项工作与计算机的启动密切相关。<h2 id=1-4、启动计算机><a class=headerlink href=#1-4、启动计算机 title=1.4、启动计算机></a>1.4、启动计算机</h2><p><strong>环境描述如下</strong>：<p>在每个Pentium上有一块双亲板（在政治上的纠正影响到计算机产业之前，它们曾称为“母板”）。在双亲板上有一个称为基本输入输出系统（Basic Input Output System，BIOS）的程序。在BIOS内有底层I/O软件，包括读键盘、写屏幕、进行磁盘I/O以及其他过程。现在这个程序存放在一块闪速RAM中，它是非可易失性的，但是在发现BIOS中有错时可以通过操作系统对它进行更新。<p><strong>Pentium启动过程可简单描述如下</strong>：<ol><li><p>计算机启动，BIOS开始运行。</p> <ol><li>首先检查安装的RAM数量，键盘和其他基本设备是否已安装并正常响应。<li>扫描ISA和PCI总线并找出连在上面的所有设备。其中有些是遗留设备，且有固定的中断级别和I/O地址。即插即用设备也被记录下来。如果现有设备 与 系统上一次启动时的设备不同，则配置新设备。</ol><li><p>BIOS尝试在CMOS存储器中的设备清单中来决定启动设备。</p> <p>用户可以在系统刚启动之后进入一个BIOS配置程序，对设备清单进行修改。典型地，如果存在软盘，则系统试图从软盘启动。如果失败则试用CD-ROM，看看是否有可启动CD-ROM存在。如果软盘和CD-ROM都没有，系统从硬盘启动。启动设备上的第一个扇区被读入内存并执行。这个扇面中包含一个对保存在启动扇面末尾的分区表检查的程序，以确定哪个分区是活动的。然后，从该分区读入第二个启动装载模块。来自活动分区的这个装载模块被读入操作系统，并启动之。</p><li><p>操作系统询问BIOS获得配置信息。</p> <p>对于每种设备，系统检查对应的设备驱动程序是否存在。如果没有，系统要求用户插入含有该设备驱动程序的CD-ROM（由设备供应商提供）。一旦有了全部的设备驱动程序，操作系统就将它们调入内核。然后初始化有关表格，创建需要的任何背景进程，并在每个终端上启动登录程序或GUI。</p></ol></div><footer class=post-footer><div class=post-eof></div></footer></article></div><div class=post-block><article class=post-content itemscope itemtype=http://schema.org/Article><link href=https://hshz21.gitee.io/2024/08/21/%E6%B6%88%E6%81%AF%E4%B8%AD%E9%97%B4%E4%BB%B6%E5%AF%B9%E6%AF%94%E6%80%BB%E7%BB%93/ itemprop=mainEntityOfPage><span hidden itemprop=author itemscope itemtype=http://schema.org/Person> <meta content=/static/imgs/avatar.png itemprop=image> <meta content=豪哥 itemprop=name> </span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization> <meta content=豪哥博客 itemprop=name> <meta content=豪哥博客 itemprop=description> </span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork> <meta content="undefined | 豪哥博客" itemprop=name> <meta itemprop=description> </span><header class=post-header><h2 itemprop="name headline" class=post-title><a class=post-title-link href=/2024/08/21/%E6%B6%88%E6%81%AF%E4%B8%AD%E9%97%B4%E4%BB%B6%E5%AF%B9%E6%AF%94%E6%80%BB%E7%BB%93/ itemprop=url>消息队列系列-消息队列框架对比</a></h2><div class=post-meta-container><div class=post-meta><span class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-calendar"></i> </span> <span class=post-meta-item-text>发表于</span> <time itemprop="dateCreated datePublished" title="创建时间：2024-08-21 21:39:15" datetime=2024-08-21T21:39:15+08:00>2024-08-21</time> </span><span class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-calendar-check"></i> </span> <span class=post-meta-item-text>更新于</span> <time title="修改时间：2023-08-07 10:07:54" datetime=2023-08-07T10:07:54+08:00 itemprop=dateModified>2023-08-07</time> </span><span class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-folder"></i> </span> <span class=post-meta-item-text>分类于</span> <span itemprop=about itemscope itemtype=http://schema.org/Thing> <a href=/categories/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/ itemprop=url rel=index><span itemprop=name>消息队列</span></a> </span> </span></div></div></header><div class=post-body itemprop=articleBody><h1 id=消息中间件使用场景><a class=headerlink href=#消息中间件使用场景 title=消息中间件使用场景></a>消息中间件使用场景</h1><h2 id=削峰填谷><a class=headerlink href=#削峰填谷 title=削峰填谷></a>削峰填谷</h2><h2 id=解耦><a class=headerlink href=#解耦 title=解耦></a>解耦</h2><h2 id=广播><a class=headerlink href=#广播 title=广播></a>广播</h2><h2 id=最终一致性><a class=headerlink href=#最终一致性 title=最终一致性></a>最终一致性</h2><h1 id=消息中间件优劣总结><a class=headerlink href=#消息中间件优劣总结 title=消息中间件优劣总结></a>消息中间件优劣总结</h1><h2 id=RabbitMQ><a class=headerlink href=#RabbitMQ title=RabbitMQ></a>RabbitMQ</h2><p><strong>RabbitMQ 发布于 2007年，基于AMQP（高级消息队列协议）设计而成的可复用企业消息系统。</strong><p>优点：<ol><li>由于erlang语言的特性，mq 性能较好，支持高并发；<li>吞吐量到万级，MQ功能比较完备；<li>健壮、稳定、易用、跨平台、支持多种语言、文档齐全；<li>开源提供的管理界面非常棒，用起来很好用；<li>社区活跃度高；</ol><p>缺点：<ol><li>通过erlang语言开发，源码难以理解，不利于做二次开发和维护，只能依赖于开源社区。<li>RabbitMQ吞吐量较低，因为它的实现机制较重。<li>需要学习比较复杂的接口和协议，学习和维护成本较高。</ol><h2 id=RocketMQ><a class=headerlink href=#RocketMQ title=RocketMQ></a>RocketMQ</h2><p><strong>RocketMQ 是 阿里参考kafka后基于 Java 语言开发的一个消息中间件。</strong><p>RocketMQ是一个分布式开源消息中间件，前身是MetaQ，是阿里参考Kafka后研发的一个消息中间件，后开源给apache基金会成为了apache顶级开源项目，具有高性能、高可靠、高实时、分布式等特点。<p>优点：<ol><li>单机吞吐量：十万级；<li>可用性：非常高，分布式架构；<li>消息可靠性：经过参数优化配置，消息可以做到0丢失；<li>功能支持：MQ功能较完善，属于分布式结构，扩展性好；<li>消息堆积：支持10亿级别的消息堆积，不会因为堆积导致性能下降；<li>底层源码：通过Java语言开发设计而成，便于理解和二次开发；</ol><p>缺点：<ol><li>社区活跃度一般；<li>客户端语言支持度不大，主要支持 Java 和 C++；<li>MQ核心中没有实现 JMS 接口，个别系统迁移需要修改大量代码；</ol><h2 id=KafKa><a class=headerlink href=#KafKa title=KafKa></a>KafKa</h2><p>可达百万级TPS，为大数据而生。在数据采集、传输、存储等过程中发挥着重要作用。<p><strong>Apache Kafka 是 LinkedIn公司开发的一个分布式日志提交系统，后成为Apache项目的一部分。</strong><p>优点：<ol><li>TPS：单机可达百万TPS，吞吐量高；<li>时效性：ms（毫秒）级；<li>可用性：分布式架构，可用性较高；<li>获取消息：消费者采用Pull方式获取消息，可保证消息有序，同时可保证所有消息都被消费且仅被消费一次；<li>管理界面：有第三方优秀的界面管理工具Kafka-Manager；<li>客户量：日志领域较成熟，已被多家公司和多个开源项目使用；<li>功能支持：功能较简单，主要支持MQ功能，在大数据实时计算以及日志采集等方面已有大量应用；</ol><p>缺点：<ol><li>Kafka单机超过64个队列/分区时会导致Load发生明显飙高现象，队列越多，load越高，发送消息响应时间越长；<li>使用短轮询方式，实时性取决于轮询间隔时间；<li>消费失败后不支持重试；<li>支持消息顺序，但是一台代理宕机后，就会产生消息乱序；<li>社区更新较慢；</ol><h2 id=ActiveMQ><a class=headerlink href=#ActiveMQ title=ActiveMQ></a>ActiveMQ</h2><p>优点：<ul><li>单机吞吐量：万级；<li>topic数量都吞吐量的影响；<li>时效性：ms级（毫秒级）；<li>可用性：高，基于主从架构实现高可用性；<li>消息可靠性：有较低的概率丢失数据；<li>功能支持：MQ领域的功能极其完备；</ul><p>缺点：<p>官方社区现在对 ActiveMQ 5.x 维护越来越少，客户量较少。<h1 id=KafKa和RabbitMQ的区别><a class=headerlink href=#KafKa和RabbitMQ的区别 title=KafKa和RabbitMQ的区别></a>KafKa和RabbitMQ的区别</h1><h2 id=语言不同><a class=headerlink href=#语言不同 title=语言不同></a>语言不同</h2><ul><li>RabbitMQ：由高并发语言 erlanng 开发而成，适用于 可靠性要求较高 的场景。<li>KafKa：由 Scala 语言开发而成，适用于 处理大量活跃流式数据的场景。</ul><h2 id=架构不同><a class=headerlink href=#架构不同 title=架构不同></a>架构不同</h2><p>producer、broker、consumer<ul><li><p>RabbitMQ：以 broker 为中心，有消息确认机制。</p><li><p>KafKa：以 consumer 为中心，无消息确认机制。</p></ul><h2 id=Brokerr与Consume交互方式不同><a class=headerlink href=#Brokerr与Consume交互方式不同 title=Brokerr与Consume交互方式不同></a>Brokerr与Consume交互方式不同</h2><ul><li>RabbitMQ 采用 push（推）方式。<li>KafKa 采用 pull（拉）方式。</ul><h2 id=集群负载><a class=headerlink href=#集群负载 title=集群负载></a>集群负载</h2><ul><li><p>RabbitMQ：不支持负载均衡，需要 loadbalancer 支持。</p> <p>loadbalancer：是一个 请求转发、负载均衡工具。</p><li><p>KafKa：采用 Zookeeper 对集群中的 broker、consumer 进行管理。</p></ul><h2 id=适用场景><a class=headerlink href=#适用场景 title=适用场景></a>适用场景</h2><ul><li><p>RabbitMQ</p> <p>RabbitMQ支持 可靠传递消息、事务，但不支持批量操作；</p> <p>存储可采用内存或者硬盘。金融场景中经常使用。</p><li><p>KafKa</p> <p>KafKa支持 批量处理消息、zero-copy机制，且拥有高吞吐量；</p> <p>数据的存储和获取是 本地磁盘顺序批量操作，具有O(1)的复杂度（与分区上的存储大小无关），消息处理效率很高；</p></ul><h1 id=常见消息中间件对比><a class=headerlink href=#常见消息中间件对比 title=常见消息中间件对比></a>常见消息中间件对比</h1><table><thead><tr><th align=center><th align=center>ActiveMQ<th align=center>RabbitMQ<th align=center>RocketMQ<th align=center>KafKa<tbody><tr><td align=center>实现语言<td align=center>Java<td align=center>Erlang<td align=center>Java<td align=center>Scala<tr><td align=center>吞吐量<td align=center>万级<td align=center>万级<td align=center>十万级<td align=center>十万级<tr><td align=center>时效<td align=center>毫秒<td align=center>微秒<td align=center>毫秒<td align=center>毫秒<tr><td align=center>可用性<td align=center>高（主从）<td align=center>高（主从）<td align=center>非常高（分布式）<td align=center>非常高（分布式）<tr><td align=center>可靠性<td align=center>低概率丢失<td align=center>几乎0丢失<td align=center>几乎0丢失<td align=center>几乎0丢失<tr><td align=center>数据存储<td align=center>每个节点存储所有数据<td align=center>每个节点存储所有数据<td align=center>每个节点存储部分数据，且每个节点都有数据备份<td align=center>每个节点存储部分数据，且每个节点都有数据备份</table></div><footer class=post-footer><div class=post-eof></div></footer></article></div><div class=post-block><article class=post-content itemscope itemtype=http://schema.org/Article><link href=https://hshz21.gitee.io/2024/08/21/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95%E7%9F%A5%E8%AF%86%E7%82%B9%E6%80%BB%E7%BB%93/ itemprop=mainEntityOfPage><span hidden itemprop=author itemscope itemtype=http://schema.org/Person> <meta content=/static/imgs/avatar.png itemprop=image> <meta content=豪哥 itemprop=name> </span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization> <meta content=豪哥博客 itemprop=name> <meta content=豪哥博客 itemprop=description> </span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork> <meta content="undefined | 豪哥博客" itemprop=name> <meta itemprop=description> </span><header class=post-header><h2 itemprop="name headline" class=post-title><a class=post-title-link href=/2024/08/21/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95%E7%9F%A5%E8%AF%86%E7%82%B9%E6%80%BB%E7%BB%93/ itemprop=url>数据与算法系列-数据结构与算法</a></h2><div class=post-meta-container><div class=post-meta><span class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-calendar"></i> </span> <span class=post-meta-item-text>发表于</span> <time itemprop="dateCreated datePublished" title="创建时间：2024-08-21 21:39:15" datetime=2024-08-21T21:39:15+08:00>2024-08-21</time> </span><span class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-calendar-check"></i> </span> <span class=post-meta-item-text>更新于</span> <time title="修改时间：2023-10-06 10:25:57" datetime=2023-10-06T10:25:57+08:00 itemprop=dateModified>2023-10-06</time> </span><span class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-folder"></i> </span> <span class=post-meta-item-text>分类于</span> <span itemprop=about itemscope itemtype=http://schema.org/Thing> <a href=/categories/%E6%95%B0%E6%8D%AE%E4%B8%8E%E7%AE%97%E6%B3%95/ itemprop=url rel=index><span itemprop=name>数据与算法</span></a> </span> </span></div></div></header><div class=post-body itemprop=articleBody><h1 id=1、算法><a class=headerlink href=#1、算法 title=1、算法></a>1、算法</h1><p>算法指同一问题的不同解决方法。算法通常针对特定数据结构。<h2 id=1-1、排序算法><a class=headerlink href=#1-1、排序算法 title=1.1、排序算法></a>1.1、排序算法</h2><h3 id=1-1-1、内部排序（使用内存）><a class=headerlink href=#1-1-1、内部排序（使用内存） title=1.1.1、内部排序（使用内存）></a>1.1.1、内部排序（使用内存）</h3><h4 id=1-1-1-1、插入排序><a class=headerlink href=#1-1-1-1、插入排序 title=1.1.1.1、插入排序></a>1.1.1.1、插入排序</h4><ul><li>直接插入排序：将n个待排序元素看成一个有序表和一个无序表，第一次排序时，有序表中只有一个元素，无序表中有n-1个元素，接下来每次从无序表中拿出第一个元素，将它放入有序表的适当位置，使之依然序表。然后继续，直到排序完毕；<li>折半插入排序：是对直接插入排序算法的一种改进。与直接插入排序的区别是：在有序表中寻找待排序数据的正确位置时，使用了折半查找/二分查找。<li>希尔排序：希尔排序是将记录按下标的一定增量分组，对每组使用直接插入排序算法排序；随着增量逐渐减少，每组包含的关键词越来越多，当增量减至1时，整个文件恰被分成一组，算法便终止。</ul><h4 id=1-1-1-2、选择排序><a class=headerlink href=#1-1-1-2、选择排序 title=1.1.1.2、选择排序></a>1.1.1.2、选择排序</h4><p><strong>（1）简单选择排序</strong><p>每一轮只找最小值且放在最前面，下一轮在剩下的元素中再次寻找最小值并放于上一次找到的最小值右边，以此类推，直到全部比较完毕。<p><strong>（2）堆排序</strong><p>堆排序是一种选择排序，最坏，最好的平均时间复杂度均为O(nlogn)，它是不稳定排序。<p>堆是一个完全二叉树，特点是<strong>每个节点的值都大于或等于其左右孩子节点的值，称为大顶堆；或者每个节点的值都小于或等于其左右孩子节点的值，称为小顶堆</strong>。<p>堆排序逻辑如下：<ol><li>将无序序列构建成一个堆，根据 升序/降序 需求 选择 小顶堆或大顶堆；<li>将堆顶元素与末尾元素交换，将最大元素”沉”到数组末端；<li>重新调整结构，使其满足堆定义，然后继续交换堆顶元素与当前末尾元素，反复执行调整+交换步骤，直到整个序列有序；</ol><p>堆排序时间复杂度：<ul><li>平均时间复杂度：O(nlogn)<li>最好情况：O(nlogn)<li>最坏情况：O(nlogn)<li>空间复杂度：O(1)<li>稳定性：不稳定</ul><h4 id=1-1-1-3、交换排序><a class=headerlink href=#1-1-1-3、交换排序 title=1.1.1.3、交换排序></a>1.1.1.3、交换排序</h4><p><strong>（1）冒泡排序</strong><p>其逻辑是比较相邻的元素。如果第一个比第二个大，就交换他们两个。<p><strong>（2）快速排序</strong><p>快速排序是一种 排序执行效率很高的 排序算法，它利用分治法来对待排序序列进行分治排序。<p>它的思想是：以最后一位数字为关键字，拿待排序数组中的每个元素对比关键字进行一趟排序将待排记录分隔成独立的两部分，其中的一部分比关键字小，后面一部分比关键字大，然后再对这前后的两部分分别采用这种方式进行排序，通过递归的运算最终达到整个序列有序。<blockquote><p>快排之所以被称为“快”排，是因为它的平均时间是最短的，主要原因是硬件方面的，每趟快排需要指定一个“支点”（也就是作为分界点的值），一趟中涉及的所有比较都是与这个“支点”来进行比较的，那么我们可以把这个“支点”放在寄存器里，如此这般，效率自然大大提高。除此之外，快排的高效率与分治思想也是分不开的。</blockquote><h4 id=1-1-1-4、归并排序><a class=headerlink href=#1-1-1-4、归并排序 title=1.1.1.4、归并排序></a>1.1.1.4、归并排序</h4><p><strong>归并排序基于分治法</strong>，其思想是将待排序的元素序列分成两个相等的子序列，然后将子序列再次分割为两个子序列，一直分割到一个序列只有一个元素为止。然后比较相邻两个子序列中数据大小，将小的放左边，大的放右边，并将之合并为一个序列，以此类推，直到合并完成为止。<p><img alt=image-20200921145201640 src=https://raw.githubusercontent.com/lucky2shh/blog-haogeblogs-image/master/2023/08/05/image-20200921145201640.png?token=AIGEF3L2CI465XXEYEKL7IDEZZWVM><h4 id=1-1-1-5、基数排序><a class=headerlink href=#1-1-1-5、基数排序 title=1.1.1.5、基数排序></a>1.1.1.5、基数排序</h4><p>基数排序（radix sort）属于“分配式排序”（distribution sort），又称“桶子法”（bucket sort）或bin sort，顾名思义，它是通过键值的各个位的值，将要排序的元素分配至某些“桶”中，从而达到排序的作用，基数排序法是属于稳定性的排序。<h3 id=1-1-2、外部排序><a class=headerlink href=#1-1-2、外部排序 title=1.1.2、外部排序></a>1.1.2、外部排序</h3><h2 id=1-2、查找算法><a class=headerlink href=#1-2、查找算法 title=1.2、查找算法></a>1.2、查找算法</h2><p>Java中常用的查找算法有四种。<h3 id=1-2-1、顺序（线性）查找><a class=headerlink href=#1-2-1、顺序（线性）查找 title=1.2.1、顺序（线性）查找></a>1.2.1、顺序（线性）查找</h3><h3 id=1-2-2、二分查找><a class=headerlink href=#1-2-2、二分查找 title=1.2.2、二分查找></a>1.2.2、二分查找</h3><p>每次拿到待查找元素数组的中间元素值且将数组分成两半（左半和右半），然后拿查找值与中间元素值比较，大了就以右半数组为基础做相同操作，小了就以左半数组为基础做相同操作，以此类推，直到找到为止。<h3 id=1-2-3、插值查找><a class=headerlink href=#1-2-3、插值查找 title=1.2.3、插值查找></a>1.2.3、插值查找</h3><p>二分查找的升级版，升级地方为求中间元素值的公式。<ul><li><p>二分查找 获取中间元素值的公式为：int mid = (left + right) / 2;</p><li><p>插值查找 获取中间元素值的公式为：int mid = left + (right - left)*(findVal - arr[left]) / (arr[right] - arr[left]);</p></ul><h3 id=1-2-4、斐波那契查找（黄金分割点查找）><a class=headerlink href=#1-2-4、斐波那契查找（黄金分割点查找） title=1.2.4、斐波那契查找（黄金分割点查找）></a>1.2.4、斐波那契查找（黄金分割点查找）</h3><p>其原理与前两种类似，仅仅<strong>改变了中间元素（mid）的位置</strong>，mid不再是中间或插值得到，而是位于黄金分割点附近，即：mid = low + F(k - 1) - 1; F代表斐波那契数列。<blockquote><p>斐波那契数列：{1,1,2,3,5,8,13,21,34,55}，发现数列的两个相邻数的比例无限接近0.618。</blockquote><h2 id=1-3、常用算法><a class=headerlink href=#1-3、常用算法 title=1.3、常用算法></a>1.3、常用算法</h2><h3 id=1-3-1、二分查找算法（非递归，关键字匹配）><a class=headerlink href=#1-3-1、二分查找算法（非递归，关键字匹配） title=1.3.1、二分查找算法（非递归，关键字匹配）></a>1.3.1、二分查找算法（非递归，关键字匹配）</h3><h4 id=1-3-1-1、简介><a class=headerlink href=#1-3-1-1、简介 title=1.3.1.1、简介></a>1.3.1.1、简介</h4><p><strong>二分查找也称 折半查找（Binary Search），是一种效率较高的查找方法</strong>。折半查找要求线性表必须采用顺序存储结构，而且表中元素按关键字有序排列。该算法时间复杂度可以表示O(h)=O(log2n)。<p>首先，假设表中元素是按升序排列，将表中间位置记录的<a href=https://baike.baidu.com/item/%E5%85%B3%E9%94%AE%E5%AD%97 rel=noopener target=_blank>关键字</a>与查找关键字比较，如果两者相等，则查找成功；否则利用中间位置记录将表分成前、后两个子表，如果中间位置记录的关键字大于查找关键字，则进一步查找前一子表，否则进一步查找后一子表。重复以上过程，直到找到满足条件的<a href=https://baike.baidu.com/item/%E8%AE%B0%E5%BD%95/1837758 rel=noopener target=_blank>记录</a>，使查找成功，或直到子表不存在为止，此时查找不成功。<h4 id=1-3-1-2、代码实现><a class=headerlink href=#1-3-1-2、代码实现 title=1.3.1.2、代码实现></a>1.3.1.2、代码实现</h4><figure class="highlight java"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br></pre><td class=code><pre><span class=line><span class=keyword>public</span> <span class=keyword>static</span> <span class=type>int</span> <span class="title function_">binarySearch</span><span class=params>(Integer[] srcArray, <span class=type>int</span> des)</span> {</span><br><span class=line>    <span class=comment>//定义初始最小、最大索引</span></span><br><span class=line>    <span class=type>int</span> <span class=variable>start</span> <span class=operator>=</span> <span class=number>0</span>;</span><br><span class=line>    <span class=type>int</span> <span class=variable>end</span> <span class=operator>=</span> srcArray.length - <span class=number>1</span>;</span><br><span class=line>    <span class=comment>//确保不会出现重复查找，越界</span></span><br><span class=line>    <span class=keyword>while</span> (start <= end) {</span><br><span class=line>        <span class=comment>//计算出中间索引值</span></span><br><span class=line>        <span class=type>int</span> <span class=variable>middle</span> <span class=operator>=</span> (end + start)>>><span class=number>1</span> ;<span class=comment>//防止溢出</span></span><br><span class=line>        <span class=keyword>if</span> (des == srcArray[middle]) {</span><br><span class=line>            <span class=keyword>return</span> middle;</span><br><span class=line>        <span class=comment>//判断下限</span></span><br><span class=line>        } <span class=keyword>else</span> <span class=keyword>if</span> (des < srcArray[middle]) {</span><br><span class=line>            end = middle - <span class=number>1</span>;</span><br><span class=line>        <span class=comment>//判断上限</span></span><br><span class=line>        } <span class=keyword>else</span> {</span><br><span class=line>            start = middle + <span class=number>1</span>;</span><br><span class=line>        }</span><br><span class=line>    }</span><br><span class=line>    <span class=comment>//若没有，则返回-1</span></span><br><span class=line>    <span class=keyword>return</span> -<span class=number>1</span>;</span><br><span class=line>}</span><br></pre></table></figure><h3 id=1-3-2、分治算法><a class=headerlink href=#1-3-2、分治算法 title=1.3.2、分治算法></a>1.3.2、分治算法</h3><h4 id=1-3-2-1、简介><a class=headerlink href=#1-3-2-1、简介 title=1.3.2.1、简介></a>1.3.2.1、简介</h4><p>分治算法的基本思想是将一个规模为N的问题分解为K个规模较小的子问题，这些子问题相互独立且与原问题性质相同。求出子问题的解就可得到原问题的解。即一种分割目标完成计算的算法，简单问题可用二分法完成。<h4 id=1-3-2-2、解题步骤><a class=headerlink href=#1-3-2-2、解题步骤 title=1.3.2.2、解题步骤></a>1.3.2.2、解题步骤</h4><p>分治法解题的一般步骤：<ol><li>分解，将要解决的问题划分成若干规模较小的同类问题；<li>求解，当子问题划分得足够小时，用较简单的方法解决；<li>合并，按原问题的要求，将子问题的解逐层合并构成原问题的解。</ol><h4 id=1-3-2-3、应用场景><a class=headerlink href=#1-3-2-3、应用场景 title=1.3.2.3、应用场景></a>1.3.2.3、应用场景</h4><p>运用分治策略解决的问题一般来说具有以下特点：<ol><li><p>原问题可以分解为多个子问题：</p> <p>这些子问题与原问题相比，只是问题的规模有所降低，其结构和求解方法与原问题相同或相似。</p><li><p>原问题在分解过程中，递归地求解子问题：</p> <p>由于递归都必须有一个终止条件，因此，当分解后的子问题规模足够小时，应能够直接求解。</p><li><p>在求解并得到各个子问题的解后：</p> <p>应能够采用某种方式、方法合并或构造出原问题的解。</p></ol><p>在分治策略中，由于子问题与原问题在结构和解法上的相似性，用分治方法解决的问题，大都采用了递归的形式。在各种排序方法中，如归并排序、堆排序、快速排序等，都存在有分治的思想。<h3 id=1-3-3、动态规划算法（求最优决策）><a class=headerlink href=#1-3-3、动态规划算法（求最优决策） title=1.3.3、动态规划算法（求最优决策）></a>1.3.3、动态规划算法（求最优决策）</h3><h4 id=13-3-1、简介><a class=headerlink href=#13-3-1、简介 title=13.3.1、简介></a>13.3.1、简介</h4><p>动态规划（Dynamic Programming，DP）是<a href=https://baike.baidu.com/item/%E8%BF%90%E7%AD%B9%E5%AD%A6/1559 rel=noopener target=_blank>运筹学</a>的一个分支，是求解<a href=https://baike.baidu.com/item/%E5%86%B3%E7%AD%96%E8%BF%87%E7%A8%8B/6714639 rel=noopener target=_blank>决策过程</a>最优化的过程。20世纪50年代初，美国数学家<a href=https://baike.baidu.com/item/%E8%B4%9D%E5%B0%94%E6%9B%BC/9239579 rel=noopener target=_blank>贝尔曼</a>（R.Bellman）等人在研究多阶段决策过程的优化问题时，提出了著名的 最优化原理，从而创立了动态规划。动态规划的应用极其广泛，包括工程技术、经济、工业生产、军事以及自动化控制等领域，并在背包问题、生产经营问题、资金管理问题、资源分配问题、最短路径问题和复杂系统可靠性问题等中取得了显著的效果。<p><strong>动态规划算法通常用于求解具有某种最优性质的问题</strong>。动态规划算法与<a href=https://baike.baidu.com/item/%E5%88%86%E6%B2%BB%E6%B3%95 rel=noopener target=_blank>分治法</a>类似，基本思想是 将待求解问题分解成若干个子问题，先求解子问题，然后根据 子问题的解 得到 原问题的解。与分治法不同的是，适合于用动态规划求解的问题，经分解得到子问题往往不是互相独立的。<h4 id=1-3-3-2、局限性><a class=headerlink href=#1-3-3-2、局限性 title=1.3.3.2、局限性></a>1.3.3.2、局限性</h4><p>动态规划对于解决多阶段决策问题的效果很明显，但是动态规划也有一定的局限性。首先，它没有统一的处理方法，必须根据问题的各种性质并结合一定的技巧来处理；另外当变量的维数增大时，总的计算量及存贮量急剧增大。因而，受计算机的存贮量及计算速度的限制，当今的计算机仍不能用动态规划方法来解决较大规模的问题，这就是“维数障碍”。<h3 id=1-3-4、暴力匹配算法（字符串匹配）><a class=headerlink href=#1-3-4、暴力匹配算法（字符串匹配） title=1.3.4、暴力匹配算法（字符串匹配）></a>1.3.4、暴力匹配算法（字符串匹配）</h3><h4 id=1-3-4-1、简介><a class=headerlink href=#1-3-4-1、简介 title=1.3.4.1、简介></a>1.3.4.1、简介</h4><p>暴力匹配的思想：假设下标<code>i</code>指向字符串<code>str1</code>，下标<code>j</code>指向字符串<code>str2</code>，则有如下规律：<ol><li>如果str1[i] = str2[j]，则i++，j++。<li>如果str1[i] != str2[j]，则令i = i - (j - 1)，j = 0。</ol><h4 id=1-3-4-2、缺点><a class=headerlink href=#1-3-4-2、缺点 title=1.3.4.2、缺点></a>1.3.4.2、缺点</h4><p><strong>暴力破解会有大量的回溯</strong>，每次只移动一位，若不匹配则移动到下一位接着判断，浪费了大量时间。为了优化就诞生了KMP算法。<h3 id=1-3-5、KMP算法（字符串匹配）><a class=headerlink href=#1-3-5、KMP算法（字符串匹配） title=1.3.5、KMP算法（字符串匹配）></a>1.3.5、KMP算法（字符串匹配）</h3><h4 id=1-3-5-1、简介><a class=headerlink href=#1-3-5-1、简介 title=1.3.5.1、简介></a>1.3.5.1、简介</h4><p><strong>KMP算法是一种改进的字符串匹配算法</strong>，由D.E.Knuth，J.H.Morris和V.R.Pratt提出的，因此人们称它为克努特—莫里斯—普拉特操作（简称KMP算法）。KMP算法的核心是利用匹配失败后的信息，尽量减少模式串与主串的匹配次数以达到快速匹配的目的。具体实现就是通过一个next()函数实现，函数本身包含了模式串的局部匹配信息。KMP算法的 时间复杂度为 <code>O(m+n) [1]</code> 。<h4 id=1-3-5-2、模式匹配类型><a class=headerlink href=#1-3-5-2、模式匹配类型 title=1.3.5.2、模式匹配类型></a>1.3.5.2、模式匹配类型</h4><ol><li>精确匹配<li>近似匹配</ol><h4 id=1-3-5-3、部分匹配表><a class=headerlink href=#1-3-5-3、部分匹配表 title=1.3.5.3、部分匹配表></a>1.3.5.3、部分匹配表</h4><p><img alt=image-20200919141327620 src=https://raw.githubusercontent.com/lucky2shh/blog-haogeblogs-image/master/2023/08/05/image-20200919141327620.png?token=AIGEF3JMQBUJFREE6ZNIL5DEZZWXE><p>由表可得：移动位数 = 已匹配的字符数 + 对应的部分匹配值。<h3 id=1-3-6、贪心算法（局部最优解）><a class=headerlink href=#1-3-6、贪心算法（局部最优解） title=1.3.6、贪心算法（局部最优解）></a>1.3.6、贪心算法（局部最优解）</h3><h4 id=1-3-6-1、简介><a class=headerlink href=#1-3-6-1、简介 title=1.3.6.1、简介></a>1.3.6.1、简介</h4><p><strong>贪心算法（又称贪婪算法）是指，在对问题求解时，总是做出在当前看来是最好的选择。也就是说，不从整体最优上加以考虑，算法得到的是在某种意义上的局部最优解</strong>。<p>贪心算法不是对所有问题都能得到整体最优解，关键是贪心策略的选择。也就是说，不从整体最优上加以考虑，做出的只是在某种意义上的局部最优解。<h3 id=1-3-7、普利姆算法（Prim，稠密图最小生成树）><a class=headerlink href=#1-3-7、普利姆算法（Prim，稠密图最小生成树） title=1.3.7、普利姆算法（Prim，稠密图最小生成树）></a>1.3.7、普利姆算法（Prim，稠密图最小生成树）</h3><h4 id=1-3-7-1、简介><a class=headerlink href=#1-3-7-1、简介 title=1.3.7.1、简介></a>1.3.7.1、简介</h4><p>普利姆(Prim)算法求最小生成树，也就是在包含n个顶点的连通图中，找出只有(n-1)条边包含所有n个顶点的连通子图，也就是所谓的极小连通子图。<p>例如，通过普里姆算法查找下图的最小生成树的步骤为：<ol><li><p>假如从顶点A出发，顶点 B、C、D 到顶点 A 的权值分别为 2、4、2，所以，对于顶点 A 来说，顶点 B 和顶点 D 到 A 的权值最小，假设先找到的顶点 B：</p> <p><img alt=image-20200920084320304 src=https://raw.githubusercontent.com/lucky2shh/blog-haogeblogs-image/master/2023/08/05/image-20200920084320304.png?token=AIGEF3IZHFXIYNI4L5HLUBLEZZWYU></p><li><p>继续分析顶点 C 和 D，顶点 C 到 B 的权值为 3，到 A 的权值为 4；顶点 D 到 A 的权值为 2，到 B 的权值为无穷大（如果之间没有直接通路，设定权值为无穷大）。所以顶点 D 到 A 的权值最小：</p> <p><img alt=image-20200920084352501 src=https://raw.githubusercontent.com/lucky2shh/blog-haogeblogs-image/master/2023/08/05/image-20200920084352501.png?token=AIGEF3LLQKIYVMKSWL5RUP3EZZWZY></p><li><p>最后，只剩下顶点 C，到 A 的权值为 4，到 B 的权值和到 D 的权值一样大，为 3。所以该连通图有两个最小生成树：</p> <p><img alt=image-20200920084435924 src=https://raw.githubusercontent.com/lucky2shh/blog-haogeblogs-image/master/2023/08/05/image-20200920084435924.png?token=AIGEF3OD2D3UJQXOLJPN4MDEZZW3O></p></ol><h4 id=1-3-7-2、总结><a class=headerlink href=#1-3-7-2、总结 title=1.3.7.2、总结></a>1.3.7.2、总结</h4><p>普利姆算法求最小生成树，是从顶点方面考虑，存在两重遍历(已访问顶点集和未访问顶点集)，对应的还有一个克鲁斯卡尔算法求最小生成树，是从边的角度出发考虑的。根据各自算法特性，可以粗略的判断出，把稠密图看作边集相对于点集数量级比较大，稀疏图看作点集相对于边集较大，则普利姆算法适合于计算稠密图，克鲁斯卡尔算法适合于计算稀疏图。<h3 id=1-3-8、克鲁斯卡尔算法（Kruskal，稀疏图最小生成树）><a class=headerlink href=#1-3-8、克鲁斯卡尔算法（Kruskal，稀疏图最小生成树） title=1.3.8、克鲁斯卡尔算法（Kruskal，稀疏图最小生成树）></a>1.3.8、克鲁斯卡尔算法（Kruskal，稀疏图最小生成树）</h3><h4 id=1-3-8-1、简介><a class=headerlink href=#1-3-8-1、简介 title=1.3.8.1、简介></a>1.3.8.1、简介</h4><p><strong>克鲁斯卡尔算法是求连通网的最小生成树的另一种方法</strong>。与普里姆算法不同，它的时间复杂度为O（e loge）（e为网中的边数），所以，适合于求边稀疏的网的最小生成树 [1] 。<h4 id=1-3-8-2、基本思想><a class=headerlink href=#1-3-8-2、基本思想 title=1.3.8.2、基本思想></a>1.3.8.2、基本思想</h4><p>克鲁斯卡尔（Kruskal）算法从另一途径求网的最小生成树。其基本思想是：假设连通网G=（V，E），令最小生成树的初始状态为只有n个顶点而无边的非连通图T=（V，{}），图中每个顶点自成一个连通分量。在E中选择代价最小的边，若该边依附的顶点分别在T中不同的连通分量上，则将此边加入到T中；否则，舍去此边而选择下一条代价最小的边。依此类推，直至T中所有顶点构成一个连通分量为止 [2] 。<h3 id=1-3-9、迪杰斯特拉算法（Dijkstra，最短路径）><a class=headerlink href=#1-3-9、迪杰斯特拉算法（Dijkstra，最短路径） title=1.3.9、迪杰斯特拉算法（Dijkstra，最短路径）></a>1.3.9、迪杰斯特拉算法（Dijkstra，最短路径）</h3><h4 id=1-3-9-1、简介><a class=headerlink href=#1-3-9-1、简介 title=1.3.9.1、简介></a>1.3.9.1、简介</h4><p>迪杰斯特拉算法(Dijkstra)是由荷兰计算机科学家<a href=https://baike.baidu.com/item/%E7%8B%84%E5%85%8B%E6%96%AF%E7%89%B9%E6%8B%89/2828872 rel=noopener target=_blank>狄克斯特拉</a>于1959 年提出，因此又叫<a href=https://baike.baidu.com/item/%E7%8B%84%E5%85%8B%E6%96%AF%E7%89%B9%E6%8B%89%E7%AE%97%E6%B3%95/6764865 rel=noopener target=_blank>狄克斯特拉算法</a>。是从一个顶点到其余各顶点的<a href=https://baike.baidu.com/item/%E6%9C%80%E7%9F%AD%E8%B7%AF%E5%BE%84 rel=noopener target=_blank>最短路径</a>算法，解决的是有权图中最短路径问题。迪杰斯特拉算法主要特点是从起始点开始，采用<a href=https://baike.baidu.com/item/%E8%B4%AA%E5%BF%83%E7%AE%97%E6%B3%95/5411800 rel=noopener target=_blank>贪心算法</a>的策略，每次遍历到始点距离最近且未访问过的顶点的邻接节点，直到扩展到终点为止。<p>Dijkstra算法通常有两种方式，一种用永久和临时标号方式，一种是用OPEN、CLOSE表的方式，这里均采用永久和临时标号方式。注意该算法要求图中不存在负权边。<h3 id=1-3-10、弗洛伊德算法（Floyd，最短路径）><a class=headerlink href=#1-3-10、弗洛伊德算法（Floyd，最短路径） title=1.3.10、弗洛伊德算法（Floyd，最短路径）></a>1.3.10、弗洛伊德算法（Floyd，最短路径）</h3><h4 id=1-3-10-1、简介><a class=headerlink href=#1-3-10-1、简介 title=1.3.10.1、简介></a>1.3.10.1、简介</h4><p><strong>Floyd算法又称为插点法</strong>，是一种利用<a href=https://baike.baidu.com/item/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/529408 rel=noopener target=_blank>动态规划</a>思想寻找给定<a href=https://baike.baidu.com/item/%E5%8A%A0%E6%9D%83%E5%9B%BE/10579361 rel=noopener target=_blank>加权图</a>中多源点之间<a href=https://baike.baidu.com/item/%E6%9C%80%E7%9F%AD%E8%B7%AF%E5%BE%84/6334920 rel=noopener target=_blank>最短路径</a>的算法，与Dijkstra算法类似。该算法名称以创始人之一、1978年<a href=https://baike.baidu.com/item/%E5%9B%BE%E7%81%B5%E5%A5%96/324645 rel=noopener target=_blank>图灵奖</a>获得者、斯坦福大学计算机科学系教授<a href=https://baike.baidu.com/item/%E7%BD%97%E4%BC%AF%E7%89%B9%C2%B7%E5%BC%97%E6%B4%9B%E4%BC%8A%E5%BE%B7/4903135 rel=noopener target=_blank>罗伯特·弗洛伊德</a>命名。<p>该算法也称为Floyd算法，Roy-Warshall算法，Roy-Floyd算法或WFI算法。<h4 id=1-3-10-2、算法过程><a class=headerlink href=#1-3-10-2、算法过程 title=1.3.10.2、算法过程></a>1.3.10.2、算法过程</h4><ol><li>从任意一条单边路径开始。所有两点之间的距离是边的权，如果两点之间没有边相连，则权为无穷大。<li>对于每一对顶点 u 和 v，看看是否存在一个顶点 w 使得从 u 到 w 再到 v 比已知的路径更短。如果是更新它。</ol><h4 id=1-3-10-3、时间-空间复杂度><a class=headerlink href=#1-3-10-3、时间-空间复杂度 title=1.3.10.3、时间/空间复杂度></a>1.3.10.3、时间/空间复杂度</h4><ul><li>时间复杂度：O(n^3)；<li>空间复杂度：O(n^2)；</ul><h4 id=1-3-10-4、优缺点><a class=headerlink href=#1-3-10-4、优缺点 title=1.3.10.4、优缺点></a>1.3.10.4、优缺点</h4><p>Floyd算法适用于APSP(All Pairs Shortest Paths，多源最短路径)，是一种动态规划算法，稠密图效果最佳，边权可正可负。此算法简单有效，由于三重循环结构紧凑，对于稠密图，效率要高于执行|V|次<a href=https://baike.baidu.com/item/Dijkstra%E7%AE%97%E6%B3%95 rel=noopener target=_blank>Dijkstra算法</a>，也要高于执行|V|次<a href=https://baike.baidu.com/item/SPFA%E7%AE%97%E6%B3%95 rel=noopener target=_blank>SPFA算法</a>。<ul><li>优点：容易理解，可以算出任意两个节点之间的最短距离，代码编写简单。<li>缺点：时间复杂度比较高，不适合计算大量数据。</ul><h3 id=1-3-11、骑士周游回溯算法><a class=headerlink href=#1-3-11、骑士周游回溯算法 title=1.3.11、骑士周游回溯算法></a>1.3.11、骑士周游回溯算法</h3><h4 id=1-3-11-1、简介><a class=headerlink href=#1-3-11-1、简介 title=1.3.11.1、简介></a>1.3.11.1、简介</h4><p>深度优先遍历+回溯+贪心。从初始位置startPoint开始，获取下一步能到达的所有位置，将它们添加到集合ArrayList< Point >中，根据它们下一步所能到达的位置的个数k对ArrayList< Point >中所有位置进行非递减排序，优先对k较小的位置进行遍历，若此路不通，则回溯。<h2 id=1-4、算法复杂度><a class=headerlink href=#1-4、算法复杂度 title=1.4、算法复杂度></a>1.4、算法复杂度</h2><h3 id=1-4-1、时间复杂度><a class=headerlink href=#1-4-1、时间复杂度 title=1.4.1、时间复杂度></a>1.4.1、时间复杂度</h3><p>度量一个程序执行时间的方法有两种：<ol><li>事前估算法<li>事后统计法</ol><h4 id=1-4-1-1、时间频度><a class=headerlink href=#1-4-1-1、时间频度 title=1.4.1.1、时间频度></a>1.4.1.1、时间频度</h4><p>**一个算法中语句执行次数称为 语句频度 或 时间频度，记为T(n)**。<h4 id=1-4-1-2、时间复杂度表示><a class=headerlink href=#1-4-1-2、时间复杂度表示 title=1.4.1.2、时间复杂度表示></a>1.4.1.2、时间复杂度表示</h4><ol><li>O(1)：常数时间，不论输入的数据规模有多大，算法都具有恒定的执行时间。<li>O(log n)：对数阶，二分搜索是一个该复杂度的一个经典例子。<li>O(n)：线性阶：数据的输入与算法的执行时间成正比。<li>O(n*log n)：线性对数阶，常见排序算法（归并、快排）都在该复杂度内。<li>O(n^2)：平方阶，嵌套循环通常会导致该复杂度。<li>O(n^3)：立方阶。<li>O(n^k)：k次方阶。<li>O(2^n)：指数时间。<li>O(n!)：阶乘时间。</ol><p><img alt=算法时间复杂度01 src=https://raw.githubusercontent.com/lucky2shh/blog-haogeblogs-image/master/2023/08/05/%E7%AE%97%E6%B3%95%E6%97%B6%E9%97%B4%E5%A4%8D%E6%9D%82%E5%BA%A601.jpg?token=AIGEF3PJUNGHWIOJSSI2YZ3EZZW5K><h3 id=1-4-2、空间复杂度><a class=headerlink href=#1-4-2、空间复杂度 title=1.4.2、空间复杂度></a>1.4.2、空间复杂度</h3><h4 id=1-4-2-1、简介><a class=headerlink href=#1-4-2-1、简介 title=1.4.2.1、简介></a>1.4.2.1、简介</h4><p>空间复杂度描述了算法在执行过程中额外使用的内存空间与输入数据量之间的关系。<p>1.4.2.2、空间复杂度类型<ul><li>O(1)：常量空间。算法使用固定规模的额外空间。<li>O(log n)：递归二分搜索中，堆栈调用深度是log n。<li>O(n)：线性空间。</ul><h3 id=1-4-3、Big-O><a title="1.4.3、Big O" class=headerlink href=#1-4-3、Big-O></a>1.4.3、Big O</h3><p><strong>Big O是描述算法复杂度的标号，通常使用Big O描述最坏情况下的运行时间或所需空间</strong>。<p><strong>Big O表示法的核心思想是关注主要部分，忽略常数、低次项等</strong>。比如，如果一个算法执行时间为 3n^2+4n+15，我们通常会说它的运行时间为O(n^2)，因为当n足够大时，低此项和常数的影响将变得微不足道。<p>Big O表示法为我们提供了一种评估算法效率的高级视角，使得我们能够快速比较不同算法在处理大数据量时的性能。<h3 id=1-4-4、总结><a class=headerlink href=#1-4-4、总结 title=1.4.4、总结></a>1.4.4、总结</h3><h4 id=排序算法-时间-空间复杂度-对比><a title="排序算法 时间/空间复杂度 对比" class=headerlink href=#排序算法-时间-空间复杂度-对比></a>排序算法 时间/空间复杂度 对比</h4><p><img alt=排序算法时间空间复杂度01 src=https://raw.githubusercontent.com/lucky2shh/blog-haogeblogs-image/master/2023/08/05/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95%E6%97%B6%E9%97%B4%E7%A9%BA%E9%97%B4%E5%A4%8D%E6%9D%82%E5%BA%A601.jpg?token=AIGEF3PCPFPUYKDIWGS3GKLEZZW7E><h1 id=2、数据结构><a class=headerlink href=#2、数据结构 title=2、数据结构></a>2、数据结构</h1><h2 id=2-1、简介><a class=headerlink href=#2-1、简介 title=2.1、简介></a>2.1、简介</h2><p>其英文称为：Data Structure，其表示存储数据的不同方式。<h2 id=2-2、分类><a class=headerlink href=#2-2、分类 title=2.2、分类></a>2.2、分类</h2><p>数据结构分为 <strong>线性结构 和 非线性结构</strong> 两大类。<h3 id=2-2-1、线性结构><a class=headerlink href=#2-2-1、线性结构 title=2.2.1、线性结构></a>2.2.1、线性结构</h3><p><strong>线性结构的特点是数据元素之间存在一对一的线性关系</strong>。即除了第一个和最后一个元素外，每个元素都有一个前驱和后继。<p>线性结构有两种存储结构：<ol><li><p>顺序存储结构：顺序存储的线性表称为顺序表，其中的元素是连续的：</p><li><p>链式存储结构：链式存储的线性表称为链表，其中的元素不一定是连续的，元素节点存放数据及相邻节点的地址信息：</p></ol><p>线性结构常见实现有：<ul><li><p><font color=orange>数组</font></p><li><p><font color=orange>队列</font>：队列是一个有序列表，遵循FIFO规则，可以用数组或链表来实现。</p> <p>队列是一种特殊操作受限的线性表，它只允许在表的前端（front，队头）执行删除操作，而在表的后端（rear，队尾）执行插入操作。</p> <p>队列中没有元素时，称为空队列。</p> <p>创建顺序队列结构必须为其静态分配或动态申请一片连续的存储空间，并设置两个指针进行管理。一个是队头指针front，它指向队头元素；另一个是队尾指针rear，它指向下一个入队元素的存储位置。</p> <p>队列采用FIFO(first in first out——先进先出)，数据插入到链表尾部，从头部开始读取数据。每次读取一个元素，释放一个元素。所谓的动态创建，动态释放。因而也不存在溢出等问题。由于链表由结构体间接而成，遍历也方便。（先进先出）。</p><li><p><font color=orange>链表</font></p><li><p><font color=orange>栈</font></p></ul><h3 id=2-2-2、非线性结构><a class=headerlink href=#2-2-2、非线性结构 title=2.2.2、非线性结构></a>2.2.2、非线性结构</h3><p><strong>非线性结构的特点是每个元素可能与多个其它元素连接，不仅仅是线性结构中的前驱和后继</strong>。<p>非线性结构通常使用指针或链接来表示元素之间的关系。<p>非线性结构常见实现有：<ol><li><p><font color=orange>树结构</font></p> <ol><li><p>二叉树</p> <ol><li><p>满二叉树：所有叶子节点都在同一层的二叉树称为：满二叉树。</p><li><p>完全二叉树：所有叶子节点在最后一层或者倒数第二层，且最后一层的叶子节点在左边连续，倒数第二层的叶子节点在右边连续，则我们称这样的二叉树为：完全二叉树。</p></ol><li><p>AVL树</p></ol><li><p><font color=orange>图结构</font></p></ol><h1 id=3、常见问题及应对><a class=headerlink href=#3、常见问题及应对 title=3、常见问题及应对></a>3、常见问题及应对</h1><h2 id=3-1、修路问题><a class=headerlink href=#3-1、修路问题 title=3.1、修路问题></a>3.1、修路问题</h2><p>最小生成树 + 普利姆算法<h2 id=3-2、最短路径问题><a class=headerlink href=#3-2、最短路径问题 title=3.2、最短路径问题></a>3.2、最短路径问题</h2><p>图 + 弗洛伊德算法<h2 id=3-3、汉诺塔问题><a class=headerlink href=#3-3、汉诺塔问题 title=3.3、汉诺塔问题></a>3.3、汉诺塔问题</h2><p>使用<strong>递归法</strong>可解决该问题。<p>汉诺塔问题是一个益智游戏，通常由3个柱子和一系列递减大小的盘子组成。初始时，所有盘子都在一个柱子上，目标是将它们移动到另一个柱子上，移动过程需要遵循两个规则：<ol><li>每次只能移动一个盘子。<li>大盘子不能放在小盘子上面。</ol><h2 id=3-4、八皇后问题><a class=headerlink href=#3-4、八皇后问题 title=3.4、八皇后问题></a>3.4、八皇后问题</h2><p>使用<strong>回溯法</strong>可解决该问题。<p>八皇后问题是一个经典问题，要求在8x8的棋盘上放置8个皇后，规则就是任何两个皇后都不能存在于同一行、同一列、同一对角线上。可以使用回溯法来解决这种问题。</div><footer class=post-footer><div class=post-eof></div></footer></article></div><div class=post-block><article class=post-content itemscope itemtype=http://schema.org/Article><link href=https://hshz21.gitee.io/2024/08/21/%E6%A0%91%E5%9E%8B%E7%BB%93%E6%9E%84%E7%9F%A5%E8%AF%86%E7%82%B9%E6%80%BB%E7%BB%93/ itemprop=mainEntityOfPage><span hidden itemprop=author itemscope itemtype=http://schema.org/Person> <meta content=/static/imgs/avatar.png itemprop=image> <meta content=豪哥 itemprop=name> </span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization> <meta content=豪哥博客 itemprop=name> <meta content=豪哥博客 itemprop=description> </span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork> <meta content="undefined | 豪哥博客" itemprop=name> <meta itemprop=description> </span><header class=post-header><h2 itemprop="name headline" class=post-title><a class=post-title-link href=/2024/08/21/%E6%A0%91%E5%9E%8B%E7%BB%93%E6%9E%84%E7%9F%A5%E8%AF%86%E7%82%B9%E6%80%BB%E7%BB%93/ itemprop=url>数据与算法系列-树结构</a></h2><div class=post-meta-container><div class=post-meta><span class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-calendar"></i> </span> <span class=post-meta-item-text>发表于</span> <time itemprop="dateCreated datePublished" title="创建时间：2024-08-21 21:39:15" datetime=2024-08-21T21:39:15+08:00>2024-08-21</time> </span><span class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-calendar-check"></i> </span> <span class=post-meta-item-text>更新于</span> <time title="修改时间：2023-10-06 09:36:43" datetime=2023-10-06T09:36:43+08:00 itemprop=dateModified>2023-10-06</time> </span><span class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-folder"></i> </span> <span class=post-meta-item-text>分类于</span> <span itemprop=about itemscope itemtype=http://schema.org/Thing> <a href=/categories/%E6%95%B0%E6%8D%AE%E4%B8%8E%E7%AE%97%E6%B3%95/ itemprop=url rel=index><span itemprop=name>数据与算法</span></a> </span> </span></div></div></header><div class=post-body itemprop=articleBody><h1 id=1、二叉排序树><a class=headerlink href=#1、二叉排序树 title=1、二叉排序树></a>1、二叉排序树</h1><h2 id=1-1、简介><a class=headerlink href=#1-1、简介 title=1.1、简介></a>1.1、简介</h2><p><strong>二叉排序树又称二叉查找树、二叉搜索树</strong>。是数据结构的一种。通常情况下，查询效率比链表要高。<h2 id=1-2、定义><a class=headerlink href=#1-2、定义 title=1.2、定义></a>1.2、定义</h2><p>空树，或拥有如下特点的二叉树：<ol><li>左子树上所有节点的值 均小于 根节点的值；<li>右子树上所有节点的值 均大于 根节点的值；<li>左、右子树也分别为二叉排序树；<li>没有键值相等的节点。</ol><h2 id=1-3、插入删除><a class=headerlink href=#1-3、插入删除 title=1.3、插入删除></a>1.3、插入删除</h2><p>与次优二叉树相对，二叉排序树是一种动态树表。特点是：树结构通常并非是一次生成，而是在查找过程中，当树中不存在关键字等于给定值的节点时再进行插入。新插入的节点一定是一个新添加的叶子节点，并且是查找不成功时查找路径上访问的最后一个节点的左孩子或右孩子节点。<h2 id=1-4、性能分析><a class=headerlink href=#1-4、性能分析 title=1.4、性能分析></a>1.4、性能分析</h2><p>每个节点的C(i) 就是 该节点的层次数。最坏情况下，当插入的关键字有序时，会形成单支树，树深为平均查找长度(n+1)/2（和顺序查找相同），最好情况就是 与折半查找相同，平均查找长度和log2(n)成正比。<p>**最好情况下时间复杂度为O(1)，最坏情况下时间复杂度为O(n)**。<h2 id=1-5、优化><a class=headerlink href=#1-5、优化 title=1.5、优化></a>1.5、优化</h2><p>使用其它数据结构代替，查找树复杂度均为O(log(n))。<ol><li>Size Balanced Tree(SBT)<li>AVL树<li>红黑树<li>Treap</ol><h1 id=2、AVL树><a class=headerlink href=#2、AVL树 title=2、AVL树></a>2、AVL树</h1><h2 id=2-1、简介><a class=headerlink href=#2-1、简介 title=2.1、简介></a>2.1、简介</h2><p><strong>AVL树是一种高效的自平衡二叉搜索树，它的特点在于它可以自动保持平衡</strong>。<blockquote><p>windows对进程地址空间的管理用到了 AVL树。</blockquote><h2 id=2-2、特点><a class=headerlink href=#2-2、特点 title=2.2、特点></a>2.2、特点</h2><p>AVL树本质上是二叉搜索树，其特点如下：<ol><li>是二叉搜索树。<li>带有平衡条件：每个节点的左右子树高度差绝对值（平衡因子）最大为1。</ol><h2 id=2-3、优缺点><a class=headerlink href=#2-3、优缺点 title=2.3、优缺点></a>2.3、优缺点</h2><h3 id=2-3-1、优点（严格平衡）><a class=headerlink href=#2-3-1、优点（严格平衡） title=2.3.1、优点（严格平衡）></a>2.3.1、优点（严格平衡）</h3><p><strong>AVL树是严格的平衡二叉树，所有节点的左右子树高度差不能超过1</strong>。<h3 id=2-3-2、缺点（旋转耗时）><a class=headerlink href=#2-3-2、缺点（旋转耗时） title=2.3.2、缺点（旋转耗时）></a>2.3.2、缺点（旋转耗时）</h3><p>AVL的平衡得益于旋转操作：插入和删除可能会破坏二叉树的平衡，此时需要旋转 。<p>插入操作最多需要1次旋转（单旋转或双旋转）；删除节点需要维护从被删节点到根节点路径上所有节点的平衡，旋转复杂度为O(log n)。<p>因旋转耗时，故删除数据效率很低；删除操作较多时，维护平衡所需的代价可能高于其带来的好处，因此AVL实际使用并不广泛。<h1 id=3、红黑树><a class=headerlink href=#3、红黑树 title=3、红黑树></a>3、红黑树</h1><h2 id=3-1、简介><a class=headerlink href=#3-1、简介 title=3.1、简介></a>3.1、简介</h2><p><strong>红黑树（Red Black Tree） 是一种自平衡二叉查找树，是一种常用的数据结构，主要用于实现关联数组</strong>。<p>红黑树是一种特化版AVL树，插入、删除时可通过变换节点颜色来保持树平衡，进而获得高性能。<p>红黑树虽复杂，但最坏情况下其表现也很好。<strong>可在 O(log n，n是树中元素的数量) 时间内实现查找、插入和删除</strong>。<h2 id=3-2、特征><a class=headerlink href=#3-2、特征 title=3.2、特征></a>3.2、特征</h2><ol><li>节点不是红色就是黑色。<li>根节点是黑色；所有叶子节点是NUll节点且是黑色；<li>红色节点的两个子节点是黑色；红色节点不能相邻。<li>从根节点到任意一个叶子节点，路径中的黑色节点数量都一样。</ol><h2 id=3-3、使用场景><a class=headerlink href=#3-3、使用场景 title=3.3、使用场景></a>3.3、使用场景</h2><p><strong>红黑树多用于内部排序，即全放在内存中，STL的 map 和 set 内部实现就是红黑树</strong>。<h2 id=3-4、应用><a class=headerlink href=#3-4、应用 title=3.4、应用></a>3.4、应用</h2><ol><li><p><strong>在Linux非实时任务调度中的应用</strong></p> <p>Linux 的稳定内核版本在 2.6.24 之后，使用了新的调度程序 CFS，所有非实时可运行进程都以虚拟运行时间为 key 值挂在一棵红黑树上，以完成更公平高效地调度所有任务。CFS 弃用 active /expired 数组和动态计算优先级，不再跟踪任务的睡眠时间和区别是否交互任务，并且在调度中采用基于时间计算键值的红黑树来选取下一个任务，根据所有任务占用 CPU 时间的状态来确定调度任务优先级。</p><li><p><strong>在Linux虚拟内存中的应用</strong></p> <p>32 位 Linux 内核虚拟地址空间划分 0 － 3G 为用户空间，3 － 4G 为内核空间，因此每个进程可以使用 4GB的虚拟空间。同时，Linux 定义了虚拟存储区域( VMA) 以便于更好表示进程所使用的虚拟空间，每个 VMA是某个进程的一段连续虚拟空间，其中的单元具有相同的特征，所有的虚拟区域按照地址排序由指针链接为一个链表。当发生缺页中断时搜索 VMA 到指定区域时，则需要频繁操作，因此选用了红黑树以减少查找时间。</p><li><p><strong>在检测树平衡性上的应用</strong></p> <p>红黑树是一种自平衡二叉搜索树，它的每个节点都被“着色”为红色或者黑色，这些节点的颜色被用来检测树的平衡性。红黑树作为嵌入式数据库中的索引机制，可以获得更好的性能，对于SQLite数据库，可以采用红黑树实现索引机制的优化。</p></ol><h2 id=3-5、数据结构><a class=headerlink href=#3-5、数据结构 title=3.5、数据结构></a>3.5、数据结构</h2><p>红黑树 统计性能 要优于平衡二叉树。目前，红黑树已广泛应用于Linux 进程管理、内存管理，设备驱动、虚拟内存跟踪等场景。<h2 id=3-6、优缺点><a class=headerlink href=#3-6、优缺点 title=3.6、优缺点></a>3.6、优缺点</h2><h3 id=3-6-1、优点><a class=headerlink href=#3-6-1、优点 title=3.6.1、优点></a>3.6.1、优点</h3><ol><li><strong>红黑树不追求严格平衡：只需保证根到叶子的最长路径长度不超过最短路径的2倍</strong>。<li><strong>红黑树删除效率较高</strong>，因O(1)次数的旋转及变色就能保证基本平衡，无需像AVL树一样进行O(lgn)次的旋转。<li><strong>红黑树适用于内存操作场景。其统计性能高于AVL树</strong>。</ol><h3 id=3-6-2、缺点（树太高）><a class=headerlink href=#3-6-2、缺点（树太高） title=3.6.2、缺点（树太高）></a>3.6.2、缺点（树太高）</h3><ol><li><p>较AVL数来说，红黑树查询效率差，因为树平衡性较差，高度更高。</p><li><p>对于磁盘等辅助存储设备中数据的操作来说（如 MySQL），红黑树并不擅长，因为红黑树高度太高。</p> <blockquote><p>当数据在磁盘中时，磁盘IO会成为最大性能瓶颈；树高度越高，IO次数也会越多，性能影响也会越严重。</blockquote></ol><h1 id=4、B树><a class=headerlink href=#4、B树 title=4、B树></a>4、B树</h1><h2 id=4-1、简介><a class=headerlink href=#4-1、简介 title=4.1、简介></a>4.1、简介</h2><p>B-树 查找关键字 方法是：先拿到 根节点 ，在根节点 所包含的关键字K1,…,Kn中 查找给定关键字（可用顺序查找或二分查找法）。若找到关键字就表示查找成功；否则，一定可以确定要查找的关键字在Ki与Ki+1之间，拿到 指针Pi 指向的节点 继续查找，直至找到，指针Pi为空时查找失败。（Pi为指向子树根节点的指针）<h2 id=4-2、定义><a class=headerlink href=#4-2、定义 title=4.2、定义></a>4.2、定义</h2><p><strong>1970年，R.Bayer和E.mccreight提出了一种平衡多叉树，称为B树（或B-树、B_树）</strong>。<p>一棵 m 阶 B树 是一棵平衡的m路搜索树。它可能是空树，也可能是如下特点的树：<ol><li>根节点至少有两个子女；<li>每个 非根节点 所包含的关键字个数 j 满足：┌m/2┐ - 1 <= j <= m - 1；<li>除根节点以外的所有节点（不包括叶子节点）的度数正好是关键字总数加1，故内部子树个数 k 满足：┌m/2┐ <= k <= m ；<li>所有叶子节点都位于同一层。</ol><p>B-树每个节点中的关键字从小到大排列，且当该节点的孩子是非叶子节点时，该k-1个关键字正好是k个孩子包含的关键字的值域的分划。<p>因为叶子节点不包含关键字，所以可以把叶子节点看成在树里实际上并不存在外部节点，指向这些外部节点的指针为空，叶子节点的数目正好等于树中所包含的关键字总个数加1。<p>B-树中的一个包含n个关键字，n+1个指针的节点的一般形式为：（n、P0、K1、P1、K2、P2,…,Kn、Pn）。<p>其中，Ki为关键字，K1&LTK2<…&LTKn, Pi 是指向包括Ki到Ki+1之间的关键字的子树的指针。<h2 id=4-3、性能分析><a class=headerlink href=#4-3、性能分析 title=4.3、性能分析></a>4.3、性能分析</h2><p>设B-树包含N个关键字，因此有N+1个叶子节点，叶子都在第I层。因为根至少有两个孩子，因此第二层至少有两个节点。除根和叶子外，其它节点至少有┌m/2┐个孩子，因此在第三层至少有2<em>┌m/2┐个节点，在第四层至少有2</em>(┌m/2┐^2)个节点，．．．，在第I层至少有2*(┌m/2┐^(l-2) )个节点，于是有：<p>N+1 ≥ 2*┌m/2┐I-2<p>考虑第L层的节点个数为N+1，那么2*(┌m/2┐^(l-2)）≤N+1，也就是L层的最少节点数刚好达到N+1个。<p>即： I≤ log┌m/2┐((N+1)/2 )+2<p>所以，当B-树包含N个关键字时，B-树最大高度为l-1（因为计算B-树高度时，叶节点所在层不计算在内）。<p>即：log┌m/2┐((N+1)/2 )+1。<p>这个公式保证了B-树 较高 的查询率。<h2 id=4-4、优缺点><a class=headerlink href=#4-4、优缺点 title=4.4、优缺点></a>4.4、优缺点</h2><h3 id=4-4-1、优点><a class=headerlink href=#4-4-1、优点 title=4.4.1、优点></a>4.4.1、优点</h3><ol><li><strong>B树适用于磁盘等辅存设备</strong>，B树每个非叶节点可以有多个子树，降低了树的高度。<li><strong>B树提供了局部性访问</strong>。换句话说，B树缓存命中率更高。（局部性原理是指：一个数据被使用时其附近数据有较大概率在短时间内被使用。B树会将相邻数据存储在同一节点，当访问其中某个数据时会将整个节点读到缓存中；当相邻数据被访问时，可直接从缓存中读取，无需执行磁盘IO；）</ol><h3 id=4-4-2、缺点><a class=headerlink href=#4-4-2、缺点 title=4.4.2、缺点></a>4.4.2、缺点</h3><ol><li>仅适用于 磁盘存储操作 场景。<li>B树 叶子和非叶子节点 都存储数据，所以树高度还是会太高。<li>B树 叶子节点 没有指针连接，且叶子节点中的元素是无序排列。<li>不适合范围查询。</ol><h1 id=5、B-树><a class=headerlink href=#5、B-树 title=5、B+树></a>5、B+树</h1><h2 id=5-1、简介><a class=headerlink href=#5-1、简介 title=5.1、简介></a>5.1、简介</h2><p><strong>B+树通常用于数据库和操作系统的文件系统</strong>。<p>B+树 能够保持 数据稳定有序，插入、修改 拥有 稳定的 时间复杂度。B+树元素自底向上插入，这与二叉树恰好相反。<blockquote><p>B+ 树创造者 Rudolf Bayer 没有解释 B 代表什么。通常 B 代表平衡（balanced），因为所有叶子节点都在树的统一级别上。<em>B</em>也可能代表<em>Bayer</em>，或者是波音（Boeing），因为他曾经工作于波音科学研究实验室。</blockquote><p><strong>B+树适用于磁盘文件组织、数据索引和数据库索引</strong>。<h2 id=5-2、定义><a class=headerlink href=#5-2、定义 title=5.2、定义></a>5.2、定义</h2><p><strong>B+树叶子节点存储页号、行记录，非叶子节点作为索引使用</strong>。一棵m阶的B+树定义如下:<ol><li>每个节点至多有m个子女；<li>除根节点外，每个节点至少有[m/2]个子女，根节点至少有两个子女；<li>有k个子女的节点必有k个关键字。</ol><p>与B树的查找操作不同，B+树在 索引关键字与待找关键字匹配时并不停止查找，而会 沿着该关键字左边指针向下，一直找到该关键字所在的叶子节点为止。<h2 id=5-3、特征><a class=headerlink href=#5-3、特征 title=5.3、特征></a>5.3、特征</h2><p>B+树是B树的一种变形，比B树具有更广泛的应用，m阶 B+树 有如下特征:<ol><li>每个节点的关键字个数与孩子个数相等，所有非最下层的内层节点的关键字是对应子树上的最大关键字，最下层内部节点包含了全部关键字。 [3]<li>除根节点以外，每个内部节点有<img alt=img src=https://bkimg.cdn.bcebos.com/formula/b6d57d975fb784adc5203ddf01a692ee.svg>到m个孩子。<li>所有叶节点在树结构的同一层，并且不含任何信息(可看成是外部节点或查找失败的节点)，因此，树结构总是树高平衡的。</ol><h2 id=5-4、算法><a class=headerlink href=#5-4、算法 title=5.4、算法></a>5.4、算法</h2><h3 id=5-4-1、查找><a class=headerlink href=#5-4-1、查找 title=5.4.1、查找></a>5.4.1、查找</h3><p>查找以典型的方式进行，类似于二叉查找树。起始于根节点，自顶向下遍历树，选择其分离值在要查找值的任意一边的子指针。在节点内部典型的使用是二分查找来确定这个位置。<h3 id=5-4-2、插入><a class=headerlink href=#5-4-2、插入 title=5.4.2、插入></a>5.4.2、插入</h3><p>节点要处于违规状态，它必须包含在可接受范围之外数目的元素。<ol><li>首先，查找要插入其中的节点的位置。接着把值插入这个节点中。<li>如果没有节点处于违规状态则处理结束。<li>如果某个节点有过多元素，则把它分裂为两个节点，每个都有最小数目的元素。在树上递归向上继续这个处理直到到达根节点，如果根节点被分裂，则创建一个新根节点。为了使它工作，元素的最小和最大数目典型的必须选择为使最小数不小于最大数的一半。</ol><h3 id=5-4-3、删除><a class=headerlink href=#5-4-3、删除 title=5.4.3、删除></a>5.4.3、删除</h3><ol><li><p>首先，查找要删除的值。接着从包含它的节点中删除这个值。</p><li><p>如果没有节点处于违规状态则处理结束。</p><li><p>如果节点处于违规状态则有两种可能情况：</p> <ol><li>它的兄弟节点，就是同一个父节点的子节点，可以把一个或多个它的子节点转移到当前节点，而把它返回为合法状态。如果是这样，在更改父节点和两个兄弟节点的分离值之后处理结束。<li>它的兄弟节点由于处在低边界上而没有额外的子节点。在这种情况下把两个兄弟节点合并到一个单一的节点中，而且我们递归到父节点上，因为它被删除了一个子节点。持续这个处理直到当前节点是合法状态或者到达根节点，在其上根节点的子节点被合并而且合并后的节点成为新的根节点。</ol></ol><h2 id=5-5、优缺点><a class=headerlink href=#5-5、优缺点 title=5.5、优缺点></a>5.5、优缺点</h2><h3 id=5-5-1、优点><a class=headerlink href=#5-5-1、优点 title=5.5.1、优点></a>5.5.1、优点</h3><ol><li>B+树只会在叶子节点存储键值和数据，非叶子节点只存储键值和指针，而B树叶子和非叶子节点都会存储。<li>B+树叶子节点通过指针连接在一起且有序，而B树没有这个特性。<li>IO次数更少。<li>适合范围查询。<li>查询效率稳定。</ol><h3 id=5-5-2、缺点><a class=headerlink href=#5-5-2、缺点 title=5.5.2、缺点></a>5.5.2、缺点</h3><ol><li><font color=red>由于键会重复出现，因此会占用更多空间。</font>但是与带来的性能优势相比，空间劣势往往可以接受，因此B+树在数据库中的使用 较B树 更广泛。</ol><h2 id=5-6、使用场景><a class=headerlink href=#5-6、使用场景 title=5.6、使用场景></a>5.6、使用场景</h2><p>B+树多用于磁盘存储等场景。<h2 id=5-7、B树-VS-B-树><a title="5.7、B树 VS B+树" class=headerlink href=#5-7、B树-VS-B-树></a>5.7、B树 VS B+树</h2><p>B+树是应文件系统所需而产生的一种B树的变形树。m阶B+树 和 m阶B树 的区别是：<ol><li>有n棵子树的节点中含有n个关键码；<li>所有的叶子节点中包含了全部关键码的信息，及指向含有这些关键码记录的指针，且叶子节点本身依关键码的大小自小而大的顺序链接；<li>所有的非终端节点可以看成是索引部分，节点中仅含有其子树根节点中最大(或最小)关键码。</ol><h2 id=5-8、知识点扩展><a class=headerlink href=#5-8、知识点扩展 title=5.8、知识点扩展></a>5.8、知识点扩展</h2><p>MySQL中的表在被插入数据时，建议主键值是递增的，其目的是为了避免B+树节点的频繁分裂进而降低整体的性能。<h1 id=6、Trie树（字典树）><a class=headerlink href=#6、Trie树（字典树） title=6、Trie树（字典树）></a>6、Trie树（字典树）</h1><h2 id=6-1、简介><a class=headerlink href=#6-1、简介 title=6.1、简介></a>6.1、简介</h2><p>Trie树 又称 单词查找树，Trie树是一种树形结构，是一种 变种哈希树。通常用于统计、排序、保存大量字符串（但不仅限于字符串），所以经常被搜索引擎用于文本词频统计。优点是：<strong>利用字符串的公共前缀来减少查询时间，最大限度地减少字符串比较，查询效率比哈希树高</strong>。<h2 id=6-2、性质><a class=headerlink href=#6-2、性质 title=6.2、性质></a>6.2、性质</h2><ol><li>根节点不包含字符，其它节点都只包含一个字符；<li>从根节点到某一节点，路径上经过的字符连接起来，为该节点对应的字符串；<li>每个节点的所有子节点包含的字符都不相同。</ol><h2 id=6-3、基本操作><a class=headerlink href=#6-3、基本操作 title=6.3、基本操作></a>6.3、基本操作</h2><p>基本操作：查找、插入和删除，当然删除操作比较少见。<h2 id=6-4、实现方法><a class=headerlink href=#6-4、实现方法 title=6.4、实现方法></a>6.4、实现方法</h2><p>搜索字典项目的方法为：<ol><li>从根节点开始一次搜索；<li>取得要查找关键词的第一个字母，并根据该字母选择对应的子树并转到该子树继续进行检索；<li>在相应的子树上，取得要查找关键词的第二个字母,并进一步选择对应的子树进行检索。<li>迭代过程……<li>在某个节点处，关键词的所有字母已被取出，则读取附在该节点上的信息，即完成查找。</ol><p>其他操作类似处理。<h1 id=7、总结><a class=headerlink href=#7、总结 title=7、总结></a>7、总结</h1><h2 id=7-1、二叉查找树-BST><a class=headerlink href=#7-1、二叉查找树-BST title=7.1、二叉查找树(BST)></a>7.1、二叉查找树(BST)</h2><p>解决了排序的基本问题，但可能退化为链表；<h2 id=7-2、平衡二叉树-AVL><a class=headerlink href=#7-2、平衡二叉树-AVL title=7.2、平衡二叉树(AVL)></a>7.2、平衡二叉树(AVL)</h2><p>通过旋转可解决平衡问题，但旋转频率较高且效率太低；<h2 id=7-3、红黑树><a class=headerlink href=#7-3、红黑树 title=7.3、红黑树></a>7.3、红黑树</h2><p>解决了AVL旋转效率过低的问题，但红黑树在磁盘IO场景下，树仍然太高，IO次数太多；<h2 id=7-4、B树><a class=headerlink href=#7-4、B树 title=7.4、B树></a>7.4、B树</h2><p>将二叉树改为多路平衡查找树，解决了树过高问题；<h2 id=7-5、B-树><a class=headerlink href=#7-5、B-树 title=7.5、B+树></a>7.5、B+树</h2><p>在B树基础上将非叶子节点改造为索引节点，增加了节点的分支数量，进一步降低了树高；叶子节点使用指针连接成双向链表，范围查询更加高效。<h1 id=X、知识拓展><a class=headerlink href=#X、知识拓展 title=X、知识拓展></a>X、知识拓展</h1><h2 id=X-1、为什么MySQL索引使用B-树而不使用红黑树><a class=headerlink href=#X-1、为什么MySQL索引使用B-树而不使用红黑树 title=X.1、为什么MySQL索引使用B+树而不使用红黑树?></a>X.1、为什么MySQL索引使用B+树而不使用红黑树?</h2><p>B+树适用于文件存储IO。<p>数据库文件通常位于磁盘中，定位一行信息需要查找该文件所在柱面号，磁盘号，扇区号，页号等。一次请求要做一次IO，因此减少IO次数是提高性能的关键。<p>IO次数与索引树的高度有关，树越低查询次数越少。相同节点个数（个数为n）环境下，红黑树高度最高为<code>2log(n+1)</code>，B+树高度最高为<code>(log(n+1)/2)+1</code>，随着 n 增大B+树高度会更小，IO次数会更少。</div><footer class=post-footer><div class=post-eof></div></footer></article></div><div class=post-block><article class=post-content itemscope itemtype=http://schema.org/Article><link href=https://hshz21.gitee.io/2024/08/21/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E7%9F%A5%E8%AF%86%E7%82%B9%E6%80%BB%E7%BB%93/ itemprop=mainEntityOfPage><span hidden itemprop=author itemscope itemtype=http://schema.org/Person> <meta content=/static/imgs/avatar.png itemprop=image> <meta content=豪哥 itemprop=name> </span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization> <meta content=豪哥博客 itemprop=name> <meta content=豪哥博客 itemprop=description> </span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork> <meta content="undefined | 豪哥博客" itemprop=name> <meta itemprop=description> </span><header class=post-header><h2 itemprop="name headline" class=post-title><a class=post-title-link href=/2024/08/21/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E7%9F%A5%E8%AF%86%E7%82%B9%E6%80%BB%E7%BB%93/ itemprop=url>Java系列-设计模式</a></h2><div class=post-meta-container><div class=post-meta><span class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-calendar"></i> </span> <span class=post-meta-item-text>发表于</span> <time itemprop="dateCreated datePublished" title="创建时间：2024-08-21 21:39:14" datetime=2024-08-21T21:39:14+08:00>2024-08-21</time> </span><span class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-calendar-check"></i> </span> <span class=post-meta-item-text>更新于</span> <time title="修改时间：2023-10-05 16:13:04" datetime=2023-10-05T16:13:04+08:00 itemprop=dateModified>2023-10-05</time> </span><span class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-folder"></i> </span> <span class=post-meta-item-text>分类于</span> <span itemprop=about itemscope itemtype=http://schema.org/Thing> <a href=/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/ itemprop=url rel=index><span itemprop=name>设计模式</span></a> </span> </span></div></div></header><div class=post-body itemprop=articleBody><h1 id=0、前言><a class=headerlink href=#0、前言 title=0、前言></a>0、前言</h1><h2 id=0-1、软件设计基本原则><a class=headerlink href=#0-1、软件设计基本原则 title=0.1、软件设计基本原则></a>0.1、软件设计基本原则</h2><ol><li>高内聚，低耦合；<li>面向抽象编程；<li>多用组合少用继承；<li>遵循开闭原则；</ol><h2 id=0-2、设计模式引入><a class=headerlink href=#0-2、设计模式引入 title=0.2、设计模式引入></a>0.2、设计模式引入</h2><p>设计模式是计算机软件领域较抽象的东西，设计模式的作用：使 软件系统 变得 更加稳定、更易扩展、更易维护。<h2 id=0-3、设计模式简介><a class=headerlink href=#0-3、设计模式简介 title=0.3、设计模式简介></a>0.3、设计模式简介</h2><p><strong>设计模式不分语言，共23种，分3种类型：创建型、行为型、结构型</strong>。<h1 id=1、设计模式><a class=headerlink href=#1、设计模式 title=1、设计模式></a>1、设计模式</h1><h2 id=1-1、创建型（5种）><a class=headerlink href=#1-1、创建型（5种） title=1.1、创建型（5种）></a>1.1、创建型（5种）</h2><h3 id=1-1-1、Singleton（单例模式）><a class=headerlink href=#1-1-1、Singleton（单例模式） title=1.1.1、Singleton（单例模式）></a>1.1.1、Singleton（单例模式）</h3><h4 id=简介><a class=headerlink href=#简介 title=简介></a>简介</h4><p><strong>保证一个类仅有一个实例，并提供一个访问它的全局访问点。常见单例模式实现有：饿汉式、懒汉式、枚举式等</strong>。<h4 id=实现><a class=headerlink href=#实现 title=实现></a>实现</h4><ol><li>构造方法设为私有，禁止它人创建对象。</ol><h4 id=何时使用><a class=headerlink href=#何时使用 title=何时使用></a>何时使用</h4><p>当您想控制实例数目，节省系统资源的时候。<h4 id=优缺点><a class=headerlink href=#优缺点 title=优缺点></a>优缺点</h4><ul><li><p>优点：</p> <ol><li>在内存里只有一个实例，减少了内存的开销，尤其是频繁的创建和销毁实例（比如管理学院首页页面缓存）。<li>避免对资源的多重占用（比如写文件操作）。</ol><li><p>缺点：</p> <p>没有接口，不能继承，与单一职责原则冲突，一个类应该只关心内部逻辑，而不关心外面怎么样来实例化。</p></ul><h4 id=应用实例><a class=headerlink href=#应用实例 title=应用实例></a>应用实例</h4><ol><li>一个班级只有一个班主任。<li>Windows 是多进程多线程的，在操作一个文件的时候，就不可避免地出现多个进程或线程同时操作一个文件的现象，所以所有文件的处理必须通过唯一的实例来进行。<li>一些设备管理器常常设计为单例模式，比如一个电脑有两台打印机，在输出的时候就要处理不能两台打印机打印同一个文件。</ol><h4 id=使用场景><a class=headerlink href=#使用场景 title=使用场景></a>使用场景</h4><ol><li>要求生产唯一序列号。<li>WEB 中的计数器，不用每次刷新都在数据库里加一次，用单例先缓存起来。<li>创建一个对象消耗资源过多时可通过单例降低多次创建带来的消耗，比如 I/O 与数据库的连接等。</ol><h4 id=注意事项><a class=headerlink href=#注意事项 title=注意事项></a>注意事项</h4><ol><li><font color=red>注意序列化对单例的破坏；</font><li><font color=red>注意反射对单例的破坏；</font></ol><h4 id=代码实例><a class=headerlink href=#代码实例 title=代码实例></a>代码实例</h4><figure class="highlight java"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br><span class=line>42</span><br><span class=line>43</span><br><span class=line>44</span><br><span class=line>45</span><br><span class=line>46</span><br><span class=line>47</span><br><span class=line>48</span><br><span class=line>49</span><br><span class=line>50</span><br><span class=line>51</span><br><span class=line>52</span><br><span class=line>53</span><br><span class=line>54</span><br><span class=line>55</span><br><span class=line>56</span><br><span class=line>57</span><br><span class=line>58</span><br><span class=line>59</span><br><span class=line>60</span><br><span class=line>61</span><br><span class=line>62</span><br><span class=line>63</span><br><span class=line>64</span><br><span class=line>65</span><br><span class=line>66</span><br><span class=line>67</span><br><span class=line>68</span><br><span class=line>69</span><br><span class=line>70</span><br><span class=line>71</span><br><span class=line>72</span><br><span class=line>73</span><br><span class=line>74</span><br><span class=line>75</span><br><span class=line>76</span><br><span class=line>77</span><br><span class=line>78</span><br><span class=line>79</span><br><span class=line>80</span><br><span class=line>81</span><br><span class=line>82</span><br><span class=line>83</span><br><span class=line>84</span><br><span class=line>85</span><br><span class=line>86</span><br><span class=line>87</span><br><span class=line>88</span><br><span class=line>89</span><br><span class=line>90</span><br><span class=line>91</span><br><span class=line>92</span><br><span class=line>93</span><br><span class=line>94</span><br><span class=line>95</span><br><span class=line>96</span><br><span class=line>97</span><br><span class=line>98</span><br><span class=line>99</span><br><span class=line>100</span><br><span class=line>101</span><br><span class=line>102</span><br><span class=line>103</span><br><span class=line>104</span><br><span class=line>105</span><br><span class=line>106</span><br><span class=line>107</span><br><span class=line>108</span><br><span class=line>109</span><br><span class=line>110</span><br><span class=line>111</span><br><span class=line>112</span><br><span class=line>113</span><br><span class=line>114</span><br><span class=line>115</span><br></pre><td class=code><pre><span class=line><span class=comment>/**</span></span><br><span class=line><span class=comment> * 实例一：基于双重校验锁方式实现单例</span></span><br><span class=line><span class=comment> *</span></span><br><span class=line><span class=comment> * - 优点：懒加载，效率较好。</span></span><br><span class=line><span class=comment> *</span></span><br><span class=line><span class=comment> * - 缺点：反序列化会对单例造成破坏</span></span><br><span class=line><span class=comment> *   应对方案：要想防止序列化对单例的破坏，只要添加readResolve方法就可避免。</span></span><br><span class=line><span class=comment> */</span></span><br><span class=line><span class=keyword>public</span> <span class=keyword>class</span> <span class="title class_">Singleton</span> <span class=keyword>implements</span> <span class="title class_">Serializable</span> {</span><br><span class=line>    <span class=keyword>private</span> <span class=keyword>volatile</span> <span class=keyword>static</span> Singleton singleton;</span><br><span class=line>    <span class=keyword>private</span> <span class="title function_">Singleton</span> <span class=params>()</span>{}</span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>static</span> Singleton <span class="title function_">getSingleton</span><span class=params>()</span> {</span><br><span class=line>        <span class=keyword>if</span> (singleton == <span class=literal>null</span>) {</span><br><span class=line>            <span class=keyword>synchronized</span> (Singleton.class) {</span><br><span class=line>                <span class=keyword>if</span> (singleton == <span class=literal>null</span>) {</span><br><span class=line>                    singleton = <span class=keyword>new</span> <span class="title class_">Singleton</span>();</span><br><span class=line>                }</span><br><span class=line>            }</span><br><span class=line>        }</span><br><span class=line>        <span class=keyword>return</span> singleton;</span><br><span class=line>    }</span><br><span class=line>    <span class=keyword>private</span> Object <span class="title function_">readResolve</span><span class=params>()</span> {</span><br><span class=line>        <span class=keyword>return</span> singleton;</span><br><span class=line>    }</span><br><span class=line>}</span><br><span class=line></span><br><span class=line></span><br><span class=line><span class=comment>/**</span></span><br><span class=line><span class=comment> * 实例二：基于 CAS 实现单例</span></span><br><span class=line><span class=comment> *</span></span><br><span class=line><span class=comment> * - 优点：</span></span><br><span class=line><span class=comment> *   - 不需要使用传统的锁机制来保证线程安全；</span></span><br><span class=line><span class=comment> *   - 相对于锁它没有线程切换和阻塞的额外消耗,可以支持较大的并行度；</span></span><br><span class=line><span class=comment> *</span></span><br><span class=line><span class=comment> * - 缺点：</span></span><br><span class=line><span class=comment> *   - 如果等待一直执行不成功(一直在死循环中)，会对CPU造成较大的执行开销；</span></span><br><span class=line><span class=comment> */</span></span><br><span class=line><span class=keyword>public</span> <span class=keyword>class</span> <span class="title class_">SingletonByCAS</span> {</span><br><span class=line>    <span class=keyword>private</span> <span class=keyword>static</span> <span class=keyword>final</span> AtomicReference&LTSingletonByCAS> INSTANCE = <span class=keyword>new</span> <span class="title class_">AtomicReference</span>&LTSingletonByCAS>();</span><br><span class=line>    <span class=keyword>private</span> <span class="title function_">SingletonByCAS</span><span class=params>()</span>{}</span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>static</span> SingletonByCAS <span class="title function_">getInstance</span><span class=params>()</span>{</span><br><span class=line>        <span class=keyword>for</span> (;;){</span><br><span class=line>            <span class=type>SingletonByCAS</span> <span class=variable>single</span> <span class=operator>=</span> INSTANCE.get();</span><br><span class=line>            <span class=keyword>if</span> (<span class=literal>null</span> != single){</span><br><span class=line>                <span class=keyword>return</span> single;</span><br><span class=line>            }</span><br><span class=line>            single = <span class=keyword>new</span> <span class="title class_">SingletonByCAS</span>();</span><br><span class=line>            <span class=keyword>if</span> (INSTANCE.compareAndSet(<span class=literal>null</span>, single)){</span><br><span class=line>                <span class=keyword>return</span> single;</span><br><span class=line>            }</span><br><span class=line>        }</span><br><span class=line>    }</span><br><span class=line>}</span><br><span class=line></span><br><span class=line></span><br><span class=line><span class=comment>/**</span></span><br><span class=line><span class=comment> * 实例三：基于 枚举 实现单例</span></span><br><span class=line><span class=comment> */</span></span><br><span class=line><span class=keyword>public</span> <span class=keyword>enum</span> <span class="title class_">SingletonByEnum</span> {</span><br><span class=line>    INSTANCE;</span><br><span class=line>    <span class=comment>// 其它方法</span></span><br><span class=line>}</span><br><span class=line></span><br><span class=line></span><br><span class=line><span class=comment>/**</span></span><br><span class=line><span class=comment> * 实例四：基于双重校验锁方式实现单例（优化版）</span></span><br><span class=line><span class=comment> *</span></span><br><span class=line><span class=comment> * - 优点：懒加载，利用局部变量提高效率；</span></span><br><span class=line><span class=comment> *</span></span><br><span class=line><span class=comment> * - 缺点：反序列化会对单例造成破坏</span></span><br><span class=line><span class=comment> *   应对方案：要想防止序列化对单例的破坏，只要添加readResolve方法就可避免。</span></span><br><span class=line><span class=comment> *</span></span><br><span class=line><span class=comment> */</span></span><br><span class=line><span class=keyword>public</span> <span class=keyword>class</span> <span class="title class_">SingletonByLocalVariable</span> <span class=keyword>implements</span> <span class="title class_">Serializable</span> {</span><br><span class=line>    <span class=keyword>private</span> <span class=keyword>volatile</span> <span class=keyword>static</span> SingletonByLocalVariable singleton;</span><br><span class=line>    <span class=keyword>private</span> <span class="title function_">SingletonByLocalVariable</span><span class=params>()</span>{}</span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>static</span> SingletonByLocalVariable <span class="title function_">getSingleton</span><span class=params>()</span> {</span><br><span class=line>        <span class=type>SingletonByLocalVariable</span> <span class=variable>tmp</span> <span class=operator>=</span> singleton;</span><br><span class=line>        <span class=keyword>if</span> (tmp == <span class=literal>null</span>) {</span><br><span class=line>            <span class=keyword>synchronized</span> (SingletonByLocalVariable.class) {</span><br><span class=line>                tmp = singleton;</span><br><span class=line>                <span class=keyword>if</span> (tmp == <span class=literal>null</span>) {</span><br><span class=line>                    tmp = <span class=keyword>new</span> <span class="title class_">SingletonByLocalVariable</span>();</span><br><span class=line>                    singleton = tmp;</span><br><span class=line>                }</span><br><span class=line>            }</span><br><span class=line>        }</span><br><span class=line>        <span class=keyword>return</span> singleton;</span><br><span class=line>    }</span><br><span class=line>    <span class=keyword>private</span> Object <span class="title function_">readResolve</span><span class=params>()</span> {</span><br><span class=line>        <span class=keyword>return</span> singleton;</span><br><span class=line>    }</span><br><span class=line>}</span><br><span class=line></span><br><span class=line></span><br><span class=line><span class=comment>/**</span></span><br><span class=line><span class=comment> * 实例五：基于静态内部类实现单例</span></span><br><span class=line><span class=comment> *</span></span><br><span class=line><span class=comment> * - 原理：利用了classloder的机制来保证初始化instance时只有一个线程。</span></span><br><span class=line><span class=comment> *</span></span><br><span class=line><span class=comment> * - 优点：这是一种懒加载，就是说Singleton类被装载了，instance不一定被初始化。</span></span><br><span class=line><span class=comment> *        因为SingletonHolder类没有被主动使用，只有显式调用getInstance方法时，</span></span><br><span class=line><span class=comment> *        才会装载SingletonHolder类，从而实例化instance。</span></span><br><span class=line><span class=comment> */</span></span><br><span class=line><span class=keyword>public</span> <span class=keyword>class</span> <span class="title class_">SingletonByStaticInnerClass</span> {</span><br><span class=line>    <span class=comment>// 私有构造，禁止通过new创建对象。</span></span><br><span class=line>    <span class=keyword>private</span> <span class="title function_">SingletonByStaticInnerClass</span><span class=params>()</span>{</span><br><span class=line>    }</span><br><span class=line>    <span class=keyword>private</span> <span class=keyword>static</span> <span class=keyword>class</span> <span class="title class_">SingletonHholder</span>{</span><br><span class=line>        <span class=keyword>private</span> <span class=keyword>static</span> <span class=keyword>final</span> <span class=type>SingletonByStaticInnerClass</span> <span class=variable>INSTANCE</span> <span class=operator>=</span> <span class=keyword>new</span> <span class="title class_">SingletonByStaticInnerClass</span>();</span><br><span class=line>    }</span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>static</span> <span class=keyword>final</span> SingletonByStaticInnerClass <span class="title function_">getInstance</span><span class=params>()</span>{</span><br><span class=line>        <span class=keyword>return</span> SingletonHholder.INSTANCE;</span><br><span class=line>    }</span><br><span class=line>}</span><br></pre></table></figure><h3 id=1-1-2、AbstractFactory（抽象工厂）><a class=headerlink href=#1-1-2、AbstractFactory（抽象工厂） title=1.1.2、AbstractFactory（抽象工厂）></a>1.1.2、AbstractFactory（抽象工厂）</h3><h4 id=定义><a class=headerlink href=#定义 title=定义></a>定义</h4><p><strong>任何可以生成对象的方法或类，都可以称之为工厂。单例也是一个工厂</strong>。主要解决接口选择问题。<h4 id=何时使用-1><a class=headerlink href=#何时使用-1 title=何时使用></a>何时使用</h4><p>系统产品有多于一个的产品族，而系统只消费其中某一族的产品。<h4 id=优缺点-1><a class=headerlink href=#优缺点-1 title=优缺点></a>优缺点</h4><ul><li>优点<ol><li>可以实现从工厂得到的产品彼此兼容。<li>可以避免具体产品和客户端代码之间的紧密耦合。<li>符合单一职责原则。<li>符合开闭原则。</ol><li>缺点<ol><li>产品族扩展非常困难，要增加一个系列的某一产品，既要在抽象的 Creator 里加代码，又要在具体实现中加代码。</ol></ul><h4 id=应用场景><a class=headerlink href=#应用场景 title=应用场景></a>应用场景</h4><ol><li>QQ 换皮肤，一整套一起换。<li>生成不同操作系统对应的程序。</ol><h4 id=应用实例-1><a class=headerlink href=#应用实例-1 title=应用实例></a>应用实例</h4><p>为了参加一些聚会，肯定有两套或多套衣服吧，比如说有商务装（成套，一系列具体产品）、时尚装（成套，一系列具体产品），对于一个家庭来说，可能有商务女装、商务男装、时尚女装、时尚男装，这些都是成套的，即一系列具体产品。<p>假设一种情况，在您的家中，某一个衣柜（具体工厂）只能存放某一种衣服（成套，一系列具体产品），每次拿这种成套衣服时自然要从这个衣柜中取出。用 OO 的思想去理解，所有的衣柜（具体工厂）都是衣柜类的（抽象工厂）某一个，而每一件成套的衣服又包括具体的上衣（某一具体产品），裤子（某一具体产品），这些具体的上衣其实也都是上衣（抽象产品），具体的裤子也都是裤子（另一个抽象产品）。<h4 id=注意事项-1><a class=headerlink href=#注意事项-1 title=注意事项></a>注意事项</h4><p>产品族难扩展，产品等级易扩展。<h4 id=QA><a class=headerlink href=#QA title=QA></a>QA</h4><ol><li><p>为何还需要工厂?</p> <ol><li>灵活控制生产过程。<li>权限、修饰、日志等。</ol></ol><h4 id=代码实例-1><a class=headerlink href=#代码实例-1 title=代码实例></a>代码实例</h4><figure class="highlight java"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br></pre><td class=code><pre><span class=line><span class=comment>/**</span></span><br><span class=line><span class=comment> * 抽象工厂模式</span></span><br><span class=line><span class=comment> *</span></span><br><span class=line><span class=comment> * 抽象工厂模式以一种倾斜的方式支持增加新的产品，它为新产品族的增加提供</span></span><br><span class=line><span class=comment> * 方便，但不能为新的产品等级结构的增加提供这样的方便。</span></span><br><span class=line><span class=comment> *</span></span><br><span class=line><span class=comment> * 三种工厂模式之间的关系：</span></span><br><span class=line><span class=comment> *      当抽象工厂模式中每一个具体工厂类只创建一个产品对象，也就是只存</span></span><br><span class=line><span class=comment> *      在一个产品等级结构时，抽象工厂模式退化成工厂方法模式；</span></span><br><span class=line><span class=comment> *</span></span><br><span class=line><span class=comment> *      抽象工厂模式与工厂方法模式最大的区别在于，工厂方法模式针对的是</span></span><br><span class=line><span class=comment> *      一个产品等级结构，而抽象工厂模式则需要面对多个产品等级结构。</span></span><br><span class=line><span class=comment> *</span></span><br><span class=line><span class=comment> *      当工厂方法模式中抽象工厂与具体工厂合并，提供一个统一的工厂来创</span></span><br><span class=line><span class=comment> *      建产品对象，并将创建对象的工厂方法设计为静态方法时，工厂方法模</span></span><br><span class=line><span class=comment> *      式退化成简单工厂模式。</span></span><br><span class=line><span class=comment> *</span></span><br><span class=line><span class=comment> * 总结：</span></span><br><span class=line><span class=comment> *      抽象工厂模式是所有工厂模式中最为抽象和最具一般性的一种形态。</span></span><br><span class=line><span class=comment> *</span></span><br><span class=line><span class=comment> *      抽象工厂模式的主要优点是隔离了具体类的生成，使得客户并不需要知</span></span><br><span class=line><span class=comment> *      道什么被创建，而且每次可以通过具体工厂类创建一个产品族中的多个</span></span><br><span class=line><span class=comment> *      对象，增加或者替换产品族比较方便，增加新的具体工厂和产品族很方</span></span><br><span class=line><span class=comment> *      便；主要缺点在于增加新的产品等级结构很复杂，需要修改抽象工厂和</span></span><br><span class=line><span class=comment> *      所有具体工厂类，对“开闭原则”的支持呈现倾斜性。</span></span><br><span class=line><span class=comment> */</span></span><br><span class=line><span class=keyword>public</span> <span class=keyword>class</span> <span class="title class_">App</span> {</span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>static</span> <span class=keyword>void</span> <span class="title function_">main</span><span class=params>(String[] args)</span> {</span><br><span class=line>        <span class=type>CarFactory</span> <span class=variable>sportCarFactory</span> <span class=operator>=</span> <span class=keyword>new</span> <span class="title class_">SportCarFactory</span>();</span><br><span class=line>        <span class=type>TeslaCar</span> <span class=variable>teslaCar</span> <span class=operator>=</span> sportCarFactory.getTeslaCar();</span><br><span class=line>        <span class=type>BenzCar</span> <span class=variable>benzCar</span> <span class=operator>=</span> sportCarFactory.getBenzCar();</span><br><span class=line>        teslaCar.charge();</span><br><span class=line>        benzCar.gasUp();</span><br><span class=line>    }</span><br><span class=line>}</span><br></pre></table></figure><h3 id=1-1-3、FactoryMethod（工厂方法）><a class=headerlink href=#1-1-3、FactoryMethod（工厂方法） title=1.1.3、FactoryMethod（工厂方法）></a>1.1.3、FactoryMethod（工厂方法）</h3><h4 id=简介-1><a class=headerlink href=#简介-1 title=简介></a>简介</h4><p><strong>定义一个用于创建对象的接口，让子类决定实例化哪一个类。Factory Method使得一个类的实例化延迟到了子类</strong>。<h4 id=何时使用-2><a class=headerlink href=#何时使用-2 title=何时使用></a>何时使用</h4><p>明确地计划不同条件下创建不同实例。<h4 id=优缺点-2><a class=headerlink href=#优缺点-2 title=优缺点></a>优缺点</h4><ul><li><p>优点</p> <ol><li>将具体产品和创建者解耦。<li>符合单一职责原则。<li>符合开闭原则。</ol><li><p>缺点</p> <p>每次增加一个产品时，都需要增加一个具体类和对象实现工厂，使得系统中类的个数成倍增加，在一定程度上增加了系统的复杂度，同时也增加了系统具体类的依赖。</p></ul><h4 id=应用场景-1><a class=headerlink href=#应用场景-1 title=应用场景></a>应用场景</h4><ol><li>日志记录器：记录可能记录到本地硬盘、系统事件、远程服务器等，用户可以选择记录日志到什么地方。<li>数据库访问，当用户不知道最后系统采用哪一类数据库，以及数据库可能有变化时。<li>设计一个连接服务器的框架，需要三个协议，”POP3”、”IMAP”、”HTTP”，可以把这三个作为产品类，共同实现一个接口。</ol><h4 id=应用实例-2><a class=headerlink href=#应用实例-2 title=应用实例></a>应用实例</h4><ol><li>您需要一辆汽车，可以直接从工厂里面提货，而不用去管这辆汽车是如何生产出来的。<li>Hibernate 换数据库只需换驱动就可以。</ol><h4 id=源码应用><a class=headerlink href=#源码应用 title=源码应用></a>源码应用</h4><figure class="highlight java"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br></pre><td class=code><pre><span class=line>Calendar.getInstance();</span><br><span class=line>java.text.NumberFormat.getInstance();</span><br><span class=line>java.util.ResourceBundle.getBundle();</span><br><span class=line></span><br><span class=line>java.net.URLStreamHandlerFactory</span><br><span class=line>java.xml.bind.JAXBContext.createMarshaller</span><br></pre></table></figure><h4 id=注意事项-2><a class=headerlink href=#注意事项-2 title=注意事项></a>注意事项</h4><p><font color=red>在任何需要生成复杂对象的地方，都可以使用工厂方法模式。有一点需要注意：复杂对象适合使用工厂模式，而简单对象不适合。</font><h4 id=代码实例-2><a class=headerlink href=#代码实例-2 title=代码实例></a>代码实例</h4><figure class="highlight java"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br><span class=line>42</span><br><span class=line>43</span><br><span class=line>44</span><br><span class=line>45</span><br><span class=line>46</span><br></pre><td class=code><pre><span class=line><span class=comment>/**</span></span><br><span class=line><span class=comment> * 计算器 - 工厂方法模式</span></span><br><span class=line><span class=comment> *</span></span><br><span class=line><span class=comment> * 工厂方法模式优点：</span></span><br><span class=line><span class=comment> *    1、使用工厂来创建对象，隐藏了具体产品类将被实例化的细节。</span></span><br><span class=line><span class=comment> *    2、能够使工厂可以自主确定创建何种产品对象，而如何创建这个对象的细节则完全</span></span><br><span class=line><span class=comment> *       封装在具体工厂内部。</span></span><br><span class=line><span class=comment> *    3、每种对象对应单独一个工厂，其目的主要为了解耦。</span></span><br><span class=line><span class=comment> *</span></span><br><span class=line><span class=comment> * 工厂方法模式缺点：</span></span><br><span class=line><span class=comment> *    1、在添加新产品时，需要编写新的具体产品类，而且还要提供与之对应的具体工厂</span></span><br><span class=line><span class=comment> *       类，系统中类的个数将成对增加，这增加了系统的复杂度。</span></span><br><span class=line><span class=comment> *    2、考虑到系统的可扩展性，需要引入抽象层，在客户端代码中均使用抽象层进行定义，</span></span><br><span class=line><span class=comment> *       增加了系统的抽象性和理解难度。且在实现时可能需要用到DOM、反射等技术，</span></span><br><span class=line><span class=comment> *       增加了系统的实现难度。</span></span><br><span class=line><span class=comment> */</span></span><br><span class=line><span class=keyword>public</span> <span class=keyword>class</span> <span class="title class_">FactoryMethodApp</span> {</span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>static</span> <span class=keyword>void</span> <span class="title function_">main</span><span class=params>(String[] args)</span> {</span><br><span class=line>        <span class=type>IFactory</span> <span class=variable>factory</span> <span class=operator>=</span> <span class=keyword>new</span> <span class="title class_">AddFactory</span>();</span><br><span class=line>        <span class=type>Operation</span> <span class=variable>operationAdd</span> <span class=operator>=</span> factory.createOperation();</span><br><span class=line>        operationAdd.setVal1(<span class=number>15.2</span>);</span><br><span class=line>        operationAdd.setVal2(<span class=number>19.3</span>);</span><br><span class=line>        System.out.println(operationAdd.getResult());</span><br><span class=line>    }</span><br><span class=line>}</span><br><span class=line></span><br><span class=line></span><br><span class=line><span class=comment>/**</span></span><br><span class=line><span class=comment> * 计算器 - 简单工厂模式</span></span><br><span class=line><span class=comment> *</span></span><br><span class=line><span class=comment> * 简单工厂模式优点:</span></span><br><span class=line><span class=comment> *    1、一个调用者想创建一个对象，只要知道其名称就行了。</span></span><br><span class=line><span class=comment> *    2、屏蔽产品的具体实现，调用者只关心产品的接口。</span></span><br><span class=line><span class=comment> *</span></span><br><span class=line><span class=comment> * 简单工厂模式缺点：</span></span><br><span class=line><span class=comment> *    1、增加新算法时，需要编写一个新类并继承Operation。</span></span><br><span class=line><span class=comment> *    2、同时需要修改OperationFactory类的代码，这违反了“开闭原则”。</span></span><br><span class=line><span class=comment> */</span></span><br><span class=line><span class=keyword>public</span> <span class=keyword>class</span> <span class="title class_">SimpleFactoryApp</span> {</span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>static</span> <span class=keyword>void</span> <span class="title function_">main</span><span class=params>(String[] args)</span> {</span><br><span class=line>        <span class=type>Operation</span> <span class=variable>operationAdd</span> <span class=operator>=</span> OperationFactory.create(<span class=string>"+"</span>);</span><br><span class=line>        operationAdd.setVal1(<span class=number>10</span>);</span><br><span class=line>        operationAdd.setVal2(<span class=number>5</span>);</span><br><span class=line>        System.out.println(operationAdd.getResult());</span><br><span class=line>    }</span><br><span class=line>}</span><br></pre></table></figure><h3 id=1-1-4、Builder（建造者模式）><a class=headerlink href=#1-1-4、Builder（建造者模式） title=1.1.4、Builder（建造者模式）></a>1.1.4、Builder（建造者模式）</h3><h4 id=简介-2><a class=headerlink href=#简介-2 title=简介></a>简介</h4><p><strong>将一个复杂对象的创建与它的表示分离，使得同样的构建过程可以创建不同的表示</strong>。<h4 id=何时使用-3><a class=headerlink href=#何时使用-3 title=何时使用></a>何时使用</h4><p>一些基本部件不会变，而其组合经常变化的时候。<h4 id=优缺点-3><a class=headerlink href=#优缺点-3 title=优缺点></a>优缺点</h4><ul><li>优点<ol><li>建造者独立，易扩展。<li>便于控制细节风险。</ol><li>缺点<ol><li>产品必须有共同点，范围有限制。<li>内部变化复杂，有很多建造类。</ol></ul><h4 id=应用场景-2><a class=headerlink href=#应用场景-2 title=应用场景></a>应用场景</h4><ol><li>需要生成的对象具有复杂的内部结构。<li>需要生成的对象内部属性本身相互依赖。<li>与不可变对象配合使用。</ol><h4 id=应用实例-3><a class=headerlink href=#应用实例-3 title=应用实例></a>应用实例</h4><ol><li>去肯德基，汉堡、可乐、薯条、炸鸡翅等是不变的，而其组合是经常变化的，生成出所谓的 “套餐”。<li>JAVA 中的 StringBuilder。</ol><h4 id=源码应用-1><a class=headerlink href=#源码应用-1 title=源码应用></a>源码应用</h4><figure class="highlight java"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br></pre><td class=code><pre><span class=line>org.springframework.web.service.mvc.method.RequestMappingInfo</span><br><span class=line>org.springframework.benas.factory.support.BeanDefinitionBuilder</span><br></pre></table></figure><h4 id=注意事项-3><a class=headerlink href=#注意事项-3 title=注意事项></a>注意事项</h4><p><font color=red>与工厂模式的区别：建造者模式更加关注零件装配的顺序。</font><h4 id=代码实例-3><a class=headerlink href=#代码实例-3 title=代码实例></a>代码实例</h4><figure class="highlight java"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br><span class=line>42</span><br><span class=line>43</span><br><span class=line>44</span><br><span class=line>45</span><br><span class=line>46</span><br><span class=line>47</span><br><span class=line>48</span><br><span class=line>49</span><br><span class=line>50</span><br><span class=line>51</span><br><span class=line>52</span><br><span class=line>53</span><br><span class=line>54</span><br><span class=line>55</span><br><span class=line>56</span><br><span class=line>57</span><br><span class=line>58</span><br><span class=line>59</span><br><span class=line>60</span><br><span class=line>61</span><br><span class=line>62</span><br><span class=line>63</span><br><span class=line>64</span><br><span class=line>65</span><br><span class=line>66</span><br><span class=line>67</span><br><span class=line>68</span><br><span class=line>69</span><br><span class=line>70</span><br><span class=line>71</span><br><span class=line>72</span><br><span class=line>73</span><br><span class=line>74</span><br><span class=line>75</span><br><span class=line>76</span><br><span class=line>77</span><br><span class=line>78</span><br><span class=line>79</span><br><span class=line>80</span><br><span class=line>81</span><br><span class=line>82</span><br><span class=line>83</span><br><span class=line>84</span><br><span class=line>85</span><br><span class=line>86</span><br><span class=line>87</span><br><span class=line>88</span><br><span class=line>89</span><br><span class=line>90</span><br><span class=line>91</span><br><span class=line>92</span><br><span class=line>93</span><br><span class=line>94</span><br><span class=line>95</span><br><span class=line>96</span><br><span class=line>97</span><br><span class=line>98</span><br><span class=line>99</span><br><span class=line>100</span><br><span class=line>101</span><br><span class=line>102</span><br><span class=line>103</span><br><span class=line>104</span><br><span class=line>105</span><br><span class=line>106</span><br><span class=line>107</span><br><span class=line>108</span><br></pre><td class=code><pre><span class=line><span class=keyword>public</span> <span class=keyword>class</span> <span class="title class_">Role</span> {</span><br><span class=line>    <span class=keyword>private</span> String head; <span class=comment>//头部</span></span><br><span class=line>    <span class=keyword>private</span> String face; <span class=comment>//脸部（脸部依赖于头部）</span></span><br><span class=line>    <span class=keyword>private</span> String body; <span class=comment>//身体</span></span><br><span class=line>    <span class=keyword>private</span> Double hp;   <span class=comment>//生命值</span></span><br><span class=line>    <span class=keyword>private</span> Double sp;   <span class=comment>//能量值</span></span><br><span class=line>    <span class=keyword>private</span> Double mp;   <span class=comment>//魔法值</span></span><br><span class=line>    </span><br><span class=line>    <span class=comment>// get/set/toString methods ...</span></span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=keyword>public</span> <span class=keyword>abstract</span> <span class=keyword>class</span> <span class="title class_">Builder</span> {</span><br><span class=line>    <span class=keyword>protected</span> <span class=type>Role</span> <span class=variable>role</span> <span class=operator>=</span> <span class=keyword>new</span> <span class="title class_">Role</span>();</span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>abstract</span> <span class=keyword>void</span> <span class="title function_">buildHead</span><span class=params>()</span>;</span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>abstract</span> <span class=keyword>void</span> <span class="title function_">buildFace</span><span class=params>()</span>;</span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>abstract</span> <span class=keyword>void</span> <span class="title function_">buildBody</span><span class=params>()</span>;</span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>abstract</span> <span class=keyword>void</span> <span class="title function_">buildHp</span><span class=params>()</span>;</span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>abstract</span> <span class=keyword>void</span> <span class="title function_">buildSp</span><span class=params>()</span>;</span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>abstract</span> <span class=keyword>void</span> <span class="title function_">buildMp</span><span class=params>()</span>;</span><br><span class=line>    <span class=keyword>public</span> Role <span class="title function_">getResult</span><span class=params>()</span> {</span><br><span class=line>        <span class=keyword>return</span> role;</span><br><span class=line>    }</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=keyword>public</span> <span class=keyword>class</span> <span class="title class_">CommonRoleBuilder</span> <span class=keyword>extends</span> <span class="title class_">Builder</span> {</span><br><span class=line>    <span class=keyword>private</span> <span class=type>Role</span> <span class=variable>role</span> <span class=operator>=</span> <span class=keyword>new</span> <span class="title class_">Role</span>();</span><br><span class=line>    <span class=meta>@Override</span></span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">buildHead</span><span class=params>()</span> {</span><br><span class=line>        role.setHead(<span class=string>"common head"</span>);</span><br><span class=line>    }</span><br><span class=line>    <span class=meta>@Override</span></span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">buildFace</span><span class=params>()</span> {</span><br><span class=line>        role.setFace(<span class=string>"common face"</span>);</span><br><span class=line>    }</span><br><span class=line>    <span class=meta>@Override</span></span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">buildBody</span><span class=params>()</span> {</span><br><span class=line>        role.setBody(<span class=string>"common body"</span>);</span><br><span class=line>    }</span><br><span class=line>    <span class=meta>@Override</span></span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">buildHp</span><span class=params>()</span> {</span><br><span class=line>        role.setHp(<span class=number>100d</span>);</span><br><span class=line>    }</span><br><span class=line>    <span class=meta>@Override</span></span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">buildSp</span><span class=params>()</span> {</span><br><span class=line>        role.setSp(<span class=number>100d</span>);</span><br><span class=line>    }</span><br><span class=line>    <span class=meta>@Override</span></span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">buildMp</span><span class=params>()</span> {</span><br><span class=line>        role.setMp(<span class=number>100d</span>);</span><br><span class=line>    }</span><br><span class=line>    <span class=meta>@Override</span></span><br><span class=line>    <span class=keyword>public</span> Role <span class="title function_">getResult</span><span class=params>()</span> {</span><br><span class=line>        <span class=keyword>return</span> role;</span><br><span class=line>    }</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=keyword>public</span> <span class=keyword>class</span> <span class="title class_">Director</span> {</span><br><span class=line>    <span class=keyword>public</span> Role <span class="title function_">constructAndGet</span><span class=params>(Builder builder)</span>{</span><br><span class=line>        builder.buildBody();</span><br><span class=line>        builder.buildHead();</span><br><span class=line>        builder.buildFace();</span><br><span class=line>        builder.buildHp();</span><br><span class=line>        builder.buildMp();</span><br><span class=line>        builder.buildSp();</span><br><span class=line>        <span class=keyword>return</span> builder.getResult();</span><br><span class=line>    }</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=comment>/**</span></span><br><span class=line><span class=comment> * 建造者模式</span></span><br><span class=line><span class=comment> *</span></span><br><span class=line><span class=comment> * 定义：</span></span><br><span class=line><span class=comment> *      建造者模式（英：Builder Pattern）是一种创建型设计模式，又名：</span></span><br><span class=line><span class=comment> *      生成器模式。GOF 给建造者模式的定义为：将一个复杂对象的构建与</span></span><br><span class=line><span class=comment> *      它的表示分离，使得同样的构建过程可以创建不同的表示。这句话说的</span></span><br><span class=line><span class=comment> *      比较抽象，其实解释一下就是：将建造复杂对象的过程和组成对象的部</span></span><br><span class=line><span class=comment> *      件解耦。</span></span><br><span class=line><span class=comment> *</span></span><br><span class=line><span class=comment> * 建造者模式包含如下角色：</span></span><br><span class=line><span class=comment> *      Builder：抽象建造者</span></span><br><span class=line><span class=comment> *      ConcreteBuilder：具体建造者</span></span><br><span class=line><span class=comment> *      Director：指挥者</span></span><br><span class=line><span class=comment> *      Product：产品角色</span></span><br><span class=line><span class=comment> *</span></span><br><span class=line><span class=comment> * 优缺点：</span></span><br><span class=line><span class=comment> *      -优点：较好封装性、客户端无需知道产品内部组成的细节、</span></span><br><span class=line><span class=comment> *            可以更精细控制产品的创建过程、容易扩展。</span></span><br><span class=line><span class=comment> *      -缺点：不适合产品间差异大的场景、使用范围受到影响、</span></span><br><span class=line><span class=comment> *             产品内部变化大，可能需要定义很多具体建造者</span></span><br><span class=line><span class=comment> *             来适应，这可能导致系统很庞大。</span></span><br><span class=line><span class=comment> *</span></span><br><span class=line><span class=comment> * 适用场景：</span></span><br><span class=line><span class=comment> *      1、需要生成的产品对象有复杂的内部结构，这些产品对象通常包含多个</span></span><br><span class=line><span class=comment> *         成员属性。</span></span><br><span class=line><span class=comment> *      2、需要生成的产品对象的属性相互依赖，需要指定其生成顺序。</span></span><br><span class=line><span class=comment> *      3、对象的创建过程独立于创建该对象的类。在建造者模式中引入了指挥</span></span><br><span class=line><span class=comment> *         者类，将创建过程封装在指挥者类中，而不在建造者类中。</span></span><br><span class=line><span class=comment> *      4、隔离复杂对象的创建和使用，并使得相同的创建过程可以创建不同的</span></span><br><span class=line><span class=comment> *         产品。</span></span><br><span class=line><span class=comment> */</span></span><br><span class=line><span class=keyword>public</span> <span class=keyword>class</span> <span class="title class_">App</span> {</span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>static</span> <span class=keyword>void</span> <span class="title function_">main</span><span class=params>(String[] args)</span> {</span><br><span class=line>        <span class=type>Builder</span> <span class=variable>commonBuilder</span> <span class=operator>=</span> <span class=keyword>new</span> <span class="title class_">CommonRoleBuilder</span>();</span><br><span class=line>        <span class=type>Director</span> <span class=variable>director</span> <span class=operator>=</span> <span class=keyword>new</span> <span class="title class_">Director</span>();</span><br><span class=line>        <span class=type>Role</span> <span class=variable>commonRole</span> <span class=operator>=</span> director.constructAndGet(commonBuilder);</span><br><span class=line>        System.out.println(commonRole);</span><br><span class=line>    }</span><br><span class=line>}</span><br></pre></table></figure><h3 id=1-1-5、Prototype（原型模式）><a class=headerlink href=#1-1-5、Prototype（原型模式） title=1.1.5、Prototype（原型模式）></a>1.1.5、Prototype（原型模式）</h3><h4 id=简介-3><a class=headerlink href=#简介-3 title=简介></a>简介</h4><p><strong>原型实例指定创建对象的种类，且通过 拷贝原型 创建新对象</strong>。<p>相关知识点：Cloneable接口/Object.clone方法；浅拷贝/深拷贝；序列化实现深拷贝。<h4 id=何时使用-4><a class=headerlink href=#何时使用-4 title=何时使用></a>何时使用</h4><ol><li>当一个系统应该独立于它的产品创建，构成和表示时。<li>当要实例化的类是在运行时刻指定时，例如，通过动态装载。<li>为了避免创建一个与产品类层次平行的工厂类层次时。<li>当一个类的实例只能由几个不同状态组合中的一种时。建立相应数目的原型并克隆它们可能比每次用合适的状态手工实例化该类更方便一些。</ol><h4 id=优缺点-4><a class=headerlink href=#优缺点-4 title=优缺点></a>优缺点</h4><ul><li>优点<ol><li>性能提高。<li>逃避构造函数的约束。<li>可以不耦合具体类的情况下克隆对象。<li>避免重复的初始化代码。<li>更方便的构建复杂对象。</ol><li>缺点<ol><li>设计克隆方法需要对类的功能进行通盘考虑，这对于全新的类不是很难，但对于已有的类不一定很容易，特别当一个类引用不支持串行化的间接对象，或者引用含有循环结构时。<li>必须实现 Cloneable 接口。</ol></ul><h4 id=应用场景-3><a class=headerlink href=#应用场景-3 title=应用场景></a>应用场景</h4><ol><li>资源优化场景；<li>类初始化需要消化非常多的资源；<li>性能和安全要求的场景；<li>通过 new 创建对象需要繁杂步骤时；<li>一个对象有多个修改；<li>当多个对象需要对同一对象执行操作时，可以将共享对象拷贝多个来应付每一个调用者对象；<li>实际开发中，原型模式一般和工厂方法一起使用。工厂方法可以将 原型模式拷贝生成的对象提供给调用者；</ol><h4 id=应用实例-4><a class=headerlink href=#应用实例-4 title=应用实例></a>应用实例</h4><ol><li>细胞分裂。<li>JAVA 中的 Object clone() 方法。</ol><h4 id=源码中的应用><a class=headerlink href=#源码中的应用 title=源码中的应用></a>源码中的应用</h4><figure class="highlight java"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br></pre><td class=code><pre><span class=line>org.springframework.beans.factory.support.AbstracBeanDefinition</span><br><span class=line>java.util.Arrays</span><br></pre></table></figure><h4 id=注意事项-4><a class=headerlink href=#注意事项-4 title=注意事项></a>注意事项</h4><p><font color=red>原型模式是通过拷贝现有对象来生成新对象。浅拷贝实现 Cloneable，重写，深拷贝通过实现 Serializable 读取二进制流。</font><h4 id=代码实例-4><a class=headerlink href=#代码实例-4 title=代码实例></a>代码实例</h4><figure class="highlight java"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br><span class=line>42</span><br><span class=line>43</span><br><span class=line>44</span><br><span class=line>45</span><br><span class=line>46</span><br><span class=line>47</span><br><span class=line>48</span><br><span class=line>49</span><br><span class=line>50</span><br><span class=line>51</span><br><span class=line>52</span><br><span class=line>53</span><br><span class=line>54</span><br><span class=line>55</span><br><span class=line>56</span><br><span class=line>57</span><br><span class=line>58</span><br><span class=line>59</span><br><span class=line>60</span><br><span class=line>61</span><br><span class=line>62</span><br><span class=line>63</span><br><span class=line>64</span><br><span class=line>65</span><br><span class=line>66</span><br><span class=line>67</span><br><span class=line>68</span><br><span class=line>69</span><br><span class=line>70</span><br><span class=line>71</span><br><span class=line>72</span><br><span class=line>73</span><br><span class=line>74</span><br><span class=line>75</span><br><span class=line>76</span><br><span class=line>77</span><br><span class=line>78</span><br><span class=line>79</span><br><span class=line>80</span><br><span class=line>81</span><br><span class=line>82</span><br><span class=line>83</span><br><span class=line>84</span><br><span class=line>85</span><br><span class=line>86</span><br><span class=line>87</span><br><span class=line>88</span><br><span class=line>89</span><br><span class=line>90</span><br><span class=line>91</span><br><span class=line>92</span><br><span class=line>93</span><br><span class=line>94</span><br><span class=line>95</span><br><span class=line>96</span><br><span class=line>97</span><br><span class=line>98</span><br><span class=line>99</span><br><span class=line>100</span><br><span class=line>101</span><br><span class=line>102</span><br><span class=line>103</span><br><span class=line>104</span><br><span class=line>105</span><br><span class=line>106</span><br><span class=line>107</span><br><span class=line>108</span><br><span class=line>109</span><br><span class=line>110</span><br><span class=line>111</span><br><span class=line>112</span><br><span class=line>113</span><br><span class=line>114</span><br></pre><td class=code><pre><span class=line><span class=comment>/**</span></span><br><span class=line><span class=comment> * 深拷贝/浅拷贝 测试注意事项：</span></span><br><span class=line><span class=comment> * 1、测试浅拷贝时，去掉Cloneable接口 和 clone方法。</span></span><br><span class=line><span class=comment> * 2、测试深拷贝时，加上Cloneable接口 和 clone方法。</span></span><br><span class=line><span class=comment> */</span></span><br><span class=line><span class=keyword>public</span> <span class=keyword>class</span> <span class="title class_">PeopleInfo</span> <span class=keyword>implements</span> <span class="title class_">Cloneable</span>{</span><br><span class=line>    <span class=keyword>private</span> <span class=type>int</span> age;</span><br><span class=line>    <span class=keyword>public</span> <span class="title function_">PeopleInfo</span><span class=params>(<span class=type>int</span> age)</span> {</span><br><span class=line>        <span class=built_in>this</span>.age = age;</span><br><span class=line>    }</span><br><span class=line>    <span class=keyword>public</span> <span class=type>int</span> <span class="title function_">getAge</span><span class=params>()</span> {</span><br><span class=line>        <span class=keyword>return</span> age;</span><br><span class=line>    }</span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">setAge</span><span class=params>(<span class=type>int</span> age)</span> {</span><br><span class=line>        <span class=built_in>this</span>.age = age;</span><br><span class=line>    }</span><br><span class=line>    <span class=meta>@Override</span></span><br><span class=line>    <span class=keyword>public</span> String <span class="title function_">toString</span><span class=params>()</span> {</span><br><span class=line>        <span class=keyword>return</span> <span class=string>"PeopleInfo{"</span> +</span><br><span class=line>                <span class=string>"age="</span> + age +</span><br><span class=line>                <span class=string>'}'</span>;</span><br><span class=line>    }</span><br><span class=line>    <span class=comment>/** 测试 浅拷贝 时去掉该方法 */</span></span><br><span class=line>    <span class=meta>@Override</span></span><br><span class=line>    <span class=keyword>protected</span> Object <span class="title function_">clone</span><span class=params>()</span> <span class=keyword>throws</span> CloneNotSupportedException {</span><br><span class=line>        <span class=keyword>return</span> <span class=built_in>super</span>.clone();</span><br><span class=line>    }</span><br><span class=line>}</span><br><span class=line></span><br><span class=line></span><br><span class=line><span class=keyword>public</span> <span class=keyword>class</span> <span class="title class_">People</span> <span class=keyword>implements</span> <span class="title class_">Cloneable</span>{</span><br><span class=line>    <span class=keyword>private</span> PeopleInfo peopleInfo;</span><br><span class=line>    <span class=keyword>private</span> <span class=type>int</span> type; <span class=comment>// 0 / 1</span></span><br><span class=line></span><br><span class=line>    <span class=keyword>public</span> <span class="title function_">People</span><span class=params>()</span>{}</span><br><span class=line>    <span class=keyword>public</span> <span class="title function_">People</span><span class=params>(PeopleInfo peopleInfo, <span class=type>int</span> type)</span> {</span><br><span class=line>        <span class=built_in>this</span>.peopleInfo = peopleInfo;</span><br><span class=line>        <span class=built_in>this</span>.type = type;</span><br><span class=line>    }</span><br><span class=line>    <span class=keyword>public</span> PeopleInfo <span class="title function_">getPeopleInfo</span><span class=params>()</span> {</span><br><span class=line>        <span class=keyword>return</span> peopleInfo;</span><br><span class=line>    }</span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">setPeopleInfo</span><span class=params>(PeopleInfo peopleInfo)</span> {</span><br><span class=line>        <span class=built_in>this</span>.peopleInfo = peopleInfo;</span><br><span class=line>    }</span><br><span class=line>    <span class=keyword>public</span> <span class=type>int</span> <span class="title function_">getType</span><span class=params>()</span> {</span><br><span class=line>        <span class=keyword>return</span> type;</span><br><span class=line>    }</span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">setType</span><span class=params>(<span class=type>int</span> type)</span> {</span><br><span class=line>        <span class=built_in>this</span>.type = type;</span><br><span class=line>    }</span><br><span class=line>    <span class=meta>@Override</span></span><br><span class=line>    <span class=keyword>public</span> String <span class="title function_">toString</span><span class=params>()</span> {</span><br><span class=line>        <span class=keyword>return</span> <span class=string>"People{"</span> +</span><br><span class=line>                <span class=string>"peopleInfo="</span> + <span class=built_in>this</span>.getPeopleInfo().toString() +</span><br><span class=line>                <span class=string>", type="</span> + <span class=built_in>this</span>.getType() +</span><br><span class=line>                <span class=string>'}'</span>;</span><br><span class=line>    }</span><br><span class=line>    <span class=comment>/** 浅复制 clone方法实现 */</span></span><br><span class=line><span class=comment>//    @Override</span></span><br><span class=line><span class=comment>//    protected People clone() throws CloneNotSupportedException {</span></span><br><span class=line><span class=comment>//        return (People) super.clone();</span></span><br><span class=line><span class=comment>//    }</span></span><br><span class=line></span><br><span class=line>    <span class=comment>/** 深复制 clone方法实现 */</span></span><br><span class=line>    <span class=meta>@Override</span></span><br><span class=line>    <span class=keyword>protected</span> People <span class="title function_">clone</span><span class=params>()</span> <span class=keyword>throws</span> CloneNotSupportedException {</span><br><span class=line>        <span class=type>People</span> <span class=variable>people</span> <span class=operator>=</span> (People) <span class=built_in>super</span>.clone();</span><br><span class=line>        people.peopleInfo = (PeopleInfo) people.getPeopleInfo().clone();</span><br><span class=line>        <span class=keyword>return</span> people;</span><br><span class=line>    }</span><br><span class=line>}</span><br><span class=line></span><br><span class=line></span><br><span class=line><span class=comment>/**</span></span><br><span class=line><span class=comment> * 设计模式 - 原型模式</span></span><br><span class=line><span class=comment> * </span></span><br><span class=line><span class=comment> * 深拷贝：引用和基本数据类型 都会拷贝；</span></span><br><span class=line><span class=comment> * 浅拷贝：只会拷贝基本数据类型；</span></span><br><span class=line><span class=comment> */</span></span><br><span class=line><span class=keyword>public</span> <span class=keyword>class</span> <span class="title class_">PrototypeApp</span> {</span><br><span class=line></span><br><span class=line>    <span class=comment>/** 浅拷贝 测试 */</span></span><br><span class=line>    <span class=meta>@Test</span></span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">shallowReplication</span><span class=params>()</span> <span class=keyword>throws</span> CloneNotSupportedException {</span><br><span class=line>        <span class=type>PeopleInfo</span> <span class=variable>peopleInfo</span> <span class=operator>=</span> <span class=keyword>new</span> <span class="title class_">PeopleInfo</span>(<span class=number>30</span>);</span><br><span class=line>        <span class=type>People</span> <span class=variable>p1</span> <span class=operator>=</span> <span class=keyword>new</span> <span class="title class_">People</span>(peopleInfo, <span class=number>0</span>);</span><br><span class=line>        <span class=type>People</span> <span class=variable>p2</span> <span class=operator>=</span> p1.clone();</span><br><span class=line>        System.out.println(<span class=string>"p1-1: "</span> + p1.toString()); <span class=comment>// 30 0</span></span><br><span class=line>        System.out.println(<span class=string>"p2-1: "</span> + p2.toString()); <span class=comment>// 30 0</span></span><br><span class=line></span><br><span class=line>        p1.setType(<span class=number>1</span>);</span><br><span class=line>        peopleInfo.setAge(<span class=number>35</span>);</span><br><span class=line></span><br><span class=line>        System.out.println(<span class=string>"p1-2: "</span> + p1.toString()); <span class=comment>// 35 1</span></span><br><span class=line>        System.out.println(<span class=string>"p2-2: "</span> + p2.toString()); <span class=comment>// 35 0</span></span><br><span class=line>    }</span><br><span class=line></span><br><span class=line>    <span class=comment>/** 深拷贝 测试 */</span></span><br><span class=line>    <span class=meta>@Test</span></span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">deepReplication</span><span class=params>()</span> <span class=keyword>throws</span> CloneNotSupportedException {</span><br><span class=line>        <span class=type>PeopleInfo</span> <span class=variable>peopleInfo</span> <span class=operator>=</span> <span class=keyword>new</span> <span class="title class_">PeopleInfo</span>(<span class=number>30</span>);</span><br><span class=line>        <span class=type>People</span> <span class=variable>p1</span> <span class=operator>=</span> <span class=keyword>new</span> <span class="title class_">People</span>(peopleInfo, <span class=number>0</span>);</span><br><span class=line>        <span class=type>People</span> <span class=variable>p2</span> <span class=operator>=</span> p1.clone();</span><br><span class=line>        System.out.println(<span class=string>"p1-1: "</span> + p1.toString()); <span class=comment>// 30 0</span></span><br><span class=line>        System.out.println(<span class=string>"p2-1: "</span> + p2.toString()); <span class=comment>// 30 0</span></span><br><span class=line></span><br><span class=line>        p1.setType(<span class=number>1</span>);</span><br><span class=line>        peopleInfo.setAge(<span class=number>35</span>);</span><br><span class=line></span><br><span class=line>        System.out.println(<span class=string>"p1-2: "</span> + p1.toString()); <span class=comment>// 35 1</span></span><br><span class=line>        System.out.println(<span class=string>"p2-2: "</span> + p2.toString()); <span class=comment>// 30 0</span></span><br><span class=line>    }</span><br><span class=line>}</span><br></pre></table></figure><h2 id=1-2、行为型（11种）><a class=headerlink href=#1-2、行为型（11种） title=1.2、行为型（11种）></a>1.2、行为型（11种）</h2><h3 id=1-2-1、Iterator（迭代器模式）><a class=headerlink href=#1-2-1、Iterator（迭代器模式） title=1.2.1、Iterator（迭代器模式）></a>1.2.1、Iterator（迭代器模式）</h3><h4 id=简介-4><a class=headerlink href=#简介-4 title=简介></a>简介</h4><p><strong>在不暴露对象内部的前提下，可以顺序访问对象的内部元素</strong>。<h4 id=何时使用-5><a class=headerlink href=#何时使用-5 title=何时使用></a>何时使用</h4><p>需要对容器/集合遍历时，可以使用迭代器模式。<h4 id=实现-1><a class=headerlink href=#实现-1 title=实现></a>实现</h4><ul><li>数组实现<li>链表实现</ul><h4 id=优缺点-5><a class=headerlink href=#优缺点-5 title=优缺点></a>优缺点</h4><ul><li><p>优点</p> <ol><li>它支持以不同方式遍历一个聚合对象；<li>迭代器简化了聚合类；<li>在同一聚合上可以有多个遍历；<li>迭代器模式中，增加新的聚合类和迭代器类都很方便，无须修改原有代码；</ol><li><p>缺点</p> <p>由于迭代器模式将存储数据和遍历数据的职责分离，增加新的聚合类需要对应增加新的迭代器类，类的个数成对增加，这在一定程度上增加了系统的复杂性。</p></ul><h4 id=应用场景-4><a class=headerlink href=#应用场景-4 title=应用场景></a>应用场景</h4><ol><li>访问一个聚合对象的内部元素而无须暴露其内部表示。<li>需要为聚合对象提供多种遍历方式。<li>为遍历不同的聚合结构提供一个统一的接口。</ol><h4 id=应用实例-5><a class=headerlink href=#应用实例-5 title=应用实例></a>应用实例</h4><p>JAVA 中的 iterator。<h4 id=注意事项-5><a class=headerlink href=#注意事项-5 title=注意事项></a>注意事项</h4><p><font color=red>迭代器模式分离了集合对象的遍历行为，抽象出一个迭代器类，可实现不爆露对象内部就可访问其内部元素；</font><h4 id=代码实例-5><a class=headerlink href=#代码实例-5 title=代码实例></a>代码实例</h4><figure class="highlight java"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br><span class=line>42</span><br><span class=line>43</span><br><span class=line>44</span><br><span class=line>45</span><br><span class=line>46</span><br><span class=line>47</span><br><span class=line>48</span><br><span class=line>49</span><br><span class=line>50</span><br><span class=line>51</span><br><span class=line>52</span><br><span class=line>53</span><br><span class=line>54</span><br><span class=line>55</span><br><span class=line>56</span><br><span class=line>57</span><br><span class=line>58</span><br><span class=line>59</span><br><span class=line>60</span><br><span class=line>61</span><br><span class=line>62</span><br><span class=line>63</span><br><span class=line>64</span><br><span class=line>65</span><br><span class=line>66</span><br><span class=line>67</span><br><span class=line>68</span><br><span class=line>69</span><br><span class=line>70</span><br><span class=line>71</span><br><span class=line>72</span><br><span class=line>73</span><br><span class=line>74</span><br><span class=line>75</span><br><span class=line>76</span><br><span class=line>77</span><br><span class=line>78</span><br><span class=line>79</span><br><span class=line>80</span><br><span class=line>81</span><br><span class=line>82</span><br><span class=line>83</span><br><span class=line>84</span><br><span class=line>85</span><br><span class=line>86</span><br><span class=line>87</span><br><span class=line>88</span><br><span class=line>89</span><br></pre><td class=code><pre><span class=line><span class=keyword>public</span> <span class=keyword>interface</span> <span class="title class_">Iterator</span> {</span><br><span class=line>    <span class=keyword>public</span> <span class=type>boolean</span> <span class="title function_">hasNext</span><span class=params>()</span>;</span><br><span class=line>    <span class=keyword>public</span> Object <span class="title function_">next</span><span class=params>()</span>;</span><br><span class=line>    <span class=keyword>public</span> Object <span class="title function_">remove</span><span class=params>()</span>;</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=keyword>public</span> <span class=keyword>interface</span> <span class="title class_">IPerson</span> {</span><br><span class=line>    <span class=keyword>public</span> String <span class="title function_">getPersonInfo</span><span class=params>()</span>;</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=keyword>public</span> <span class=keyword>interface</span> <span class="title class_">IPersonList</span> {</span><br><span class=line>    <span class=keyword>public</span> ArrayList&LTIPerson> <span class="title function_">getPersonList</span><span class=params>()</span>;</span><br><span class=line>    <span class=keyword>public</span> Iterator <span class="title function_">iterator</span><span class=params>()</span>;</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=keyword>public</span> <span class=keyword>class</span> <span class="title class_">Person</span> {</span><br><span class=line>    <span class=keyword>private</span> String name;</span><br><span class=line>    <span class=keyword>public</span> <span class="title function_">Person</span><span class=params>(String name)</span>{</span><br><span class=line>        System.out.println(<span class=string>"构造器进来了！"</span>);</span><br><span class=line>        <span class=built_in>this</span>.name = name;</span><br><span class=line>    }</span><br><span class=line>}</span><br><span class=line></span><br><span class=line></span><br><span class=line><span class=keyword>public</span> <span class=keyword>class</span> <span class="title class_">PersonIterator</span> <span class=keyword>implements</span> <span class="title class_">Iterator</span>{</span><br><span class=line>    <span class=keyword>private</span> <span class=keyword>final</span> ArrayList&LTIPerson> personList;</span><br><span class=line>    <span class=keyword>private</span> <span class=type>int</span> <span class=variable>index</span> <span class=operator>=</span> -<span class=number>1</span>;</span><br><span class=line>    <span class=keyword>public</span> <span class="title function_">PersonIterator</span><span class=params>(ArrayList&LTIPerson> personList)</span>{</span><br><span class=line>        <span class=built_in>this</span>.personList = personList;</span><br><span class=line>    }</span><br><span class=line>    <span class=meta>@Override</span></span><br><span class=line>    <span class=keyword>public</span> <span class=type>boolean</span> <span class="title function_">hasNext</span><span class=params>()</span> {</span><br><span class=line>        <span class=keyword>return</span> (<span class=built_in>this</span>.personList == <span class=literal>null</span> ? <span class=literal>false</span> : (index < <span class=built_in>this</span>.personList.size() - <span class=number>1</span>));</span><br><span class=line>    }</span><br><span class=line>    <span class=meta>@Override</span></span><br><span class=line>    <span class=keyword>public</span> Object <span class="title function_">next</span><span class=params>()</span> {</span><br><span class=line>        <span class=keyword>if</span> (<span class=built_in>this</span>.personList != <span class=literal>null</span> && (index < <span class=built_in>this</span>.personList.size() - <span class=number>1</span>)){</span><br><span class=line>            <span class=keyword>return</span> <span class=built_in>this</span>.personList.get(++index);</span><br><span class=line>        }</span><br><span class=line>        <span class=keyword>return</span> <span class=literal>null</span>;</span><br><span class=line>    }</span><br><span class=line>    <span class=meta>@Override</span></span><br><span class=line>    <span class=keyword>public</span> Object <span class="title function_">remove</span><span class=params>()</span> {</span><br><span class=line>        <span class=keyword>if</span> (<span class=built_in>this</span>.personList != <span class=literal>null</span>){</span><br><span class=line>            <span class=keyword>return</span> <span class=built_in>this</span>.personList.remove(index);</span><br><span class=line>        }</span><br><span class=line>        <span class=keyword>return</span> <span class=literal>null</span>;</span><br><span class=line>    }</span><br><span class=line>}</span><br><span class=line></span><br><span class=line></span><br><span class=line><span class=keyword>public</span> <span class=keyword>class</span> <span class="title class_">PersonList</span> <span class=keyword>implements</span> <span class="title class_">IPersonList</span>{</span><br><span class=line>    <span class=keyword>private</span> ArrayList&LTIPerson> personList = <span class=keyword>new</span> <span class="title class_">ArrayList</span>&LTIPerson>();</span><br><span class=line>    <span class=keyword>public</span> <span class="title function_">PersonList</span><span class=params>()</span>{</span><br><span class=line>        <span class=keyword>for</span> (<span class=type>int</span> <span class=variable>i</span> <span class=operator>=</span> <span class=number>0</span>; i < <span class=number>10</span>; i++){</span><br><span class=line>            <span class=type>IPerson</span> <span class=variable>person</span> <span class=operator>=</span> <span class=keyword>new</span> <span class="title class_">Person</span>(<span class=string>"孙悟空"</span>, <span class=number>30</span>);</span><br><span class=line>            <span class=built_in>this</span>.personList.add(person);</span><br><span class=line>        }</span><br><span class=line>    }</span><br><span class=line>    <span class=meta>@Override</span></span><br><span class=line>    <span class=keyword>public</span> ArrayList&LTIPerson> <span class="title function_">getPersonList</span><span class=params>()</span> {</span><br><span class=line>        <span class=keyword>return</span> <span class=built_in>this</span>.personList;</span><br><span class=line>    }</span><br><span class=line>    <span class=meta>@Override</span></span><br><span class=line>    <span class=keyword>public</span> Iterator <span class="title function_">iterator</span><span class=params>()</span> {</span><br><span class=line>        <span class=keyword>return</span> <span class=keyword>new</span> <span class="title class_">PersonIterator</span>(<span class=built_in>this</span>.personList);</span><br><span class=line>    }</span><br><span class=line>}</span><br><span class=line></span><br><span class=line></span><br><span class=line><span class=keyword>public</span> <span class=keyword>class</span> <span class="title class_">IteratorApp</span> {</span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>static</span> <span class=keyword>void</span> <span class="title function_">main</span><span class=params>(String[] args)</span> {</span><br><span class=line>        <span class=type>IPersonList</span> <span class=variable>personList</span> <span class=operator>=</span> <span class=keyword>new</span> <span class="title class_">PersonList</span>();</span><br><span class=line>        ArrayList&LTIPerson> list = personList.getPersonList();</span><br><span class=line>        <span class=keyword>for</span> (<span class=type>int</span> <span class=variable>i</span> <span class=operator>=</span> <span class=number>0</span>; i < list.size(); i++){</span><br><span class=line>            System.out.println(list.get(i).getPersonInfo());</span><br><span class=line>        }</span><br><span class=line></span><br><span class=line>        System.out.println(<span class=string>"----------------------------------"</span>);</span><br><span class=line></span><br><span class=line>        <span class=type>Iterator</span> <span class=variable>iterator</span> <span class=operator>=</span> personList.iterator();</span><br><span class=line>        <span class=keyword>while</span> (iterator.hasNext()){</span><br><span class=line>            <span class=type>IPerson</span> <span class=variable>person</span> <span class=operator>=</span> (IPerson) iterator.next();</span><br><span class=line>            <span class=keyword>if</span> (person != <span class=literal>null</span>){</span><br><span class=line>                System.out.println(person.getPersonInfo());</span><br><span class=line>            }</span><br><span class=line>        }</span><br><span class=line>    }</span><br><span class=line>}</span><br></pre></table></figure><h3 id=1-2-2、Observer（观察者模式）><a class=headerlink href=#1-2-2、Observer（观察者模式） title=1.2.2、Observer（观察者模式）></a>1.2.2、Observer（观察者模式）</h3><h4 id=简介-5><a class=headerlink href=#简介-5 title=简介></a>简介</h4><p><strong>多个参与者对象同时监听参考对象A，当参考对象A发生变化时，所有参与者对象依据该变化会做出相应的改变；</strong><h4 id=何时使用-6><a class=headerlink href=#何时使用-6 title=何时使用></a>何时使用</h4><p>一个对象（目标对象）的状态发生改变，所有的依赖对象（观察者对象）都将得到通知。<h4 id=优缺点-6><a class=headerlink href=#优缺点-6 title=优缺点></a>优缺点</h4><ul><li>优点<ol><li>观察者和被观察者是抽象耦合的。<li>建立一套触发机制。</ol><li>缺点<ol><li>参与者太多 导致 参照者发送通知会消耗很多资源；<li>参与者和参照者中间发生 循坏依赖可能导致系统崩溃。<li>参与者只知道参照者发生了变化，而如何变化却不知道；</ol></ul><h4 id=应用场景-5><a class=headerlink href=#应用场景-5 title=应用场景></a>应用场景</h4><ol><li>一个抽象模型有两个方面，其中一个方面依赖于另一个方面。将这些方面封装在独立的对象中使它们可以各自独立地改变和复用。<li>一个对象的改变将导致其他一个或多个对象也发生改变，而不知道具体有多少对象将发生改变，可以降低对象之间的耦合度。<li>一个对象必须通知其他对象，而并不知道这些对象是谁。<li>需要在系统中创建一个触发链，A 对象的行为将影响 B 对象，B 对象的行为将影响 C 对象……，可以使用观察者模式创建一种链式触发机制。</ol><h4 id=应用实例-6><a class=headerlink href=#应用实例-6 title=应用实例></a>应用实例</h4><ol><li>拍卖的时候，拍卖师观察最高标价，然后通知给其他竞价者竞价。<li>西游记里面悟空请求菩萨降服红孩儿，菩萨洒了一地水招来一个老乌龟，这个乌龟就是观察者，他观察菩萨洒水这个动作。</ol><h4 id=源码应用-2><a class=headerlink href=#源码应用-2 title=源码应用></a>源码应用</h4><figure class="highlight java"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br></pre><td class=code><pre><span class=line>java.util.Observable</span><br><span class=line>org.springframework.context.ApplicationListener</span><br></pre></table></figure><h4 id=注意事项-6><a class=headerlink href=#注意事项-6 title=注意事项></a>注意事项</h4><ol><li><font color=red>JAVA 中存在相关支持类；</font><li><font color=red>应该避免循环引用；</font><li><font color=red>顺序执行将导致某一观察者错误进而导致系统卡壳，故一般采用异步方式；</font></ol><h4 id=代码实例-6><a class=headerlink href=#代码实例-6 title=代码实例></a>代码实例</h4><figure class="highlight java"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br><span class=line>42</span><br><span class=line>43</span><br><span class=line>44</span><br><span class=line>45</span><br><span class=line>46</span><br><span class=line>47</span><br><span class=line>48</span><br><span class=line>49</span><br><span class=line>50</span><br><span class=line>51</span><br><span class=line>52</span><br><span class=line>53</span><br><span class=line>54</span><br><span class=line>55</span><br><span class=line>56</span><br><span class=line>57</span><br><span class=line>58</span><br></pre><td class=code><pre><span class=line><span class=keyword>import</span> java.util.Observable;</span><br><span class=line><span class=comment>/**</span></span><br><span class=line><span class=comment> * 观察目标</span></span><br><span class=line><span class=comment> *</span></span><br><span class=line><span class=comment> * 观察目标的逻辑是先发表文章，再改变观察目标的状态，再通知观察者。</span></span><br><span class=line><span class=comment> */</span></span><br><span class=line><span class=keyword>public</span> <span class=keyword>class</span> <span class="title class_">ObserverTarget</span> <span class=keyword>extends</span> <span class="title class_">Observable</span> {</span><br><span class=line>    <span class=keyword>private</span> <span class=keyword>static</span> String article;</span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>static</span> String <span class="title function_">getArticle</span><span class=params>()</span> {</span><br><span class=line>        <span class=keyword>return</span> article;</span><br><span class=line>    }</span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">publish</span><span class=params>(String article)</span>{</span><br><span class=line>        <span class=built_in>this</span>.article = article;</span><br><span class=line>        <span class=comment>// 改变状态</span></span><br><span class=line>        <span class=built_in>this</span>.setChanged();</span><br><span class=line>        <span class=comment>/* 作用：通知所有观察者；内部逻辑：先获取同步锁，判断状态是否更新，若更新了则清空</span></span><br><span class=line><span class=comment>         * 观察目标状态，然后再使用for循环遍历所有观察者，一一调用观察者的更新方法通知观</span></span><br><span class=line><span class=comment>         * 察者更新。 **/</span></span><br><span class=line>        <span class=built_in>this</span>.notifyObservers();</span><br><span class=line>    }</span><br><span class=line>}</span><br><span class=line></span><br><span class=line></span><br><span class=line><span class=keyword>import</span> java.util.Observable;</span><br><span class=line><span class=keyword>import</span> java.util.Observer;</span><br><span class=line><span class=comment>/**</span></span><br><span class=line><span class=comment> * 观察者：读者</span></span><br><span class=line><span class=comment> */</span></span><br><span class=line><span class=keyword>public</span> <span class=keyword>class</span> <span class="title class_">ReaderObserver</span> <span class=keyword>implements</span> <span class="title class_">Observer</span> {</span><br><span class=line>    <span class=keyword>private</span> String name;</span><br><span class=line>    <span class=keyword>private</span> String article;</span><br><span class=line>    <span class=keyword>public</span> <span class="title function_">ReaderObserver</span><span class=params>(String name)</span>{</span><br><span class=line>        <span class=built_in>this</span>.name = name;</span><br><span class=line>    }</span><br><span class=line>    <span class=meta>@Override</span></span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">update</span><span class=params>(Observable o, Object arg)</span> {</span><br><span class=line>        updateArticle(o);</span><br><span class=line>    }</span><br><span class=line>    <span class=keyword>private</span> <span class=keyword>void</span> <span class="title function_">updateArticle</span><span class=params>(Observable o)</span> {</span><br><span class=line>        <span class=type>ObserverTarget</span> <span class=variable>target</span> <span class=operator>=</span> (ObserverTarget) o;</span><br><span class=line>        <span class=built_in>this</span>.article = ObserverTarget.getArticle();</span><br><span class=line>        System.out.printf(<span class=string>"读者 %s，你好，文章已更新：%s\n"</span>, <span class=built_in>this</span>.name, <span class=built_in>this</span>.article);</span><br><span class=line>    }</span><br><span class=line>}</span><br><span class=line></span><br><span class=line></span><br><span class=line><span class=keyword>public</span> <span class=keyword>class</span> <span class="title class_">ObserverApp</span> {</span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>static</span> <span class=keyword>void</span> <span class="title function_">main</span><span class=params>(String[] args)</span> {</span><br><span class=line>        <span class=comment>// 创建一个观察目标</span></span><br><span class=line>        <span class=type>ObserverTarget</span> <span class=variable>target</span> <span class=operator>=</span> <span class=keyword>new</span> <span class="title class_">ObserverTarget</span>();</span><br><span class=line>        <span class=comment>// 添加观察者</span></span><br><span class=line>        target.addObserver(<span class=keyword>new</span> <span class="title class_">ReaderObserver</span>(<span class=string>"小明"</span>));</span><br><span class=line>        target.addObserver(<span class=keyword>new</span> <span class="title class_">ReaderObserver</span>(<span class=string>"小王"</span>));</span><br><span class=line>        target.addObserver(<span class=keyword>new</span> <span class="title class_">ReaderObserver</span>(<span class=string>"小张"</span>));</span><br><span class=line>        <span class=comment>// 发表文章</span></span><br><span class=line>        target.publish(<span class=string>"啥是观察者模式。"</span>);</span><br><span class=line>    }</span><br><span class=line>}</span><br></pre></table></figure><h3 id=1-2-3、TemplateMethod（模板方法）><a class=headerlink href=#1-2-3、TemplateMethod（模板方法） title=1.2.3、TemplateMethod（模板方法）></a>1.2.3、TemplateMethod（模板方法）</h3><h4 id=简介-6><a class=headerlink href=#简介-6 title=简介></a>简介</h4><p><strong>也称钩子函数，其定义一个操作算法骨架，而将一些步骤延迟到子类中，模板方法使得子类可以不改变一个算法的结果，即可重定义该算法的某些特定步骤。</strong><h4 id=何时使用-7><a class=headerlink href=#何时使用-7 title=何时使用></a>何时使用</h4><p>系统中存在一部分通用方法。<h4 id=优缺点-7><a class=headerlink href=#优缺点-7 title=优缺点></a>优缺点</h4><ul><li><p>优点</p> <ol><li>封装不变部分，扩展可变部分。<li>提取公共代码，便于维护。<li>行为由父类控制，子类实现。</ol><li><p>缺点</p> <p>每一个不同的实现都需要一个子类来实现，类的数量增加导致系统愈加庞大。</p></ul><h4 id=应用场景-6><a class=headerlink href=#应用场景-6 title=应用场景></a>应用场景</h4><ol><li>有多个子类共有的方法，且逻辑相同。<li>重要的、复杂的方法，可以考虑作为模板方法。</ol><h4 id=应用实例-7><a class=headerlink href=#应用实例-7 title=应用实例></a>应用实例</h4><ol><li>在造房子的时候，地基、走线、水管都一样，只有后期加壁橱加栅栏等差异。<li>西游记中的 81 难，就是一个顶层逻辑骨架。<li>spring 对 Hibernate 的支持，将一些规定好的方法封装起来，编程人员直接使用即可。</ol><h4 id=注意事项-7><a class=headerlink href=#注意事项-7 title=注意事项></a>注意事项</h4><p><font color=red>为防止恶意操作，模板方法一般会使用 final 修饰。</font><h4 id=代码实例-7><a class=headerlink href=#代码实例-7 title=代码实例></a>代码实例</h4><figure class="highlight java"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br></pre><td class=code><pre><span class=line><span class=keyword>public</span> <span class=keyword>abstract</span> <span class=keyword>class</span> <span class="title class_">AbstractTemplate</span> {</span><br><span class=line>    <span class=comment>// 模板方法</span></span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">templateMethod</span><span class=params>()</span>{</span><br><span class=line>        init();</span><br><span class=line>        apply();  <span class=comment>// 重点</span></span><br><span class=line>        end();    <span class=comment>// 可以作为钩子方法</span></span><br><span class=line>    }</span><br><span class=line>    <span class=keyword>protected</span> <span class=keyword>void</span> <span class="title function_">init</span><span class=params>()</span> {</span><br><span class=line>        System.out.println(<span class=string>"init 抽象层已经实现，子类也可以选择覆写"</span>);</span><br><span class=line>    }</span><br><span class=line>    <span class=comment>// 留给子类实现</span></span><br><span class=line>    <span class=keyword>protected</span> <span class=keyword>abstract</span> <span class=keyword>void</span> <span class="title function_">apply</span><span class=params>()</span>;</span><br><span class=line>    <span class=keyword>protected</span> <span class=keyword>void</span> <span class="title function_">end</span><span class=params>()</span> {}</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=keyword>public</span> <span class=keyword>class</span> <span class="title class_">ConcreteTemplate</span> <span class=keyword>extends</span> <span class="title class_">AbstractTemplate</span> {</span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">apply</span><span class=params>()</span> {</span><br><span class=line>        System.out.println(<span class=string>"子类实现抽象方法 apply"</span>);</span><br><span class=line>    }</span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">end</span><span class=params>()</span> {</span><br><span class=line>        System.out.println(<span class=string>"我们可以把 method3 当做钩子方法来使用，需要的时候覆写就可以了"</span>);</span><br><span class=line>    }</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=keyword>public</span> <span class=keyword>class</span> <span class="title class_">TemplateMethodApp</span> {</span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>static</span> <span class=keyword>void</span> <span class="title function_">main</span><span class=params>(String[] args)</span> {</span><br><span class=line>        <span class=type>AbstractTemplate</span> <span class=variable>t</span> <span class=operator>=</span> <span class=keyword>new</span> <span class="title class_">ConcreteTemplate</span>();</span><br><span class=line>        <span class=comment>// 调用模板方法</span></span><br><span class=line>        t.templateMethod();</span><br><span class=line>    }</span><br><span class=line>}</span><br></pre></table></figure><h3 id=1-2-4、Strategy（策略模式）><a class=headerlink href=#1-2-4、Strategy（策略模式） title=1.2.4、Strategy（策略模式）></a>1.2.4、Strategy（策略模式）</h3><h4 id=简介-7><a class=headerlink href=#简介-7 title=简介></a>简介</h4><p><strong>一个类的行为或算法可在运行时修改。创建各种策略对象和一个随策略对象改变而会改变行为的context对象。策略对象会改变context对象的执行算法。</strong><h4 id=何时使用-8><a class=headerlink href=#何时使用-8 title=何时使用></a>何时使用</h4><p>一个系统有许多类，而区分它们的只是他们直接的行为。<h4 id=优缺点-8><a class=headerlink href=#优缺点-8 title=优缺点></a>优缺点</h4><ul><li>优点<ol><li>算法可以自由切换。<li>避免使用多重条件判断。<li>扩展性良好。</ol><li>缺点<ol><li>策略类会增多。<li>所有策略类都需要对外暴露。</ol></ul><h4 id=应用场景-7><a class=headerlink href=#应用场景-7 title=应用场景></a>应用场景</h4><ol><li>一个系统中的许多类只存在行为上的区别时，该模式可以动态让一个对象在许多行为中选择一种行为。<li>一个系统需要动态地在几种算法中选择一种。<li>如果一个对象有很多行为，如果不用恰当的模式，这些行为就只好使用多重的条件选择语句来实现。</ol><h4 id=应用实例-8><a class=headerlink href=#应用实例-8 title=应用实例></a>应用实例</h4><ol><li>诸葛亮的锦囊妙计，每一个锦囊就是一个策略。<li>旅行的交通方式可以选择骑自行车、开汽车等，每一种旅行方式都是一个策略。<li>JAVA AWT 中的 LayoutManager。</ol><h4 id=注意事项-8><a class=headerlink href=#注意事项-8 title=注意事项></a>注意事项</h4><p><font color=red>如果一个系统的策略多于四个，就需要考虑使用混合模式，解决策略类膨胀的问题。</font>、<h4 id=代码实例-8><a class=headerlink href=#代码实例-8 title=代码实例></a>代码实例</h4><figure class="highlight java"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br><span class=line>42</span><br><span class=line>43</span><br><span class=line>44</span><br><span class=line>45</span><br><span class=line>46</span><br><span class=line>47</span><br><span class=line>48</span><br><span class=line>49</span><br><span class=line>50</span><br><span class=line>51</span><br><span class=line>52</span><br><span class=line>53</span><br><span class=line>54</span><br><span class=line>55</span><br><span class=line>56</span><br><span class=line>57</span><br><span class=line>58</span><br><span class=line>59</span><br><span class=line>60</span><br><span class=line>61</span><br><span class=line>62</span><br><span class=line>63</span><br><span class=line>64</span><br><span class=line>65</span><br><span class=line>66</span><br><span class=line>67</span><br><span class=line>68</span><br><span class=line>69</span><br><span class=line>70</span><br><span class=line>71</span><br><span class=line>72</span><br><span class=line>73</span><br><span class=line>74</span><br><span class=line>75</span><br><span class=line>76</span><br><span class=line>77</span><br><span class=line>78</span><br><span class=line>79</span><br><span class=line>80</span><br><span class=line>81</span><br><span class=line>82</span><br><span class=line>83</span><br><span class=line>84</span><br></pre><td class=code><pre><span class=line><span class=comment>/**</span></span><br><span class=line><span class=comment> * 会员接口</span></span><br><span class=line><span class=comment> */</span></span><br><span class=line><span class=keyword>public</span> <span class=keyword>interface</span> <span class="title class_">Member</span> {</span><br><span class=line>    <span class=comment>/**</span></span><br><span class=line><span class=comment>     * 计算应付价格</span></span><br><span class=line><span class=comment>     * <span class=doctag>@param</span> bookPrice 书籍原价(针对金额,建议使用BigDecimal,double会损失精度)</span></span><br><span class=line><span class=comment>     * <span class=doctag>@return</span> 应付金额</span></span><br><span class=line><span class=comment>     */</span></span><br><span class=line>    <span class=keyword>public</span> <span class=type>double</span> <span class="title function_">calPrice</span><span class=params>(<span class=type>double</span> bookPrice)</span>;</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=comment>/**</span></span><br><span class=line><span class=comment> * 初级会员</span></span><br><span class=line><span class=comment> */</span></span><br><span class=line><span class=keyword>public</span> <span class=keyword>class</span> <span class="title class_">PrimaryMember</span> <span class=keyword>implements</span> <span class="title class_">Member</span> {</span><br><span class=line>    <span class=meta>@Override</span></span><br><span class=line>    <span class=keyword>public</span> <span class=type>double</span> <span class="title function_">calPrice</span><span class=params>(<span class=type>double</span> bookPrice)</span> {</span><br><span class=line>        System.out.println(<span class=string>"对于初级会员的没有折扣"</span>);</span><br><span class=line>        <span class=keyword>return</span> bookPrice;</span><br><span class=line>    }</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=comment>/**</span></span><br><span class=line><span class=comment> * 中级会员，买书打九折</span></span><br><span class=line><span class=comment> */</span></span><br><span class=line><span class=keyword>public</span> <span class=keyword>class</span> <span class="title class_">IntermediateMember</span> <span class=keyword>implements</span> <span class="title class_">Member</span> {</span><br><span class=line>    <span class=meta>@Override</span></span><br><span class=line>    <span class=keyword>public</span> <span class=type>double</span> <span class="title function_">calPrice</span><span class=params>(<span class=type>double</span> bookPrice)</span> {</span><br><span class=line>        System.out.println(<span class=string>"对于中级会员的折扣为10%"</span>);</span><br><span class=line>        <span class=keyword>return</span> bookPrice * <span class=number>0.9</span>;</span><br><span class=line>    }</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=comment>/**</span></span><br><span class=line><span class=comment> * 高级会员，买书打八折</span></span><br><span class=line><span class=comment> */</span></span><br><span class=line><span class=keyword>public</span> <span class=keyword>class</span> <span class="title class_">AdvancedMember</span> <span class=keyword>implements</span> <span class="title class_">Member</span> {</span><br><span class=line>    <span class=meta>@Override</span></span><br><span class=line>    <span class=keyword>public</span> <span class=type>double</span> <span class="title function_">calPrice</span><span class=params>(<span class=type>double</span> bookPrice)</span> {</span><br><span class=line>        System.out.println(<span class=string>"对于高级会员的折扣为20%"</span>);</span><br><span class=line>        <span class=keyword>return</span> bookPrice * <span class=number>0.8</span>;</span><br><span class=line>    }</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=comment>/**</span></span><br><span class=line><span class=comment> * 书籍价格类</span></span><br><span class=line><span class=comment> */</span></span><br><span class=line><span class=keyword>public</span> <span class=keyword>class</span> <span class="title class_">Cashier</span> {</span><br><span class=line>    <span class=comment>/**</span></span><br><span class=line><span class=comment>     * 会员,策略对象</span></span><br><span class=line><span class=comment>     */</span></span><br><span class=line>    <span class=keyword>private</span> Member member;</span><br><span class=line></span><br><span class=line>    <span class=keyword>public</span> <span class="title function_">Cashier</span><span class=params>(Member member)</span>{</span><br><span class=line>        <span class=built_in>this</span>.member = member;</span><br><span class=line>    }</span><br><span class=line>    <span class=comment>/**</span></span><br><span class=line><span class=comment>     * 计算应付价格</span></span><br><span class=line><span class=comment>     * <span class=doctag>@param</span> booksPrice</span></span><br><span class=line><span class=comment>     * <span class=doctag>@return</span></span></span><br><span class=line><span class=comment>     */</span></span><br><span class=line>    <span class=keyword>public</span> <span class=type>double</span> <span class="title function_">quote</span><span class=params>(<span class=type>double</span> booksPrice)</span> {</span><br><span class=line>        <span class=keyword>return</span> <span class=built_in>this</span>.member.calPrice(booksPrice);</span><br><span class=line>    }</span><br><span class=line>}</span><br><span class=line></span><br><span class=line></span><br><span class=line><span class=keyword>public</span> <span class=keyword>class</span> <span class="title class_">BookStoreApp</span> {</span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>static</span> <span class=keyword>void</span> <span class="title function_">main</span><span class=params>(String[] args)</span> {</span><br><span class=line>        <span class=comment>//选择并创建需要使用的策略对象</span></span><br><span class=line>        <span class=type>Member</span> <span class=variable>strategy</span> <span class=operator>=</span> <span class=keyword>new</span> <span class="title class_">AdvancedMember</span>();</span><br><span class=line>        <span class=comment>//创建环境</span></span><br><span class=line>        <span class=type>Cashier</span> <span class=variable>cashier</span> <span class=operator>=</span> <span class=keyword>new</span> <span class="title class_">Cashier</span>(strategy);</span><br><span class=line>        <span class=comment>//计算价格</span></span><br><span class=line>        <span class=type>double</span> <span class=variable>quote</span> <span class=operator>=</span> cashier.quote(<span class=number>300</span>);</span><br><span class=line>        System.out.println(<span class=string>"高级会员图书的最终价格为："</span> + quote);</span><br><span class=line></span><br><span class=line>        strategy = <span class=keyword>new</span> <span class="title class_">IntermediateMember</span>();</span><br><span class=line>        cashier = <span class=keyword>new</span> <span class="title class_">Cashier</span>(strategy);</span><br><span class=line>        quote = cashier.quote(<span class=number>300</span>);</span><br><span class=line>        System.out.println(<span class=string>"中级会员图书的最终价格为："</span> + quote);</span><br><span class=line>    }</span><br><span class=line>}</span><br></pre></table></figure><h3 id=1-2-5、ChainOfResponsibility（职责链模式）><a class=headerlink href=#1-2-5、ChainOfResponsibility（职责链模式） title=1.2.5、ChainOfResponsibility（职责链模式）></a>1.2.5、ChainOfResponsibility（职责链模式）</h3><h4 id=简介-8><a class=headerlink href=#简介-8 title=简介></a>简介</h4><p><strong>创建一个请求接收者链，每一个请求接收者通过一个引用与其它接收者相连。请求发送者发送的请求会经过 接收者链，链中的每一个接收者都有机会处理该请求。实现了发送者与接收者的解耦。</strong><h4 id=何时使用-9><a class=headerlink href=#何时使用-9 title=何时使用></a>何时使用</h4><p>过滤消息中各种不雅内容；<h4 id=优缺点-9><a class=headerlink href=#优缺点-9 title=优缺点></a>优缺点</h4><ol><li>请求的发送者和接收者解耦。<li>可以执行控制顺序。<li>符合开闭原则和单一职责原则。</ol><h4 id=应用场景-8><a class=headerlink href=#应用场景-8 title=应用场景></a>应用场景</h4><ol><li>多个对象都能处理同一个请求，具体由哪个对象处理该请求则在运行时自动确定。<li>在不明确指定接收者的情况下，向多个对象中的某个对象发送一个请求。<li>动态指定一组对象处理请求的场景。</ol><h4 id=应用实例-9><a class=headerlink href=#应用实例-9 title=应用实例></a>应用实例</h4><ol><li>红楼梦中的 “击鼓传花”。<li>JS 中的事件冒泡。<li>JAVA WEB 中 Apache Tomcat 对 Encoding 的处理，Struts2 的拦截器，jsp servlet 的 Filter。</ol><h4 id=源码应用-3><a class=headerlink href=#源码应用-3 title=源码应用></a>源码应用</h4><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br></pre><td class=code><pre><span class=line>javax.servlet.Filter</span><br><span class=line>javax.servlet.FilterChain</span><br></pre></table></figure><h4 id=注意事项-9><a class=headerlink href=#注意事项-9 title=注意事项></a>注意事项</h4><p><font color=red>JAVA WEB 中有很多应用。</font><h4 id=代码实例-9><a class=headerlink href=#代码实例-9 title=代码实例></a>代码实例</h4><figure class="highlight java"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br></pre><td class=code><pre><span class=line><span class=keyword>import</span> java.util.Random;</span><br><span class=line></span><br><span class=line><span class=keyword>public</span> <span class=keyword>class</span> <span class="title class_">App</span> {</span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>static</span> <span class=keyword>void</span> <span class="title function_">main</span><span class=params>(String[] args)</span> {</span><br><span class=line>        <span class=type>ProcessHandler</span> <span class=variable>processHandler</span> <span class=operator>=</span> ProcessHandler.getInstance();</span><br><span class=line>        <span class=type>Random</span> <span class=variable>random</span> <span class=operator>=</span> <span class=keyword>new</span> <span class="title class_">Random</span>();</span><br><span class=line>        <span class=keyword>for</span> (<span class=type>int</span> <span class=variable>i</span> <span class=operator>=</span> <span class=number>0</span>; i < <span class=number>3</span>; i++){</span><br><span class=line>            <span class=type>int</span> <span class=variable>radom</span> <span class=operator>=</span> random.nextInt(<span class=number>3</span>);</span><br><span class=line>            <span class=type>IStudent</span> <span class=variable>student</span> <span class=operator>=</span> <span class=keyword>new</span> <span class="title class_">Student</span>(radom, <span class=string>"学生"</span> + i + <span class=string>"生病了，需要请假。"</span>);</span><br><span class=line></span><br><span class=line>            System.out.println(<span class=string>"~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~"</span>);</span><br><span class=line>            processHandler.sendMsg(student);</span><br><span class=line>            System.out.println(<span class=string>"~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~"</span>);</span><br><span class=line>        }</span><br><span class=line>    }</span><br><span class=line>}</span><br></pre></table></figure><h3 id=1-2-6、Mediator（中介者模式）><a class=headerlink href=#1-2-6、Mediator（中介者模式） title=1.2.6、Mediator（中介者模式）></a>1.2.6、Mediator（中介者模式）</h3><h4 id=简介-9><a class=headerlink href=#简介-9 title=简介></a>简介</h4><p><strong>创建一个中介类来处理不同类之间的通信，且支持松耦合，代码易维护。</strong><h4 id=何时使用-10><a class=headerlink href=#何时使用-10 title=何时使用></a>何时使用</h4><p>多个类相互耦合，形成了网状结构。<h4 id=优缺点-10><a class=headerlink href=#优缺点-10 title=优缺点></a>优缺点</h4><ul><li><p>优点</p> <ol><li>降低了类的复杂度，将一对多转化成了一对一。<li>实现了类之间的解耦。<li>符合迪米特原则。</ol><li><p>缺点</p> <p>中介者会庞大，变得复杂难以维护。</p></ul><h4 id=应用场景-9><a class=headerlink href=#应用场景-9 title=应用场景></a>应用场景</h4><ol><li>对象间存在复杂引用关系，内部结构复杂难以使用；<li>通过一个中间类来封装多个类中的行为，而又不想生成太多的子类；</ol><h4 id=应用实例-10><a class=headerlink href=#应用实例-10 title=应用实例></a>应用实例</h4><ol><li>中国加入 WTO 之前是各个国家相互贸易，结构复杂，现在是各个国家通过 WTO 来互相贸易。<li>机场调度系统。<li>MVC 框架中 C（控制器）就是 M（模型）和 V（视图）的中介者。</ol><h4 id=注意事项-10><a class=headerlink href=#注意事项-10 title=注意事项></a>注意事项</h4><p><font color=red>不应当在职责混乱时使用。</font><h4 id=代码实例-10><a class=headerlink href=#代码实例-10 title=代码实例></a>代码实例</h4><figure class="highlight java"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br><span class=line>42</span><br><span class=line>43</span><br><span class=line>44</span><br><span class=line>45</span><br><span class=line>46</span><br><span class=line>47</span><br><span class=line>48</span><br><span class=line>49</span><br><span class=line>50</span><br><span class=line>51</span><br><span class=line>52</span><br><span class=line>53</span><br><span class=line>54</span><br><span class=line>55</span><br><span class=line>56</span><br><span class=line>57</span><br><span class=line>58</span><br><span class=line>59</span><br><span class=line>60</span><br><span class=line>61</span><br><span class=line>62</span><br><span class=line>63</span><br><span class=line>64</span><br><span class=line>65</span><br><span class=line>66</span><br><span class=line>67</span><br><span class=line>68</span><br><span class=line>69</span><br><span class=line>70</span><br><span class=line>71</span><br><span class=line>72</span><br><span class=line>73</span><br><span class=line>74</span><br><span class=line>75</span><br><span class=line>76</span><br><span class=line>77</span><br><span class=line>78</span><br><span class=line>79</span><br><span class=line>80</span><br><span class=line>81</span><br><span class=line>82</span><br><span class=line>83</span><br><span class=line>84</span><br><span class=line>85</span><br><span class=line>86</span><br><span class=line>87</span><br><span class=line>88</span><br><span class=line>89</span><br><span class=line>90</span><br><span class=line>91</span><br><span class=line>92</span><br><span class=line>93</span><br><span class=line>94</span><br><span class=line>95</span><br><span class=line>96</span><br><span class=line>97</span><br><span class=line>98</span><br><span class=line>99</span><br><span class=line>100</span><br><span class=line>101</span><br><span class=line>102</span><br><span class=line>103</span><br><span class=line>104</span><br><span class=line>105</span><br><span class=line>106</span><br><span class=line>107</span><br><span class=line>108</span><br></pre><td class=code><pre><span class=line><span class=comment>/**</span></span><br><span class=line><span class=comment> * 用户接口</span></span><br><span class=line><span class=comment> */</span></span><br><span class=line><span class=keyword>public</span> <span class=keyword>interface</span> <span class="title class_">IUser</span> {</span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">receiveMsg</span><span class=params>(String msg)</span>;</span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">sendMsg</span><span class=params>(String msg)</span>;</span><br><span class=line>    <span class=keyword>public</span> String <span class="title function_">getMsg</span><span class=params>()</span>;</span><br><span class=line>}</span><br><span class=line></span><br><span class=line></span><br><span class=line><span class=comment>/**</span></span><br><span class=line><span class=comment> * 中介者接口</span></span><br><span class=line><span class=comment> */</span></span><br><span class=line><span class=keyword>public</span> <span class=keyword>interface</span> <span class="title class_">IMediator</span> {</span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">regist</span><span class=params>(IUser iUser)</span>;</span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">notifyAllMsg</span><span class=params>(IUser iUser)</span>;</span><br><span class=line>}</span><br><span class=line></span><br><span class=line></span><br><span class=line><span class=keyword>public</span> <span class=keyword>abstract</span> <span class=keyword>class</span> <span class="title class_">AbstractUser</span> <span class=keyword>implements</span> <span class="title class_">IUser</span>{</span><br><span class=line>    <span class=keyword>protected</span> IMediator mediator;</span><br><span class=line>    <span class=keyword>protected</span>  String name;</span><br><span class=line>    <span class=keyword>protected</span> String msg;</span><br><span class=line></span><br><span class=line>    <span class=keyword>public</span> <span class="title function_">AbstractUser</span><span class=params>(IMediator mediator, String name)</span>{</span><br><span class=line>        <span class=built_in>this</span>.mediator = mediator;</span><br><span class=line>        <span class=built_in>this</span>.name = name;</span><br><span class=line>    }</span><br><span class=line></span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">sendMsg</span><span class=params>(String msg)</span>{</span><br><span class=line>        <span class=built_in>this</span>.msg = msg;</span><br><span class=line>        System.out.println(<span class=built_in>this</span>.name + <span class=string>"说： "</span> + <span class=built_in>this</span>.msg );</span><br><span class=line>        mediator.notifyAllMsg(<span class=built_in>this</span>);</span><br><span class=line>    }</span><br><span class=line></span><br><span class=line>    <span class=keyword>public</span> String <span class="title function_">getMsg</span><span class=params>()</span>{</span><br><span class=line>        <span class=keyword>return</span> msg;</span><br><span class=line>    }</span><br><span class=line>}</span><br><span class=line></span><br><span class=line></span><br><span class=line><span class=keyword>public</span> <span class=keyword>class</span> <span class="title class_">ConcreteMediator</span> <span class=keyword>implements</span> <span class="title class_">IMediator</span>{</span><br><span class=line>    <span class=keyword>private</span> <span class=keyword>final</span> List&LTIUser> userList = <span class=keyword>new</span> <span class="title class_">ArrayList</span>&LTIUser>();</span><br><span class=line>    <span class=meta>@Override</span></span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">regist</span><span class=params>(IUser iUser)</span> {</span><br><span class=line>        <span class=keyword>if</span> (iUser != <span class=literal>null</span> && !userList.contains(iUser)){</span><br><span class=line>            userList.add(iUser);</span><br><span class=line>        }</span><br><span class=line>    }</span><br><span class=line>    <span class=meta>@Override</span></span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">notifyAllMsg</span><span class=params>(IUser iUser)</span> {</span><br><span class=line>        Iterator&LTIUser> iterator = userList.iterator();</span><br><span class=line>        <span class=type>IUser</span> <span class=variable>tmp</span> <span class=operator>=</span> <span class=literal>null</span>;</span><br><span class=line>        <span class=keyword>while</span> (iterator.hasNext()){</span><br><span class=line>            tmp = iterator.next();</span><br><span class=line>            <span class=keyword>if</span> (tmp != <span class=literal>null</span> && !tmp.equals(iUser)){</span><br><span class=line>                tmp.receiveMsg(iUser.getMsg());</span><br><span class=line>            }</span><br><span class=line>        }</span><br><span class=line>    }</span><br><span class=line>}</span><br><span class=line></span><br><span class=line></span><br><span class=line><span class=keyword>public</span> <span class=keyword>class</span> <span class="title class_">UserA</span> <span class=keyword>extends</span> <span class="title class_">AbstractUser</span>{</span><br><span class=line>    <span class=keyword>public</span> <span class="title function_">UserA</span><span class=params>(IMediator mediator, String name)</span>{</span><br><span class=line>        <span class=built_in>super</span>(mediator, name);</span><br><span class=line>        mediator.regist(<span class=built_in>this</span>);</span><br><span class=line>    }</span><br><span class=line>    <span class=meta>@Override</span></span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">receiveMsg</span><span class=params>(String msg)</span> {</span><br><span class=line>        System.out.println(<span class=string>"UserA received msg: "</span> + msg);</span><br><span class=line>    }</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=keyword>public</span> <span class=keyword>class</span> <span class="title class_">UserB</span> <span class=keyword>extends</span> <span class="title class_">AbstractUser</span>{</span><br><span class=line>    <span class=keyword>public</span> <span class="title function_">UserB</span><span class=params>(IMediator mediator, String name)</span>{</span><br><span class=line>        <span class=built_in>super</span>(mediator, name);</span><br><span class=line>        mediator.regist(<span class=built_in>this</span>);</span><br><span class=line>    }</span><br><span class=line>    <span class=meta>@Override</span></span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">receiveMsg</span><span class=params>(String msg)</span> {</span><br><span class=line>        System.out.println(<span class=string>"UserB received msg: "</span> + msg);</span><br><span class=line>    }</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=keyword>public</span> <span class=keyword>class</span> <span class="title class_">UserC</span> <span class=keyword>extends</span> <span class="title class_">AbstractUser</span>{</span><br><span class=line>    <span class=keyword>public</span> <span class="title function_">UserC</span><span class=params>(IMediator mediator, String name)</span>{</span><br><span class=line>        <span class=built_in>super</span>(mediator, name);</span><br><span class=line>        mediator.regist(<span class=built_in>this</span>);</span><br><span class=line>    }</span><br><span class=line>    <span class=meta>@Override</span></span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">receiveMsg</span><span class=params>(String msg)</span> {</span><br><span class=line>        System.out.println(<span class=string>"UserC received msg: "</span> + msg);</span><br><span class=line>    }</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=keyword>public</span> <span class=keyword>class</span> <span class="title class_">MediatorApp</span> {</span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>static</span> <span class=keyword>void</span> <span class="title function_">main</span><span class=params>(String[] args)</span> {</span><br><span class=line>        <span class=type>IMediator</span> <span class=variable>mediator</span> <span class=operator>=</span> <span class=keyword>new</span> <span class="title class_">ConcreteMediator</span>();</span><br><span class=line>        <span class=type>IUser</span> <span class=variable>userA</span> <span class=operator>=</span> <span class=keyword>new</span> <span class="title class_">UserA</span>(mediator, <span class=string>"孙悟空"</span>);</span><br><span class=line>        <span class=type>IUser</span> <span class=variable>userB</span> <span class=operator>=</span> <span class=keyword>new</span> <span class="title class_">UserB</span>(mediator, <span class=string>"猪八戒"</span>);</span><br><span class=line>        <span class=type>IUser</span> <span class=variable>userC</span> <span class=operator>=</span> <span class=keyword>new</span> <span class="title class_">UserC</span>(mediator, <span class=string>"沙和尚"</span>);</span><br><span class=line></span><br><span class=line>        userA.sendMsg(<span class=string>"大家好，我乃齐天大圣 孙悟空！"</span>);</span><br><span class=line>        userB.sendMsg(<span class=string>"大家好，我乃高老庄 猪八戒！"</span>);</span><br><span class=line>        userC.sendMsg(<span class=string>"大家好，我乃 沙和尚！"</span>);</span><br><span class=line>    }</span><br><span class=line>}</span><br></pre></table></figure><h3 id=1-2-7、Interpreter（解释器模式）><a class=headerlink href=#1-2-7、Interpreter（解释器模式） title=1.2.7、Interpreter（解释器模式）></a>1.2.7、Interpreter（解释器模式）</h3><h4 id=简介-10><a class=headerlink href=#简介-10 title=简介></a>简介</h4><p><strong>实现一个表达式接口，该接口解释一个特定上下文。该模式在SQL解析、符号处理引擎中有使用。</strong><h4 id=何时使用-11><a class=headerlink href=#何时使用-11 title=何时使用></a>何时使用</h4><p>某一个类型的问题发送频率特高，可以将该类型问题的各实例封装成一个简单描述，然后通过解释器来解释处理该描述。<h4 id=优缺点-11><a class=headerlink href=#优缺点-11 title=优缺点></a>优缺点</h4><ul><li>优点<ol><li>可扩展性比较好，灵活。<li>增加了新的解释表达式的方式。<li>易于实现简单文法。</ol><li>缺点<ol><li>可利用场景比较少。<li>对于复杂的文法比较难维护。<li>解释器模式会引起类膨胀。<li>解释器模式采用递归调用方法。</ol></ul><h4 id=应用场景-10><a class=headerlink href=#应用场景-10 title=应用场景></a>应用场景</h4><ol><li>将一个解释执行语言中的句子表示为一个抽象语法树。<li>重复出现的问题可以用一种简单的语言来进行表达。<li>简单语法需要解释的场景。</ol><h4 id=应用实例-11><a class=headerlink href=#应用实例-11 title=应用实例></a>应用实例</h4><p>编译器、运算表达式计算。<h4 id=注意事项-11><a class=headerlink href=#注意事项-11 title=注意事项></a>注意事项</h4><p><font color=red>可利用场景比较少，JAVA 中可以用 expression4J 代替。</font><h4 id=代码实例-11><a class=headerlink href=#代码实例-11 title=代码实例></a>代码实例</h4><figure class="highlight java"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br><span class=line>42</span><br><span class=line>43</span><br><span class=line>44</span><br><span class=line>45</span><br><span class=line>46</span><br><span class=line>47</span><br><span class=line>48</span><br><span class=line>49</span><br><span class=line>50</span><br><span class=line>51</span><br><span class=line>52</span><br><span class=line>53</span><br><span class=line>54</span><br><span class=line>55</span><br><span class=line>56</span><br><span class=line>57</span><br><span class=line>58</span><br><span class=line>59</span><br><span class=line>60</span><br><span class=line>61</span><br><span class=line>62</span><br><span class=line>63</span><br><span class=line>64</span><br><span class=line>65</span><br><span class=line>66</span><br><span class=line>67</span><br><span class=line>68</span><br><span class=line>69</span><br><span class=line>70</span><br><span class=line>71</span><br><span class=line>72</span><br><span class=line>73</span><br><span class=line>74</span><br><span class=line>75</span><br><span class=line>76</span><br><span class=line>77</span><br><span class=line>78</span><br><span class=line>79</span><br><span class=line>80</span><br><span class=line>81</span><br><span class=line>82</span><br><span class=line>83</span><br><span class=line>84</span><br><span class=line>85</span><br><span class=line>86</span><br><span class=line>87</span><br><span class=line>88</span><br><span class=line>89</span><br><span class=line>90</span><br><span class=line>91</span><br><span class=line>92</span><br><span class=line>93</span><br><span class=line>94</span><br><span class=line>95</span><br><span class=line>96</span><br><span class=line>97</span><br><span class=line>98</span><br><span class=line>99</span><br><span class=line>100</span><br><span class=line>101</span><br><span class=line>102</span><br><span class=line>103</span><br><span class=line>104</span><br><span class=line>105</span><br><span class=line>106</span><br><span class=line>107</span><br><span class=line>108</span><br><span class=line>109</span><br><span class=line>110</span><br><span class=line>111</span><br><span class=line>112</span><br><span class=line>113</span><br><span class=line>114</span><br><span class=line>115</span><br><span class=line>116</span><br><span class=line>117</span><br><span class=line>118</span><br><span class=line>119</span><br><span class=line>120</span><br><span class=line>121</span><br><span class=line>122</span><br><span class=line>123</span><br><span class=line>124</span><br><span class=line>125</span><br><span class=line>126</span><br><span class=line>127</span><br><span class=line>128</span><br><span class=line>129</span><br><span class=line>130</span><br><span class=line>131</span><br><span class=line>132</span><br><span class=line>133</span><br><span class=line>134</span><br><span class=line>135</span><br><span class=line>136</span><br><span class=line>137</span><br><span class=line>138</span><br><span class=line>139</span><br><span class=line>140</span><br><span class=line>141</span><br><span class=line>142</span><br><span class=line>143</span><br><span class=line>144</span><br><span class=line>145</span><br><span class=line>146</span><br><span class=line>147</span><br><span class=line>148</span><br><span class=line>149</span><br><span class=line>150</span><br><span class=line>151</span><br><span class=line>152</span><br><span class=line>153</span><br><span class=line>154</span><br><span class=line>155</span><br><span class=line>156</span><br><span class=line>157</span><br><span class=line>158</span><br><span class=line>159</span><br><span class=line>160</span><br><span class=line>161</span><br><span class=line>162</span><br><span class=line>163</span><br><span class=line>164</span><br><span class=line>165</span><br><span class=line>166</span><br><span class=line>167</span><br><span class=line>168</span><br><span class=line>169</span><br><span class=line>170</span><br><span class=line>171</span><br><span class=line>172</span><br><span class=line>173</span><br><span class=line>174</span><br><span class=line>175</span><br><span class=line>176</span><br><span class=line>177</span><br><span class=line>178</span><br><span class=line>179</span><br><span class=line>180</span><br><span class=line>181</span><br><span class=line>182</span><br><span class=line>183</span><br><span class=line>184</span><br><span class=line>185</span><br><span class=line>186</span><br><span class=line>187</span><br><span class=line>188</span><br><span class=line>189</span><br><span class=line>190</span><br><span class=line>191</span><br><span class=line>192</span><br><span class=line>193</span><br><span class=line>194</span><br><span class=line>195</span><br><span class=line>196</span><br><span class=line>197</span><br><span class=line>198</span><br><span class=line>199</span><br><span class=line>200</span><br><span class=line>201</span><br><span class=line>202</span><br><span class=line>203</span><br><span class=line>204</span><br><span class=line>205</span><br><span class=line>206</span><br><span class=line>207</span><br><span class=line>208</span><br><span class=line>209</span><br><span class=line>210</span><br><span class=line>211</span><br><span class=line>212</span><br><span class=line>213</span><br><span class=line>214</span><br><span class=line>215</span><br><span class=line>216</span><br><span class=line>217</span><br><span class=line>218</span><br><span class=line>219</span><br><span class=line>220</span><br><span class=line>221</span><br><span class=line>222</span><br><span class=line>223</span><br><span class=line>224</span><br><span class=line>225</span><br><span class=line>226</span><br></pre><td class=code><pre><span class=line><span class=comment>/**</span></span><br><span class=line><span class=comment> * 上下文环境</span></span><br><span class=line><span class=comment> */</span></span><br><span class=line><span class=keyword>public</span> <span class=keyword>class</span> <span class="title class_">Context</span> {</span><br><span class=line>    <span class=keyword>private</span> <span class=keyword>final</span> StringTokenizer stringTokenizer;</span><br><span class=line>    <span class=keyword>private</span> String currentToken;</span><br><span class=line>    <span class=keyword>private</span> <span class=keyword>final</span> Map&LTString, Object> map = <span class=keyword>new</span> <span class="title class_">HashMap</span>&LTString, Object>();</span><br><span class=line></span><br><span class=line>    <span class=keyword>public</span> <span class="title function_">Context</span><span class=params>(String text)</span>{</span><br><span class=line>        <span class=built_in>this</span>.stringTokenizer = <span class=keyword>new</span> <span class="title class_">StringTokenizer</span>(text);</span><br><span class=line>    }</span><br><span class=line></span><br><span class=line>    <span class=keyword>public</span> String <span class="title function_">next</span><span class=params>()</span>{</span><br><span class=line>        <span class=keyword>if</span> (<span class=built_in>this</span>.stringTokenizer.hasMoreTokens()){</span><br><span class=line>            currentToken = <span class=built_in>this</span>.stringTokenizer.nextToken();</span><br><span class=line>        }<span class=keyword>else</span> {</span><br><span class=line>            currentToken = <span class=literal>null</span>;</span><br><span class=line>        }</span><br><span class=line>        <span class=keyword>return</span> currentToken;</span><br><span class=line>    }</span><br><span class=line></span><br><span class=line>    <span class=keyword>public</span> <span class=type>boolean</span> <span class="title function_">equalsWithCommand</span><span class=params>(String command)</span>{</span><br><span class=line>        <span class=keyword>if</span> (command == <span class=literal>null</span> || !command.equals(<span class=built_in>this</span>.currentToken)){</span><br><span class=line>            <span class=keyword>return</span> <span class=literal>false</span>;</span><br><span class=line>        }</span><br><span class=line>        <span class=keyword>return</span> <span class=literal>true</span>;</span><br><span class=line>    }</span><br><span class=line></span><br><span class=line>    <span class=keyword>public</span> String <span class="title function_">getCurrentToken</span><span class=params>()</span>{</span><br><span class=line>        <span class=keyword>return</span> <span class=built_in>this</span>.currentToken;</span><br><span class=line>    }</span><br><span class=line></span><br><span class=line>    <span class=keyword>public</span> String <span class="title function_">getTokenContext</span><span class=params>(String text)</span>{</span><br><span class=line>        <span class=type>String</span> <span class=variable>str</span> <span class=operator>=</span> text;</span><br><span class=line>        <span class=keyword>if</span> (str != <span class=literal>null</span>){</span><br><span class=line>            Iterator&LTString> iterator = <span class=built_in>this</span>.map.keySet().iterator();</span><br><span class=line>            <span class=keyword>while</span> (iterator.hasNext()){</span><br><span class=line>                <span class=type>String</span> <span class=variable>key</span> <span class=operator>=</span> iterator.next();</span><br><span class=line>                <span class=type>Object</span> <span class=variable>obj</span> <span class=operator>=</span> map.get(key);</span><br><span class=line>                str = str.replaceAll(key, obj.toString());</span><br><span class=line>            }</span><br><span class=line>        }</span><br><span class=line>        <span class=keyword>return</span> str;</span><br><span class=line>    }</span><br><span class=line></span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">put</span><span class=params>(String key, Object value)</span>{</span><br><span class=line>        <span class=built_in>this</span>.map.put(key, value);</span><br><span class=line>    }</span><br><span class=line></span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">clear</span><span class=params>(String key)</span>{</span><br><span class=line>        <span class=built_in>this</span>.map.remove(key);</span><br><span class=line>    }</span><br><span class=line>}</span><br><span class=line></span><br><span class=line></span><br><span class=line><span class=keyword>public</span> <span class=keyword>interface</span> <span class="title class_">IExpressions</span> {</span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">parse</span><span class=params>(Context context)</span>;</span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">interpret</span><span class=params>()</span>;</span><br><span class=line>}</span><br><span class=line></span><br><span class=line></span><br><span class=line><span class=keyword>public</span> <span class=keyword>class</span> <span class="title class_">ListExpression</span> <span class=keyword>implements</span> <span class="title class_">IExpressions</span>{</span><br><span class=line>    <span class=keyword>private</span> Context context;</span><br><span class=line>    <span class=keyword>private</span> <span class=keyword>final</span> ArrayList&LTIExpressions> list = <span class=keyword>new</span> <span class="title class_">ArrayList</span>&LTIExpressions>();</span><br><span class=line>    <span class=meta>@Override</span></span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">parse</span><span class=params>(Context context)</span> {</span><br><span class=line>        <span class=built_in>this</span>.context = context;</span><br><span class=line>        <span class=keyword>while</span> (<span class=literal>true</span>){</span><br><span class=line>            <span class=keyword>if</span> (<span class=built_in>this</span>.context.getCurrentToken() == <span class=literal>null</span>){</span><br><span class=line>                System.out.println(<span class=string>"Error: the experssion missing end! "</span>);</span><br><span class=line>                <span class=keyword>break</span>;</span><br><span class=line>            }<span class=keyword>else</span> <span class=keyword>if</span> (<span class=built_in>this</span>.context.equalsWithCommand(<span class=string>"END"</span>)){</span><br><span class=line>                <span class=built_in>this</span>.context.next();</span><br><span class=line>                <span class=keyword>break</span>;</span><br><span class=line>            }<span class=keyword>else</span> {</span><br><span class=line>                <span class=type>IExpressions</span> <span class=variable>expressions</span> <span class=operator>=</span> <span class=keyword>new</span> <span class="title class_">CommandExperssion</span>(<span class=built_in>this</span>.context);</span><br><span class=line>                list.add(expressions);</span><br><span class=line>            }</span><br><span class=line>        }</span><br><span class=line>    }</span><br><span class=line>    <span class=meta>@Override</span></span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">interpret</span><span class=params>()</span> {</span><br><span class=line>        Iterator&LTIExpressions> iterator = list.iterator();</span><br><span class=line>        <span class=keyword>while</span> (iterator.hasNext()){</span><br><span class=line>            iterator.next().interpret();</span><br><span class=line>        }</span><br><span class=line>    }</span><br><span class=line>}</span><br><span class=line></span><br><span class=line></span><br><span class=line><span class=keyword>public</span> <span class=keyword>class</span> <span class="title class_">PrimitiveExpression</span> <span class=keyword>implements</span> <span class="title class_">IExpressions</span>{</span><br><span class=line>    <span class=keyword>private</span> Context context;</span><br><span class=line>    <span class=keyword>private</span> String tokenName;</span><br><span class=line>    <span class=keyword>private</span> String text;</span><br><span class=line>    <span class=keyword>public</span> <span class="title function_">PrimitiveExpression</span><span class=params>(Context context)</span>{</span><br><span class=line>        <span class=built_in>this</span>.parse(context);</span><br><span class=line>    }</span><br><span class=line>    <span class=meta>@Override</span></span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">parse</span><span class=params>(Context context)</span> {</span><br><span class=line>        <span class=built_in>this</span>.context = context;</span><br><span class=line>        <span class=built_in>this</span>.tokenName = <span class=built_in>this</span>.context.getCurrentToken();</span><br><span class=line>        <span class=built_in>this</span>.context.next();</span><br><span class=line>        <span class=keyword>if</span> (<span class=string>"PRINTLN"</span>.equals(<span class=built_in>this</span>.tokenName)){</span><br><span class=line>            <span class=built_in>this</span>.text = <span class=built_in>this</span>.context.getCurrentToken();</span><br><span class=line>            <span class=built_in>this</span>.context.next();</span><br><span class=line>        }</span><br><span class=line>    }</span><br><span class=line>    <span class=meta>@Override</span></span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">interpret</span><span class=params>()</span> {</span><br><span class=line>        <span class=keyword>if</span> (<span class=string>"PRINTLN"</span>.equals(tokenName)){</span><br><span class=line>            System.out.println(<span class=built_in>this</span>.context.getTokenContext(<span class=built_in>this</span>.text));</span><br><span class=line>        }</span><br><span class=line>    }</span><br><span class=line>}</span><br><span class=line></span><br><span class=line></span><br><span class=line><span class=keyword>public</span> <span class=keyword>class</span> <span class="title class_">ProgramExpression</span> <span class=keyword>implements</span> <span class="title class_">IExpressions</span>{</span><br><span class=line>    <span class=keyword>private</span> <span class=keyword>final</span> Context context;</span><br><span class=line>    <span class=keyword>private</span> <span class=keyword>final</span> <span class=keyword>static</span> <span class=type>String</span> <span class=variable>COMMAND</span> <span class=operator>=</span> <span class=string>"PROGRAM"</span>;</span><br><span class=line>    <span class=keyword>private</span> IExpressions expressions;</span><br><span class=line>    <span class=keyword>public</span> <span class="title function_">ProgramExpression</span><span class=params>(String text)</span>{</span><br><span class=line>        <span class=built_in>this</span>.context = <span class=keyword>new</span> <span class="title class_">Context</span>(text);</span><br><span class=line>        <span class=built_in>this</span>.parse(<span class=built_in>this</span>.context);</span><br><span class=line>    }</span><br><span class=line>    <span class=meta>@Override</span></span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">parse</span><span class=params>(Context context)</span> {</span><br><span class=line>        <span class=built_in>this</span>.context.next();</span><br><span class=line>    }</span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">interpret</span><span class=params>()</span>{</span><br><span class=line>        <span class=keyword>if</span> (!<span class=built_in>this</span>.context.equalsWithCommand(COMMAND)){</span><br><span class=line>            System.out.println(<span class=string>"the "</span> + COMMAND + <span class=string>"is Excepted for start!"</span>);</span><br><span class=line>        }<span class=keyword>else</span> {</span><br><span class=line>            <span class=built_in>this</span>.context.next();</span><br><span class=line>            <span class=built_in>this</span>.expressions = <span class=keyword>new</span> <span class="title class_">ListExpression</span>();</span><br><span class=line>            <span class=built_in>this</span>.expressions.parse(<span class=built_in>this</span>.context);</span><br><span class=line>            <span class=built_in>this</span>.expressions.interpret();</span><br><span class=line>        }</span><br><span class=line>    }</span><br><span class=line>}</span><br><span class=line></span><br><span class=line></span><br><span class=line><span class=keyword>public</span> <span class=keyword>class</span> <span class="title class_">ForExpression</span> <span class=keyword>implements</span> <span class="title class_">IExpressions</span>{</span><br><span class=line>    <span class=keyword>private</span> <span class=keyword>final</span> Context context;</span><br><span class=line>    <span class=keyword>private</span> String variable;</span><br><span class=line>    <span class=keyword>private</span> <span class=type>int</span> start_index;</span><br><span class=line>    <span class=keyword>private</span> <span class=type>int</span> end_index;</span><br><span class=line>    <span class=keyword>private</span> IExpressions expressions;</span><br><span class=line>    <span class=keyword>public</span> <span class="title function_">ForExpression</span><span class=params>(Context context)</span>{</span><br><span class=line>        <span class=built_in>this</span>.context = context;</span><br><span class=line>        <span class=built_in>this</span>.parse(<span class=built_in>this</span>.context);</span><br><span class=line>    }</span><br><span class=line></span><br><span class=line>    <span class=meta>@Override</span></span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">parse</span><span class=params>(Context context)</span> {</span><br><span class=line>        <span class=built_in>this</span>.context.next();</span><br><span class=line>        <span class=keyword>while</span> (<span class=literal>true</span>){</span><br><span class=line>            <span class=keyword>if</span> (<span class=built_in>this</span>.context.equalsWithCommand(<span class=string>"FROM"</span>)){</span><br><span class=line>                <span class=type>String</span> <span class=variable>nextStr</span> <span class=operator>=</span> <span class=built_in>this</span>.context.next();</span><br><span class=line>                <span class=keyword>try</span> {</span><br><span class=line>                    <span class=built_in>this</span>.start_index = Integer.parseInt(nextStr);</span><br><span class=line>                }<span class=keyword>catch</span> (Exception e){</span><br><span class=line>                    e.printStackTrace();</span><br><span class=line>                    <span class=keyword>break</span>;</span><br><span class=line>                }</span><br><span class=line>                <span class=built_in>this</span>.context.next();</span><br><span class=line>            }<span class=keyword>else</span> <span class=keyword>if</span> (<span class=built_in>this</span>.context.equalsWithCommand(<span class=string>"TO"</span>)){</span><br><span class=line>                <span class=type>String</span> <span class=variable>nextStr</span> <span class=operator>=</span> <span class=built_in>this</span>.context.next();</span><br><span class=line>                <span class=keyword>try</span> {</span><br><span class=line>                    <span class=built_in>this</span>.end_index = Integer.parseInt(nextStr);</span><br><span class=line>                }<span class=keyword>catch</span> (Exception e){</span><br><span class=line>                    e.printStackTrace();</span><br><span class=line>                }</span><br><span class=line>                <span class=built_in>this</span>.context.next();</span><br><span class=line>                <span class=keyword>break</span>;</span><br><span class=line>            }<span class=keyword>else</span> {</span><br><span class=line>                <span class=keyword>if</span> (<span class=built_in>this</span>.variable == <span class=literal>null</span>){</span><br><span class=line>                    <span class=built_in>this</span>.variable = <span class=built_in>this</span>.context.getCurrentToken();</span><br><span class=line>                }</span><br><span class=line>                <span class=built_in>this</span>.context.next();</span><br><span class=line>            }</span><br><span class=line>        }</span><br><span class=line>        <span class=built_in>this</span>.expressions = <span class=keyword>new</span> <span class="title class_">ListExpression</span>();</span><br><span class=line>        <span class=built_in>this</span>.expressions.parse(<span class=built_in>this</span>.context);</span><br><span class=line>    }</span><br><span class=line>    <span class=meta>@Override</span></span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">interpret</span><span class=params>()</span> {</span><br><span class=line>        <span class=keyword>for</span> (<span class=type>int</span> <span class=variable>x</span> <span class=operator>=</span> <span class=built_in>this</span>.start_index; x < <span class=built_in>this</span>.end_index; x++){</span><br><span class=line>            <span class=built_in>this</span>.context.put(<span class=string>""</span> + <span class=built_in>this</span>.variable, x);</span><br><span class=line>            <span class=built_in>this</span>.expressions.interpret();</span><br><span class=line>        }</span><br><span class=line>        <span class=built_in>this</span>.context.clear(<span class=string>""</span> + <span class=built_in>this</span>.variable);</span><br><span class=line>    }</span><br><span class=line>}</span><br><span class=line></span><br><span class=line></span><br><span class=line><span class=keyword>public</span> <span class=keyword>class</span> <span class="title class_">CommandExperssion</span> <span class=keyword>implements</span> <span class="title class_">IExpressions</span>{</span><br><span class=line>    <span class=keyword>private</span> <span class=keyword>final</span> Context context;</span><br><span class=line>    <span class=keyword>private</span> IExpressions expressions;</span><br><span class=line></span><br><span class=line>    <span class=keyword>public</span> <span class="title function_">CommandExperssion</span><span class=params>(Context context)</span>{</span><br><span class=line>        <span class=built_in>this</span>.context = context;</span><br><span class=line>        <span class=built_in>this</span>.parse(<span class=built_in>this</span>.context);</span><br><span class=line>    }</span><br><span class=line>    <span class=meta>@Override</span></span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">parse</span><span class=params>(Context context)</span> {</span><br><span class=line>        <span class=keyword>if</span> (<span class=built_in>this</span>.context.equalsWithCommand(<span class=string>"FOR"</span>)){</span><br><span class=line>            expressions = <span class=keyword>new</span> <span class="title class_">ForExpression</span>(<span class=built_in>this</span>.context);</span><br><span class=line>        }<span class=keyword>else</span>{</span><br><span class=line>            expressions = <span class=keyword>new</span> <span class="title class_">PrimitiveExpression</span>(<span class=built_in>this</span>.context);</span><br><span class=line>        }</span><br><span class=line>    }</span><br><span class=line>    <span class=meta>@Override</span></span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">interpret</span><span class=params>()</span> {</span><br><span class=line>        <span class=built_in>this</span>.expressions.interpret();</span><br><span class=line>    }</span><br><span class=line>}</span><br><span class=line></span><br><span class=line></span><br><span class=line><span class=keyword>public</span> <span class=keyword>class</span> <span class="title class_">InterpreterApp</span> {</span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>static</span> <span class=keyword>void</span> <span class="title function_">main</span><span class=params>(String[] args)</span> {</span><br><span class=line>        <span class=type>String</span> <span class=variable>str</span> <span class=operator>=</span> <span class=string>"PROGRAM PRINTLN start... FOR i FROM 90 TO 100 PRINTLN i END PRINTLN end... END"</span>;</span><br><span class=line>        System.out.println(<span class=string>"str: "</span> + str);</span><br><span class=line>        <span class=type>IExpressions</span> <span class=variable>expressions</span> <span class=operator>=</span> <span class=keyword>new</span> <span class="title class_">ProgramExpression</span>(str);</span><br><span class=line>        expressions.interpret();</span><br><span class=line>    }</span><br><span class=line>}</span><br></pre></table></figure><h3 id=1-2-8、Command（命令模式）><a class=headerlink href=#1-2-8、Command（命令模式） title=1.2.8、Command（命令模式）></a>1.2.8、Command（命令模式）</h3><h4 id=简介-11><a class=headerlink href=#简介-11 title=简介></a>简介</h4><p><strong>将请求以 命令形式 封装至对象A中，然后调用对象B将对象A传递给 能处理A对象中命令的 对象C，对象C拿到A对象后执行其中的命令。</strong><h4 id=何时使用-12><a class=headerlink href=#何时使用-12 title=何时使用></a>何时使用</h4><p>在某些场合，比如要对行为进行 “记录、撤销 / 重做、事务” 等处理，这种无法抵御变化的紧耦合是不合适的。在这种情况下，如何将 “行为请求者” 与 “行为实现者” 解耦？将一组行为抽象为对象，可以实现二者之间的松耦合。<h4 id=优缺点-12><a class=headerlink href=#优缺点-12 title=优缺点></a>优缺点</h4><ul><li><p>优点</p> <ol><li>降低了系统耦合度。<li>新命令可以很容易添加到系统中去。</ol><li><p>缺点</p> <p>可能会导致某些系统有过多的具体命令类。</p></ul><h4 id=应用场景-11><a class=headerlink href=#应用场景-11 title=应用场景></a>应用场景</h4><ol><li>GUI 中每一个按钮都是一条命令。<li>模拟 CMD。</ol><h4 id=应用实例-12><a class=headerlink href=#应用实例-12 title=应用实例></a>应用实例</h4><p>struts 1 中 action 的核心控制器 ActionServlet 只有一个，相当于 Invoker，而模型层也会有对应不同的模型类，相当于具体的 Command。<h4 id=注意事项-12><a class=headerlink href=#注意事项-12 title=注意事项></a>注意事项</h4><p><font color=red>需要支持命令的撤销 (Undo) 操作和恢复 (Redo) 操作。</font><h4 id=代码实例-12><a class=headerlink href=#代码实例-12 title=代码实例></a>代码实例</h4><figure class="highlight java"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br><span class=line>42</span><br><span class=line>43</span><br><span class=line>44</span><br><span class=line>45</span><br><span class=line>46</span><br><span class=line>47</span><br><span class=line>48</span><br><span class=line>49</span><br><span class=line>50</span><br><span class=line>51</span><br><span class=line>52</span><br><span class=line>53</span><br><span class=line>54</span><br><span class=line>55</span><br><span class=line>56</span><br><span class=line>57</span><br><span class=line>58</span><br><span class=line>59</span><br><span class=line>60</span><br><span class=line>61</span><br><span class=line>62</span><br></pre><td class=code><pre><span class=line><span class=comment>/**</span></span><br><span class=line><span class=comment> * 邮局接口</span></span><br><span class=line><span class=comment> */</span></span><br><span class=line><span class=keyword>public</span> <span class=keyword>interface</span> <span class="title class_">IPost</span> {</span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">sendMail</span><span class=params>(String msg)</span>;</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=keyword>public</span> <span class=keyword>interface</span> <span class="title class_">IReceiver</span> {</span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">readMail</span><span class=params>(String msg)</span>;</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=comment>/**</span></span><br><span class=line><span class=comment> * 邮局实现</span></span><br><span class=line><span class=comment> */</span></span><br><span class=line><span class=keyword>public</span> <span class=keyword>class</span> <span class="title class_">Post</span> <span class=keyword>implements</span> <span class="title class_">IPost</span>{</span><br><span class=line>    <span class=keyword>private</span> <span class=keyword>final</span> IReceiver receiver;</span><br><span class=line>    <span class=keyword>public</span> <span class="title function_">Post</span><span class=params>(IReceiver receiver)</span>{</span><br><span class=line>        <span class=built_in>this</span>.receiver = receiver;</span><br><span class=line>    }</span><br><span class=line>    <span class=meta>@Override</span></span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">sendMail</span><span class=params>(String msg)</span> {</span><br><span class=line>        System.out.println(<span class=string>"邮局发送信件给收件人......"</span> );</span><br><span class=line>        <span class=built_in>this</span>.receiver.readMail(msg);</span><br><span class=line>    }</span><br><span class=line>}</span><br><span class=line></span><br><span class=line></span><br><span class=line><span class=comment>/**</span></span><br><span class=line><span class=comment> * 发信人</span></span><br><span class=line><span class=comment> */</span></span><br><span class=line><span class=keyword>public</span> <span class=keyword>class</span> <span class="title class_">Invoker</span> {</span><br><span class=line>    <span class=keyword>private</span> IPost iPost;</span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">setiPost</span><span class=params>(IPost iPost)</span> {</span><br><span class=line>        <span class=built_in>this</span>.iPost = iPost;</span><br><span class=line>    }</span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">postMail</span><span class=params>(String msg)</span> {</span><br><span class=line>        System.out.println(<span class=string>"发信人投递邮件给邮局......"</span>);</span><br><span class=line>        <span class=built_in>this</span>.iPost.sendMail(msg);</span><br><span class=line>    }</span><br><span class=line>}</span><br><span class=line></span><br><span class=line></span><br><span class=line><span class=comment>/**</span></span><br><span class=line><span class=comment> * 接收人</span></span><br><span class=line><span class=comment> */</span></span><br><span class=line><span class=keyword>public</span> <span class=keyword>class</span> <span class="title class_">Receiver</span>  <span class=keyword>implements</span> <span class="title class_">IReceiver</span>{</span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">readMail</span><span class=params>(String msg)</span>{</span><br><span class=line>        System.out.println(<span class=string>"收件人收到信件，开始读取消息: "</span> + msg);</span><br><span class=line>    }</span><br><span class=line>}</span><br><span class=line></span><br><span class=line></span><br><span class=line><span class=keyword>public</span> <span class=keyword>class</span> <span class="title class_">CommandApp</span> {</span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>static</span> <span class=keyword>void</span> <span class="title function_">main</span><span class=params>(String[] args)</span> {</span><br><span class=line>        <span class=type>Receiver</span> <span class=variable>receiver</span> <span class=operator>=</span> <span class=keyword>new</span> <span class="title class_">Receiver</span>();</span><br><span class=line>        <span class=type>IPost</span> <span class=variable>iPost</span> <span class=operator>=</span> <span class=keyword>new</span> <span class="title class_">Post</span>(receiver);</span><br><span class=line></span><br><span class=line>        <span class=type>Invoker</span> <span class=variable>invoker</span> <span class=operator>=</span> <span class=keyword>new</span> <span class="title class_">Invoker</span>();</span><br><span class=line>        invoker.setiPost(iPost);</span><br><span class=line>        invoker.postMail(<span class=string>"好久不见，近来如何？"</span>);</span><br><span class=line>    }</span><br><span class=line>}</span><br></pre></table></figure><h3 id=1-2-9、State（状态模式）><a class=headerlink href=#1-2-9、State（状态模式） title=1.2.9、State（状态模式）></a>1.2.9、State（状态模式）</h3><h4 id=简介-12><a class=headerlink href=#简介-12 title=简介></a>简介</h4><p><strong>状态模式下 会创建各种状态对象 和 一个会随状态对象改变而改变其行为的context对象。</strong><h4 id=何时使用-13><a class=headerlink href=#何时使用-13 title=何时使用></a>何时使用</h4><p>代码中包含大量与对象状态有关的条件语句。<h4 id=优缺点-13><a class=headerlink href=#优缺点-13 title=优缺点></a>优缺点</h4><ul><li>优点<ol><li>封装了转换规则。<li>枚举可能的状态，在枚举状态之前需要确定状态种类。<li>将所有与某个状态有关的行为放到一个类中，并且可以方便地增加新的状态，只需要改变对象状态即可改变对象的行为。<li>允许状态转换逻辑与状态对象合成一体，而不是某一个巨大的条件语句块。<li>可以让多个环境对象共享一个状态对象，从而减少系统中对象的个数。</ol><li>缺点<ol><li>状态模式的使用必然会增加系统类和对象的个数。<li>状态模式的结构与实现都较为复杂，如果使用不当将导致程序结构和代码的混乱。<li>状态模式对 “开闭原则” 的支持并不太好，对于可以切换状态的状态模式，增加新的状态类需要修改那些负责状态转换的源代码，否则无法切换到新增状态，而且修改某个状态类的行为也需修改对应类的源代码。</ol></ul><h4 id=应用场景-12><a class=headerlink href=#应用场景-12 title=应用场景></a>应用场景</h4><ol><li>行为随状态改变而改变的场景。<li>条件、分支语句的代替者。</ol><h4 id=应用实例-13><a class=headerlink href=#应用实例-13 title=应用实例></a>应用实例</h4><ol><li>打篮球的时候运动员可以有正常状态. 不正常状态和超常状态。<li>‘曾侯乙编钟’是具体环境(Context)，钟是抽象接口，钟 A是具体状态。</ol><h4 id=注意事项-13><a class=headerlink href=#注意事项-13 title=注意事项></a>注意事项</h4><p><font color=red>行为受状态约束时使用状态模式，而且状态不超过 5 个。</font><h4 id=代码实例-13><a class=headerlink href=#代码实例-13 title=代码实例></a>代码实例</h4><figure class="highlight java"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br><span class=line>42</span><br><span class=line>43</span><br><span class=line>44</span><br><span class=line>45</span><br><span class=line>46</span><br><span class=line>47</span><br><span class=line>48</span><br><span class=line>49</span><br><span class=line>50</span><br><span class=line>51</span><br><span class=line>52</span><br><span class=line>53</span><br><span class=line>54</span><br><span class=line>55</span><br><span class=line>56</span><br><span class=line>57</span><br><span class=line>58</span><br><span class=line>59</span><br><span class=line>60</span><br><span class=line>61</span><br><span class=line>62</span><br><span class=line>63</span><br><span class=line>64</span><br></pre><td class=code><pre><span class=line><span class=keyword>public</span> <span class=keyword>class</span> <span class="title class_">Context</span> {</span><br><span class=line>    <span class=keyword>private</span> State state;</span><br><span class=line>    <span class=keyword>private</span> String name;</span><br><span class=line>    <span class=keyword>public</span> <span class="title function_">Context</span><span class=params>(String name)</span> {</span><br><span class=line>        <span class=built_in>this</span>.name = name;</span><br><span class=line>    }</span><br><span class=line></span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">setState</span><span class=params>(State state)</span> {</span><br><span class=line>        <span class=built_in>this</span>.state = state;</span><br><span class=line>    }</span><br><span class=line>    <span class=keyword>public</span> State <span class="title function_">getState</span><span class=params>()</span> {</span><br><span class=line>        <span class=keyword>return</span> <span class=built_in>this</span>.state;</span><br><span class=line>    }</span><br><span class=line>}</span><br><span class=line></span><br><span class=line></span><br><span class=line><span class=keyword>public</span> <span class=keyword>interface</span> <span class="title class_">State</span> {</span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">doAction</span><span class=params>(Context context)</span>;</span><br><span class=line>}</span><br><span class=line></span><br><span class=line></span><br><span class=line><span class=keyword>public</span> <span class=keyword>class</span> <span class="title class_">DeductState</span> <span class=keyword>implements</span> <span class="title class_">State</span> {</span><br><span class=line>    <span class=keyword>public</span> String <span class="title function_">toString</span><span class=params>()</span>{</span><br><span class=line>        <span class=keyword>return</span> <span class=string>"Deduct State"</span>;</span><br><span class=line>    }</span><br><span class=line>    <span class=meta>@Override</span></span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">doAction</span><span class=params>(Context context)</span> {</span><br><span class=line>        System.out.println(<span class=string>"商品卖出，准备减库存"</span>);</span><br><span class=line>        context.setState(<span class=built_in>this</span>);</span><br><span class=line></span><br><span class=line>        <span class=comment>//... 执行减库存的具体操作</span></span><br><span class=line>    }</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=keyword>public</span> <span class=keyword>class</span> <span class="title class_">RevertState</span> <span class=keyword>implements</span> <span class="title class_">State</span> {</span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">doAction</span><span class=params>(Context context)</span> {</span><br><span class=line>        System.out.println(<span class=string>"给此商品补库存"</span>);</span><br><span class=line>        context.setState(<span class=built_in>this</span>);</span><br><span class=line></span><br><span class=line>        <span class=comment>//... 执行加库存的具体操作</span></span><br><span class=line>    }</span><br><span class=line>    <span class=keyword>public</span> String <span class="title function_">toString</span><span class=params>()</span> {</span><br><span class=line>        <span class=keyword>return</span> <span class=string>"Revert State"</span>;</span><br><span class=line>    }</span><br><span class=line>}</span><br><span class=line></span><br><span class=line></span><br><span class=line><span class=keyword>public</span> <span class=keyword>class</span> <span class="title class_">StateApp</span> {</span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>static</span> <span class=keyword>void</span> <span class="title function_">main</span><span class=params>(String[] args)</span> {</span><br><span class=line>        <span class=comment>// 我们需要操作的是 iPhone X</span></span><br><span class=line>        <span class=type>Context</span> <span class=variable>context</span> <span class=operator>=</span> <span class=keyword>new</span> <span class="title class_">Context</span>(<span class=string>"iPhone X"</span>);</span><br><span class=line></span><br><span class=line>        <span class=comment>// 看看怎么进行补库存操作</span></span><br><span class=line>        <span class=type>State</span> <span class=variable>revertState</span> <span class=operator>=</span> <span class=keyword>new</span> <span class="title class_">RevertState</span>();</span><br><span class=line>        revertState.doAction(context);</span><br><span class=line></span><br><span class=line>        <span class=comment>// 同样的，减库存操作也非常简单</span></span><br><span class=line>        <span class=type>State</span> <span class=variable>deductState</span> <span class=operator>=</span> <span class=keyword>new</span> <span class="title class_">DeductState</span>();</span><br><span class=line>        deductState.doAction(context);</span><br><span class=line></span><br><span class=line>        <span class=comment>// 如果需要我们可以获取当前的状态</span></span><br><span class=line>        <span class=comment>// context.getState().toString();</span></span><br><span class=line>    }</span><br><span class=line>}</span><br></pre></table></figure><h3 id=1-2-10、Visitor（访问者模式）><a class=headerlink href=#1-2-10、Visitor（访问者模式） title=1.2.10、Visitor（访问者模式）></a>1.2.10、Visitor（访问者模式）</h3><h4 id=简介-13><a class=headerlink href=#简介-13 title=简介></a>简介</h4><p><strong>元素类的执行算法可以随着访问者改变而改变。访问者对象可以处理元素对象上的操作。</strong><h4 id=何时使用-14><a class=headerlink href=#何时使用-14 title=何时使用></a>何时使用</h4><p>对一个对象执行多种不同操作，且要避免这些操作影响对象关联的类，可以使用该模式将这些操作封装到类中。<h4 id=优缺点-14><a class=headerlink href=#优缺点-14 title=优缺点></a>优缺点</h4><ul><li>优点<ol><li>符合单一职责原则。<li>优秀的扩展性。<li>灵活性。</ol><li>缺点<ol><li>具体元素对访问者公布细节，违反了迪米特原则。<li>具体元素变更比较困难。<li>违反了依赖倒置原则，依赖具体类，没有依赖抽象。</ol></ul><h4 id=应用场景-13><a class=headerlink href=#应用场景-13 title=应用场景></a>应用场景</h4><ol><li>对象对应的类很少改变，但需要在对象上添加新操作。<li>需要对一个对象执行多种不同操作，且要避免这些操作影响对象对应的类，且在添加新操作时也不想修改该类的场景；</ol><h4 id=应用实例-14><a class=headerlink href=#应用实例-14 title=应用实例></a>应用实例</h4><p>你去朋友家做客，您是访问者，朋友接受您的访问，然后对朋友的描述做出一个判断，这就是访问者模式。<h4 id=注意事项-14><a class=headerlink href=#注意事项-14 title=注意事项></a>注意事项</h4><p><font color=red>访问者可以对功能进行统一，可以做报表、UI、拦截器与过滤器。</font><h4 id=代码实例-14><a class=headerlink href=#代码实例-14 title=代码实例></a>代码实例</h4><figure class="highlight java"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br><span class=line>42</span><br><span class=line>43</span><br><span class=line>44</span><br><span class=line>45</span><br><span class=line>46</span><br><span class=line>47</span><br><span class=line>48</span><br><span class=line>49</span><br><span class=line>50</span><br><span class=line>51</span><br><span class=line>52</span><br><span class=line>53</span><br><span class=line>54</span><br><span class=line>55</span><br><span class=line>56</span><br><span class=line>57</span><br><span class=line>58</span><br><span class=line>59</span><br><span class=line>60</span><br><span class=line>61</span><br><span class=line>62</span><br><span class=line>63</span><br><span class=line>64</span><br><span class=line>65</span><br><span class=line>66</span><br><span class=line>67</span><br><span class=line>68</span><br><span class=line>69</span><br><span class=line>70</span><br><span class=line>71</span><br><span class=line>72</span><br><span class=line>73</span><br><span class=line>74</span><br><span class=line>75</span><br><span class=line>76</span><br><span class=line>77</span><br><span class=line>78</span><br><span class=line>79</span><br><span class=line>80</span><br><span class=line>81</span><br><span class=line>82</span><br><span class=line>83</span><br><span class=line>84</span><br><span class=line>85</span><br><span class=line>86</span><br><span class=line>87</span><br><span class=line>88</span><br><span class=line>89</span><br><span class=line>90</span><br><span class=line>91</span><br><span class=line>92</span><br><span class=line>93</span><br><span class=line>94</span><br><span class=line>95</span><br><span class=line>96</span><br><span class=line>97</span><br><span class=line>98</span><br><span class=line>99</span><br><span class=line>100</span><br><span class=line>101</span><br><span class=line>102</span><br><span class=line>103</span><br><span class=line>104</span><br><span class=line>105</span><br><span class=line>106</span><br><span class=line>107</span><br><span class=line>108</span><br><span class=line>109</span><br><span class=line>110</span><br><span class=line>111</span><br><span class=line>112</span><br><span class=line>113</span><br><span class=line>114</span><br><span class=line>115</span><br><span class=line>116</span><br><span class=line>117</span><br><span class=line>118</span><br><span class=line>119</span><br><span class=line>120</span><br><span class=line>121</span><br><span class=line>122</span><br><span class=line>123</span><br><span class=line>124</span><br><span class=line>125</span><br><span class=line>126</span><br><span class=line>127</span><br><span class=line>128</span><br><span class=line>129</span><br><span class=line>130</span><br><span class=line>131</span><br><span class=line>132</span><br><span class=line>133</span><br><span class=line>134</span><br><span class=line>135</span><br><span class=line>136</span><br><span class=line>137</span><br><span class=line>138</span><br><span class=line>139</span><br><span class=line>140</span><br><span class=line>141</span><br><span class=line>142</span><br><span class=line>143</span><br><span class=line>144</span><br><span class=line>145</span><br><span class=line>146</span><br><span class=line>147</span><br><span class=line>148</span><br><span class=line>149</span><br><span class=line>150</span><br><span class=line>151</span><br><span class=line>152</span><br><span class=line>153</span><br><span class=line>154</span><br><span class=line>155</span><br><span class=line>156</span><br><span class=line>157</span><br><span class=line>158</span><br><span class=line>159</span><br><span class=line>160</span><br><span class=line>161</span><br><span class=line>162</span><br><span class=line>163</span><br><span class=line>164</span><br><span class=line>165</span><br><span class=line>166</span><br><span class=line>167</span><br><span class=line>168</span><br><span class=line>169</span><br><span class=line>170</span><br><span class=line>171</span><br><span class=line>172</span><br><span class=line>173</span><br><span class=line>174</span><br><span class=line>175</span><br><span class=line>176</span><br><span class=line>177</span><br><span class=line>178</span><br><span class=line>179</span><br><span class=line>180</span><br><span class=line>181</span><br><span class=line>182</span><br><span class=line>183</span><br><span class=line>184</span><br><span class=line>185</span><br><span class=line>186</span><br><span class=line>187</span><br><span class=line>188</span><br></pre><td class=code><pre><span class=line><span class=comment>/**</span></span><br><span class=line><span class=comment> * 访问者接口</span></span><br><span class=line><span class=comment> */</span></span><br><span class=line><span class=keyword>public</span> <span class=keyword>interface</span> <span class="title class_">IVisitor</span> {</span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">visit</span><span class=params>(Manager manager)</span>;</span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">visit</span><span class=params>(Employees employees)</span>;</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=comment>/**</span></span><br><span class=line><span class=comment> * 计算薪资访问者</span></span><br><span class=line><span class=comment> */</span></span><br><span class=line><span class=keyword>public</span> <span class=keyword>interface</span> <span class="title class_">ISalaryVisitor</span> <span class=keyword>extends</span> <span class="title class_">IVisitor</span>{</span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">printManagerTotalSalary</span><span class=params>()</span>;</span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">printEmployeesTotalSalary</span><span class=params>()</span>;</span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">printTotalSalary</span><span class=params>()</span>;</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=comment>/**</span></span><br><span class=line><span class=comment> * 抽象员工类</span></span><br><span class=line><span class=comment> */</span></span><br><span class=line><span class=keyword>public</span> <span class=keyword>abstract</span> <span class=keyword>class</span> <span class="title class_">Staff</span> {</span><br><span class=line>    <span class=keyword>protected</span> String no;</span><br><span class=line>    <span class=keyword>protected</span> String name;</span><br><span class=line>    <span class=keyword>protected</span> String position;</span><br><span class=line>    <span class=keyword>protected</span> <span class=type>float</span> salary;</span><br><span class=line>    <span class=keyword>private</span> <span class=type>int</span> length;</span><br><span class=line></span><br><span class=line>    <span class=keyword>public</span> <span class="title function_">Staff</span><span class=params>(String no, String name, String position, <span class=type>float</span> salary)</span> {</span><br><span class=line>        <span class=built_in>this</span>.no = no;</span><br><span class=line>        <span class=built_in>this</span>.name = name;</span><br><span class=line>        <span class=built_in>this</span>.position = position;</span><br><span class=line>        <span class=built_in>this</span>.salary = salary;</span><br><span class=line></span><br><span class=line>        <span class=built_in>this</span>.length += (no == <span class=literal>null</span> || <span class=string>""</span>.equals(no.trim())) ? <span class=number>0</span> : no.getBytes().length;</span><br><span class=line>        <span class=built_in>this</span>.length += (no == <span class=literal>null</span> || <span class=string>""</span>.equals(name.trim())) ? <span class=number>0</span> : name.getBytes().length;</span><br><span class=line>        <span class=built_in>this</span>.length += (no == <span class=literal>null</span> || <span class=string>""</span>.equals(position.trim())) ? <span class=number>0</span> : position.getBytes().length;</span><br><span class=line>        <span class=built_in>this</span>.length += String.valueOf(salary).getBytes().length;</span><br><span class=line>    }</span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">printUserBaseInfo</span><span class=params>()</span>{</span><br><span class=line>        System.out.println(<span class=built_in>this</span>.no + <span class=string>"/"</span> + <span class=built_in>this</span>.name + <span class=string>"/"</span> + <span class=built_in>this</span>.position + <span class=string>"/"</span> + <span class=built_in>this</span>.salary);</span><br><span class=line>    }</span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>abstract</span> <span class=keyword>void</span> <span class="title function_">add</span><span class=params>(Staff staff)</span>;</span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>abstract</span> Staff <span class="title function_">remove</span><span class=params>(String no)</span>;</span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>abstract</span> <span class=keyword>void</span> <span class="title function_">accept</span><span class=params>(IVisitor visitor)</span>;</span><br><span class=line></span><br><span class=line>	<span class=comment>// set/get methods ...</span></span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=keyword>public</span> <span class=keyword>class</span> <span class="title class_">Manager</span> <span class=keyword>extends</span> <span class="title class_">Staff</span>{</span><br><span class=line>    <span class=keyword>private</span> <span class=keyword>final</span> ArrayList&LTStaff> staffList = <span class=keyword>new</span> <span class="title class_">ArrayList</span>&LTStaff>();</span><br><span class=line>    <span class=keyword>public</span> <span class="title function_">Manager</span><span class=params>(String no, String name, String position, <span class=type>float</span> salary)</span>{</span><br><span class=line>        <span class=built_in>super</span>(no, name, position, salary);</span><br><span class=line>    }</span><br><span class=line>    <span class=meta>@Override</span></span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">add</span><span class=params>(Staff staff)</span> {</span><br><span class=line>        <span class=built_in>this</span>.staffList.add(staff);</span><br><span class=line>    }</span><br><span class=line>    <span class=meta>@Override</span></span><br><span class=line>    <span class=keyword>public</span> Staff <span class="title function_">remove</span><span class=params>(String no)</span> {</span><br><span class=line>        <span class=type>Staff</span> <span class=variable>staff</span> <span class=operator>=</span> <span class=literal>null</span>;</span><br><span class=line>        <span class=keyword>if</span> (no != <span class=literal>null</span> && !<span class=string>""</span>.equals(no.trim())){</span><br><span class=line>            <span class=keyword>for</span> (<span class=type>int</span> <span class=variable>i</span> <span class=operator>=</span> <span class=number>0</span>; i < <span class=built_in>this</span>.staffList.size(); i++){</span><br><span class=line>                <span class=keyword>if</span> (<span class=built_in>this</span>.staffList.get(i) == <span class=literal>null</span>){</span><br><span class=line>                    <span class=keyword>continue</span>;</span><br><span class=line>                }</span><br><span class=line>                <span class=keyword>if</span> (no.equals(<span class=built_in>this</span>.staffList.get(i).getNo())){</span><br><span class=line>                    staff = <span class=built_in>this</span>.staffList.remove(i);</span><br><span class=line>                    <span class=keyword>break</span>;</span><br><span class=line>                }</span><br><span class=line>            }</span><br><span class=line>        }</span><br><span class=line>        <span class=keyword>return</span> staff;</span><br><span class=line>    }</span><br><span class=line>    <span class=meta>@Override</span></span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">accept</span><span class=params>(IVisitor visitor)</span> {</span><br><span class=line>        visitor.visit(<span class=built_in>this</span>);</span><br><span class=line>        <span class=keyword>for</span> (<span class=type>int</span> <span class=variable>i</span> <span class=operator>=</span> <span class=number>0</span>; i < <span class=built_in>this</span>.staffList.size(); i++){</span><br><span class=line>            <span class=keyword>if</span> (<span class=built_in>this</span>.staffList.get(i) == <span class=literal>null</span>){</span><br><span class=line>                <span class=keyword>continue</span>;</span><br><span class=line>            }</span><br><span class=line>            <span class=built_in>this</span>.staffList.get(i).accept(visitor);</span><br><span class=line>        }</span><br><span class=line>    }</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=keyword>public</span> <span class=keyword>class</span> <span class="title class_">Employees</span> <span class=keyword>extends</span> <span class="title class_">Staff</span>{</span><br><span class=line>    <span class=keyword>public</span> <span class="title function_">Employees</span><span class=params>(String no, String name, String position, <span class=type>float</span> salary)</span>{</span><br><span class=line>        <span class=built_in>super</span>(no, name, position, salary);</span><br><span class=line>    }</span><br><span class=line>    <span class=meta>@Override</span></span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">add</span><span class=params>(Staff staff)</span> {</span><br><span class=line>        <span class=keyword>return</span>;</span><br><span class=line>    }</span><br><span class=line>    <span class=meta>@Override</span></span><br><span class=line>    <span class=keyword>public</span> Staff <span class="title function_">remove</span><span class=params>(String no)</span> {</span><br><span class=line>        <span class=keyword>return</span> <span class=literal>null</span>;</span><br><span class=line>    }</span><br><span class=line>    <span class=meta>@Override</span></span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">accept</span><span class=params>(IVisitor visitor)</span> {</span><br><span class=line>        visitor.visit(<span class=built_in>this</span>);</span><br><span class=line>    }</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=comment>/**</span></span><br><span class=line><span class=comment> * 打印基本信息访问者</span></span><br><span class=line><span class=comment> */</span></span><br><span class=line><span class=keyword>public</span> <span class=keyword>class</span> <span class="title class_">PrintBaseInfoVisitor</span> <span class=keyword>implements</span> <span class="title class_">IVisitor</span>{</span><br><span class=line>    <span class=meta>@Override</span></span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">visit</span><span class=params>(Manager manager)</span> {</span><br><span class=line>        System.out.print(<span class=string>"管理者: "</span>);</span><br><span class=line>        manager.printUserBaseInfo();</span><br><span class=line>    }</span><br><span class=line>    <span class=meta>@Override</span></span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">visit</span><span class=params>(Employees employees)</span> {</span><br><span class=line>        System.out.print(<span class=string>"普通员工: "</span>);</span><br><span class=line>        employees.printUserBaseInfo();</span><br><span class=line>    }</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=keyword>public</span> <span class=keyword>class</span> <span class="title class_">SalaryVisitor</span> <span class=keyword>implements</span> <span class="title class_">ISalaryVisitor</span>{</span><br><span class=line>    <span class=keyword>private</span> <span class=type>float</span> managerSalary;</span><br><span class=line>    <span class=keyword>private</span> <span class=type>float</span> employeesSalary;</span><br><span class=line>    <span class=keyword>public</span> <span class="title function_">SalaryVisitor</span><span class=params>()</span>{</span><br><span class=line>        managerSalary = <span class=number>0</span>;</span><br><span class=line>        employeesSalary = <span class=number>0</span>;</span><br><span class=line>    }</span><br><span class=line>    <span class=meta>@Override</span></span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">printManagerTotalSalary</span><span class=params>()</span> {</span><br><span class=line>        System.out.println(<span class=string>"管理者薪资总和："</span> + managerSalary);</span><br><span class=line>    }</span><br><span class=line>    <span class=meta>@Override</span></span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">printEmployeesTotalSalary</span><span class=params>()</span> {</span><br><span class=line>        System.out.println(<span class=string>"一般员工薪资总和："</span> + employeesSalary);</span><br><span class=line>    }</span><br><span class=line>    <span class=meta>@Override</span></span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">printTotalSalary</span><span class=params>()</span> {</span><br><span class=line>        System.out.println(<span class=string>"员工薪资总和："</span> + (managerSalary + employeesSalary));</span><br><span class=line>    }</span><br><span class=line>    <span class=meta>@Override</span></span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">visit</span><span class=params>(Manager manager)</span> {</span><br><span class=line>        managerSalary += manager.getSalary();</span><br><span class=line>    }</span><br><span class=line>    <span class=meta>@Override</span></span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">visit</span><span class=params>(Employees employees)</span> {</span><br><span class=line>        employeesSalary += employees.getSalary();</span><br><span class=line>    }</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=keyword>public</span> <span class=keyword>class</span> <span class="title class_">VisitorApp</span> {</span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>static</span> <span class=keyword>void</span> <span class="title function_">main</span><span class=params>(String[] args)</span> {</span><br><span class=line>        <span class=type>Staff</span> <span class=variable>boss</span> <span class=operator>=</span> <span class=keyword>new</span> <span class="title class_">Manager</span>(<span class=string>"1"</span>, <span class=string>"大老板"</span>, <span class=string>"CEO"</span>, <span class=number>100000</span>);</span><br><span class=line></span><br><span class=line>        <span class=type>Staff</span> <span class=variable>financeManager</span> <span class=operator>=</span> <span class=keyword>new</span> <span class="title class_">Manager</span>(<span class=string>"11"</span>, <span class=string>"张总"</span>, <span class=string>"财务部经理"</span>, <span class=number>60000</span>);</span><br><span class=line>        <span class=type>Staff</span> <span class=variable>personnelManager</span> <span class=operator>=</span> <span class=keyword>new</span> <span class="title class_">Manager</span>(<span class=string>"12"</span>, <span class=string>"王总"</span>, <span class=string>"人事部经理"</span>, <span class=number>60000</span>);</span><br><span class=line></span><br><span class=line>        <span class=type>Staff</span> <span class=variable>technicalManager</span> <span class=operator>=</span> <span class=keyword>new</span> <span class="title class_">Manager</span>(<span class=string>"13"</span>, <span class=string>"陈总"</span>, <span class=string>"技术部经理"</span>, <span class=number>60000</span>);</span><br><span class=line>        <span class=type>Staff</span> <span class=variable>deptAssistant</span> <span class=operator>=</span> <span class=keyword>new</span> <span class="title class_">Manager</span>(<span class=string>"1301"</span>, <span class=string>"王助理"</span>, <span class=string>"技术部助理"</span>, <span class=number>20000</span>);</span><br><span class=line>        <span class=type>Staff</span> <span class=variable>deptManager1</span> <span class=operator>=</span> <span class=keyword>new</span> <span class="title class_">Manager</span>(<span class=string>"1302"</span>, <span class=string>"主管1"</span>, <span class=string>"技术部主管"</span>, <span class=number>30000</span>);</span><br><span class=line>        <span class=type>Staff</span> <span class=variable>softwareEngineer1</span> <span class=operator>=</span> <span class=keyword>new</span> <span class="title class_">Employees</span>(<span class=string>"1302001"</span>, <span class=string>"张三"</span>, <span class=string>"软件工程师"</span>, <span class=number>5000</span>);</span><br><span class=line>        <span class=type>Staff</span> <span class=variable>softwareEngineer2</span> <span class=operator>=</span> <span class=keyword>new</span> <span class="title class_">Employees</span>(<span class=string>"1302002"</span>, <span class=string>"李四"</span>, <span class=string>"软件工程师"</span>, <span class=number>5500</span>);</span><br><span class=line>        <span class=type>Staff</span> <span class=variable>softwareEngineer3</span> <span class=operator>=</span> <span class=keyword>new</span> <span class="title class_">Employees</span>(<span class=string>"1302003"</span>, <span class=string>"王五"</span>, <span class=string>"软件工程师"</span>, <span class=number>4500</span>);</span><br><span class=line></span><br><span class=line>        deptManager1.add(softwareEngineer1);</span><br><span class=line>        deptManager1.add(softwareEngineer2);</span><br><span class=line>        deptManager1.add(softwareEngineer3);</span><br><span class=line></span><br><span class=line>        <span class=type>Staff</span> <span class=variable>deptManager2</span> <span class=operator>=</span> <span class=keyword>new</span> <span class="title class_">Manager</span>(<span class=string>"1302"</span>, <span class=string>"主管2"</span>, <span class=string>"技术部主管"</span>, <span class=number>30000</span>);</span><br><span class=line>        technicalManager.add(deptAssistant);</span><br><span class=line>        technicalManager.add(deptManager1);</span><br><span class=line>        technicalManager.add(deptManager2);</span><br><span class=line></span><br><span class=line>        <span class=type>Staff</span> <span class=variable>marketingManager</span> <span class=operator>=</span> <span class=keyword>new</span> <span class="title class_">Manager</span>(<span class=string>"14"</span>, <span class=string>"吴总"</span>, <span class=string>"市场部经理"</span>, <span class=number>60000</span>);</span><br><span class=line></span><br><span class=line>        boss.add(financeManager);</span><br><span class=line>        boss.add(personnelManager);</span><br><span class=line>        boss.add(technicalManager);</span><br><span class=line>        boss.add(marketingManager);</span><br><span class=line></span><br><span class=line>        boss.printUserBaseInfo();</span><br><span class=line>        boss.accept(<span class=keyword>new</span> <span class="title class_">PrintBaseInfoVisitor</span>());</span><br><span class=line></span><br><span class=line>        <span class=type>SalaryVisitor</span> <span class=variable>visitor</span> <span class=operator>=</span> <span class=keyword>new</span> <span class="title class_">SalaryVisitor</span>();</span><br><span class=line>        boss.accept(visitor);</span><br><span class=line>        visitor.printManagerTotalSalary();</span><br><span class=line>        visitor.printEmployeesTotalSalary();</span><br><span class=line>        visitor.printTotalSalary();</span><br><span class=line>    }</span><br><span class=line>}</span><br></pre></table></figure><h3 id=1-2-11、Memento（备忘录模式）><a class=headerlink href=#1-2-11、Memento（备忘录模式） title=1.2.11、Memento（备忘录模式）></a>1.2.11、Memento（备忘录模式）</h3><h4 id=简介-14><a class=headerlink href=#简介-14 title=简介></a>简介</h4><p><strong>在不破坏封装性的前提下捕获一个对象的内部状态，并将该状态存于对象外。后续可恢复对象至该状态；</strong><h4 id=何时使用-15><a class=headerlink href=#何时使用-15 title=何时使用></a>何时使用</h4><p>用户需要取消不确定或者错误的操作时，能够恢复到他原先的状态，使得他有 “后悔药” 可吃。<h4 id=优缺点-15><a class=headerlink href=#优缺点-15 title=优缺点></a>优缺点</h4><ul><li><p>优点</p> <ol><li>给用户提供了一种可以恢复状态的机制，可以使用户能够比较方便地回到某个历史的状态。<li>实现了信息的封装，使得用户不需要关心状态的保存细节。</ol><li><p>缺点</p> <p>消耗资源。类成员数量多导致占用大量资源，且保存时会占用内存。</p></ul><h4 id=应用场景-14><a class=headerlink href=#应用场景-14 title=应用场景></a>应用场景</h4><ol><li>需要保存 / 恢复数据的相关状态场景。<li>提供一个可回滚的操作。</ol><h4 id=应用实例-15><a class=headerlink href=#应用实例-15 title=应用实例></a>应用实例</h4><ol><li>后悔药。<li>打游戏时的存档。<li>Windows 里的 ctri + z。<li>IE 中的后退。<li>数据库的事务管理。</ol><h4 id=注意事项-15><a class=headerlink href=#注意事项-15 title=注意事项></a>注意事项</h4><ol><li><font color=red>为了符合迪米特原则，还要增加一个管理备忘录的类。</font><li><font color=red>为了节约内存，可使用原型模式 + 备忘录模式。</font></ol><h4 id=代码实例-15><a class=headerlink href=#代码实例-15 title=代码实例></a>代码实例</h4><figure class="highlight java"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br><span class=line>42</span><br><span class=line>43</span><br><span class=line>44</span><br><span class=line>45</span><br><span class=line>46</span><br><span class=line>47</span><br><span class=line>48</span><br><span class=line>49</span><br><span class=line>50</span><br><span class=line>51</span><br><span class=line>52</span><br><span class=line>53</span><br><span class=line>54</span><br><span class=line>55</span><br><span class=line>56</span><br><span class=line>57</span><br><span class=line>58</span><br><span class=line>59</span><br><span class=line>60</span><br><span class=line>61</span><br><span class=line>62</span><br><span class=line>63</span><br><span class=line>64</span><br><span class=line>65</span><br><span class=line>66</span><br><span class=line>67</span><br><span class=line>68</span><br><span class=line>69</span><br><span class=line>70</span><br><span class=line>71</span><br><span class=line>72</span><br><span class=line>73</span><br><span class=line>74</span><br><span class=line>75</span><br><span class=line>76</span><br><span class=line>77</span><br><span class=line>78</span><br><span class=line>79</span><br><span class=line>80</span><br><span class=line>81</span><br><span class=line>82</span><br><span class=line>83</span><br><span class=line>84</span><br><span class=line>85</span><br><span class=line>86</span><br><span class=line>87</span><br><span class=line>88</span><br><span class=line>89</span><br><span class=line>90</span><br><span class=line>91</span><br><span class=line>92</span><br><span class=line>93</span><br><span class=line>94</span><br><span class=line>95</span><br><span class=line>96</span><br><span class=line>97</span><br><span class=line>98</span><br><span class=line>99</span><br><span class=line>100</span><br><span class=line>101</span><br><span class=line>102</span><br><span class=line>103</span><br></pre><td class=code><pre><span class=line><span class=keyword>public</span> <span class=keyword>interface</span> <span class="title class_">INarrowMemento</span> {</span><br><span class=line></span><br><span class=line>}</span><br><span class=line></span><br><span class=line></span><br><span class=line><span class=keyword>public</span> <span class=keyword>class</span> <span class="title class_">Hero</span> {</span><br><span class=line>    <span class=keyword>private</span> <span class=type>int</span> blood;</span><br><span class=line>    <span class=keyword>private</span> <span class=type>int</span> sword;</span><br><span class=line>    <span class=keyword>private</span> <span class=keyword>final</span> <span class=type>Random</span> <span class=variable>random</span> <span class=operator>=</span> <span class=keyword>new</span> <span class="title class_">Random</span>();</span><br><span class=line>    <span class=keyword>public</span> <span class="title function_">Hero</span><span class=params>()</span>{</span><br><span class=line>        <span class=built_in>this</span>.blood = <span class=number>100</span>;</span><br><span class=line>        <span class=built_in>this</span>.sword = <span class=number>100</span>;</span><br><span class=line>    }</span><br><span class=line>    <span class=keyword>public</span> INarrowMemento <span class="title function_">createMemento</span><span class=params>()</span>{</span><br><span class=line>        System.out.println(<span class=string>"创建备忘录..."</span>);</span><br><span class=line>        <span class=keyword>return</span> <span class=keyword>new</span> <span class="title class_">Memento</span>(<span class=built_in>this</span>.blood, <span class=built_in>this</span>.sword);</span><br><span class=line>    }</span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">restoreFromMemento</span><span class=params>(INarrowMemento memento)</span>{</span><br><span class=line>        System.out.println(<span class=string>"修改备忘录的状态..."</span>);</span><br><span class=line>        <span class=keyword>if</span> (memento != <span class=literal>null</span>){</span><br><span class=line>            <span class=type>Memento</span> <span class=variable>memento2</span> <span class=operator>=</span> (Memento) memento;</span><br><span class=line>            <span class=built_in>this</span>.blood = memento2.getBlood();</span><br><span class=line>            <span class=built_in>this</span>.sword = memento2.getSword();</span><br><span class=line>        }</span><br><span class=line>    }</span><br><span class=line>    <span class=keyword>public</span> <span class=type>int</span> <span class="title function_">koBoss</span><span class=params>()</span>{</span><br><span class=line>        <span class=keyword>if</span> (<span class=built_in>this</span>.blood <= <span class=number>0</span> || <span class=built_in>this</span>.sword <= <span class=number>0</span>){</span><br><span class=line>            System.out.println(<span class=built_in>this</span>.toString());</span><br><span class=line>            System.out.println(<span class=string>"挑战BOSS失败！！！"</span>);</span><br><span class=line>            <span class=keyword>return</span> -<span class=number>1</span>;</span><br><span class=line>        }<span class=keyword>else</span> {</span><br><span class=line>            <span class=type>double</span> <span class=variable>win</span> <span class=operator>=</span> Math.random();</span><br><span class=line>            <span class=keyword>if</span> (win <= <span class=number>0.02</span>){</span><br><span class=line>                System.out.println(<span class=built_in>this</span>.toString());</span><br><span class=line>                System.out.println(<span class=string>"恭喜您，挑战BOSS成功。"</span>);</span><br><span class=line>                <span class=keyword>return</span> <span class=number>1</span>;</span><br><span class=line>            }<span class=keyword>else</span> {</span><br><span class=line>                System.out.println(<span class=built_in>this</span>.toString());</span><br><span class=line>                System.out.println(<span class=string>"继续攻击BOSS..."</span>);</span><br><span class=line>                <span class=type>int</span> <span class=variable>blood_sub</span> <span class=operator>=</span> random.nextInt(<span class=number>10</span>);</span><br><span class=line>                <span class=type>int</span> <span class=variable>sword_sub</span> <span class=operator>=</span> random.nextInt(<span class=number>10</span>);</span><br><span class=line>                <span class=built_in>this</span>.blood -= blood_sub;</span><br><span class=line>                <span class=built_in>this</span>.sword -= sword_sub;</span><br><span class=line>                <span class=keyword>return</span> <span class=number>0</span>;</span><br><span class=line>            }</span><br><span class=line>        }</span><br><span class=line>    }</span><br><span class=line>    <span class=meta>@Override</span></span><br><span class=line>    <span class=keyword>public</span> String <span class="title function_">toString</span><span class=params>()</span> {</span><br><span class=line>        <span class=keyword>return</span> <span class=string>"当前血量："</span> + <span class=built_in>this</span>.blood + <span class=string>", 当前力量："</span> + <span class=built_in>this</span>.sword;</span><br><span class=line>    }</span><br><span class=line>    <span class=keyword>private</span> <span class=keyword>class</span> <span class="title class_">Memento</span> <span class=keyword>implements</span> <span class="title class_">INarrowMemento</span>{</span><br><span class=line>        <span class=keyword>private</span> <span class=type>int</span> blood;</span><br><span class=line>        <span class=keyword>private</span> <span class=type>int</span> sword;</span><br><span class=line>        <span class=keyword>public</span> <span class="title function_">Memento</span><span class=params>(<span class=type>int</span> blood, <span class=type>int</span> sword)</span>{</span><br><span class=line>            <span class=built_in>this</span>.blood = blood;</span><br><span class=line>            <span class=built_in>this</span>.sword = sword;</span><br><span class=line>        }</span><br><span class=line>        <span class=keyword>public</span> <span class=type>int</span> <span class="title function_">getBlood</span><span class=params>()</span> {</span><br><span class=line>            <span class=keyword>return</span> blood;</span><br><span class=line>        }</span><br><span class=line>        <span class=keyword>public</span> <span class=type>int</span> <span class="title function_">getSword</span><span class=params>()</span> {</span><br><span class=line>            <span class=keyword>return</span> sword;</span><br><span class=line>        }</span><br><span class=line>    }</span><br><span class=line>}</span><br><span class=line></span><br><span class=line></span><br><span class=line><span class=keyword>public</span> <span class=keyword>class</span> <span class="title class_">Caretaker</span> {</span><br><span class=line>    <span class=keyword>private</span> INarrowMemento memento;</span><br><span class=line>    <span class=keyword>public</span> INarrowMemento <span class="title function_">getMemento</span><span class=params>()</span>{</span><br><span class=line>        <span class=keyword>return</span> memento;</span><br><span class=line>    }</span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">setMemento</span><span class=params>(INarrowMemento memento)</span> {</span><br><span class=line>        <span class=built_in>this</span>.memento = memento;</span><br><span class=line>    }</span><br><span class=line>}</span><br><span class=line></span><br><span class=line></span><br><span class=line><span class=keyword>public</span> <span class=keyword>class</span> <span class="title class_">MementoOfBlackApp</span> {</span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>static</span> <span class=keyword>void</span> <span class="title function_">main</span><span class=params>(String[] args)</span> {</span><br><span class=line>        <span class=type>Hero</span> <span class=variable>hero</span> <span class=operator>=</span> <span class=keyword>new</span> <span class="title class_">Hero</span>();</span><br><span class=line>        <span class=type>Caretaker</span> <span class=variable>caretaker</span> <span class=operator>=</span> <span class=keyword>new</span> <span class="title class_">Caretaker</span>();</span><br><span class=line>        caretaker.setMemento(hero.createMemento());</span><br><span class=line>        <span class=type>int</span> <span class=variable>cnt</span> <span class=operator>=</span> <span class=number>1</span>;</span><br><span class=line>        <span class=type>int</span> <span class=variable>ko</span> <span class=operator>=</span> -<span class=number>1</span>;</span><br><span class=line>        <span class=keyword>while</span> (ko != <span class=number>1</span> && cnt <= <span class=number>3</span>){</span><br><span class=line>            System.out.println(<span class=string>"第 "</span> + cnt + <span class=string>" 次挑战！"</span>);</span><br><span class=line>            ko = hero.koBoss();</span><br><span class=line>            <span class=keyword>while</span> (<span class=literal>true</span>){</span><br><span class=line>                <span class=keyword>if</span> (ko == -<span class=number>1</span>){</span><br><span class=line>                    hero.restoreFromMemento(caretaker.getMemento());</span><br><span class=line>                    cnt += <span class=number>1</span>;</span><br><span class=line>                    <span class=keyword>break</span>;</span><br><span class=line>                }<span class=keyword>else</span> <span class=keyword>if</span> (ko == <span class=number>0</span>){</span><br><span class=line>                    ko = hero.koBoss();</span><br><span class=line>                }<span class=keyword>else</span> <span class=keyword>if</span> (ko == <span class=number>1</span>){</span><br><span class=line>                    <span class=keyword>break</span>;</span><br><span class=line>                }</span><br><span class=line>            }</span><br><span class=line>        }</span><br><span class=line>    }</span><br><span class=line>}</span><br></pre></table></figure><h2 id=1-3、结构型（7种）><a class=headerlink href=#1-3、结构型（7种） title=1.3、结构型（7种）></a>1.3、结构型（7种）</h2><h3 id=1-3-1、Composite（组合模式）><a class=headerlink href=#1-3-1、Composite（组合模式） title=1.3.1、Composite（组合模式）></a>1.3.1、Composite（组合模式）</h3><h4 id=简介-15><a class=headerlink href=#简介-15 title=简介></a>简介</h4><p><strong>将对象组合成树形结构以表示 部分和整体 的层次结构。它使得客户对单个对象和复合对象的使用具有一致性</strong>。<h4 id=何时使用-16><a class=headerlink href=#何时使用-16 title=何时使用></a>何时使用</h4><ol><li>想表示对象部分 - 整体的层次结构（树形结构）。<li>忽略组合对象与单个对象的不同，用户将统一地使用组合结构中的所有对象。</ol><h5 id=优缺点-16><a class=headerlink href=#优缺点-16 title=优缺点></a>优缺点</h5><ul><li><p>优点</p> <ol><li>高层模块调用简单。<li>节点自由增加。</ol><li><p>缺点</p> <p>在使用组合模式时，其叶子和树枝的声明都是实现类，而不是接口，违反了依赖倒置原则。</p></ul><h4 id=应用场景-15><a class=headerlink href=#应用场景-15 title=应用场景></a>应用场景</h4><p>部分. 整体场景，如树形菜单，文件. 文件夹的管理。<h4 id=应用实例-16><a class=headerlink href=#应用实例-16 title=应用实例></a>应用实例</h4><ol><li>算术表达式包括操作数. 操作符和另一个操作数，其中，另一个操作符也可以是操作数. 操作符和另一个操作数。<li>在 JAVA AWT 和 SWING 中，对于 Button 和 Checkbox 是树叶，Container 是树枝。</ol><h4 id=注意事项-16><a class=headerlink href=#注意事项-16 title=注意事项></a>注意事项</h4><p><font color=red>定义时 为 具体类。</font><h4 id=代码实例-16><a class=headerlink href=#代码实例-16 title=代码实例></a>代码实例</h4><figure class="highlight java"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br></pre><td class=code><pre><span class=line><span class=keyword>import</span> java.util.ArrayList;</span><br><span class=line><span class=keyword>import</span> java.util.List;</span><br><span class=line></span><br><span class=line><span class=keyword>public</span> <span class=keyword>class</span> <span class="title class_">Employee</span> {</span><br><span class=line>    <span class=keyword>private</span> String name;</span><br><span class=line>    <span class=keyword>private</span> String dept;</span><br><span class=line>    <span class=keyword>private</span> <span class=type>int</span> salary;</span><br><span class=line>    <span class=keyword>private</span> List&LTEmployee> subordinates; <span class=comment>// 下属</span></span><br><span class=line></span><br><span class=line>    <span class=keyword>public</span> <span class="title function_">Employee</span><span class=params>(String name,String dept, <span class=type>int</span> sal)</span> {</span><br><span class=line>        <span class=built_in>this</span>.name = name;</span><br><span class=line>        <span class=built_in>this</span>.dept = dept;</span><br><span class=line>        <span class=built_in>this</span>.salary = sal;</span><br><span class=line>        subordinates = <span class=keyword>new</span> <span class="title class_">ArrayList</span>&LTEmployee>();</span><br><span class=line>    }</span><br><span class=line></span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">add</span><span class=params>(Employee e)</span> {</span><br><span class=line>        subordinates.add(e);</span><br><span class=line>    }</span><br><span class=line></span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">remove</span><span class=params>(Employee e)</span> {</span><br><span class=line>        subordinates.remove(e);</span><br><span class=line>    }</span><br><span class=line></span><br><span class=line>    <span class=keyword>public</span> List&LTEmployee> <span class="title function_">getSubordinates</span><span class=params>()</span>{</span><br><span class=line>        <span class=keyword>return</span> subordinates;</span><br><span class=line>    }</span><br><span class=line></span><br><span class=line>    <span class=keyword>public</span> String <span class="title function_">toString</span><span class=params>()</span>{</span><br><span class=line>        <span class=keyword>return</span> (<span class=string>"Employee :[ Name : "</span> + name + <span class=string>", dept : "</span> + dept + <span class=string>", salary :"</span> + salary+<span class=string>" ]"</span>);</span><br><span class=line>    }</span><br><span class=line>}</span><br></pre></table></figure><h3 id=1-3-2、Facade（外观模式）><a class=headerlink href=#1-3-2、Facade（外观模式） title=1.3.2、Facade（外观模式）></a>1.3.2、Facade（外观模式）</h3><h4 id=简介-16><a class=headerlink href=#简介-16 title=简介></a>简介</h4><p><strong>为子系统内部一系列小接口提供一个高层接口，通过高层接口来统一访问操作系统，提高了使用子系统的便利性；</strong><h4 id=何时使用-17><a class=headerlink href=#何时使用-17 title=何时使用></a>何时使用</h4><ol><li>无需知道系统内部，只需提供一个系统 “接待员” 即可。<li>定义系统的入口。</ol><h4 id=优缺点-17><a class=headerlink href=#优缺点-17 title=优缺点></a>优缺点</h4><ul><li><p>优点</p> <ol><li>减少系统相互依赖。<li>提高灵活性。<li>提高了安全性。</ol><li><p>缺点</p> <p>不符合开闭原则，如果要改东西很麻烦，继承重写都不合适。</p></ul><h4 id=应用场景-16><a class=headerlink href=#应用场景-16 title=应用场景></a>应用场景</h4><ol><li>为复杂的模块或子系统提供外界访问的模块。<li>子系统相对独立。<li>预防低水平人员带来的风险。</ol><h4 id=应用实例-17><a class=headerlink href=#应用实例-17 title=应用实例></a>应用实例</h4><ol><li>去医院看病，可能要去挂号、门诊、划价、取药，让患者或患者家属觉得很复杂，如果有提供接待人员，只让接待人员来处理，就很方便。<li>JAVA 的三层开发模式。</ol><h4 id=注意事项-17><a class=headerlink href=#注意事项-17 title=注意事项></a>注意事项</h4><p><font color=red>在层次化结构中，可以使用外观模式定义系统每一层的入口。</font><h4 id=代码实例-17><a class=headerlink href=#代码实例-17 title=代码实例></a>代码实例</h4><figure class="highlight java"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br><span class=line>42</span><br><span class=line>43</span><br><span class=line>44</span><br><span class=line>45</span><br><span class=line>46</span><br><span class=line>47</span><br><span class=line>48</span><br><span class=line>49</span><br><span class=line>50</span><br><span class=line>51</span><br><span class=line>52</span><br><span class=line>53</span><br><span class=line>54</span><br><span class=line>55</span><br><span class=line>56</span><br><span class=line>57</span><br><span class=line>58</span><br><span class=line>59</span><br><span class=line>60</span><br><span class=line>61</span><br><span class=line>62</span><br><span class=line>63</span><br></pre><td class=code><pre><span class=line><span class=keyword>public</span> <span class=keyword>interface</span> <span class="title class_">Shape</span> {</span><br><span class=line>    <span class=keyword>void</span> <span class="title function_">draw</span><span class=params>()</span>;</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=keyword>public</span> <span class=keyword>class</span> <span class="title class_">Circle</span> <span class=keyword>implements</span> <span class="title class_">Shape</span>{</span><br><span class=line>    <span class=meta>@Override</span></span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">draw</span><span class=params>()</span> {</span><br><span class=line>        System.out.println(<span class=string>"Circle::draw()"</span>);</span><br><span class=line>    }</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=keyword>public</span> <span class=keyword>class</span> <span class="title class_">Rectangle</span> <span class=keyword>implements</span> <span class="title class_">Shape</span> {</span><br><span class=line>    <span class=meta>@Override</span></span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">draw</span><span class=params>()</span> {</span><br><span class=line>        System.out.println(<span class=string>"Rectangle::draw()"</span>);</span><br><span class=line>    }</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=keyword>public</span> <span class=keyword>class</span> <span class="title class_">FacadeApp</span> {</span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>static</span> <span class=keyword>void</span> <span class="title function_">main</span><span class=params>(String[] args)</span> {</span><br><span class=line>        <span class=comment>// 画一个圆形</span></span><br><span class=line>        <span class=type>Shape</span> <span class=variable>circle</span> <span class=operator>=</span> <span class=keyword>new</span> <span class="title class_">Circle</span>();</span><br><span class=line>        circle.draw();</span><br><span class=line></span><br><span class=line>        <span class=comment>// 画一个长方形</span></span><br><span class=line>        <span class=type>Shape</span> <span class=variable>rectangle</span> <span class=operator>=</span> <span class=keyword>new</span> <span class="title class_">Rectangle</span>();</span><br><span class=line>        rectangle.draw();</span><br><span class=line>    }</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=keyword>public</span> <span class=keyword>class</span> <span class="title class_">ShapeMaker</span> {</span><br><span class=line>    <span class=keyword>private</span> Shape circle;</span><br><span class=line>    <span class=keyword>private</span> Shape rectangle;</span><br><span class=line>    <span class=keyword>private</span> Shape square;</span><br><span class=line>    <span class=keyword>public</span> <span class="title function_">ShapeMaker</span><span class=params>()</span> {</span><br><span class=line>        circle = <span class=keyword>new</span> <span class="title class_">Circle</span>();</span><br><span class=line>        rectangle = <span class=keyword>new</span> <span class="title class_">Rectangle</span>();</span><br><span class=line>        square = <span class=keyword>new</span> <span class="title class_">Square</span>();</span><br><span class=line>    }</span><br><span class=line></span><br><span class=line>    <span class=comment>/**</span></span><br><span class=line><span class=comment>     * 下面定义一堆方法，具体应该调用什么方法，由这个门面来决定</span></span><br><span class=line><span class=comment>     */</span></span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">drawCircle</span><span class=params>()</span>{</span><br><span class=line>        circle.draw();</span><br><span class=line>    }</span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">drawRectangle</span><span class=params>()</span>{</span><br><span class=line>        rectangle.draw();</span><br><span class=line>    }</span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">drawSquare</span><span class=params>()</span>{</span><br><span class=line>        square.draw();</span><br><span class=line>    }</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=keyword>public</span> <span class=keyword>class</span> <span class="title class_">ShapeMakerApp</span> {</span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>static</span> <span class=keyword>void</span> <span class="title function_">main</span><span class=params>(String[] args)</span> {</span><br><span class=line>        <span class=type>ShapeMaker</span> <span class=variable>shapeMaker</span> <span class=operator>=</span> <span class=keyword>new</span> <span class="title class_">ShapeMaker</span>();</span><br><span class=line>        <span class=comment>// 客户端调用现在更加清晰了</span></span><br><span class=line>        shapeMaker.drawCircle();</span><br><span class=line>        shapeMaker.drawRectangle();</span><br><span class=line>        shapeMaker.drawSquare();</span><br><span class=line>    }</span><br><span class=line>}</span><br></pre></table></figure><h3 id=1-3-3、Proxy（代理模式）><a class=headerlink href=#1-3-3、Proxy（代理模式） title=1.3.3、Proxy（代理模式）></a>1.3.3、Proxy（代理模式）</h3><h4 id=简介-17><a class=headerlink href=#简介-17 title=简介></a>简介</h4><p><strong>为某个动作生成一个代理，用来控制对目标对象的访问。</strong><h4 id=实现-2><a class=headerlink href=#实现-2 title=实现></a>实现</h4><ul><li>静态代理<li>动态代理</ul><h4 id=何时使用-18><a class=headerlink href=#何时使用-18 title=何时使用></a>何时使用</h4><p>想在访问一个类时做一些控制。<h4 id=优缺点-18><a class=headerlink href=#优缺点-18 title=优缺点></a>优缺点</h4><ul><li>优点<ol><li>职责清晰。<li>高扩展性。<li>智能化。</ol><li>缺点<ol><li>由于增加了代理对象，因此有些类型的代理模式可能会造成请求的处理速度变慢。<li>实现代理模式需要额外的工作，有些代理模式的实现非常复杂。</ol></ul><h4 id=应用场景-17><a class=headerlink href=#应用场景-17 title=应用场景></a>应用场景</h4><ol><li>远程代理。<li>虚拟代理。<li>Copy-on-Write 代理。<li>保护（Protect or Access）代理。<li>Cache 代理。<li>防火墙（Firewall）代理。<li>同步化（Synchronization）代理。<li>智能引用（Smart Reference）代理。</ol><h4 id=应用实例-18><a class=headerlink href=#应用实例-18 title=应用实例></a>应用实例</h4><ol><li>Windows 中的快捷方式。<li>猪八戒去找高翠兰结果是孙悟空变的，可以这样理解：把高翠兰的外貌抽象出来，高翠兰本人和孙悟空都实现了这个接口，猪八戒访问高翠兰的时候看不出来这个是孙悟空，所以说孙悟空是高翠兰代理类。<li>买火车票不一定在火车站买，也可以去代售点。<li>一张支票或银行存单是账户中资金的代理。支票在市场交易中用来代替现金，并提供对签发人账号上资金的控制。<li>spring aop。</ol><h4 id=注意事项-18><a class=headerlink href=#注意事项-18 title=注意事项></a>注意事项</h4><ol><li><font color=red>与适配器模式的区别：适配器模式主要改变所考虑对象的接口，而代理模式不能改变所代理类的接口。</font><li><font color=red>与装饰器模式的区别：装饰器模式为了增强功能，而代理模式是为了加以控制。</font></ol><h4 id=代码实例-18><a class=headerlink href=#代码实例-18 title=代码实例></a>代码实例</h4><figure class="highlight java"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br><span class=line>42</span><br><span class=line>43</span><br><span class=line>44</span><br><span class=line>45</span><br><span class=line>46</span><br><span class=line>47</span><br><span class=line>48</span><br><span class=line>49</span><br><span class=line>50</span><br><span class=line>51</span><br><span class=line>52</span><br><span class=line>53</span><br><span class=line>54</span><br><span class=line>55</span><br><span class=line>56</span><br><span class=line>57</span><br><span class=line>58</span><br><span class=line>59</span><br><span class=line>60</span><br><span class=line>61</span><br><span class=line>62</span><br><span class=line>63</span><br><span class=line>64</span><br><span class=line>65</span><br><span class=line>66</span><br><span class=line>67</span><br><span class=line>68</span><br><span class=line>69</span><br><span class=line>70</span><br><span class=line>71</span><br><span class=line>72</span><br><span class=line>73</span><br><span class=line>74</span><br><span class=line>75</span><br></pre><td class=code><pre><span class=line><span class=keyword>public</span> <span class=keyword>abstract</span> <span class=keyword>class</span> <span class="title class_">Food</span> {</span><br><span class=line>    <span class=keyword>void</span> <span class="title function_">setChicken</span><span class=params>(String chicken)</span> { }</span><br><span class=line>    <span class=keyword>void</span> <span class="title function_">setSpicy</span><span class=params>(String spicy)</span> { }</span><br><span class=line>    <span class=keyword>void</span> <span class="title function_">setNoodle</span><span class=params>(String noodle)</span> { }</span><br><span class=line>    <span class=keyword>void</span> <span class="title function_">setSalt</span><span class=params>(String salt)</span> { }</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=keyword>public</span> <span class=keyword>interface</span> <span class="title class_">FoodService</span> {</span><br><span class=line>    Food <span class="title function_">makeChicken</span><span class=params>()</span>;</span><br><span class=line>    Food <span class="title function_">makeNoodle</span><span class=params>()</span>;</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=keyword>public</span> <span class=keyword>class</span> <span class="title class_">FoodServiceImpl</span> <span class=keyword>implements</span> <span class="title class_">FoodService</span>{</span><br><span class=line>    <span class=meta>@Override</span></span><br><span class=line>    <span class=keyword>public</span> Food <span class="title function_">makeChicken</span><span class=params>()</span> {</span><br><span class=line>        <span class=type>Food</span> <span class=variable>f</span> <span class=operator>=</span> <span class=keyword>new</span> <span class="title class_">Chicken</span>();</span><br><span class=line>        f.setChicken(<span class=string>"1kg"</span>);</span><br><span class=line>        f.setSpicy(<span class=string>"1g"</span>);</span><br><span class=line>        f.setSalt(<span class=string>"3g"</span>);</span><br><span class=line>        <span class=keyword>return</span> f;</span><br><span class=line>    }</span><br><span class=line>    <span class=meta>@Override</span></span><br><span class=line>    <span class=keyword>public</span> Food <span class="title function_">makeNoodle</span><span class=params>()</span> {</span><br><span class=line>        <span class=type>Food</span> <span class=variable>f</span> <span class=operator>=</span> <span class=keyword>new</span> <span class="title class_">Noodle</span>();</span><br><span class=line>        f.setNoodle(<span class=string>"500g"</span>);</span><br><span class=line>        f.setSalt(<span class=string>"5g"</span>);</span><br><span class=line>        <span class=keyword>return</span> f;</span><br><span class=line>    }</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=keyword>public</span> <span class=keyword>class</span> <span class="title class_">Chicken</span> <span class=keyword>extends</span> <span class="title class_">Food</span>{</span><br><span class=line>    <span class=keyword>private</span> String chicken;</span><br><span class=line>    <span class=keyword>private</span> String spicy;</span><br><span class=line>    <span class=keyword>private</span> String salt;</span><br><span class=line>	</span><br><span class=line>    <span class=comment>// set/get methods... </span></span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=keyword>public</span> <span class=keyword>class</span> <span class="title class_">Noodle</span> <span class=keyword>extends</span> <span class="title class_">Food</span>{</span><br><span class=line>    <span class=keyword>private</span> String noodle;</span><br><span class=line>    <span class=keyword>private</span> String salt;</span><br><span class=line></span><br><span class=line>    <span class=comment>// set/get methods...</span></span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=keyword>public</span> <span class=keyword>class</span> <span class="title class_">FoodServiceProxy</span> <span class=keyword>implements</span> <span class="title class_">FoodService</span> {</span><br><span class=line>    <span class=comment>// 内部一定要有一个真实的实现类，当然也可以通过构造方法注入</span></span><br><span class=line>    <span class=keyword>private</span> <span class=type>FoodService</span> <span class=variable>foodService</span> <span class=operator>=</span> <span class=keyword>new</span> <span class="title class_">FoodServiceImpl</span>();</span><br><span class=line></span><br><span class=line>    <span class=keyword>public</span> Food <span class="title function_">makeChicken</span><span class=params>()</span> {</span><br><span class=line>        System.out.println(<span class=string>"我们马上要开始制作鸡肉了"</span>);</span><br><span class=line></span><br><span class=line>        <span class=comment>// 如果我们定义这句为核心代码的话，那么，核心代码是真实实现类做的，</span></span><br><span class=line>        <span class=comment>// 代理只是在核心代码前后做些“无足轻重”的事情</span></span><br><span class=line>        <span class=type>Food</span> <span class=variable>food</span> <span class=operator>=</span> foodService.makeChicken();</span><br><span class=line></span><br><span class=line>        System.out.println(<span class=string>"鸡肉制作完成啦，加点胡椒粉"</span>); <span class=comment>// 增强</span></span><br><span class=line>        food.addCondiment(<span class=string>"pepper"</span>);</span><br><span class=line></span><br><span class=line>        <span class=keyword>return</span> food;</span><br><span class=line>    }</span><br><span class=line>    <span class=keyword>public</span> Food <span class="title function_">makeNoodle</span><span class=params>()</span> {</span><br><span class=line>        System.out.println(<span class=string>"准备制作拉面~"</span>);</span><br><span class=line>        <span class=type>Food</span> <span class=variable>food</span> <span class=operator>=</span> foodService.makeNoodle();</span><br><span class=line>        System.out.println(<span class=string>"制作完成啦"</span>);</span><br><span class=line>        <span class=keyword>return</span> food;</span><br><span class=line>    }</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=keyword>public</span> <span class=keyword>class</span> <span class="title class_">ProxyApp</span> {</span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>static</span> <span class=keyword>void</span> <span class="title function_">main</span><span class=params>(String[] args)</span> {</span><br><span class=line>        <span class=type>FoodService</span> <span class=variable>foodService</span> <span class=operator>=</span> <span class=keyword>new</span> <span class="title class_">FoodServiceProxy</span>();</span><br><span class=line>        foodService.makeChicken();</span><br><span class=line>    }</span><br><span class=line>}</span><br></pre></table></figure><h3 id=1-3-4、Adpter（适配器模式）><a class=headerlink href=#1-3-4、Adpter（适配器模式） title=1.3.4、Adpter（适配器模式）></a>1.3.4、Adpter（适配器模式）</h3><h4 id=简介-18><a class=headerlink href=#简介-18 title=简介></a>简介</h4><p>Adapter模式可以使得 不兼容的接口变得兼容。<h4 id=实现-3><a class=headerlink href=#实现-3 title=实现></a>实现</h4><ul><li>Object Adapter<li>Class Adapter</ul><h4 id=何时使用-19><a class=headerlink href=#何时使用-19 title=何时使用></a>何时使用</h4><ol><li>系统需要使用现有的类，而此类的接口不符合系统需要。<li>想要建立一个可以重复使用的类，可以使得不兼容的类变得兼容起来。<li>通过接口转换，将一个类插入另一个类系中。（比如老虎和飞禽，现在多了一个飞虎，在不增加实体的需求下，增加一个适配器，在里面包容一个虎对象，实现飞的接口。）</ol><h4 id=优缺点-19><a class=headerlink href=#优缺点-19 title=优缺点></a>优缺点</h4><ul><li>优点<ol><li>可以让任何两个没有关联的类一起运行。<li>提高了类的复用。<li>增加了类的透明度。<li>灵活性好。</ol><li>缺点<ol><li>过多地使用适配器，会让系统非常零乱，不易整体进行把握。比如，明明看到调用的是 A 接口，其实内部被适配成了 B 接口的实现，一个系统如果太多出现这种情况，无异于一场灾难。因此如果不是很有必要，可以不使用适配器，而是直接对系统进行重构。<li>由于 JAVA 至多继承一个类，所以至多只能适配一个适配者类，而且目标类必须是抽象类。</ol></ul><h4 id=应用场景-18><a class=headerlink href=#应用场景-18 title=应用场景></a>应用场景</h4><ol><li>希望使用某些现有类，但接口与代码不兼容时，可以使用适配器模式。<li>希望重用几个现有子类，这些子类缺少一些不能添加到超类中的公共功能时，可以使用适配器模式。</ol><h4 id=应用实例-19><a class=headerlink href=#应用实例-19 title=应用实例></a>应用实例</h4><ol><li>美国电器 110V，中国 220V，就要有一个适配器将 110V 转化为 220V。<li>JAVA JDK 1.1 提供了 Enumeration 接口，而在 1.2 中提供了 Iterator 接口，想要使用 1.2 的 JDK，则要将以前系统的 Enumeration 接口转化为 Iterator 接口，这时就需要适配器模式。<li>在 LINUX 上运行 WINDOWS 程序。 4. JAVA 中的 jdbc。</ol><h4 id=源码应用-4><a class=headerlink href=#源码应用-4 title=源码应用></a>源码应用</h4><figure class="highlight java"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br></pre><td class=code><pre><span class=line>java.util.Arrays#asList();</span><br><span class=line>java.util.Collections#list();</span><br><span class=line>org.springframework.context.event.GenericApplicationListenerAdapter</span><br></pre></table></figure><h4 id=注意事项-19><a class=headerlink href=#注意事项-19 title=注意事项></a>注意事项</h4><p><font color=red>适配器不是在详细设计时添加的，而是解决正在服役的项目问题。</font><h4 id=代码实例-19><a class=headerlink href=#代码实例-19 title=代码实例></a>代码实例</h4><figure class="highlight java"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br><span class=line>42</span><br><span class=line>43</span><br><span class=line>44</span><br><span class=line>45</span><br></pre><td class=code><pre><span class=line><span class=comment>/**</span></span><br><span class=line><span class=comment> * 适配器模式</span></span><br><span class=line><span class=comment> *</span></span><br><span class=line><span class=comment> * 简介：</span></span><br><span class=line><span class=comment> *      GOF是这样给适配器模式(Adapter)定义的：将一个类的接口转化成用户需要的</span></span><br><span class=line><span class=comment> *      另外一个接口。Adapter模式使得原本由于接口不兼容而不能一起工作的那些类</span></span><br><span class=line><span class=comment> *      可以一起工作。</span></span><br><span class=line><span class=comment> *</span></span><br><span class=line><span class=comment> * 实现方式-包含以下角色：</span></span><br><span class=line><span class=comment> *      Target：目标抽象类</span></span><br><span class=line><span class=comment> *      Adapter：适配器类</span></span><br><span class=line><span class=comment> *      Adaptee：适配者类</span></span><br><span class=line><span class=comment> *      Client：客户类</span></span><br><span class=line><span class=comment> *</span></span><br><span class=line><span class=comment> * 优缺点：</span></span><br><span class=line><span class=comment> *      - 优点：将目标类和适配者类解耦，通过引入一个适配器类来重用现有的适配者</span></span><br><span class=line><span class=comment> *             类，而无须修改原有代码。</span></span><br><span class=line><span class=comment> *             增加了类的透明性和复用性，将具体的实现封装在适配者类中，对于客</span></span><br><span class=line><span class=comment> *             户端类来说是透明的，而且提高了适配者的复用性。</span></span><br><span class=line><span class=comment> *             灵活性和扩展性都非常好，通过使用配置文件，可以很方便地更换适配</span></span><br><span class=line><span class=comment> *             器，也可以在不修改原有代码的基础上增加新的适配器类，完全符合“开</span></span><br><span class=line><span class=comment> *             闭原则”。</span></span><br><span class=line><span class=comment> *      - 缺点：过多地使用适配器，会让系统非常零乱，不易整体进行把握。</span></span><br><span class=line><span class=comment> *             对于类适配器而言，由于 JAVA 至多继承一个类，所以至多只能适配一</span></span><br><span class=line><span class=comment> *             个适配者类，而且目标类必须是抽象类</span></span><br><span class=line><span class=comment> *</span></span><br><span class=line><span class=comment> */</span></span><br><span class=line><span class=keyword>public</span> <span class=keyword>class</span> <span class="title class_">App</span> {</span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>static</span> <span class=keyword>void</span> <span class="title function_">main</span><span class=params>(String[] args)</span> {</span><br><span class=line>        <span class=type>Iphone6Plus</span> <span class=variable>iphone6Plus</span> <span class=operator>=</span> <span class=keyword>new</span> <span class="title class_">Iphone6Plus</span>(<span class=keyword>new</span> <span class="title class_">AppleCharger</span>());</span><br><span class=line>        iphone6Plus.charge();</span><br><span class=line></span><br><span class=line>        System.out.println(<span class=string>"=============================="</span>);</span><br><span class=line></span><br><span class=line>        <span class=type>GalaxyS7</span> <span class=variable>galaxyS7</span> <span class=operator>=</span> <span class=keyword>new</span> <span class="title class_">GalaxyS7</span>(<span class=keyword>new</span> <span class="title class_">AndroidCharger</span>());</span><br><span class=line>        galaxyS7.charge();</span><br><span class=line></span><br><span class=line>        System.out.println(<span class=string>"=============================="</span>);</span><br><span class=line></span><br><span class=line>        <span class=type>Adapter</span> <span class=variable>adapter</span>  <span class=operator>=</span> <span class=keyword>new</span> <span class="title class_">Adapter</span>(<span class=keyword>new</span> <span class="title class_">AndroidCharger</span>());</span><br><span class=line>        <span class=type>Iphone6Plus</span> <span class=variable>newIphone</span> <span class=operator>=</span> <span class=keyword>new</span> <span class="title class_">Iphone6Plus</span>();</span><br><span class=line>        newIphone.setLightningInterface(adapter);</span><br><span class=line>        newIphone.charge();</span><br><span class=line>    }</span><br><span class=line>}</span><br></pre></table></figure><h3 id=1-3-5、Decorator（装饰模式）><a class=headerlink href=#1-3-5、Decorator（装饰模式） title=1.3.5、Decorator（装饰模式）></a>1.3.5、Decorator（装饰模式）</h3><h4 id=简介-19><a class=headerlink href=#简介-19 title=简介></a>简介</h4><p><strong>动态地给一个对象添加一些额外职责</strong>。<h4 id=何时使用-20><a class=headerlink href=#何时使用-20 title=何时使用></a>何时使用</h4><p>既想扩展类，又不想通过子类的方式实现。<h4 id=优缺点-20><a class=headerlink href=#优缺点-20 title=优缺点></a>优缺点</h4><ul><li><p>优点</p> <ol><li>不改变原有对象的情况下给一个对象扩展功能。<li>使用不同的组合可以实现不同的效果。<li>符合开闭原则。</ol><li><p>缺点</p> <p>多层装饰比较复杂。</p></ul><h4 id=应用场景-19><a class=headerlink href=#应用场景-19 title=应用场景></a>应用场景</h4><ol><li>扩展一个类的功能。<li>动态增加功能，动态撤销。</ol><h4 id=应用实例-20><a class=headerlink href=#应用实例-20 title=应用实例></a>应用实例</h4><ol><li>孙悟空有 72 变，当他变成 “庙宇” 后，他的根本还是一只猴子，但是他又有了庙宇的功能。<li>不论一幅画有没有画框都可以挂在墙上，但是通常都是有画框的，并且实际上是画框被挂在墙上。在挂在墙上之前，画可以被蒙上玻璃，装到框子里；这时画、玻璃和画框形成了一个物体。</ol><h4 id=源码中的应用-1><a class=headerlink href=#源码中的应用-1 title=源码中的应用></a>源码中的应用</h4><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br></pre><td class=code><pre><span class=line>Servlet API</span><br><span class=line>javax.servlet.http.HttpServletRequestWrapper</span><br><span class=line>javax.servlet.http.HttpServletResponseWrapper</span><br></pre></table></figure><h4 id=注意事项-20><a class=headerlink href=#注意事项-20 title=注意事项></a>注意事项</h4><p><font color=red>可代替继承。</font><h4 id=代码实例-20><a class=headerlink href=#代码实例-20 title=代码实例></a>代码实例</h4><figure class="highlight java"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br><span class=line>42</span><br><span class=line>43</span><br><span class=line>44</span><br><span class=line>45</span><br><span class=line>46</span><br><span class=line>47</span><br><span class=line>48</span><br><span class=line>49</span><br><span class=line>50</span><br><span class=line>51</span><br><span class=line>52</span><br><span class=line>53</span><br><span class=line>54</span><br><span class=line>55</span><br><span class=line>56</span><br><span class=line>57</span><br><span class=line>58</span><br><span class=line>59</span><br><span class=line>60</span><br><span class=line>61</span><br><span class=line>62</span><br><span class=line>63</span><br><span class=line>64</span><br><span class=line>65</span><br><span class=line>66</span><br><span class=line>67</span><br><span class=line>68</span><br><span class=line>69</span><br><span class=line>70</span><br><span class=line>71</span><br><span class=line>72</span><br></pre><td class=code><pre><span class=line><span class=keyword>public</span> <span class=keyword>abstract</span> <span class=keyword>class</span> <span class="title class_">Beverage</span> {</span><br><span class=line>    <span class=comment>// 返回描述</span></span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>abstract</span> String <span class="title function_">getDescription</span><span class=params>()</span>;</span><br><span class=line>    <span class=comment>// 返回价格</span></span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>abstract</span> <span class=type>double</span> <span class="title function_">cost</span><span class=params>()</span>;</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=keyword>public</span> <span class=keyword>class</span> <span class="title class_">BlackTea</span> <span class=keyword>extends</span> <span class="title class_">Beverage</span> {</span><br><span class=line>    <span class=keyword>public</span> String <span class="title function_">getDescription</span><span class=params>()</span> {</span><br><span class=line>        <span class=keyword>return</span> <span class=string>"红茶"</span>;</span><br><span class=line>    }</span><br><span class=line>    <span class=keyword>public</span> <span class=type>double</span> <span class="title function_">cost</span><span class=params>()</span> {</span><br><span class=line>        <span class=keyword>return</span> <span class=number>10</span>;</span><br><span class=line>    }</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=keyword>public</span> <span class=keyword>class</span> <span class="title class_">GreenTea</span> <span class=keyword>extends</span> <span class="title class_">Beverage</span> {</span><br><span class=line>    <span class=keyword>public</span> String <span class="title function_">getDescription</span><span class=params>()</span> {</span><br><span class=line>        <span class=keyword>return</span> <span class=string>"绿茶"</span>;</span><br><span class=line>    }</span><br><span class=line>    <span class=keyword>public</span> <span class=type>double</span> <span class="title function_">cost</span><span class=params>()</span> {</span><br><span class=line>        <span class=keyword>return</span> <span class=number>11</span>;</span><br><span class=line>    }</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=comment>// 调料</span></span><br><span class=line><span class=keyword>public</span> <span class=keyword>abstract</span> <span class=keyword>class</span> <span class="title class_">Condiment</span> <span class=keyword>extends</span> <span class="title class_">Beverage</span> {</span><br><span class=line></span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=keyword>public</span> <span class=keyword>class</span> <span class="title class_">Mango</span> <span class=keyword>extends</span> <span class="title class_">Condiment</span> {</span><br><span class=line>    <span class=keyword>private</span> Beverage bevarage;</span><br><span class=line>    <span class=keyword>public</span> <span class="title function_">Mango</span><span class=params>(Beverage bevarage)</span> {</span><br><span class=line>        <span class=built_in>this</span>.bevarage = bevarage;</span><br><span class=line>    }</span><br><span class=line>    <span class=keyword>public</span> String <span class="title function_">getDescription</span><span class=params>()</span> {</span><br><span class=line>        <span class=keyword>return</span> bevarage.getDescription() + <span class=string>", 加芒果"</span>;</span><br><span class=line>    }</span><br><span class=line>    <span class=keyword>public</span> <span class=type>double</span> <span class="title function_">cost</span><span class=params>()</span> {</span><br><span class=line>        <span class=keyword>return</span> bevarage.cost() + <span class=number>3</span>; <span class=comment>// 加芒果需要 3 元</span></span><br><span class=line>    }</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=keyword>public</span> <span class=keyword>class</span> <span class="title class_">Lemon</span> <span class=keyword>extends</span> <span class="title class_">Condiment</span> {</span><br><span class=line>    <span class=keyword>private</span> Beverage bevarage;</span><br><span class=line>    <span class=comment>// 这里很关键，需要传入具体的饮料，如需要传入没有被装饰的红茶或绿茶，</span></span><br><span class=line>    <span class=comment>// 当然也可以传入已经装饰好的芒果绿茶，这样可以做芒果柠檬绿茶</span></span><br><span class=line>    <span class=keyword>public</span> <span class="title function_">Lemon</span><span class=params>(Beverage bevarage)</span> {</span><br><span class=line>        <span class=built_in>this</span>.bevarage = bevarage;</span><br><span class=line>    }</span><br><span class=line>    <span class=keyword>public</span> String <span class="title function_">getDescription</span><span class=params>()</span> {</span><br><span class=line>        <span class=comment>// 装饰</span></span><br><span class=line>        <span class=keyword>return</span> bevarage.getDescription() + <span class=string>", 加柠檬"</span>;</span><br><span class=line>    }</span><br><span class=line>    <span class=keyword>public</span> <span class=type>double</span> <span class="title function_">cost</span><span class=params>()</span> {</span><br><span class=line>        <span class=comment>// 装饰</span></span><br><span class=line>        <span class=keyword>return</span> bevarage.cost() + <span class=number>2</span>; <span class=comment>// 加柠檬需要 2 元</span></span><br><span class=line>    }</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=keyword>public</span> <span class=keyword>class</span> <span class="title class_">DecoratorApp</span> {</span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>static</span> <span class=keyword>void</span> <span class="title function_">main</span><span class=params>(String[] args)</span> {</span><br><span class=line>        <span class=comment>// 首先，我们需要一个基础饮料，红茶、绿茶或咖啡</span></span><br><span class=line>        <span class=type>Beverage</span> <span class=variable>beverage</span> <span class=operator>=</span> <span class=keyword>new</span> <span class="title class_">GreenTea</span>();</span><br><span class=line>        <span class=comment>// 开始装饰</span></span><br><span class=line>        beverage = <span class=keyword>new</span> <span class="title class_">Lemon</span>(beverage); <span class=comment>// 先加一份柠檬</span></span><br><span class=line>        beverage = <span class=keyword>new</span> <span class="title class_">Mango</span>(beverage); <span class=comment>// 再加一份芒果</span></span><br><span class=line></span><br><span class=line>        System.out.println(beverage.getDescription() + <span class=string>" 价格：￥"</span> + beverage.cost());</span><br><span class=line>        <span class=comment>//"绿茶, 加柠檬, 加芒果 价格：￥16"</span></span><br><span class=line>    }</span><br><span class=line>}</span><br></pre></table></figure><h3 id=1-3-6、Bridge（桥接模式）><a class=headerlink href=#1-3-6、Bridge（桥接模式） title=1.3.6、Bridge（桥接模式）></a>1.3.6、Bridge（桥接模式）</h3><h4 id=简介-20><a class=headerlink href=#简介-20 title=简介></a>简介</h4><p><strong>将抽象与实现分离，使它们都可以独立地变化</strong>。<h4 id=何时使用-21><a class=headerlink href=#何时使用-21 title=何时使用></a>何时使用</h4><p>系统的实现有多个方案，每一种都可能变化。<h4 id=优缺点-21><a class=headerlink href=#优缺点-21 title=优缺点></a>优缺点</h4><ul><li><p>优点</p> <ol><li>抽象和实现的分离。<li>优秀的扩展能力。<li>实现细节对客户透明。</ol><li><p>缺点</p> <p>桥接模式的引入会增加系统的理解与设计难度，由于聚合关联关系建立在抽象层，要求开发者针对抽象进行设计与编程。</p></ul><h4 id=应用场景-20><a class=headerlink href=#应用场景-20 title=应用场景></a>应用场景</h4><ol><li>不希望在抽象类和它的实现之间有一个固定的绑定关系；<li>类的抽象和实现都应该可以通过生成子类的方法加以扩充；<li>对一个抽象的实现部分的修改应对客户不产生影响，即客户代码无需重新编译；</ol><h4 id=应用实例-21><a class=headerlink href=#应用实例-21 title=应用实例></a>应用实例</h4><ol><li>猪八戒从天蓬元帅转世投胎到猪，转世投胎的机制将尘世划分为两个等级，即：灵魂和肉体，前者相当于抽象化，后者相当于实现化。生灵通过功能的委派，调用肉体对象的功能，使得生灵可以动态地选择。<li>墙上的开关，可以看到的开关是抽象的，不用管里面具体怎么实现的。</ol><h4 id=注意事项-21><a class=headerlink href=#注意事项-21 title=注意事项></a>注意事项</h4><p><font color=red>对于两个独立变化的维度，使用桥接模式非常合适。</font><h4 id=代码实例-21><a class=headerlink href=#代码实例-21 title=代码实例></a>代码实例</h4><figure class="highlight java"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br><span class=line>42</span><br><span class=line>43</span><br><span class=line>44</span><br><span class=line>45</span><br><span class=line>46</span><br><span class=line>47</span><br><span class=line>48</span><br><span class=line>49</span><br><span class=line>50</span><br><span class=line>51</span><br><span class=line>52</span><br><span class=line>53</span><br><span class=line>54</span><br><span class=line>55</span><br><span class=line>56</span><br><span class=line>57</span><br><span class=line>58</span><br><span class=line>59</span><br><span class=line>60</span><br><span class=line>61</span><br><span class=line>62</span><br><span class=line>63</span><br><span class=line>64</span><br><span class=line>65</span><br><span class=line>66</span><br><span class=line>67</span><br><span class=line>68</span><br><span class=line>69</span><br><span class=line>70</span><br><span class=line>71</span><br><span class=line>72</span><br><span class=line>73</span><br><span class=line>74</span><br><span class=line>75</span><br><span class=line>76</span><br><span class=line>77</span><br><span class=line>78</span><br><span class=line>79</span><br><span class=line>80</span><br><span class=line>81</span><br><span class=line>82</span><br><span class=line>83</span><br><span class=line>84</span><br><span class=line>85</span><br><span class=line>86</span><br><span class=line>87</span><br><span class=line>88</span><br><span class=line>89</span><br><span class=line>90</span><br><span class=line>91</span><br><span class=line>92</span><br><span class=line>93</span><br><span class=line>94</span><br><span class=line>95</span><br><span class=line>96</span><br><span class=line>97</span><br><span class=line>98</span><br><span class=line>99</span><br><span class=line>100</span><br><span class=line>101</span><br><span class=line>102</span><br><span class=line>103</span><br><span class=line>104</span><br><span class=line>105</span><br><span class=line>106</span><br></pre><td class=code><pre><span class=line><span class=comment>/**</span></span><br><span class=line><span class=comment> * 电灯接口</span></span><br><span class=line><span class=comment> */</span></span><br><span class=line><span class=keyword>public</span> <span class=keyword>interface</span> <span class="title class_">ILight</span> {</span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">electricConnected</span><span class=params>()</span>;</span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">light</span><span class=params>()</span>;</span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">electricClosed</span><span class=params>()</span>;</span><br><span class=line>}</span><br><span class=line></span><br><span class=line></span><br><span class=line><span class=comment>/**</span></span><br><span class=line><span class=comment> * 开关顶层类</span></span><br><span class=line><span class=comment> */</span></span><br><span class=line><span class=keyword>public</span> <span class=keyword>class</span> <span class="title class_">BaseSwitch</span> {</span><br><span class=line>    <span class=keyword>protected</span> ILight light;</span><br><span class=line>    <span class=keyword>public</span> <span class="title function_">BaseSwitch</span><span class=params>(ILight light)</span>{</span><br><span class=line>        <span class=built_in>this</span>.light = light;</span><br><span class=line>    }</span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>final</span> <span class=keyword>void</span> <span class="title function_">makeLight</span><span class=params>()</span>{</span><br><span class=line>        <span class=built_in>this</span>.light.electricConnected();</span><br><span class=line>        <span class=built_in>this</span>.light.light();</span><br><span class=line>        <span class=built_in>this</span>.light.electricClosed();</span><br><span class=line>    }</span><br><span class=line>}</span><br><span class=line></span><br><span class=line></span><br><span class=line><span class=comment>/**</span></span><br><span class=line><span class=comment> * 遥控开关</span></span><br><span class=line><span class=comment> */</span></span><br><span class=line><span class=keyword>public</span> <span class=keyword>class</span> <span class="title class_">RemoteControISwitch</span> <span class=keyword>extends</span> <span class="title class_">BaseSwitch</span>{</span><br><span class=line>    <span class=keyword>public</span> <span class="title function_">RemoteControISwitch</span><span class=params>(ILight light)</span>{</span><br><span class=line>        <span class=built_in>super</span>(light);</span><br><span class=line>    }</span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>final</span> <span class=keyword>void</span> <span class="title function_">makeRemoteLight</span><span class=params>(<span class=type>int</span> operColor)</span>{</span><br><span class=line>        <span class=built_in>this</span>.light.electricConnected();</span><br><span class=line>        <span class=built_in>this</span>.light.light();</span><br><span class=line>        <span class=type>String</span> <span class=variable>color</span> <span class=operator>=</span> <span class=string>""</span>;</span><br><span class=line>        <span class=keyword>switch</span> (operColor){</span><br><span class=line>            <span class=keyword>case</span> <span class=number>1</span>:</span><br><span class=line>                color = <span class=string>"暖色"</span>;</span><br><span class=line>                <span class=keyword>break</span>;</span><br><span class=line>            <span class=keyword>case</span> <span class=number>2</span>:</span><br><span class=line>                color = <span class=string>"蓝色"</span>;</span><br><span class=line>                <span class=keyword>break</span>;</span><br><span class=line>            <span class=keyword>case</span> <span class=number>3</span>:</span><br><span class=line>                color = <span class=string>"红色"</span>;</span><br><span class=line>                <span class=keyword>break</span>;</span><br><span class=line>            <span class=keyword>default</span>:</span><br><span class=line>                color = <span class=string>"白色"</span>;</span><br><span class=line>                <span class=keyword>break</span>;</span><br><span class=line>        }</span><br><span class=line>        System.out.println(<span class=string>"当前灯光颜色为："</span> + color);</span><br><span class=line>        <span class=built_in>this</span>.light.electricClosed();</span><br><span class=line>    }</span><br><span class=line>}</span><br><span class=line></span><br><span class=line></span><br><span class=line><span class=comment>/**</span></span><br><span class=line><span class=comment> * 白炽灯实现</span></span><br><span class=line><span class=comment> */</span></span><br><span class=line><span class=keyword>public</span> <span class=keyword>class</span> <span class="title class_">IncandescentLight</span> <span class=keyword>implements</span> <span class="title class_">ILight</span>{</span><br><span class=line>    <span class=meta>@Override</span></span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">electricConnected</span><span class=params>()</span> {</span><br><span class=line>        System.out.println(<span class=string>"白炽灯被打开了！"</span>);</span><br><span class=line>    }</span><br><span class=line>    <span class=meta>@Override</span></span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">light</span><span class=params>()</span> {</span><br><span class=line>        System.out.println(<span class=string>"白炽灯在照明！"</span>);</span><br><span class=line>    }</span><br><span class=line>    <span class=meta>@Override</span></span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">electricClosed</span><span class=params>()</span> {</span><br><span class=line>        System.out.println(<span class=string>"白炽灯被关闭了！"</span>);</span><br><span class=line>    }</span><br><span class=line>}</span><br><span class=line></span><br><span class=line></span><br><span class=line><span class=keyword>public</span> <span class=keyword>class</span> <span class="title class_">CrystalLight</span> <span class=keyword>implements</span> <span class="title class_">ILight</span>{</span><br><span class=line>    <span class=meta>@Override</span></span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">electricConnected</span><span class=params>()</span> {</span><br><span class=line>        System.out.println(<span class=string>"水晶灯被打开了！"</span>);</span><br><span class=line>    }</span><br><span class=line>    <span class=meta>@Override</span></span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">light</span><span class=params>()</span> {</span><br><span class=line>        System.out.println(<span class=string>"水晶灯在照明！"</span>);</span><br><span class=line>    }</span><br><span class=line>    <span class=meta>@Override</span></span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">electricClosed</span><span class=params>()</span> {</span><br><span class=line>        System.out.println(<span class=string>"水晶灯被关闭了！"</span>);</span><br><span class=line>    }</span><br><span class=line>}</span><br><span class=line></span><br><span class=line></span><br><span class=line><span class=keyword>public</span> <span class=keyword>class</span> <span class="title class_">BridgeApp</span> {</span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>static</span> <span class=keyword>void</span> <span class="title function_">main</span><span class=params>(String[] args)</span> {</span><br><span class=line>        <span class=type>ILight</span> <span class=variable>incandescentLight</span> <span class=operator>=</span> <span class=keyword>new</span> <span class="title class_">IncandescentLight</span>();</span><br><span class=line>        <span class=type>ILight</span> <span class=variable>crystalLight</span> <span class=operator>=</span> <span class=keyword>new</span> <span class="title class_">CrystalLight</span>();</span><br><span class=line></span><br><span class=line>        <span class=type>BaseSwitch</span> <span class=variable>baseSwitch</span> <span class=operator>=</span> <span class=keyword>new</span> <span class="title class_">BaseSwitch</span>(incandescentLight);</span><br><span class=line>        baseSwitch.makeLight();</span><br><span class=line></span><br><span class=line>        System.out.println(<span class=string>"--------------------------"</span>);</span><br><span class=line></span><br><span class=line>        <span class=type>RemoteControISwitch</span> <span class=variable>controISwitch</span> <span class=operator>=</span> <span class=keyword>new</span> <span class="title class_">RemoteControISwitch</span>(crystalLight);</span><br><span class=line>        controISwitch.makeRemoteLight(<span class=number>1</span>);</span><br><span class=line>    }</span><br><span class=line>}</span><br></pre></table></figure><h3 id=1-3-7、Flyweight（享元模式）><a class=headerlink href=#1-3-7、Flyweight（享元模式） title=1.3.7、Flyweight（享元模式）></a>1.3.7、Flyweight（享元模式）</h3><h4 id=简介-21><a class=headerlink href=#简介-21 title=简介></a>简介</h4><p>主要用于减少创建对象的数量，减少内存占用以提高性能。该模式会尝试重用现有的同类对象，如果未找到匹配的对象，则创建新对象。<h4 id=何时使用-22><a class=headerlink href=#何时使用-22 title=何时使用></a>何时使用</h4><ol><li>系统中有大量对象。<li>这些对象消耗大量内存。<li>这些对象的状态大部分可以外部化。<li>这些对象可以按照内蕴状态分为很多组，当把外蕴对象从对象中拿出来时，每组对象都可用一个对象来代替。<li>系统不依赖于对象身份，因对象不可分辨。</ol><h4 id=优缺点-22><a class=headerlink href=#优缺点-22 title=优缺点></a>优缺点</h4><ul><li>优点：减少对象创建，降低内存消耗，效率提高。<li>缺点：提高了系统复杂度，需要分离出外部状态和内部状态，而且外部状态具有固有化的性质，不应该随着内部状态的变化而变化，否则会造成系统混乱。</ul><h4 id=应用场景-21><a class=headerlink href=#应用场景-21 title=应用场景></a>应用场景</h4><ol><li>系统有大量相似对象。<li>需要缓冲池的场景。</ol><h4 id=应用实例-22><a class=headerlink href=#应用实例-22 title=应用实例></a>应用实例</h4><ol><li>JAVA 中的 String，如果有则返回，如果没有则创建一个字符串保存在字符串缓存池里面。<li>数据库的数据池。</ol><h4 id=源码应用-5><a class=headerlink href=#源码应用-5 title=源码应用></a>源码应用</h4><figure class="highlight java"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br></pre><td class=code><pre><span class=line>String / Integer / Long....</span><br><span class=line>com.sun.org.apache.bcel.internal.generic.InstructionConstants</span><br></pre></table></figure><h4 id=注意事项-22><a class=headerlink href=#注意事项-22 title=注意事项></a>注意事项</h4><ol><li><font color=red>注意划分外部状态和内部状态，否则可能会引起线程安全问题。</font><li><font color=red>这些类必须有一个工厂对象加以控制。</font></ol><h4 id=代码实例-22><a class=headerlink href=#代码实例-22 title=代码实例></a>代码实例</h4><figure class="highlight java"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br><span class=line>42</span><br><span class=line>43</span><br><span class=line>44</span><br><span class=line>45</span><br><span class=line>46</span><br><span class=line>47</span><br><span class=line>48</span><br><span class=line>49</span><br><span class=line>50</span><br><span class=line>51</span><br><span class=line>52</span><br><span class=line>53</span><br><span class=line>54</span><br><span class=line>55</span><br><span class=line>56</span><br><span class=line>57</span><br><span class=line>58</span><br><span class=line>59</span><br><span class=line>60</span><br><span class=line>61</span><br><span class=line>62</span><br><span class=line>63</span><br><span class=line>64</span><br><span class=line>65</span><br><span class=line>66</span><br><span class=line>67</span><br><span class=line>68</span><br><span class=line>69</span><br><span class=line>70</span><br><span class=line>71</span><br><span class=line>72</span><br><span class=line>73</span><br><span class=line>74</span><br><span class=line>75</span><br><span class=line>76</span><br><span class=line>77</span><br><span class=line>78</span><br><span class=line>79</span><br><span class=line>80</span><br><span class=line>81</span><br><span class=line>82</span><br><span class=line>83</span><br><span class=line>84</span><br><span class=line>85</span><br><span class=line>86</span><br><span class=line>87</span><br><span class=line>88</span><br><span class=line>89</span><br><span class=line>90</span><br><span class=line>91</span><br><span class=line>92</span><br><span class=line>93</span><br><span class=line>94</span><br><span class=line>95</span><br><span class=line>96</span><br><span class=line>97</span><br></pre><td class=code><pre><span class=line><span class=keyword>public</span> <span class=keyword>abstract</span> <span class=keyword>class</span> <span class="title class_">AbstractChessman</span> {</span><br><span class=line>    <span class=keyword>protected</span> <span class=type>int</span> x;</span><br><span class=line>    <span class=keyword>protected</span> <span class=type>int</span> y;</span><br><span class=line>    <span class=keyword>protected</span> String chess;</span><br><span class=line>    <span class=keyword>public</span> <span class="title function_">AbstractChessman</span><span class=params>(String chess)</span>{</span><br><span class=line>        <span class=built_in>this</span>.chess = chess;</span><br><span class=line>    }</span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>abstract</span> <span class=keyword>void</span> <span class="title function_">point</span><span class=params>(<span class=type>int</span> x, <span class=type>int</span> y)</span>;</span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">show</span><span class=params>()</span>{</span><br><span class=line>        System.out.println(<span class=built_in>this</span>.chess + <span class=string>": "</span> + <span class=built_in>this</span>.x + <span class=string>"/"</span> + <span class=built_in>this</span>.y);</span><br><span class=line>    }</span><br><span class=line>}</span><br><span class=line></span><br><span class=line></span><br><span class=line><span class=keyword>public</span> <span class=keyword>class</span> <span class="title class_">BlackChessman</span> <span class=keyword>extends</span> <span class="title class_">AbstractChessman</span>{</span><br><span class=line>    <span class=keyword>public</span> <span class="title function_">BlackChessman</span><span class=params>()</span>{</span><br><span class=line>        <span class=built_in>super</span>(<span class=string>"."</span>);</span><br><span class=line>        System.out.println(<span class=string>"BlackChessman construction exec!"</span>);</span><br><span class=line>    }</span><br><span class=line>    <span class=meta>@Override</span></span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">point</span><span class=params>(<span class=type>int</span> x, <span class=type>int</span> y)</span> {</span><br><span class=line>        <span class=built_in>this</span>.x = x;</span><br><span class=line>        <span class=built_in>this</span>.y = y;</span><br><span class=line>        <span class=built_in>this</span>.show();</span><br><span class=line>    }</span><br><span class=line>}</span><br><span class=line></span><br><span class=line></span><br><span class=line><span class=keyword>public</span> <span class=keyword>class</span> <span class="title class_">WhiteChessman</span> <span class=keyword>extends</span> <span class="title class_">AbstractChessman</span>{</span><br><span class=line>    <span class=keyword>public</span> <span class="title function_">WhiteChessman</span><span class=params>()</span>{</span><br><span class=line>        <span class=built_in>super</span>(<span class=string>"o"</span>);</span><br><span class=line>        System.out.println(<span class=string>"WhiteChessman construction exec!"</span>);</span><br><span class=line>    }</span><br><span class=line>    <span class=meta>@Override</span></span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">point</span><span class=params>(<span class=type>int</span> x, <span class=type>int</span> y)</span> {</span><br><span class=line>        <span class=built_in>this</span>.x = x;</span><br><span class=line>        <span class=built_in>this</span>.y = y;</span><br><span class=line>        <span class=built_in>this</span>.show();</span><br><span class=line>    }</span><br><span class=line>}</span><br><span class=line></span><br><span class=line></span><br><span class=line><span class=keyword>public</span> <span class=keyword>class</span> <span class="title class_">FiveChessmanFactory</span> {</span><br><span class=line>    <span class=keyword>private</span> <span class=keyword>static</span> <span class=type>FiveChessmanFactory</span> <span class=variable>fiveChessmanFactory</span> <span class=operator>=</span> <span class=keyword>new</span> <span class="title class_">FiveChessmanFactory</span>();</span><br><span class=line>    <span class=keyword>private</span> <span class=keyword>final</span> Hashtable&LTCharacter, AbstractChessman> cache = <span class=keyword>new</span> <span class="title class_">Hashtable</span>&LTCharacter, AbstractChessman>();</span><br><span class=line>    <span class=keyword>private</span> <span class="title function_">FiveChessmanFactory</span><span class=params>()</span>{</span><br><span class=line></span><br><span class=line>    }</span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>static</span> FiveChessmanFactory <span class="title function_">getInstance</span><span class=params>()</span>{</span><br><span class=line>        <span class=keyword>return</span> fiveChessmanFactory;</span><br><span class=line>    }</span><br><span class=line>    <span class=keyword>public</span> AbstractChessman <span class="title function_">getChessmanObject</span><span class=params>(<span class=type>char</span> c)</span>{</span><br><span class=line>        <span class=type>AbstractChessman</span> <span class=variable>chessman</span> <span class=operator>=</span> <span class=built_in>this</span>.cache.get(c);</span><br><span class=line>        <span class=keyword>if</span> (chessman == <span class=literal>null</span>){</span><br><span class=line>            <span class=keyword>switch</span> (c){</span><br><span class=line>                <span class=keyword>case</span> <span class=string>'B'</span>:</span><br><span class=line>                    chessman = <span class=keyword>new</span> <span class="title class_">BlackChessman</span>();</span><br><span class=line>                    <span class=keyword>break</span>;</span><br><span class=line>                <span class=keyword>case</span> <span class=string>'W'</span>:</span><br><span class=line>                    chessman = <span class=keyword>new</span> <span class="title class_">WhiteChessman</span>();</span><br><span class=line>                    <span class=keyword>break</span>;</span><br><span class=line>                <span class=keyword>default</span>:</span><br><span class=line>                    <span class=keyword>break</span>;</span><br><span class=line>            }</span><br><span class=line>            <span class=keyword>if</span> (chessman != <span class=literal>null</span>){</span><br><span class=line>                <span class=built_in>this</span>.cache.put(c, chessman);</span><br><span class=line>            }</span><br><span class=line>        }</span><br><span class=line>        <span class=keyword>return</span> chessman;</span><br><span class=line>    }</span><br><span class=line>}</span><br><span class=line></span><br><span class=line></span><br><span class=line><span class=keyword>public</span> <span class=keyword>class</span> <span class="title class_">FlyweightApp</span> {</span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>static</span> <span class=keyword>void</span> <span class="title function_">main</span><span class=params>(String[] args)</span> {</span><br><span class=line>        <span class=type>FiveChessmanFactory</span> <span class=variable>fiveChessmanFactory</span> <span class=operator>=</span> FiveChessmanFactory.getInstance();</span><br><span class=line>        </span><br><span class=line>        <span class=type>Random</span> <span class=variable>random</span> <span class=operator>=</span> <span class=keyword>new</span> <span class="title class_">Random</span>();</span><br><span class=line>        <span class=type>int</span> <span class=variable>radom</span> <span class=operator>=</span> <span class=number>0</span>;</span><br><span class=line>        <span class=type>AbstractChessman</span> <span class=variable>abstractChessman</span> <span class=operator>=</span> <span class=literal>null</span>;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>for</span> (<span class=type>int</span> <span class=variable>i</span> <span class=operator>=</span> <span class=number>0</span>; i < <span class=number>10</span>; i++){</span><br><span class=line>            radom = random.nextInt(<span class=number>2</span>);</span><br><span class=line>            <span class=keyword>switch</span> (radom){</span><br><span class=line>                <span class=keyword>case</span> <span class=number>0</span>:</span><br><span class=line>                    abstractChessman = fiveChessmanFactory.getChessmanObject(<span class=string>'B'</span>);</span><br><span class=line>                    <span class=keyword>break</span>;</span><br><span class=line>                <span class=keyword>case</span> <span class=number>1</span>:</span><br><span class=line>                    abstractChessman = fiveChessmanFactory.getChessmanObject(<span class=string>'W'</span>);</span><br><span class=line>                    <span class=keyword>break</span>;</span><br><span class=line>            }</span><br><span class=line>            <span class=keyword>if</span> (abstractChessman != <span class=literal>null</span>){</span><br><span class=line>                abstractChessman.point(i, random.nextInt(<span class=number>15</span>));</span><br><span class=line>            }</span><br><span class=line>        }</span><br><span class=line>    }</span><br><span class=line>}</span><br></pre></table></figure><h2 id=1-4、设计模式间的关系><a class=headerlink href=#1-4、设计模式间的关系 title=1.4、设计模式间的关系></a>1.4、设计模式间的关系</h2><p><img alt=设计模式间的关系 src=https://raw.githubusercontent.com/lucky2shh/blog-haogeblogs-image/master/2023/08/06/image-20210420203056818.png?token=AIGEF3L6P4ZSWPM3RWVOD3LEZZZVE><h1 id=2、设计模式原则><a class=headerlink href=#2、设计模式原则 title=2、设计模式原则></a>2、设计模式原则</h1><h2 id=2-1、开闭原则（OCP）><a class=headerlink href=#2-1、开闭原则（OCP） title=2.1、开闭原则（OCP）></a>2.1、开闭原则（OCP）</h2><h3 id=2-1-1、简介><a class=headerlink href=#2-1-1、简介 title=2.1.1、简介></a>2.1.1、简介</h3><p><strong>开闭原则规定：软件中的对象（类，模块，函数等）对于扩展应该开放，对于修改应该封闭。</strong>也就是说，应该在不修改类源代码前提下来更改类的行为。<h3 id=2-1-2、分类><a class=headerlink href=#2-1-2、分类 title=2.1.2、分类></a>2.1.2、分类</h3><ul><li><p><strong>梅耶开闭原则</strong></p> <p>梅耶原则 提倡继承实现。具体实现可以通过继承来重用，但是接口规格不必如此。已存在的实现对于修改是封闭的，但是新的实现不必实现原有接口。</p><li><p><strong>多态开闭原则</strong></p> <p>多态开闭原则 倡导继承抽象类。接口规约可以通过继承来重用，但是实现不必如此。已存在的接口对于修改是封闭的，并且新的实现必须至少实现那个接口。</p></ul><h2 id=2-2、单一职责原则（SRP）><a class=headerlink href=#2-2、单一职责原则（SRP） title=2.2、单一职责原则（SRP）></a>2.2、单一职责原则（SRP）</h2><h3 id=2-2-1、简介><a class=headerlink href=#2-2-1、简介 title=2.2.1、简介></a>2.2.1、简介</h3><p>面向对象五个基本原则（SOLID）之一。<p><strong>单一职责原则（SRP：Single responsibility principle）又称单一功能原则。该原则规定：一个类或者模块应该有且只有一个改变原因。</strong><p>单一职责原则由罗伯特·C·马丁（Robert C. Martin）于《敏捷软件开发：原则、模式和实践》一书中给出。马丁表示此原则是基于汤姆·狄马克(Tom DeMarco)和Meilir Page-Jones的=著作中的 内聚性原则 来实现。<p><strong>所谓职责是指类变化的原因。如果类改变的原因多于一个，那就违反了该职责。</strong><h3 id=2-2-2、问题由来><a class=headerlink href=#2-2-2、问题由来 title=2.2.2、问题由来></a>2.2.2、问题由来</h3><p>之所以会出现单一职责原则就是因为在软件设计时会出现以下类似场景：<p>T负责两个不同的职责：职责P1，职责P2。当由于职责P1需求发生改变而需要修改类T时，有可能会导致原本运行正常的职责P2功能发生故障。也就是说职责P1和P2耦合在了一起。<h3 id=2-2-3、产生原因><a class=headerlink href=#2-2-3、产生原因 title=2.2.3、产生原因></a>2.2.3、产生原因</h3><p>很多耦合常常发生在不经意之间，原因就是 职责扩散：因为某种原因，某一职责被分化为颗粒度更细多个职责。<h3 id=2-2-4、解决方法><a class=headerlink href=#2-2-4、解决方法 title=2.2.4、解决方法></a>2.2.4、解决方法</h3><p>遵守单一职责原则，将不同的职责封装到不同的类或模块中。<h2 id=2-3、依赖倒置原则（DIP）><a class=headerlink href=#2-3、依赖倒置原则（DIP） title=2.3、依赖倒置原则（DIP）></a>2.3、依赖倒置原则（DIP）</h2><h3 id=2-3-1、简介><a class=headerlink href=#2-3-1、简介 title=2.3.1、简介></a>2.3.1、简介</h3><p><strong>开闭原则的基础。依赖倒置原则（Dependence Inversion Principle）是指：程序要依赖于抽象接口，不要依赖于具体实现。</strong>简单说就是一定要面向抽象编程，而不要面向实现编程，这样就降低了客户与实现模块间的耦合。<h3 id=2-3-2、意图><a class=headerlink href=#2-3-2、意图 title=2.3.2、意图></a>2.3.2、意图</h3><p><strong>面向过程开发，上层调用下层，上层依赖于下层，当下层剧烈变动时上层也要跟着变动，这就会降低模块的复用性且大大提高了开发成本</strong><p>面向对象开发解决了这个问题，一般情况下抽象的变化概率很小，让用户程序依赖于抽象，实现的细节也依赖于抽象。即使实现细节不断变动，只要抽象不变，客户程序就不需要变化。这大大降低了客户程序与实现细节的耦合度。<h3 id=2-3-3、注意事项><a class=headerlink href=#2-3-3、注意事项 title=2.3.3、注意事项></a>2.3.3、注意事项</h3><ol><li>高层次的模块不应该依赖于低层次的模块，他们都应该依赖于抽象。<li>抽象不应该依赖于具体，而是具体应该依赖于抽象。</ol><h2 id=2-4、接口隔离原则（ISP）><a class=headerlink href=#2-4、接口隔离原则（ISP） title=2.4、接口隔离原则（ISP）></a>2.4、接口隔离原则（ISP）</h2><h3 id=2-4-1、简介><a class=headerlink href=#2-4-1、简介 title=2.4.1、简介></a>2.4.1、简介</h3><p>接口隔离原则（Interface Segregation Principle，ISP）是面向对象设计中的一个原则，它强调的是 <strong>客户端不应该依赖它不需要的接口，将臃肿的接口拆分为更小、更具体的接口，避免接口的冗余</strong>。<p>接口隔离原则的核心思想是 <strong>定义接口时要精简、单一，不应该包含不需要的方法，这样可以减少类与接口之间的耦合，提高代码可读性、可维护性、可扩展性</strong>。<p>接口隔离原则可以参考如下几点来实现：<ul><li>将庞大的接口拆分为多个小接口。<li>根据需要只使用特定的接口。<li>接口的职责要单一。</ul><h3 id=2-4-2、优点><a class=headerlink href=#2-4-2、优点 title=2.4.2、优点></a>2.4.2、优点</h3><p>接口隔离原则可以使得系统的接口设计更加灵活、可扩展和易于维护。能降低类与接口之间的耦合度，减少不必要的依赖关系，使得系统的各个模块能够独立地发展与演化。<h2 id=2-5、里氏替换原则（LSP）><a class=headerlink href=#2-5、里氏替换原则（LSP） title=2.5、里氏替换原则（LSP）></a>2.5、里氏替换原则（LSP）</h2><h3 id=2-5-1、简介><a class=headerlink href=#2-5-1、简介 title=2.5.1、简介></a>2.5.1、简介</h3><p>里氏代换原则（Liskov Substitution Principle LSP）是指：<strong>基类可以出现的地方，子类也可以出现</strong>。<p>LSP是继承复用的基石，只有当衍生类可以替换掉基类，软件的功能不受到影响时，基类才能真正被复用，而衍生类也能够在基类的基础上增加新的行为。<em><strong>里氏代换原则是对“开闭”原则的补充。实现“开闭”原则的关键步骤就是抽象化</strong></em>。而基类与子类的继承关系就是抽象化的具体实现，所以里氏代换原则是对实现抽象化的具体步骤的规范。<h3 id=2-5-2、注意事项><a class=headerlink href=#2-5-2、注意事项 title=2.5.2、注意事项></a>2.5.2、注意事项</h3><p><strong>设计时，尽量继承抽象类，而不要继承具体类。</strong>如果从继承等级树来看，所有叶子节点应当是具体类，而所有的树枝节点应当是抽象类或者接口。当然这只是一般性的指导原则，使用时还需具体情况具体分析。<p>简单的理解为一个软件实体如果使用的是一个父类，那么一定适用于其子类，而且它察觉不出父类对象和子类对象的区别。也就是说，软件里面，把父类都替换成它的子类，程序的行为没有变化。<h2 id=2-6、迪米特原则（LOD）><a class=headerlink href=#2-6、迪米特原则（LOD） title=2.6、迪米特原则（LOD）></a>2.6、迪米特原则（LOD）</h2><h3 id=2-6-1、简介><a class=headerlink href=#2-6-1、简介 title=2.6.1、简介></a>2.6.1、简介</h3><p>迪米特原则（Law Of Demeter）也被称为最少知道原则，是面向对象设计中的一个原则。迪米特原则的核心思想是 <strong>降低对象之间的耦合，使得对象之间的通信变得简单和直接</strong>。<p>迪米特原则的目标是 实现高内聚、低耦合。具体包括如下几点：<ul><li>减少对象之间的耦合<li>保护对象的隐私<li>提高代码可维护性</ul><p>迪米特原则可以参考如下几个方面来实现：<ul><li>在类中尽量减少对其它类的引用，不应该直接引用与本类关系较远的类。<li>通过封装和信息隐藏，将对象的内部细节隐藏起来，只暴漏必要的接口。<li>使用中介者模式或外观模式来降低对象之间的直接依赖关系。</ul><h2 id=2-7、合成复用原则（CRP）><a class=headerlink href=#2-7、合成复用原则（CRP） title=2.7、合成复用原则（CRP）></a>2.7、合成复用原则（CRP）</h2><h3 id=2-7-1、简介><a class=headerlink href=#2-7-1、简介 title=2.7.1、简介></a>2.7.1、简介</h3><p>合成复用原则是设计模式中的一个原则，也称之为CRP原则。它指的是在软件设计中，<strong>优先使用对象组合而不是继承来实现代码的复用</strong>。<p>合成复用原则的核心思想是：<strong>通过将现有的对象组合成新的对象，实现代码复用和灵活性</strong>。相对于通过继承实现复用，使用对象组合可以更好的控制类之间的关系，且可以动态改变对象的行为。<h3 id=2-7-2、优点><a class=headerlink href=#2-7-2、优点 title=2.7.2、优点></a>2.7.2、优点</h3><p>合成复用有如下几个优点：<ul><li>减少类之间的耦合：继承会导致子类和父类之间的紧耦合，而对象组合可以在对象之间建立松散的关系，减少类之间的依赖。<li>提高系统灵活性：对象组合可以动态改变对象的行为，通过替换组合中的对象，可以灵活扩展和修改系统的功能。<li>更好地复用代码：组合现有对象，可以构建出具有不同功能的新对象，实现代码复用。<li>更好的维护：对象组合关系松散，需要修改系统行为时，可以更容易的定位和修改相关的对象。</ul></div><footer class=post-footer><div class=post-eof></div></footer></article></div><div class=post-block><article class=post-content itemscope itemtype=http://schema.org/Article><link href=https://hshz21.gitee.io/2024/08/21/%E8%BF%9B%E5%88%B6%E6%95%B0%E6%8D%AE%E7%9F%A5%E8%AF%86%E7%82%B9%E6%80%BB%E7%BB%93/ itemprop=mainEntityOfPage><span hidden itemprop=author itemscope itemtype=http://schema.org/Person> <meta content=/static/imgs/avatar.png itemprop=image> <meta content=豪哥 itemprop=name> </span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization> <meta content=豪哥博客 itemprop=name> <meta content=豪哥博客 itemprop=description> </span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork> <meta content="undefined | 豪哥博客" itemprop=name> <meta itemprop=description> </span><header class=post-header><h2 itemprop="name headline" class=post-title><a class=post-title-link href=/2024/08/21/%E8%BF%9B%E5%88%B6%E6%95%B0%E6%8D%AE%E7%9F%A5%E8%AF%86%E7%82%B9%E6%80%BB%E7%BB%93/ itemprop=url>数据与算法系列-原码反码补码移码转换</a></h2><div class=post-meta-container><div class=post-meta><span class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-calendar"></i> </span> <span class=post-meta-item-text>发表于</span> <time itemprop="dateCreated datePublished" title="创建时间：2024-08-21 21:39:14" datetime=2024-08-21T21:39:14+08:00>2024-08-21</time> </span><span class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-calendar-check"></i> </span> <span class=post-meta-item-text>更新于</span> <time title="修改时间：2023-10-06 09:14:28" datetime=2023-10-06T09:14:28+08:00 itemprop=dateModified>2023-10-06</time> </span><span class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-folder"></i> </span> <span class=post-meta-item-text>分类于</span> <span itemprop=about itemscope itemtype=http://schema.org/Thing> <a href=/categories/%E6%95%B0%E6%8D%AE%E4%B8%8E%E7%AE%97%E6%B3%95/ itemprop=url rel=index><span itemprop=name>数据与算法</span></a> </span> </span></div></div></header><div class=post-body itemprop=articleBody><h1 id=原码-反码-补码-移码><a class=headerlink href=#原码-反码-补码-移码 title=原码/反码/补码/移码></a>原码/反码/补码/移码</h1><h2 id=原码><a class=headerlink href=#原码 title=原码></a>原码</h2><p>原码是最简单机器数表示法。用最高位表示符号位，‘1’表示负号，‘0’表示正号。其它位存放该数的二进制的绝对值。<p>注意：<ol><li>数0的原码有两种形式： [+0]原=00000000B [-0]原=10000000B。<li>8位二进制原码的表示范围：-127～+127。</ol><h2 id=反码><a class=headerlink href=#反码 title=反码></a>反码</h2><p><strong>符号位0表示正，1表示负</strong>。正数的原码、反码、补码都一样。负数的反码等于原码按位数取反，（绝对值按位求反）。<p>步骤：先将这个负数化为原码，再根据原码取反。比如该负数原码是：00000001，那么它取反就是0 1111110。<h2 id=补码><a class=headerlink href=#补码 title=补码></a>补码</h2><p><strong>符号位0表示正，1表示负</strong>。正数的原码、反码、补码都一样。负数的补码等于反码末位加1，<p>步骤：先将这个负数化为原码再化为反码，末位加1。比如该负数的反码是11111110，那么它末位加1就是11111111。<h2 id=移码><a class=headerlink href=#移码 title=移码></a>移码</h2><p>负数的移码等于补码的符号（第一位数字）位取反。<p>步骤：先把这个数化为补码，然后再根据补码的第一位数字取反即可。（移码和补码的关系：同一数值的移码与补码符号位相反，其它各位相同。）<h2 id=小总结><a class=headerlink href=#小总结 title=小总结></a>小总结</h2><ol><li>正数的原码、反码、补码都相同；<li>负数的反码 就是 原码的各个位取反。<li>负数的补码 就是 反码末位加1。<li>负数的移码 就是 补码的符号位（第一位数字）取反。</ol></div><footer class=post-footer><div class=post-eof></div></footer></article></div><nav class=pagination><a class="extend prev" aria-label=上一页 href=/ rel=prev title=上一页><i class="fa fa-angle-left"></i></a><a class=page-number href=/>1</a><span class="page-number current">2</span><a class=page-number href=/page/3/>3</a><span class=space>…</span><a class=page-number href=/page/12/>12</a><a class="extend next" aria-label=下一页 href=/page/3/ rel=next title=下一页><i class="fa fa-angle-right"></i></a></nav></div></main><footer class=footer><div class=footer-inner><div class=copyright>© <span itemprop=copyrightYear>2024</span><span class=with-love> <i class="fa fa-heart"></i> </span><span class=author itemprop=copyrightHolder>豪哥</span></div></div></footer><div class="toggle sidebar-toggle" role=button><span class=toggle-line></span><span class=toggle-line></span><span class=toggle-line></span></div><div class=sidebar-dimmer></div><div aria-label=返回顶部 class=back-to-top role=button><i class="fa fa-arrow-up fa-lg"></i><span>0%</span></div><noscript><div class=noscript-warning>Theme NexT works best with JavaScript enabled</div></noscript><script crossorigin=anonymous integrity=sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY= src=https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js></script><script src=/js/comments.js></script><script src=/js/utils.js></script><script src=/js/motion.js></script><script src=/js/sidebar.js></script><script src=/js/next-boot.js></script><script crossorigin=anonymous integrity=sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc= src=https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js></script><script src=/js/third-party/search/local-search.js></script>