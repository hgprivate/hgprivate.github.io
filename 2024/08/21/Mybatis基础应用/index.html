<!doctypehtml><html lang=zh-CN><meta charset=UTF-8><meta content=width=device-width name=viewport><meta media="(prefers-color-scheme: light)" content=#222 name=theme-color><meta media="(prefers-color-scheme: dark)" content=#222 name=theme-color><meta content="Hexo 7.3.0" name=generator><link href=/images/apple-touch-icon-next.png rel=apple-touch-icon sizes=180x180><link href=/images/favicon-32x32-next.png rel=icon sizes=32x32 type=image/png><link href=/images/favicon-16x16-next.png rel=icon sizes=16x16 type=image/png><link color=#222 href=/images/logo.svg rel=mask-icon><link href=/css/main.css rel=stylesheet><link crossorigin=anonymous href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css integrity=sha256-XOqroi11tY4EFQMR9ZYwZWKj5ZXiftSx36RRuC3anlA= rel=stylesheet><link crossorigin=anonymous href=https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css integrity=sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE= rel=stylesheet><script class=next-config data-name=main type=application/json>{"hostname":"hshz21.gitee.io","root":"/","images":"/images","scheme":"Gemini","darkmode":true,"version":"8.20.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":false}}</script><script src=/js/config.js></script><meta content="1、什么是MyBatisMyBatis 是一个持久层框架，它支持自定义 SQL、存储过程以及高级映射。MyBatis 免除了几乎所有的 JDBC 代码以及设置参数和获取结果集的工作。MyBatis 可以通过简单的 XML 或注解来配置和映射原始类型、接口和 Java POJO（Plain Old Java Objects，普通老式 Java 对象）为数据库中的记录。 2、如何使用2.1、安装要使用" name=description><meta content=article property=og:type><meta content=MyBatis系列-MyBatis基础应用 property=og:title><meta content=https://hshz21.gitee.io/2024/08/21/Mybatis%E5%9F%BA%E7%A1%80%E5%BA%94%E7%94%A8/index.html property=og:url><meta content=豪哥博客 property=og:site_name><meta content="1、什么是MyBatisMyBatis 是一个持久层框架，它支持自定义 SQL、存储过程以及高级映射。MyBatis 免除了几乎所有的 JDBC 代码以及设置参数和获取结果集的工作。MyBatis 可以通过简单的 XML 或注解来配置和映射原始类型、接口和 Java POJO（Plain Old Java Objects，普通老式 Java 对象）为数据库中的记录。 2、如何使用2.1、安装要使用" property=og:description><meta content=zh_CN property=og:locale><meta content=2024-08-21T13:39:13.987Z property=article:published_time><meta content=2023-10-03T13:11:57.531Z property=article:modified_time><meta content=豪哥 property=article:author><meta content=MyBatis property=article:tag><meta content=MyBatis基础 property=article:tag><meta content=summary name=twitter:card><link href=https://hshz21.gitee.io/2024/08/21/Mybatis%E5%9F%BA%E7%A1%80%E5%BA%94%E7%94%A8/ rel=canonical><script class=next-config data-name=page type=application/json>{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://hshz21.gitee.io/2024/08/21/Mybatis%E5%9F%BA%E7%A1%80%E5%BA%94%E7%94%A8/","path":"2024/08/21/Mybatis基础应用/","title":"MyBatis系列-MyBatis基础应用"}</script><script class=next-config data-name=calendar type=application/json>""</script><title>MyBatis系列-MyBatis基础应用 | 豪哥博客</title><noscript><link href=/css/noscript.css rel=stylesheet></noscript><body class=use-motion itemscope itemtype=http://schema.org/WebPage><div class=headband></div><main class=main><div class=column><header class=header itemscope itemtype=http://schema.org/WPHeader><div class=site-brand-container><div class=site-nav-toggle><div aria-label=切换导航栏 class=toggle role=button><span class=toggle-line></span><span class=toggle-line></span><span class=toggle-line></span></div></div><div class=site-meta><a class=brand href=/ rel=start> <i class=logo-line></i> <p class=site-title>豪哥博客</p> <i class=logo-line></i> </a><p class=site-subtitle itemprop=description>豪哥博客</div><div class=site-nav-right><div class="toggle popup-trigger" aria-label=搜索 role=button><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class=site-nav><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href=/ rel=section><i class="fa fa-home fa-fw"></i>首页</a><li class="menu-item menu-item-tags"><a href=/tags/ rel=section><i class="fa fa-tags fa-fw"></i>标签</a><li class="menu-item menu-item-categories"><a href=/categories/ rel=section><i class="fa fa-th fa-fw"></i>分类</a><li class="menu-item menu-item-archives"><a href=/archives/ rel=section><i class="fa fa-archive fa-fw"></i>归档</a><li class="menu-item menu-item-search"><a class=popup-trigger role=button><i class="fa fa-search fa-fw"></i>搜索 </a></ul></nav><div class=search-pop-overlay><div class="popup search-popup"><div class=search-header><span class=search-icon> <i class="fa fa-search"></i> </span><div class=search-input-container><input autocapitalize=off autocomplete=off class=search-input maxlength=80 placeholder=搜索... spellcheck=false type=search></div><span class=popup-btn-close role=button> <i class="fa fa-times-circle"></i> </span></div><div class=search-result-container><div class=search-result-icon><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></header><aside class=sidebar><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class=sidebar-nav><li class=sidebar-nav-toc>文章目录<li class=sidebar-nav-overview>站点概览</ul><div class=sidebar-panel-container><!--noindex--><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class=nav><li class="nav-item nav-level-1"><a class=nav-link href=#1%E3%80%81%E4%BB%80%E4%B9%88%E6%98%AFMyBatis><span class=nav-number>1.</span> <span class=nav-text>1、什么是MyBatis</span></a><li class="nav-item nav-level-1"><a class=nav-link href=#2%E3%80%81%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8><span class=nav-number>2.</span> <span class=nav-text>2、如何使用</span></a><ol class=nav-child><li class="nav-item nav-level-2"><a class=nav-link href=#2-1%E3%80%81%E5%AE%89%E8%A3%85><span class=nav-number>2.1.</span> <span class=nav-text>2.1、安装</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#2-2%E3%80%81%E6%9E%84%E5%BB%BASqlSessionFactory><span class=nav-number>2.2.</span> <span class=nav-text>2.2、构建SqlSessionFactory</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#2-2-1%E3%80%81%E5%9F%BA%E4%BA%8EXML%E6%9E%84%E5%BB%BA><span class=nav-number>2.2.1.</span> <span class=nav-text>2.2.1、基于XML构建</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#2-2-2%E3%80%81%E5%9F%BA%E4%BA%8EJava%E4%BB%A3%E7%A0%81%E6%9E%84%E5%BB%BA><span class=nav-number>2.2.2.</span> <span class=nav-text>2.2.2、基于Java代码构建</span></a></ol><li class="nav-item nav-level-2"><a class=nav-link href=#2-3%E3%80%81%E8%8E%B7%E5%8F%96SqlSession><span class=nav-number>2.3.</span> <span class=nav-text>2.3、获取SqlSession</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#2-3-1%E3%80%81%E5%9F%BA%E4%BA%8EXML%E5%B9%B6%E6%8C%87%E5%AE%9A%E5%85%B6%E4%B8%AD%E7%9A%84%E5%94%AF%E4%B8%80%E6%A0%87%E8%AF%86ID%EF%BC%88%E4%B8%8D%E6%8E%A8%E8%8D%90%EF%BC%89><span class=nav-number>2.3.1.</span> <span class=nav-text>2.3.1、基于XML并指定其中的唯一标识ID（不推荐）</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#2-3-2%E3%80%81%E5%9F%BA%E4%BA%8E%E6%8E%A5%E5%8F%A3%EF%BC%88%E6%8E%A8%E8%8D%90%E4%BD%BF%E7%94%A8%EF%BC%89><span class=nav-number>2.3.2.</span> <span class=nav-text>2.3.2、基于接口（推荐使用）</span></a></ol><li class="nav-item nav-level-2"><a class=nav-link href=#2-4%E3%80%81SQL%E8%AF%AD%E5%8F%A5%E6%98%A0%E5%B0%84><span class=nav-number>2.4.</span> <span class=nav-text>2.4、SQL语句映射</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#2-4-1%E3%80%81%E5%9F%BA%E4%BA%8EXML%E6%98%A0%E5%B0%84SQL%E8%AF%AD%E5%8F%A5%E7%A4%BA%E4%BE%8B%EF%BC%9A><span class=nav-number>2.4.1.</span> <span class=nav-text>2.4.1、基于XML映射SQL语句示例：</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#2-4-2%E3%80%81%E5%9F%BA%E4%BA%8E%E5%85%A8%E9%99%90%E5%AE%9A%E5%90%8D%E6%9D%A5%E8%B0%83%E7%94%A8%E6%98%A0%E5%B0%84SQL%EF%BC%88%E4%B8%8D%E6%8E%A8%E8%8D%90%EF%BC%8C%E4%B8%8D%E5%AE%89%E5%85%A8%EF%BC%89><span class=nav-number>2.4.2.</span> <span class=nav-text>2.4.2、基于全限定名来调用映射SQL（不推荐，不安全）</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#2-4-3%E3%80%81%E5%9F%BA%E4%BA%8E%E6%8E%A5%E5%8F%A3%E6%9D%A5%E8%B0%83%E7%94%A8%E6%98%A0%E5%B0%84SQL%EF%BC%88%E6%8E%A8%E8%8D%90%E4%BD%BF%E7%94%A8%EF%BC%89><span class=nav-number>2.4.3.</span> <span class=nav-text>2.4.3、基于接口来调用映射SQL（推荐使用）</span></a></ol></ol><li class="nav-item nav-level-1"><a class=nav-link href=#3%E3%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E5%92%8C%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F><span class=nav-number>3.</span> <span class=nav-text>3、作用域和生命周期</span></a><ol class=nav-child><li class="nav-item nav-level-2"><a class=nav-link href=#3-1%E3%80%81SqlSessionFactoryBuilder><span class=nav-number>3.1.</span> <span class=nav-text>3.1、SqlSessionFactoryBuilder</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#3-2%E3%80%81SqlSessionFactory><span class=nav-number>3.2.</span> <span class=nav-text>3.2、SqlSessionFactory</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#3-3%E3%80%81SqlSession><span class=nav-number>3.3.</span> <span class=nav-text>3.3、SqlSession</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#3-4%E3%80%81%E6%98%A0%E5%B0%84%E5%99%A8%E5%AE%9E%E4%BE%8B><span class=nav-number>3.4.</span> <span class=nav-text>3.4、映射器实例</span></a></ol><li class="nav-item nav-level-1"><a class=nav-link href=#4%E3%80%81XML%E9%85%8D%E7%BD%AE><span class=nav-number>4.</span> <span class=nav-text>4、XML配置</span></a><ol class=nav-child><li class="nav-item nav-level-2"><a class=nav-link href=#4-1%E3%80%81properties%EF%BC%88%E5%B1%9E%E6%80%A7%EF%BC%89><span class=nav-number>4.1.</span> <span class=nav-text>4.1、properties（属性）</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#4-2%E3%80%81settings%EF%BC%88%E8%AE%BE%E7%BD%AE%EF%BC%89><span class=nav-number>4.2.</span> <span class=nav-text>4.2、settings（设置）</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#4-3%E3%80%81typeAliases%EF%BC%88%E7%B1%BB%E5%9E%8B%E5%88%AB%E5%90%8D%EF%BC%89><span class=nav-number>4.3.</span> <span class=nav-text>4.3、typeAliases（类型别名）</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#4-4%E3%80%81typeHandlers%EF%BC%88%E7%B1%BB%E5%9E%8B%E5%A4%84%E7%90%86%E5%99%A8%EF%BC%89><span class=nav-number>4.4.</span> <span class=nav-text>4.4、typeHandlers（类型处理器）</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#4-5%E3%80%81%E5%A4%84%E7%90%86%E6%9E%9A%E4%B8%BE%E7%B1%BB%E5%9E%8B><span class=nav-number>4.5.</span> <span class=nav-text>4.5、处理枚举类型</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#4-6%E3%80%81objectFactory%EF%BC%88%E5%AF%B9%E8%B1%A1%E5%B7%A5%E5%8E%82%EF%BC%89><span class=nav-number>4.6.</span> <span class=nav-text>4.6、objectFactory（对象工厂）</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#4-7%E3%80%81plugins%EF%BC%88%E6%8F%92%E4%BB%B6%EF%BC%89><span class=nav-number>4.7.</span> <span class=nav-text>4.7、plugins（插件）</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#4-8%E3%80%81environments%EF%BC%88%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE><span class=nav-number>4.8.</span> <span class=nav-text>4.8、environments（环境配置)</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#4-9%E3%80%81mapper%EF%BC%88%E6%98%A0%E5%B0%84%E5%99%A8%EF%BC%89><span class=nav-number>4.9.</span> <span class=nav-text>4.9、mapper（映射器）</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#4-9-1%E3%80%81%E7%9B%B8%E5%AF%B9%E4%BA%8E%E7%B1%BB%E8%B7%AF%E5%BE%84><span class=nav-number>4.9.1.</span> <span class=nav-text>4.9.1、相对于类路径</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#4-9-2%E3%80%81%E5%AE%8C%E5%85%A8%E9%99%90%E5%AE%9A%E8%B5%84%E6%BA%90%E5%AE%9A%E4%BD%8D%E7%AC%A6><span class=nav-number>4.9.2.</span> <span class=nav-text>4.9.2、完全限定资源定位符</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#4-9-3%E3%80%81%E6%98%A0%E5%B0%84%E5%99%A8%E6%8E%A5%E5%8F%A3%E5%AE%9E%E7%8E%B0%E7%B1%BB%E7%9A%84%E5%AE%8C%E5%85%A8%E9%99%90%E5%AE%9A%E7%B1%BB%E5%90%8D><span class=nav-number>4.9.3.</span> <span class=nav-text>4.9.3、映射器接口实现类的完全限定类名</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#4-9-4%E3%80%81%E6%98%A0%E5%B0%84%E5%99%A8%E6%8E%A5%E5%8F%A3%E5%AE%9E%E7%8E%B0-%E6%B3%A8%E5%86%8C%E4%B8%BA%E6%98%A0%E5%B0%84%E5%99%A8><span class=nav-number>4.9.4.</span> <span class=nav-text>4.9.4、映射器接口实现 注册为映射器</span></a></ol></ol><li class="nav-item nav-level-1"><a class=nav-link href=#5%E3%80%81XML%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6><span class=nav-number>5.</span> <span class=nav-text>5、XML映射文件</span></a><ol class=nav-child><li class="nav-item nav-level-2"><a class=nav-link href=#5-1%E3%80%81%E5%89%8D%E8%A8%80><span class=nav-number>5.1.</span> <span class=nav-text>5.1、前言</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#5-2%E3%80%81Cache%EF%BC%88%E7%BC%93%E5%AD%98%EF%BC%89><span class=nav-number>5.2.</span> <span class=nav-text>5.2、Cache（缓存）</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#5-3%E3%80%81Cache-ref><span class=nav-number>5.3.</span> <span class=nav-text>5.3、Cache-ref</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#5-4%E3%80%81ResultMap%EF%BC%88%E7%BB%93%E6%9E%9C%E6%98%A0%E5%B0%84%EF%BC%89><span class=nav-number>5.4.</span> <span class=nav-text>5.4、ResultMap（结果映射）</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#5-4-1%E3%80%81%E9%AB%98%E7%BA%A7%E7%BB%93%E6%9E%9C%E6%98%A0%E5%B0%84><span class=nav-number>5.4.1.</span> <span class=nav-text>5.4.1、高级结果映射</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#5-4-2%E3%80%81%E9%89%B4%E5%88%AB%E5%99%A8><span class=nav-number>5.4.2.</span> <span class=nav-text>5.4.2、鉴别器</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#5-4-3%E3%80%81%E8%87%AA%E5%8A%A8%E6%98%A0%E5%B0%84><span class=nav-number>5.4.3.</span> <span class=nav-text>5.4.3、自动映射</span></a></ol><li class="nav-item nav-level-2"><a class=nav-link href=#5-5%E3%80%81ParameterMap%EF%BC%88%E5%8F%82%E6%95%B0%EF%BC%89><span class=nav-number>5.5.</span> <span class=nav-text>5.5、ParameterMap（参数）</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#5-6%E3%80%81SQL><span class=nav-number>5.6.</span> <span class=nav-text>5.6、SQL</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#5-7%E3%80%81Insert%E3%80%81Update-%E5%92%8C-Delete><span class=nav-number>5.7.</span> <span class=nav-text>5.7、Insert、Update 和 Delete</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#5-8%E3%80%81Select><span class=nav-number>5.8.</span> <span class=nav-text>5.8、Select</span></a></ol><li class="nav-item nav-level-1"><a class=nav-link href=#6%E3%80%81%E6%97%A5%E5%BF%97><span class=nav-number>6.</span> <span class=nav-text>6、日志</span></a><ol class=nav-child><li class="nav-item nav-level-2"><a class=nav-link href=#6-1%E3%80%81%E5%89%8D%E8%A8%80><span class=nav-number>6.1.</span> <span class=nav-text>6.1、前言</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#6-2%E3%80%81%E6%97%A5%E5%BF%97%E9%85%8D%E7%BD%AE><span class=nav-number>6.2.</span> <span class=nav-text>6.2、日志配置</span></a><ol class=nav-child><li class="nav-item nav-level-4"><a class=nav-link href=#%E6%AD%A5%E9%AA%A4-1%EF%BC%9A%E6%B7%BB%E5%8A%A0-Log4J-%E7%9A%84-jar-%E5%8C%85><span class=nav-number>6.2.0.1.</span> <span class=nav-text>步骤 1：添加 Log4J 的 jar 包</span></a><li class="nav-item nav-level-4"><a class=nav-link href=#%E6%AD%A5%E9%AA%A4-2%EF%BC%9A%E9%85%8D%E7%BD%AE-Log4J><span class=nav-number>6.2.0.2.</span> <span class=nav-text>步骤 2：配置 Log4J</span></a></ol></ol></ol><li class="nav-item nav-level-1"><a class=nav-link href=#7%E3%80%81%E5%88%86%E9%A1%B5%E6%8F%92%E4%BB%B6><span class=nav-number>7.</span> <span class=nav-text>7、分页插件</span></a><ol class=nav-child><li class="nav-item nav-level-2"><a class=nav-link href=#7-1%E3%80%81%E6%B7%BB%E5%8A%A0%E4%BE%9D%E8%B5%96><span class=nav-number>7.1.</span> <span class=nav-text>7.1、添加依赖</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#7-2%E3%80%81%E9%85%8D%E7%BD%AE%E5%88%86%E9%A1%B5%E6%8F%92%E4%BB%B6><span class=nav-number>7.2.</span> <span class=nav-text>7.2、配置分页插件</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#7-3%E3%80%81%E4%BD%BF%E7%94%A8%E5%88%86%E9%A1%B5%E6%8F%92%E4%BB%B6><span class=nav-number>7.3.</span> <span class=nav-text>7.3、使用分页插件</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#7-3-1%E3%80%81%E5%BC%80%E5%90%AF%E5%88%86%E9%A1%B5%E5%8A%9F%E8%83%BD><span class=nav-number>7.3.1.</span> <span class=nav-text>7.3.1、开启分页功能</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#7-3-2%E3%80%81%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C><span class=nav-number>7.3.2.</span> <span class=nav-text>7.3.2、常用操作</span></a><ol class=nav-child><li class="nav-item nav-level-4"><a class=nav-link href=#7-3-2-1%E3%80%81%E7%9B%B4%E6%8E%A5%E8%BE%93%E5%87%BA><span class=nav-number>7.3.2.1.</span> <span class=nav-text>7.3.2.1、直接输出</span></a><li class="nav-item nav-level-4"><a class=nav-link href=#7-3-2-2%E3%80%81%E4%BD%BF%E7%94%A8PageInfo><span class=nav-number>7.3.2.2.</span> <span class=nav-text>7.3.2.2、使用PageInfo</span></a></ol></ol><li class="nav-item nav-level-2"><a class=nav-link href=#7-4%E3%80%81%E5%B8%B8%E8%A7%81%E5%AD%97%E6%AE%B5><span class=nav-number>7.4.</span> <span class=nav-text>7.4、常见字段</span></a></ol></div></div><!--/noindex--><div class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop=author itemscope itemtype=http://schema.org/Person><img alt=豪哥 class=site-author-image itemprop=image src=/static/imgs/avatar.png><p class=site-author-name itemprop=name>豪哥<div class=site-description itemprop=description>豪哥博客</div></div><div class="site-state-wrap animated"><nav class=site-state><div class="site-state-item site-state-posts"><a href=/archives/> <span class=site-state-item-count>116</span> <span class=site-state-item-name>日志</span> </a></div><div class="site-state-item site-state-categories"><a href=/categories/> <span class=site-state-item-count>35</span> <span class=site-state-item-name>分类</span></a></div><div class="site-state-item site-state-tags"><a href=/tags/> <span class=site-state-item-count>128</span> <span class=site-state-item-name>标签</span></a></div></nav></div></div></div></div></aside></div><div class="main-inner post posts-expand"><div class=post-block><article class=post-content itemscope itemtype=http://schema.org/Article lang=zh-CN><link href=https://hshz21.gitee.io/2024/08/21/Mybatis%E5%9F%BA%E7%A1%80%E5%BA%94%E7%94%A8/ itemprop=mainEntityOfPage><span hidden itemprop=author itemscope itemtype=http://schema.org/Person> <meta content=/static/imgs/avatar.png itemprop=image> <meta content=豪哥 itemprop=name> </span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization> <meta content=豪哥博客 itemprop=name> <meta content=豪哥博客 itemprop=description> </span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork> <meta content="MyBatis系列-MyBatis基础应用 | 豪哥博客" itemprop=name> <meta itemprop=description> </span><header class=post-header><h1 itemprop="name headline" class=post-title>MyBatis系列-MyBatis基础应用</h1><div class=post-meta-container><div class=post-meta><span class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-calendar"></i> </span> <span class=post-meta-item-text>发表于</span> <time itemprop="dateCreated datePublished" title="创建时间：2024-08-21 21:39:13" datetime=2024-08-21T21:39:13+08:00>2024-08-21</time> </span><span class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-calendar-check"></i> </span> <span class=post-meta-item-text>更新于</span> <time title="修改时间：2023-10-03 21:11:57" datetime=2023-10-03T21:11:57+08:00 itemprop=dateModified>2023-10-03</time> </span><span class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-folder"></i> </span> <span class=post-meta-item-text>分类于</span> <span itemprop=about itemscope itemtype=http://schema.org/Thing> <a href=/categories/MyBatis/ itemprop=url rel=index><span itemprop=name>MyBatis</span></a> </span> </span></div></div></header><div class=post-body itemprop=articleBody><h1 id=1、什么是MyBatis><a class=headerlink href=#1、什么是MyBatis title=1、什么是MyBatis></a>1、什么是MyBatis</h1><p>MyBatis 是一个持久层框架，它支持自定义 SQL、存储过程以及高级映射。MyBatis 免除了几乎所有的 JDBC 代码以及设置参数和获取结果集的工作。MyBatis 可以通过简单的 XML 或注解来配置和映射原始类型、接口和 Java POJO（Plain Old Java Objects，普通老式 Java 对象）为数据库中的记录。<h1 id=2、如何使用><a class=headerlink href=#2、如何使用 title=2、如何使用></a>2、如何使用</h1><h2 id=2-1、安装><a class=headerlink href=#2-1、安装 title=2.1、安装></a>2.1、安装</h2><p>要使用 MyBatis， 只需将 <a href=https://github.com/mybatis/mybatis-3/releases rel=noopener target=_blank>mybatis-x.x.x.jar</a> 文件置于类路径（classpath）中即可。<p>如果使用 Maven 来构建项目，则需将下面的依赖代码置于 pom.xml 文件中：<figure class="highlight xml"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br></pre><td class=code><pre><span class=line><span class=tag><<span class=name>dependency</span>></span></span><br><span class=line>  <span class=tag><<span class=name>groupId</span>></span>org.mybatis<span class=tag>&LT/<span class=name>groupId</span>></span></span><br><span class=line>  <span class=tag><<span class=name>artifactId</span>></span>mybatis<span class=tag>&LT/<span class=name>artifactId</span>></span></span><br><span class=line>  <span class=tag><<span class=name>version</span>></span>x.x.x<span class=tag>&LT/<span class=name>version</span>></span></span><br><span class=line><span class=tag>&LT/<span class=name>dependency</span>></span></span><br></pre></table></figure><h2 id=2-2、构建SqlSessionFactory><a class=headerlink href=#2-2、构建SqlSessionFactory title=2.2、构建SqlSessionFactory></a>2.2、构建SqlSessionFactory</h2><h3 id=2-2-1、基于XML构建><a class=headerlink href=#2-2-1、基于XML构建 title=2.2.1、基于XML构建></a>2.2.1、基于XML构建</h3><p>每个基于 MyBatis 的应用都是以一个 SqlSessionFactory 的实例为核心的。SqlSessionFactory 的实例可以通过 SqlSessionFactoryBuilder 获得。而 SqlSessionFactoryBuilder 则可以从 XML 配置文件或一个预先配置的 Configuration 实例来构建出 SqlSessionFactory 实例。<p>XML 配置文件中包含了对 MyBatis 系统的核心设置，包括获取数据库连接实例的数据源（DataSource）以及决定事务作用域和控制方式的事务管理器（TransactionManager）。XML（mybatis-config.xml）配置示例如下：<figure class="highlight xml"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br></pre><td class=code><pre><span class=line><span class=meta>&LT?xml version=<span class=string>"1.0"</span> encoding=<span class=string>"UTF-8"</span> ?></span></span><br><span class=line><span class=meta>&LT!DOCTYPE <span class=keyword>configuration</span></span></span><br><span class=line><span class=meta>  <span class=keyword>PUBLIC</span> <span class=string>"-//mybatis.org//DTD Config 3.0//EN"</span></span></span><br><span class=line><span class=meta>  <span class=string>"http://mybatis.org/dtd/mybatis-3-config.dtd"</span>></span></span><br><span class=line><span class=tag><<span class=name>configuration</span>></span></span><br><span class=line>  <span class=tag><<span class=name>environments</span> <span class=attr>default</span>=<span class=string>"development"</span>></span></span><br><span class=line>    <span class=tag><<span class=name>environment</span> <span class=attr>id</span>=<span class=string>"development"</span>></span></span><br><span class=line>      <span class=tag><<span class=name>transactionManager</span> <span class=attr>type</span>=<span class=string>"JDBC"</span>/></span></span><br><span class=line>      <span class=tag><<span class=name>dataSource</span> <span class=attr>type</span>=<span class=string>"POOLED"</span>></span></span><br><span class=line>        <span class=tag><<span class=name>property</span> <span class=attr>name</span>=<span class=string>"driver"</span> <span class=attr>value</span>=<span class=string>"${driver}"</span>/></span></span><br><span class=line>        <span class=tag><<span class=name>property</span> <span class=attr>name</span>=<span class=string>"url"</span> <span class=attr>value</span>=<span class=string>"${url}"</span>/></span></span><br><span class=line>        <span class=tag><<span class=name>property</span> <span class=attr>name</span>=<span class=string>"username"</span> <span class=attr>value</span>=<span class=string>"${username}"</span>/></span></span><br><span class=line>        <span class=tag><<span class=name>property</span> <span class=attr>name</span>=<span class=string>"password"</span> <span class=attr>value</span>=<span class=string>"${password}"</span>/></span></span><br><span class=line>      <span class=tag>&LT/<span class=name>dataSource</span>></span></span><br><span class=line>    <span class=tag>&LT/<span class=name>environment</span>></span></span><br><span class=line>  <span class=tag>&LT/<span class=name>environments</span>></span></span><br><span class=line>  <span class=tag><<span class=name>mappers</span>></span></span><br><span class=line>    <span class=tag><<span class=name>mapper</span> <span class=attr>resource</span>=<span class=string>"org/mybatis/example/BlogMapper.xml"</span>/></span></span><br><span class=line>  <span class=tag>&LT/<span class=name>mappers</span>></span></span><br><span class=line><span class=tag>&LT/<span class=name>configuration</span>></span></span><br></pre></table></figure><p>从 XML 文件中构建 SqlSessionFactory 的实例非常简单，建议使用类路径下的资源文件进行配置。 但也可以使用任意的输入流（InputStream）实例，比如用文件路径字符串或 file:// URL 构造的输入流。MyBatis 包含一个名叫 Resources 的工具类，它包含一些实用方法，使得从类路径或其它位置加载资源文件更加容易。<figure class="highlight java"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br></pre><td class=code><pre><span class=line><span class=type>String</span> <span class=variable>resource</span> <span class=operator>=</span> <span class=string>"org/mybatis/example/mybatis-config.xml"</span>;</span><br><span class=line><span class=type>InputStream</span> <span class=variable>inputStream</span> <span class=operator>=</span> Resources.getResourceAsStream(resource);</span><br><span class=line><span class=type>SqlSessionFactory</span> <span class=variable>sqlSessionFactory</span> <span class=operator>=</span> <span class=keyword>new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(inputStream);</span><br></pre></table></figure><h3 id=2-2-2、基于Java代码构建><a class=headerlink href=#2-2-2、基于Java代码构建 title=2.2.2、基于Java代码构建></a>2.2.2、基于Java代码构建</h3><p>如果你更愿意直接从 Java 代码而不是 XML 文件中创建配置，或者想要创建你自己的配置建造器，MyBatis 也提供了完整的配置类，提供了所有与 XML 文件等价的配置项。<figure class="highlight java"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br></pre><td class=code><pre><span class=line><span class=type>DataSource</span> <span class=variable>dataSource</span> <span class=operator>=</span> BlogDataSourceFactory.getBlogDataSource();</span><br><span class=line><span class=type>TransactionFactory</span> <span class=variable>transactionFactory</span> <span class=operator>=</span> <span class=keyword>new</span> <span class="title class_">JdbcTransactionFactory</span>();</span><br><span class=line><span class=type>Environment</span> <span class=variable>environment</span> <span class=operator>=</span> <span class=keyword>new</span> <span class="title class_">Environment</span>(<span class=string>"development"</span>, transactionFactory, dataSource);</span><br><span class=line><span class=type>Configuration</span> <span class=variable>configuration</span> <span class=operator>=</span> <span class=keyword>new</span> <span class="title class_">Configuration</span>(environment);</span><br><span class=line>configuration.addMapper(BlogMapper.class);</span><br><span class=line><span class=type>SqlSessionFactory</span> <span class=variable>sqlSessionFactory</span> <span class=operator>=</span> <span class=keyword>new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(configuration);</span><br></pre></table></figure><p>注意该例中，configuration 添加了一个映射器类（mapper class）。映射器类是 Java 类，它们包含 SQL 映射注解从而避免依赖 XML 文件。不过，由于 Java 注解的一些限制以及某些 MyBatis 映射的复杂性，要使用大多数高级映射（比如：嵌套联合映射），仍然需要使用 XML 配置。有鉴于此，如果存在一个同名 XML 配置文件，MyBatis 会自动查找并加载它（在这个例子中，基于类路径和 BlogMapper.class 的类名，会加载 BlogMapper.xml）。<h2 id=2-3、获取SqlSession><a class=headerlink href=#2-3、获取SqlSession title=2.3、获取SqlSession></a>2.3、获取SqlSession</h2><h3 id=2-3-1、基于XML并指定其中的唯一标识ID（不推荐）><a class=headerlink href=#2-3-1、基于XML并指定其中的唯一标识ID（不推荐） title=2.3.1、基于XML并指定其中的唯一标识ID（不推荐）></a>2.3.1、基于XML并指定其中的唯一标识ID（不推荐）</h3><p>既然有了 SqlSessionFactory，顾名思义，我们可以从中获得 SqlSession 的实例。SqlSession 提供了在数据库执行 SQL 命令所需的所有方法。你可以通过 SqlSession 实例来直接执行已映射的 SQL 语句。例如：<figure class="highlight java"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br></pre><td class=code><pre><span class=line><span class=keyword>try</span> (<span class=type>SqlSession</span> <span class=variable>session</span> <span class=operator>=</span> sqlSessionFactory.openSession()) {</span><br><span class=line>  <span class=type>Blog</span> <span class=variable>blog</span> <span class=operator>=</span> (Blog) session.selectOne(<span class=string>"org.mybatis.example.BlogMapper.selectBlog"</span>, <span class=number>101</span>);</span><br><span class=line>}</span><br></pre></table></figure><h3 id=2-3-2、基于接口（推荐使用）><a class=headerlink href=#2-3-2、基于接口（推荐使用） title=2.3.2、基于接口（推荐使用）></a>2.3.2、基于接口（推荐使用）</h3><p>基于XML的方式虽然能够正常工作（对使用旧版本 MyBatis 的用户来说也比较熟悉）。但现在有了一种更简洁的方式——使用指定语句的参数和返回值相匹配的接口（比如 BlogMapper.class），现在你的代码不仅更清晰，更加类型安全，还不用担心可能出错的字符串字面值以及强制类型转换。例如：<figure class="highlight java"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br></pre><td class=code><pre><span class=line><span class=keyword>try</span> (<span class=type>SqlSession</span> <span class=variable>session</span> <span class=operator>=</span> sqlSessionFactory.openSession()) {</span><br><span class=line>  <span class=type>BlogMapper</span> <span class=variable>mapper</span> <span class=operator>=</span> session.getMapper(BlogMapper.class);</span><br><span class=line>  <span class=type>Blog</span> <span class=variable>blog</span> <span class=operator>=</span> mapper.selectBlog(<span class=number>101</span>);</span><br><span class=line>}</span><br></pre></table></figure><h2 id=2-4、SQL语句映射><a class=headerlink href=#2-4、SQL语句映射 title=2.4、SQL语句映射></a>2.4、SQL语句映射</h2><h3 id=2-4-1、基于XML映射SQL语句示例：><a class=headerlink href=#2-4-1、基于XML映射SQL语句示例： title=2.4.1、基于XML映射SQL语句示例：></a>2.4.1、基于XML映射SQL语句示例：</h3><figure class="highlight xml"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br></pre><td class=code><pre><span class=line><span class=meta>&LT?xml version=<span class=string>"1.0"</span> encoding=<span class=string>"UTF-8"</span> ?></span></span><br><span class=line><span class=meta>&LT!DOCTYPE <span class=keyword>mapper</span></span></span><br><span class=line><span class=meta>  <span class=keyword>PUBLIC</span> <span class=string>"-//mybatis.org//DTD Mapper 3.0//EN"</span></span></span><br><span class=line><span class=meta>  <span class=string>"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span>></span></span><br><span class=line><span class=tag><<span class=name>mapper</span> <span class=attr>namespace</span>=<span class=string>"org.mybatis.example.BlogMapper"</span>></span></span><br><span class=line>  <span class=tag><<span class=name>select</span> <span class=attr>id</span>=<span class=string>"selectBlog"</span> <span class=attr>resultType</span>=<span class=string>"Blog"</span>></span></span><br><span class=line>    select * from Blog where id = #{id}</span><br><span class=line>  <span class=tag>&LT/<span class=name>select</span>></span></span><br><span class=line><span class=tag>&LT/<span class=name>mapper</span>></span></span><br></pre></table></figure><h3 id=2-4-2、基于全限定名来调用映射SQL（不推荐，不安全）><a class=headerlink href=#2-4-2、基于全限定名来调用映射SQL（不推荐，不安全） title=2.4.2、基于全限定名来调用映射SQL（不推荐，不安全）></a>2.4.2、基于全限定名来调用映射SQL（不推荐，不安全）</h3><figure class="highlight java"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line><span class=type>Blog</span> <span class=variable>blog</span> <span class=operator>=</span> (Blog) session.selectOne(<span class=string>"org.mybatis.example.BlogMapper.selectBlog"</span>, <span class=number>101</span>);</span><br></pre></table></figure><h3 id=2-4-3、基于接口来调用映射SQL（推荐使用）><a class=headerlink href=#2-4-3、基于接口来调用映射SQL（推荐使用） title=2.4.3、基于接口来调用映射SQL（推荐使用）></a>2.4.3、基于接口来调用映射SQL（推荐使用）</h3><p>第二种方法有很多优势，首先它不依赖于字符串字面值，会更安全一点；其次，如果你的 IDE 有代码补全功能，那么代码补全可以帮你快速选择到映射好的 SQL 语句。<figure class="highlight java"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br></pre><td class=code><pre><span class=line><span class=type>BlogMapper</span> <span class=variable>mapper</span> <span class=operator>=</span> session.getMapper(BlogMapper.class);</span><br><span class=line><span class=type>Blog</span> <span class=variable>blog</span> <span class=operator>=</span> mapper.selectBlog(<span class=number>101</span>);</span><br></pre></table></figure><h1 id=3、作用域和生命周期><a class=headerlink href=#3、作用域和生命周期 title=3、作用域和生命周期></a>3、作用域和生命周期</h1><h2 id=3-1、SqlSessionFactoryBuilder><a class=headerlink href=#3-1、SqlSessionFactoryBuilder title=3.1、SqlSessionFactoryBuilder></a>3.1、SqlSessionFactoryBuilder</h2><p>这个类可以被实例化、使用和丢弃，一旦创建了 SqlSessionFactory，就不再需要它了。 因此 <code>SqlSessionFactoryBuilder</code>实例的最佳作用域是<strong>方法作用域（也就是局部方法变量）</strong>。 你可以重用 <code>SqlSessionFactoryBuilder</code>来创建多个<code>SqlSessionFactory</code>实例，但最好还是不要一直保留着它，以保证所有的 XML 解析资源可以被释放给更重要的事情。<h2 id=3-2、SqlSessionFactory><a class=headerlink href=#3-2、SqlSessionFactory title=3.2、SqlSessionFactory></a>3.2、SqlSessionFactory</h2><p><code>SqlSessionFactory</code>一旦被创建就应该在应用的运行期间一直存在，且应用运行期间不要重复创建多次。因此 <code>SqlSessionFactory</code>的最佳作用域是<strong>应用作用域</strong>。 有很多方法可以做到，最简单的就是使用单例模式或者静态单例模式。<h2 id=3-3、SqlSession><a class=headerlink href=#3-3、SqlSession title=3.3、SqlSession></a>3.3、SqlSession</h2><p>每个线程都应该有它自己的<code>SqlSession</code>实例。<code>SqlSession</code>实例不是线程安全的，因此不能被共享，所以它的最佳作用域是<strong>请求或方法作用域</strong>。<p>绝对不能将 SqlSession 实例的引用放在一个类的静态域，甚至一个类的实例变量也不行。 也绝不能将 SqlSession 实例的引用放在任何类型的托管作用域中，比如 Servlet 框架中的 HttpSession。 如果你现在正在使用一种 Web 框架，考虑将 SqlSession 放在一个和 HTTP 请求相似的作用域中。 换句话说，每次收到 HTTP 请求，就可以打开一个 SqlSession，返回一个响应后，就关闭它。 这个关闭操作很重要，为了确保每次都能执行关闭操作，你应该把这个关闭操作放到 finally 块中。 下面的示例就是一个确保 SqlSession 关闭的标准模式：<figure class="highlight java"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br></pre><td class=code><pre><span class=line><span class=keyword>try</span> (<span class=type>SqlSession</span> <span class=variable>session</span> <span class=operator>=</span> sqlSessionFactory.openSession()) {</span><br><span class=line>  <span class=comment>// 你的应用逻辑代码</span></span><br><span class=line>}</span><br></pre></table></figure><p>在所有代码中都遵循这种使用模式，可以保证所有数据库资源都能被正确地关闭。<h2 id=3-4、映射器实例><a class=headerlink href=#3-4、映射器实例 title=3.4、映射器实例></a>3.4、映射器实例</h2><p>映射器是一些绑定映射语句的接口。映射器接口的实例是从 SqlSession 中获得的。虽然从技术层面上来讲，任何映射器实例的最大作用域与请求它们的SqlSession相同。但<strong>方法作用域才是映射器实例最合适的作用域</strong>。 也就是说，映射器实例应该在调用它们的方法中被获取，使用完毕之后即可丢弃。 映射器实例并不需要被显式地关闭。尽管在整个请求作用域保留映射器实例不会有什么问题，但是你很快会发现，在这个作用域上管理太多像 SqlSession 的资源会让你忙不过来。 因此，最好将映射器放在方法作用域内。就像下面的例子一样：<figure class="highlight java"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br></pre><td class=code><pre><span class=line><span class=keyword>try</span> (<span class=type>SqlSession</span> <span class=variable>session</span> <span class=operator>=</span> sqlSessionFactory.openSession()) {</span><br><span class=line>  <span class=type>BlogMapper</span> <span class=variable>mapper</span> <span class=operator>=</span> session.getMapper(BlogMapper.class);</span><br><span class=line>  <span class=comment>// 你的应用逻辑代码</span></span><br><span class=line>}</span><br></pre></table></figure><h1 id=4、XML配置><a class=headerlink href=#4、XML配置 title=4、XML配置></a>4、XML配置</h1><h2 id=4-1、properties（属性）><a class=headerlink href=#4-1、properties（属性） title=4.1、properties（属性）></a>4.1、properties（属性）</h2><p>这些属性可以在外部进行配置，并可以进行动态替换。你既可以在典型的 Java 属性文件中配置这些属性，也可以在 properties 元素的子元素中设置。例如：<figure class="highlight xml"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br></pre><td class=code><pre><span class=line><span class=tag><<span class=name>properties</span> <span class=attr>resource</span>=<span class=string>"org/mybatis/example/config.properties"</span>></span></span><br><span class=line>  <span class=tag><<span class=name>property</span> <span class=attr>name</span>=<span class=string>"username"</span> <span class=attr>value</span>=<span class=string>"dev_user"</span>/></span></span><br><span class=line>  <span class=tag><<span class=name>property</span> <span class=attr>name</span>=<span class=string>"password"</span> <span class=attr>value</span>=<span class=string>"F2Fa3!33TYyg"</span>/></span></span><br><span class=line><span class=tag>&LT/<span class=name>properties</span>></span></span><br></pre></table></figure><p>设置好的属性可以在整个配置文件中用来替换需要动态配置的属性值。比如：<figure class="highlight xml"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br></pre><td class=code><pre><span class=line><span class=tag><<span class=name>dataSource</span> <span class=attr>type</span>=<span class=string>"POOLED"</span>></span></span><br><span class=line>  <span class=tag><<span class=name>property</span> <span class=attr>name</span>=<span class=string>"driver"</span> <span class=attr>value</span>=<span class=string>"${driver}"</span>/></span></span><br><span class=line>  <span class=tag><<span class=name>property</span> <span class=attr>name</span>=<span class=string>"url"</span> <span class=attr>value</span>=<span class=string>"${url}"</span>/></span></span><br><span class=line>  <span class=tag><<span class=name>property</span> <span class=attr>name</span>=<span class=string>"username"</span> <span class=attr>value</span>=<span class=string>"${username}"</span>/></span></span><br><span class=line>  <span class=tag><<span class=name>property</span> <span class=attr>name</span>=<span class=string>"password"</span> <span class=attr>value</span>=<span class=string>"${password}"</span>/></span></span><br><span class=line><span class=tag>&LT/<span class=name>dataSource</span>></span></span><br></pre></table></figure><p>这个例子中的 username 和 password 将会由 properties 元素中设置的相应值来替换。 driver 和 url 属性将会由 config.properties 文件中对应的值来替换。这样就为配置提供了诸多灵活选择。<p><strong>注意</strong>：如果一个属性在不只一个地方进行了配置，那么，MyBatis 将按照下面的顺序来加载：<ol><li>首先读取在 properties 元素体内指定的属性。(优先级1-最低)<li>然后根据 properties 元素中的 resource 属性读取类路径下属性文件，或根据 url 属性指定的路径读取属性文件，并覆盖之前读取过的同名属性。（优先级2）<li>最后读取作为方法参数传递的属性，并覆盖之前读取过的同名属性。（优先级3-最高）</ol><p>因此，通过方法参数传递的属性具有最高优先级，resource/url 属性中指定的配置文件次之，最低优先级的则是 properties 元素中指定的属性。<h2 id=4-2、settings（设置）><a class=headerlink href=#4-2、settings（设置） title=4.2、settings（设置）></a>4.2、settings（设置）</h2><p>这是<code>MyBatis</code>极为重要的设置，它们会改变<code>MyBatis</code>的运行时行为。 下表描述了各项设置的含义、默认值等。<table><thead><tr><th align=center>设置名<th>描述<th align=left>有效值<th align=left>默认值<tbody><tr><td align=center>cacheEnabled<td>全局性地开启或关闭所有映射器配置文件中已配置的任何缓存。<td align=left>true | false<td align=left>true<tr><td align=center>lazyLoadingEnabled<td>延迟加载的全局开关。当开启时，所有关联对象都会延迟加载。 特定关联关系中可通过设置 <code>fetchType</code> 属性来覆盖该项的开关状态。<td align=left>true | false<td align=left>false<tr><td align=center>aggressiveLazyLoading<td>开启时，任一方法的调用都会加载该对象的所有延迟加载属性。 否则，每个延迟加载属性会按需加载（参考 <code>lazyLoadTriggerMethods</code>)。<td align=left>true | false<td align=left>false （在 3.4.1 及之前的版本中默认为 true）<tr><td align=center>multipleResultSetsEnabled<td>是否允许单个语句返回多结果集（需要数据库驱动支持）。<td align=left>true | false<td align=left>true<tr><td align=center>useColumnLabel<td>使用列标签代替列名。实际表现依赖于数据库驱动，具体可参考数据库驱动的相关文档，或通过对比测试来观察。<td align=left>true | false<td align=left>true<tr><td align=center>useGeneratedKeys<td>允许 JDBC 支持自动生成主键，需要数据库驱动支持。如果设置为 true，将强制使用自动生成主键。尽管一些数据库驱动不支持此特性，但仍可正常工作（如 Derby）。<td align=left>true | false<td align=left>False<tr><td align=center>autoMappingBehavior<td>指定 MyBatis 应如何自动映射列到字段或属性。 NONE 表示关闭自动映射；PARTIAL 只会自动映射没有定义嵌套结果映射的字段。 FULL 会自动映射任何复杂的结果集（无论是否嵌套）。<td align=left>NONE, PARTIAL, FULL<td align=left>PARTIAL<tr><td align=center>autoMappingUnknownColumnBehavior<td>指定发现自动映射目标未知列（或未知属性类型）的行为。<code>NONE</code>: 不做任何反应<code>WARNING</code>: 输出警告日志（<code>'org.apache.ibatis.session.AutoMappingUnknownColumnBehavior'</code> 的日志等级必须设置为 <code>WARN</code>）<code>FAILING</code>: 映射失败 (抛出 <code>SqlSessionException</code>)<td align=left>NONE, WARNING, FAILING<td align=left>NONE<tr><td align=center>defaultExecutorType<td>配置默认的执行器。SIMPLE 就是普通的执行器；REUSE 执行器会重用预处理语句（PreparedStatement）； BATCH 执行器不仅重用语句还会执行批量更新。<td align=left>SIMPLE REUSE BATCH<td align=left>SIMPLE<tr><td align=center>defaultStatementTimeout<td>设置超时时间，它决定数据库驱动等待数据库响应的秒数。<td align=left>任意正整数<td align=left>未设置 (null)<tr><td align=center>defaultFetchSize<td>为驱动的结果集获取数量（fetchSize）设置一个建议值。此参数只可以在查询设置中被覆盖。<td align=left>任意正整数<td align=left>未设置 (null)<tr><td align=center>defaultResultSetType<td>指定语句默认的滚动策略。（新增于 3.5.2）<td align=left>FORWARD_ONLY | SCROLL_SENSITIVE | SCROLL_INSENSITIVE | DEFAULT（等同于未设置）<td align=left>未设置 (null)<tr><td align=center>safeRowBoundsEnabled<td>是否允许在嵌套语句中使用分页（RowBounds）。如果允许使用则设置为 false。<td align=left>true | false<td align=left>False<tr><td align=center>safeResultHandlerEnabled<td>是否允许在嵌套语句中使用结果处理器（ResultHandler）。如果允许使用则设置为 false。<td align=left>true | false<td align=left>True<tr><td align=center>mapUnderscoreToCamelCase<td>是否开启驼峰命名自动映射，即从经典数据库列名 A_COLUMN 映射到经典 Java 属性名 aColumn。<td align=left>true | false<td align=left>False<tr><td align=center>localCacheScope<td>MyBatis 利用本地缓存机制（Local Cache）防止循环引用和加速重复的嵌套查询。 默认值为 SESSION，会缓存一个会话中执行的所有查询。 若设置值为 STATEMENT，本地缓存将仅用于执行语句，对相同 SqlSession 的不同查询将不会进行缓存。<td align=left>SESSION | STATEMENT<td align=left>SESSION<tr><td align=center>jdbcTypeForNull<td>当没有为参数指定特定的 JDBC 类型时，空值的默认 JDBC 类型。 某些数据库驱动需要指定列的 JDBC 类型，多数情况直接用一般类型即可，比如 NULL、VARCHAR 或 OTHER。<td align=left>JdbcType 常量，常用值：NULL、VARCHAR 或 OTHER。<td align=left>OTHER<tr><td align=center>lazyLoadTriggerMethods<td>指定对象的哪些方法触发一次延迟加载。<td align=left>用逗号分隔的方法列表。<td align=left>equals,clone,hashCode,toString<tr><td align=center>defaultScriptingLanguage<td>指定动态 SQL 生成使用的默认脚本语言。<td align=left>一个类型别名或全限定类名。<td align=left>org.apache.ibatis.scripting.xmltags.XMLLanguageDriver<tr><td align=center>defaultEnumTypeHandler<td>指定 Enum 使用的默认 <code>TypeHandler</code> 。（新增于 3.4.5）<td align=left>一个类型别名或全限定类名。<td align=left>org.apache.ibatis.type.EnumTypeHandler<tr><td align=center>callSettersOnNulls<td>指定当结果集中值为 null 的时候是否调用映射对象的 setter（map 对象时为 put）方法，这在依赖于 Map.keySet() 或 null 值进行初始化时比较有用。注意基本类型（int、boolean 等）是不能设置成 null 的。<td align=left>true | false<td align=left>false<tr><td align=center>returnInstanceForEmptyRow<td>当返回行的所有列都是空时，MyBatis默认返回 <code>null</code>。 当开启这个设置时，MyBatis会返回一个空实例。 请注意，它也适用于嵌套的结果集（如集合或关联）。（新增于 3.4.2）<td align=left>true | false<td align=left>false<tr><td align=center>logPrefix<td>指定 MyBatis 增加到日志名称的前缀。<td align=left>任何字符串<td align=left>未设置<tr><td align=center>logImpl<td>指定 MyBatis 所用日志的具体实现，未指定时将自动查找。<td align=left>SLF4J | LOG4J | LOG4J2 | JDK_LOGGING | COMMONS_LOGGING | STDOUT_LOGGING | NO_LOGGING<td align=left>未设置<tr><td align=center>proxyFactory<td>指定 Mybatis 创建可延迟加载对象所用到的代理工具。<td align=left>CGLIB | JAVASSIST<td align=left>JAVASSIST （MyBatis 3.3 以上）<tr><td align=center>vfsImpl<td>指定 VFS 的实现<td align=left>自定义 VFS 的实现的类全限定名，以逗号分隔。<td align=left>未设置<tr><td align=center>useActualParamName<td>允许使用方法签名中的名称作为语句参数名称。 为了使用该特性，你的项目必须采用 Java 8 编译，并且加上 <code>-parameters</code> 选项。（新增于 3.4.1）<td align=left>true | false<td align=left>true<tr><td align=center>configurationFactory<td>指定一个提供 <code>Configuration</code> 实例的类。 这个被返回的 Configuration 实例用来加载被反序列化对象的延迟加载属性值。 这个类必须包含一个签名为<code>static Configuration getConfiguration()</code> 的方法。（新增于 3.2.3）<td align=left>一个类型别名或完全限定类名。<td align=left>未设置<tr><td align=center>shrinkWhitespacesInSql<td>Removes extra whitespace characters from the SQL. Note that this also affects literal strings in SQL. (Since 3.5.5)<td align=left>true | false<td align=left>false</table><p>一个配置完整的<code>settings</code>元素的示例如下：<figure class="highlight xml"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br></pre><td class=code><pre><span class=line><span class=tag><<span class=name>settings</span>></span></span><br><span class=line>  <span class=tag><<span class=name>setting</span> <span class=attr>name</span>=<span class=string>"cacheEnabled"</span> <span class=attr>value</span>=<span class=string>"true"</span>/></span></span><br><span class=line>  <span class=tag><<span class=name>setting</span> <span class=attr>name</span>=<span class=string>"lazyLoadingEnabled"</span> <span class=attr>value</span>=<span class=string>"true"</span>/></span></span><br><span class=line>  <span class=tag><<span class=name>setting</span> <span class=attr>name</span>=<span class=string>"multipleResultSetsEnabled"</span> <span class=attr>value</span>=<span class=string>"true"</span>/></span></span><br><span class=line>  <span class=tag><<span class=name>setting</span> <span class=attr>name</span>=<span class=string>"useColumnLabel"</span> <span class=attr>value</span>=<span class=string>"true"</span>/></span></span><br><span class=line>  <span class=tag><<span class=name>setting</span> <span class=attr>name</span>=<span class=string>"useGeneratedKeys"</span> <span class=attr>value</span>=<span class=string>"false"</span>/></span></span><br><span class=line>  <span class=tag><<span class=name>setting</span> <span class=attr>name</span>=<span class=string>"autoMappingBehavior"</span> <span class=attr>value</span>=<span class=string>"PARTIAL"</span>/></span></span><br><span class=line>  <span class=tag><<span class=name>setting</span> <span class=attr>name</span>=<span class=string>"autoMappingUnknownColumnBehavior"</span> <span class=attr>value</span>=<span class=string>"WARNING"</span>/></span></span><br><span class=line>  <span class=tag><<span class=name>setting</span> <span class=attr>name</span>=<span class=string>"defaultExecutorType"</span> <span class=attr>value</span>=<span class=string>"SIMPLE"</span>/></span></span><br><span class=line>  <span class=tag><<span class=name>setting</span> <span class=attr>name</span>=<span class=string>"defaultStatementTimeout"</span> <span class=attr>value</span>=<span class=string>"25"</span>/></span></span><br><span class=line>  <span class=tag><<span class=name>setting</span> <span class=attr>name</span>=<span class=string>"defaultFetchSize"</span> <span class=attr>value</span>=<span class=string>"100"</span>/></span></span><br><span class=line>  <span class=tag><<span class=name>setting</span> <span class=attr>name</span>=<span class=string>"safeRowBoundsEnabled"</span> <span class=attr>value</span>=<span class=string>"false"</span>/></span></span><br><span class=line>  <span class=tag><<span class=name>setting</span> <span class=attr>name</span>=<span class=string>"mapUnderscoreToCamelCase"</span> <span class=attr>value</span>=<span class=string>"false"</span>/></span></span><br><span class=line>  <span class=tag><<span class=name>setting</span> <span class=attr>name</span>=<span class=string>"localCacheScope"</span> <span class=attr>value</span>=<span class=string>"SESSION"</span>/></span></span><br><span class=line>  <span class=tag><<span class=name>setting</span> <span class=attr>name</span>=<span class=string>"jdbcTypeForNull"</span> <span class=attr>value</span>=<span class=string>"OTHER"</span>/></span></span><br><span class=line>  <span class=tag><<span class=name>setting</span> <span class=attr>name</span>=<span class=string>"lazyLoadTriggerMethods"</span> <span class=attr>value</span>=<span class=string>"equals,clone,hashCode,toString"</span>/></span></span><br><span class=line><span class=tag>&LT/<span class=name>settings</span>></span></span><br></pre></table></figure><h2 id=4-3、typeAliases（类型别名）><a class=headerlink href=#4-3、typeAliases（类型别名） title=4.3、typeAliases（类型别名）></a>4.3、typeAliases（类型别名）</h2><p>类型别名可为 Java 类型设置一个缩写名字。 它仅用于 XML 配置，意在降低冗余的全限定类名书写。例如：<figure class="highlight xml"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br></pre><td class=code><pre><span class=line><span class=tag><<span class=name>typeAliases</span>></span></span><br><span class=line>  <span class=tag><<span class=name>typeAlias</span> <span class=attr>alias</span>=<span class=string>"Author"</span> <span class=attr>type</span>=<span class=string>"domain.blog.Author"</span>/></span></span><br><span class=line>  <span class=tag><<span class=name>typeAlias</span> <span class=attr>alias</span>=<span class=string>"Blog"</span> <span class=attr>type</span>=<span class=string>"domain.blog.Blog"</span>/></span></span><br><span class=line>  <span class=tag><<span class=name>typeAlias</span> <span class=attr>alias</span>=<span class=string>"Comment"</span> <span class=attr>type</span>=<span class=string>"domain.blog.Comment"</span>/></span></span><br><span class=line>  <span class=tag><<span class=name>typeAlias</span> <span class=attr>alias</span>=<span class=string>"Post"</span> <span class=attr>type</span>=<span class=string>"domain.blog.Post"</span>/></span></span><br><span class=line>  <span class=tag><<span class=name>typeAlias</span> <span class=attr>alias</span>=<span class=string>"Section"</span> <span class=attr>type</span>=<span class=string>"domain.blog.Section"</span>/></span></span><br><span class=line>  <span class=tag><<span class=name>typeAlias</span> <span class=attr>alias</span>=<span class=string>"Tag"</span> <span class=attr>type</span>=<span class=string>"domain.blog.Tag"</span>/></span></span><br><span class=line><span class=tag>&LT/<span class=name>typeAliases</span>></span></span><br></pre></table></figure><p>当这样配置时，<code>Blog</code> 可以用在任何使用 <code>domain.blog.Blog</code> 的地方。<p>也可以指定一个包名，<code>MyBatis</code>会在包名下面搜索需要的<code>Java Bean</code>，比如：<figure class="highlight xml"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br></pre><td class=code><pre><span class=line><span class=tag><<span class=name>typeAliases</span>></span></span><br><span class=line>  <span class=tag><<span class=name>package</span> <span class=attr>name</span>=<span class=string>"domain.blog"</span>/></span></span><br><span class=line><span class=tag>&LT/<span class=name>typeAliases</span>></span></span><br></pre></table></figure><p>每一个在包 <code>domain.blog</code> 中的 Java Bean，在没有注解的情况下，会使用 Bean 的首字母小写的非限定类名来作为它的别名。 比如 <code>domain.blog.Author</code> 的别名为 <code>author</code>；若有注解，则别名为其注解值。见下面的例子：<figure class="highlight java"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br></pre><td class=code><pre><span class=line><span class=meta>@Alias("author")</span></span><br><span class=line><span class=keyword>public</span> <span class=keyword>class</span> <span class="title class_">Author</span> {</span><br><span class=line>    <span class=comment>//...</span></span><br><span class=line>}</span><br></pre></table></figure><p>下面是一些为常见的 Java 类型内建的类型别名。它们都是不区分大小写的，注意，为了应对原始类型的命名重复，采取了特殊的命名风格。<table><thead><tr><th align=right>别名<th align=left>映射的类型<tbody><tr><td align=right>_byte<td align=left>byte<tr><td align=right>_long<td align=left>long<tr><td align=right>_short<td align=left>short<tr><td align=right>_int<td align=left>int<tr><td align=right>_integer<td align=left>int<tr><td align=right>_double<td align=left>double<tr><td align=right>_float<td align=left>float<tr><td align=right>_boolean<td align=left>boolean<tr><td align=right>string<td align=left>String<tr><td align=right>byte<td align=left>Byte<tr><td align=right>long<td align=left>Long<tr><td align=right>short<td align=left>Short<tr><td align=right>int<td align=left>Integer<tr><td align=right>integer<td align=left>Integer<tr><td align=right>double<td align=left>Double<tr><td align=right>float<td align=left>Float<tr><td align=right>boolean<td align=left>Boolean<tr><td align=right>date<td align=left>Date<tr><td align=right>decimal<td align=left>BigDecimal<tr><td align=right>bigdecimal<td align=left>BigDecimal<tr><td align=right>object<td align=left>Object<tr><td align=right>map<td align=left>Map<tr><td align=right>hashmap<td align=left>HashMap<tr><td align=right>list<td align=left>List<tr><td align=right>arraylist<td align=left>ArrayList<tr><td align=right>collection<td align=left>Collection<tr><td align=right>iterator<td align=left>Iterator</table><h2 id=4-4、typeHandlers（类型处理器）><a class=headerlink href=#4-4、typeHandlers（类型处理器） title=4.4、typeHandlers（类型处理器）></a>4.4、typeHandlers（类型处理器）</h2><p>MyBatis 在设置预处理语句（PreparedStatement）中的参数或从结果集中取出一个值时， 都会用类型处理器将获取到的值以合适的方式转换成 Java 类型。下表描述了一些默认的类型处理器。<p><strong>提示</strong>： 从 3.4.5 开始，MyBatis 默认支持 JSR-310（日期和时间 API） 。<table><thead><tr><th align=center>类型处理器<th align=left>Java 类型<th align=left>JDBC 类型<tbody><tr><td align=center><code>BooleanTypeHandler</code><td align=left><code>java.lang.Boolean</code>, <code>boolean</code><td align=left>数据库兼容的 <code>BOOLEAN</code><tr><td align=center><code>ByteTypeHandler</code><td align=left><code>java.lang.Byte</code>, <code>byte</code><td align=left>数据库兼容的 <code>NUMERIC</code> 或 <code>BYTE</code><tr><td align=center><code>ShortTypeHandler</code><td align=left><code>java.lang.Short</code>, <code>short</code><td align=left>数据库兼容的 <code>NUMERIC</code> 或 <code>SMALLINT</code><tr><td align=center><code>IntegerTypeHandler</code><td align=left><code>java.lang.Integer</code>, <code>int</code><td align=left>数据库兼容的 <code>NUMERIC</code> 或 <code>INTEGER</code><tr><td align=center><code>LongTypeHandler</code><td align=left><code>java.lang.Long</code>, <code>long</code><td align=left>数据库兼容的 <code>NUMERIC</code> 或 <code>BIGINT</code><tr><td align=center><code>FloatTypeHandler</code><td align=left><code>java.lang.Float</code>, <code>float</code><td align=left>数据库兼容的 <code>NUMERIC</code> 或 <code>FLOAT</code><tr><td align=center><code>DoubleTypeHandler</code><td align=left><code>java.lang.Double</code>, <code>double</code><td align=left>数据库兼容的 <code>NUMERIC</code> 或 <code>DOUBLE</code><tr><td align=center><code>BigDecimalTypeHandler</code><td align=left><code>java.math.BigDecimal</code><td align=left>数据库兼容的 <code>NUMERIC</code> 或 <code>DECIMAL</code><tr><td align=center><code>StringTypeHandler</code><td align=left><code>java.lang.String</code><td align=left><code>CHAR</code>, <code>VARCHAR</code><tr><td align=center><code>ClobReaderTypeHandler</code><td align=left><code>java.io.Reader</code><td align=left>-<tr><td align=center><code>ClobTypeHandler</code><td align=left><code>java.lang.String</code><td align=left><code>CLOB</code>, <code>LONGVARCHAR</code><tr><td align=center><code>NStringTypeHandler</code><td align=left><code>java.lang.String</code><td align=left><code>NVARCHAR</code>, <code>NCHAR</code><tr><td align=center><code>NClobTypeHandler</code><td align=left><code>java.lang.String</code><td align=left><code>NCLOB</code><tr><td align=center><code>BlobInputStreamTypeHandler</code><td align=left><code>java.io.InputStream</code><td align=left>-<tr><td align=center><code>ByteArrayTypeHandler</code><td align=left><code>byte[]</code><td align=left>数据库兼容的字节流类型<tr><td align=center><code>BlobTypeHandler</code><td align=left><code>byte[]</code><td align=left><code>BLOB</code>, <code>LONGVARBINARY</code><tr><td align=center><code>DateTypeHandler</code><td align=left><code>java.util.Date</code><td align=left><code>TIMESTAMP</code><tr><td align=center><code>DateOnlyTypeHandler</code><td align=left><code>java.util.Date</code><td align=left><code>DATE</code><tr><td align=center><code>TimeOnlyTypeHandler</code><td align=left><code>java.util.Date</code><td align=left><code>TIME</code><tr><td align=center><code>SqlTimestampTypeHandler</code><td align=left><code>java.sql.Timestamp</code><td align=left><code>TIMESTAMP</code><tr><td align=center><code>SqlDateTypeHandler</code><td align=left><code>java.sql.Date</code><td align=left><code>DATE</code><tr><td align=center><code>SqlTimeTypeHandler</code><td align=left><code>java.sql.Time</code><td align=left><code>TIME</code><tr><td align=center><code>ObjectTypeHandler</code><td align=left>Any<td align=left><code>OTHER</code> 或未指定类型<tr><td align=center><code>EnumTypeHandler</code><td align=left>Enumeration Type<td align=left>VARCHAR 或任何兼容的字符串类型，用来存储枚举的名称（而不是索引序数值）<tr><td align=center><code>EnumOrdinalTypeHandler</code><td align=left>Enumeration Type<td align=left>任何兼容的 <code>NUMERIC</code> 或 <code>DOUBLE</code> 类型，用来存储枚举的序数值（而不是名称）。<tr><td align=center><code>SqlxmlTypeHandler</code><td align=left><code>java.lang.String</code><td align=left><code>SQLXML</code><tr><td align=center><code>InstantTypeHandler</code><td align=left><code>java.time.Instant</code><td align=left><code>TIMESTAMP</code><tr><td align=center><code>LocalDateTimeTypeHandler</code><td align=left><code>java.time.LocalDateTime</code><td align=left><code>TIMESTAMP</code><tr><td align=center><code>LocalDateTypeHandler</code><td align=left><code>java.time.LocalDate</code><td align=left><code>DATE</code><tr><td align=center><code>LocalTimeTypeHandler</code><td align=left><code>java.time.LocalTime</code><td align=left><code>TIME</code><tr><td align=center><code>OffsetDateTimeTypeHandler</code><td align=left><code>java.time.OffsetDateTime</code><td align=left><code>TIMESTAMP</code><tr><td align=center><code>OffsetTimeTypeHandler</code><td align=left><code>java.time.OffsetTime</code><td align=left><code>TIME</code><tr><td align=center><code>ZonedDateTimeTypeHandler</code><td align=left><code>java.time.ZonedDateTime</code><td align=left><code>TIMESTAMP</code><tr><td align=center><code>YearTypeHandler</code><td align=left><code>java.time.Year</code><td align=left><code>INTEGER</code><tr><td align=center><code>MonthTypeHandler</code><td align=left><code>java.time.Month</code><td align=left><code>INTEGER</code><tr><td align=center><code>YearMonthTypeHandler</code><td align=left><code>java.time.YearMonth</code><td align=left><code>VARCHAR</code> 或 <code>LONGVARCHAR</code><tr><td align=center><code>JapaneseDateTypeHandler</code><td align=left><code>java.time.chrono.JapaneseDate</code><td align=left><code>DATE</code></table><p>你可以重写已有的类型处理器或创建你自己的类型处理器来处理不支持的或非标准的类型。 具体做法为：实现 <code>org.apache.ibatis.type.TypeHandler</code> 接口， 或继承一个很便利的类 <code>org.apache.ibatis.type.BaseTypeHandler</code>， 并且可以（可选地）将它映射到一个 JDBC 类型。比如：<figure class="highlight java"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br></pre><td class=code><pre><span class=line><span class=meta>@MappedJdbcTypes(JdbcType.VARCHAR)</span></span><br><span class=line><span class=keyword>public</span> <span class=keyword>class</span> <span class="title class_">ExampleTypeHandler</span> <span class=keyword>extends</span> <span class="title class_">BaseTypeHandler</span>&LTString> {</span><br><span class=line>  <span class=meta>@Override</span></span><br><span class=line>  <span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">setNonNullParameter</span><span class=params>(PreparedStatement ps, <span class=type>int</span> i, String parameter, JdbcType jdbcType)</span> <span class=keyword>throws</span> SQLException {</span><br><span class=line>    ps.setString(i, parameter);</span><br><span class=line>  }</span><br><span class=line></span><br><span class=line>  <span class=meta>@Override</span></span><br><span class=line>  <span class=keyword>public</span> String <span class="title function_">getNullableResult</span><span class=params>(ResultSet rs, String columnName)</span> <span class=keyword>throws</span> SQLException {</span><br><span class=line>    <span class=keyword>return</span> rs.getString(columnName);</span><br><span class=line>  }</span><br><span class=line></span><br><span class=line>  <span class=meta>@Override</span></span><br><span class=line>  <span class=keyword>public</span> String <span class="title function_">getNullableResult</span><span class=params>(ResultSet rs, <span class=type>int</span> columnIndex)</span> <span class=keyword>throws</span> SQLException {</span><br><span class=line>    <span class=keyword>return</span> rs.getString(columnIndex);</span><br><span class=line>  }</span><br><span class=line></span><br><span class=line>  <span class=meta>@Override</span></span><br><span class=line>  <span class=keyword>public</span> String <span class="title function_">getNullableResult</span><span class=params>(CallableStatement cs, <span class=type>int</span> columnIndex)</span> <span class=keyword>throws</span> SQLException {</span><br><span class=line>    <span class=keyword>return</span> cs.getString(columnIndex);</span><br><span class=line>  }</span><br><span class=line>}</span><br></pre></table></figure><p>mybatis-config.xml<figure class="highlight xml"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br></pre><td class=code><pre><span class=line><span class=tag><<span class=name>typeHandlers</span>></span></span><br><span class=line>  <span class=tag><<span class=name>typeHandler</span> <span class=attr>handler</span>=<span class=string>"org.mybatis.example.ExampleTypeHandler"</span>/></span></span><br><span class=line><span class=tag>&LT/<span class=name>typeHandlers</span>></span></span><br></pre></table></figure><h2 id=4-5、处理枚举类型><a class=headerlink href=#4-5、处理枚举类型 title=4.5、处理枚举类型></a>4.5、处理枚举类型</h2><p>若想映射枚举类型 <code>Enum</code>，则需要从 <code>EnumTypeHandler</code> 或者 <code>EnumOrdinalTypeHandler</code> 中选择一个来使用。<p>比如说我们想存储取近似值时用到的舍入模式。默认情况下，MyBatis 会利用 <code>EnumTypeHandler</code> 来把 <code>Enum</code> 值转换成对应的名字。<p><strong>注意</strong>： <code>EnumTypeHandler</code> 在某种意义上来说是比较特别的，其它的处理器只针对某个特定的类，而它不同，它会处理任意继承了 <code>Enum</code> 的类。<p>不过，我们可能不想存储名字，相反我们的 DBA 会坚持使用整形值代码。那也一样简单：在配置文件中把 <code>EnumOrdinalTypeHandler</code> 加到 <code>typeHandlers</code> 中即可， 这样每个 <code>RoundingMode</code> 将通过他们的序数值来映射成对应的整形数值。<figure class="highlight xml"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br></pre><td class=code><pre><span class=line><span class=comment>&LT!-- mybatis-config.xml --></span></span><br><span class=line><span class=tag><<span class=name>typeHandlers</span>></span></span><br><span class=line>  <span class=tag><<span class=name>typeHandler</span> <span class=attr>handler</span>=<span class=string>"org.apache.ibatis.type.EnumOrdinalTypeHandler"</span> <span class=attr>javaType</span>=<span class=string>"java.math.RoundingMode"</span>/></span></span><br><span class=line><span class=tag>&LT/<span class=name>typeHandlers</span>></span></span><br></pre></table></figure><p>但要是你想在一个地方将 <code>Enum</code> 映射成字符串，在另外一个地方映射成整形值呢？<p>自动映射器（auto-mapper）会自动地选用 <code>EnumOrdinalTypeHandler</code> 来处理枚举类型， 所以如果我们想用普通的 <code>EnumTypeHandler</code>，就必须要显式地为那些 SQL 语句设置要使用的类型处理器。<h2 id=4-6、objectFactory（对象工厂）><a class=headerlink href=#4-6、objectFactory（对象工厂） title=4.6、objectFactory（对象工厂）></a>4.6、objectFactory（对象工厂）</h2><p>每次 MyBatis 创建结果对象的新实例时，它都会使用一个对象工厂（ObjectFactory）实例来完成实例化工作。 默认的对象工厂需要做的仅仅是实例化目标类，要么通过默认无参构造方法，要么通过存在的参数映射来调用带有参数的构造方法。 如果想覆盖对象工厂的默认行为，可以通过创建自己的对象工厂来实现。比如：<figure class="highlight java"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br></pre><td class=code><pre><span class=line><span class=comment>// ExampleObjectFactory.java</span></span><br><span class=line><span class=keyword>public</span> <span class=keyword>class</span> <span class="title class_">ExampleObjectFactory</span> <span class=keyword>extends</span> <span class="title class_">DefaultObjectFactory</span> {</span><br><span class=line>  <span class=keyword>public</span> Object <span class="title function_">create</span><span class=params>(Class type)</span> {</span><br><span class=line>    <span class=keyword>return</span> <span class=built_in>super</span>.create(type);</span><br><span class=line>  }</span><br><span class=line>  <span class=keyword>public</span> Object <span class="title function_">create</span><span class=params>(Class type, List&LTClass> constructorArgTypes, List&LTObject> constructorArgs)</span> {</span><br><span class=line>    <span class=keyword>return</span> <span class=built_in>super</span>.create(type, constructorArgTypes, constructorArgs);</span><br><span class=line>  }</span><br><span class=line>  <span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">setProperties</span><span class=params>(Properties properties)</span> {</span><br><span class=line>    <span class=built_in>super</span>.setProperties(properties);</span><br><span class=line>  }</span><br><span class=line>  <span class=keyword>public</span> &LTT> <span class=type>boolean</span> <span class="title function_">isCollection</span><span class=params>(Class&LTT> type)</span> {</span><br><span class=line>    <span class=keyword>return</span> Collection.class.isAssignableFrom(type);</span><br><span class=line>  }</span><br><span class=line>}</span><br></pre></table></figure><figure class="highlight xml"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br></pre><td class=code><pre><span class=line><span class=comment>&LT!-- mybatis-config.xml --></span></span><br><span class=line><span class=tag><<span class=name>objectFactory</span> <span class=attr>type</span>=<span class=string>"org.mybatis.example.ExampleObjectFactory"</span>></span></span><br><span class=line>  <span class=tag><<span class=name>property</span> <span class=attr>name</span>=<span class=string>"someProperty"</span> <span class=attr>value</span>=<span class=string>"100"</span>/></span></span><br><span class=line><span class=tag>&LT/<span class=name>objectFactory</span>></span></span><br></pre></table></figure><p>ObjectFactory 接口很简单，它包含两个创建实例用的方法，一个是处理默认无参构造方法的，另外一个是处理带参数的构造方法的。 另外，setProperties 方法可以被用来配置 ObjectFactory，在初始化你的 ObjectFactory 实例后， objectFactory 元素体中定义的属性会被传递给 setProperties 方法。<h2 id=4-7、plugins（插件）><a class=headerlink href=#4-7、plugins（插件） title=4.7、plugins（插件）></a>4.7、plugins（插件）</h2><p>MyBatis 允许你在映射语句执行过程中的某一点进行拦截调用。默认情况下，MyBatis 允许使用插件来拦截的方法调用包括：<ul><li>Executor (update, query, flushStatements, commit, rollback, getTransaction, close, isClosed)<li>ParameterHandler (getParameterObject, setParameters)<li>ResultSetHandler (handleResultSets, handleOutputParameters)<li>StatementHandler (prepare, parameterize, batch, update, query)</ul><p>这些类中方法的细节可以通过查看每个方法的签名来发现，或者直接查看 MyBatis 发行包中的源代码。 如果你想做的不仅仅是监控方法的调用，那么你最好相当了解要重写的方法的行为。 因为在试图修改或重写已有方法的行为时，很可能会破坏 MyBatis 的核心模块。 这些都是更底层的类和方法，所以使用插件的时候要特别当心。<p>通过 MyBatis 提供的强大机制，使用插件是非常简单的，只需实现 Interceptor 接口，并指定想要拦截的方法签名即可。<figure class="highlight java"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br></pre><td class=code><pre><span class=line><span class=comment>// ExamplePlugin.java</span></span><br><span class=line><span class=meta>@Intercepts({@Signature(</span></span><br><span class=line><span class=meta>  type= Executor.class,</span></span><br><span class=line><span class=meta>  method = "update",</span></span><br><span class=line><span class=meta>  args = {MappedStatement.class,Object.class})})</span></span><br><span class=line><span class=keyword>public</span> <span class=keyword>class</span> <span class="title class_">ExamplePlugin</span> <span class=keyword>implements</span> <span class="title class_">Interceptor</span> {</span><br><span class=line>  <span class=keyword>private</span> <span class=type>Properties</span> <span class=variable>properties</span> <span class=operator>=</span> <span class=keyword>new</span> <span class="title class_">Properties</span>();</span><br><span class=line>  <span class=keyword>public</span> Object <span class="title function_">intercept</span><span class=params>(Invocation invocation)</span> <span class=keyword>throws</span> Throwable {</span><br><span class=line>    <span class=comment>// implement pre processing if need</span></span><br><span class=line>    <span class=type>Object</span> <span class=variable>returnObject</span> <span class=operator>=</span> invocation.proceed();</span><br><span class=line>    <span class=comment>// implement post processing if need</span></span><br><span class=line>    <span class=keyword>return</span> returnObject;</span><br><span class=line>  }</span><br><span class=line>  <span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">setProperties</span><span class=params>(Properties properties)</span> {</span><br><span class=line>    <span class=built_in>this</span>.properties = properties;</span><br><span class=line>  }</span><br><span class=line>}</span><br></pre></table></figure><figure class="highlight xml"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br></pre><td class=code><pre><span class=line><span class=comment>&LT!-- mybatis-config.xml --></span></span><br><span class=line><span class=tag><<span class=name>plugins</span>></span></span><br><span class=line>  <span class=tag><<span class=name>plugin</span> <span class=attr>interceptor</span>=<span class=string>"org.mybatis.example.ExamplePlugin"</span>></span></span><br><span class=line>    <span class=tag><<span class=name>property</span> <span class=attr>name</span>=<span class=string>"someProperty"</span> <span class=attr>value</span>=<span class=string>"100"</span>/></span></span><br><span class=line>  <span class=tag>&LT/<span class=name>plugin</span>></span></span><br><span class=line><span class=tag>&LT/<span class=name>plugins</span>></span></span><br></pre></table></figure><p>上面的插件将会拦截在 Executor 实例中所有的 “update” 方法调用， 这里的 Executor 是负责执行底层映射语句的内部对象。<p><strong>覆盖配置类</strong>：除了用插件来修改 MyBatis 核心行为以外，还可以通过完全覆盖配置类来达到目的。只需继承配置类后覆盖其中的某个方法，再把它传递到 SqlSessionFactoryBuilder.build(myConfig) 方法即可。再次重申，这可能会极大影响 MyBatis 的行为，务请慎之又慎。<h2 id=4-8、environments（环境配置><a class=headerlink href=#4-8、environments（环境配置 title=4.8、environments（环境配置)></a>4.8、environments（环境配置)</h2><p>MyBatis 可以配置成适应多种环境，这种机制有助于将 SQL 映射应用于多种数据库之中， 现实情况下有多种理由需要这么做。例如，开发、测试和生产环境需要有不同的配置；或者想在具有相同 Schema 的多个生产数据库中使用相同的 SQL 映射。还有许多类似的使用场景。<p>为了指定创建哪种环境，只要将它作为可选的参数传递给 SqlSessionFactoryBuilder 即可。可以接受环境配置的两个方法签名是：<figure class="highlight java"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br></pre><td class=code><pre><span class=line><span class=type>SqlSessionFactory</span> <span class=variable>factory</span> <span class=operator>=</span> <span class=keyword>new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(reader, environment);</span><br><span class=line><span class=type>SqlSessionFactory</span> <span class=variable>factory</span> <span class=operator>=</span> <span class=keyword>new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(reader, environment, properties);</span><br></pre></table></figure><p>如果忽略了环境参数，那么将会加载默认环境，如下所示：<figure class="highlight java"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br></pre><td class=code><pre><span class=line><span class=type>SqlSessionFactory</span> <span class=variable>factory</span> <span class=operator>=</span> <span class=keyword>new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(reader);</span><br><span class=line><span class=type>SqlSessionFactory</span> <span class=variable>factory</span> <span class=operator>=</span> <span class=keyword>new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(reader, properties);</span><br></pre></table></figure><p>environments 元素定义了如何配置环境。<figure class="highlight java"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br></pre><td class=code><pre><span class=line>&LTenvironments <span class=keyword>default</span>=<span class=string>"development"</span>></span><br><span class=line>  &LTenvironment id=<span class=string>"development"</span>></span><br><span class=line>    &LTtransactionManager type=<span class=string>"JDBC"</span>></span><br><span class=line>      &LTproperty name=<span class=string>"..."</span> value=<span class=string>"..."</span>/></span><br><span class=line>    &LT/transactionManager></span><br><span class=line>    &LTdataSource type=<span class=string>"POOLED"</span>></span><br><span class=line>      &LTproperty name=<span class=string>"driver"</span> value=<span class=string>"${driver}"</span>/></span><br><span class=line>      &LTproperty name=<span class=string>"url"</span> value=<span class=string>"${url}"</span>/></span><br><span class=line>      &LTproperty name=<span class=string>"username"</span> value=<span class=string>"${username}"</span>/></span><br><span class=line>      &LTproperty name=<span class=string>"password"</span> value=<span class=string>"${password}"</span>/></span><br><span class=line>    &LT/dataSource></span><br><span class=line>  &LT/environment></span><br><span class=line>&LT/environments></span><br></pre></table></figure><p>注意事项：<ol><li>每个 SqlSessionFactory 实例只能选择一种环境。<li>每个数据库对应一个 SqlSessionFactory 实例。<li>默认使用的环境 ID（比如：default=”development”）。<li>每个 environment 元素定义的环境 ID（比如：id=”development”）。<li>事务管理器的配置（比如：type=”JDBC”）。<li>数据源的配置（比如：type=”POOLED”）。</ol><ul><li><p>事务管理器（transactionManager）</p> <p>在 MyBatis 中有两种类型的事务管理器（也就是 type=”[JDBC|MANAGED]”）：</p> <ul><li><p>JDBC – 这个配置直接使用了 JDBC 的提交和回滚设施，它依赖从数据源获得的连接来管理事务作用域。</p><li><p>MANAGED – 这个配置几乎没做什么。它从不提交或回滚一个连接，而是让容器来管理事务的整个生命周期（比如 JEE 应用服务器的上下文）。 默认情况下它会关闭连接。然而一些容器并不希望连接被关闭，因此需要将 closeConnection 属性设置为 false 来阻止默认的关闭行为。例如:</p> <figure class="highlight xml"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br></pre><td class=code><pre><span class=line><span class=tag><<span class=name>transactionManager</span> <span class=attr>type</span>=<span class=string>"MANAGED"</span>></span></span><br><span class=line>  <span class=tag><<span class=name>property</span> <span class=attr>name</span>=<span class=string>"closeConnection"</span> <span class=attr>value</span>=<span class=string>"false"</span>/></span></span><br><span class=line><span class=tag>&LT/<span class=name>transactionManager</span>></span></span><br></pre></table></figure></ul> <p><strong>注意</strong>：如果你正在使用 Spring + MyBatis，则没有必要配置事务管理器，因为 Spring 模块会使用自带的管理器来覆盖前面的配置。</p><li><p>数据源（dataSource）</p> <p>dataSource 元素使用标准的 JDBC 数据源接口来配置 JDBC 连接对象的资源。大多数 MyBatis 应用程序会按示例中的例子来配置数据源。虽然数据源配置是可选的，但如果要启用延迟加载特性，就必须配置数据源。</p> <p>有三种内建的数据源类型（也就是 type=”[UNPOOLED|POOLED|JNDI]”）：</p> <ol><li><p><strong>UNPOOLED</strong>——这个数据源的实现会每次请求时打开和关闭连接。虽然有点慢，但对那些数据库连接可用性要求不高的简单应用程序来说，是一个很好的选择。 性能表现则依赖于使用的数据库，对某些数据库来说，使用连接池并不重要，这个配置就很适合这种情形。</p><li><p><strong>POOLED</strong>——这种数据源的实现利用“池”的概念将 JDBC 连接对象组织起来，避免了创建新的连接实例时所必需的初始化和认证时间。 这种处理方式很流行，能使并发 Web 应用快速响应请求。</p><li><p><strong>JNDI</strong>——这个数据源实现是为了能在如 EJB 或应用服务器这类容器中使用，容器可以集中或在外部配置数据源，然后放置一个 JNDI 上下文的数据源引用。这种数据源配置只需要两个属性：</p> <ul><li><code>initial_context</code> – 这个属性用来在 InitialContext 中寻找上下文（即，initialContext.lookup(initial_context)）。这是个可选属性，如果忽略，那么将会直接从 InitialContext中寻找 data_source属性。<li><code>data_source</code> – 这是引用数据源实例位置的上下文路径。提供了 initial_context 配置时会在其返回的上下文中进行查找，没有提供时则直接在InitialContext中查找。</ul> <p>和其他数据源配置类似，可以通过添加前缀“env.”直接把属性传递给 InitialContext。比如：</p> <ul><li><code>env.encoding=UTF8</code></ul><li><p>你可以通过实现接口 <code>org.apache.ibatis.datasource.DataSourceFactory</code> 来使用第三方数据源实现：</p> <figure class="highlight java"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br></pre><td class=code><pre><span class=line><span class=keyword>public</span> <span class=keyword>interface</span> <span class="title class_">DataSourceFactory</span> {</span><br><span class=line>  <span class=keyword>void</span> <span class="title function_">setProperties</span><span class=params>(Properties props)</span>;</span><br><span class=line>  DataSource <span class="title function_">getDataSource</span><span class=params>()</span>;</span><br><span class=line>}</span><br></pre></table></figure> <ul><li><p>C3P0数据源实现：</p> <figure class="highlight java"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br></pre><td class=code><pre><span class=line><span class=keyword>import</span> org.apache.ibatis.datasource.unpooled.UnpooledDataSourceFactory;</span><br><span class=line><span class=keyword>import</span> com.mchange.v2.c3p0.ComboPooledDataSource;</span><br><span class=line></span><br><span class=line><span class=keyword>public</span> <span class=keyword>class</span> <span class="title class_">C3P0DataSourceFactory</span> <span class=keyword>extends</span> <span class="title class_">UnpooledDataSourceFactory</span> {</span><br><span class=line>  <span class=keyword>public</span> <span class="title function_">C3P0DataSourceFactory</span><span class=params>()</span> {</span><br><span class=line>    <span class=built_in>this</span>.dataSource = <span class=keyword>new</span> <span class="title class_">ComboPooledDataSource</span>();</span><br><span class=line>  }</span><br><span class=line>}</span><br></pre></table></figure></ul></ol></ul><p>为了令其工作，记得在配置文件中为每个希望 MyBatis 调用的 setter 方法增加对应的属性。 下面是一个可以连接至 PostgreSQL 数据库的例子：<figure class="highlight xml"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br></pre><td class=code><pre><span class=line><span class=tag><<span class=name>dataSource</span> <span class=attr>type</span>=<span class=string>"org.myproject.C3P0DataSourceFactory"</span>></span></span><br><span class=line>  <span class=tag><<span class=name>property</span> <span class=attr>name</span>=<span class=string>"driver"</span> <span class=attr>value</span>=<span class=string>"org.postgresql.Driver"</span>/></span></span><br><span class=line>  <span class=tag><<span class=name>property</span> <span class=attr>name</span>=<span class=string>"url"</span> <span class=attr>value</span>=<span class=string>"jdbc:postgresql:mydb"</span>/></span></span><br><span class=line>  <span class=tag><<span class=name>property</span> <span class=attr>name</span>=<span class=string>"username"</span> <span class=attr>value</span>=<span class=string>"postgres"</span>/></span></span><br><span class=line>  <span class=tag><<span class=name>property</span> <span class=attr>name</span>=<span class=string>"password"</span> <span class=attr>value</span>=<span class=string>"root"</span>/></span></span><br><span class=line><span class=tag>&LT/<span class=name>dataSource</span>></span></span><br></pre></table></figure><h2 id=4-9、mapper（映射器）><a class=headerlink href=#4-9、mapper（映射器） title=4.9、mapper（映射器）></a>4.9、mapper（映射器）</h2><p>我们现在就要来定义 SQL 映射语句了。 但首先，我们需要告诉 MyBatis 到哪里去找到这些语句。 在自动查找资源方面，Java 并没有提供一个很好的解决方案，所以最好的办法是直接告诉 MyBatis 到哪里去找映射文件。 你可以使用相对于类路径的资源引用，或完全限定资源定位符（包括 <code>file:///</code> 形式的 URL），或类名和包名等。例如：<h3 id=4-9-1、相对于类路径><a class=headerlink href=#4-9-1、相对于类路径 title=4.9.1、相对于类路径></a>4.9.1、相对于类路径</h3><figure class="highlight xml"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br></pre><td class=code><pre><span class=line><span class=comment>&LT!-- 使用相对于类路径的资源引用 --></span></span><br><span class=line><span class=tag><<span class=name>mappers</span>></span></span><br><span class=line>  <span class=tag><<span class=name>mapper</span> <span class=attr>resource</span>=<span class=string>"org/mybatis/builder/AuthorMapper.xml"</span>/></span></span><br><span class=line>  <span class=tag><<span class=name>mapper</span> <span class=attr>resource</span>=<span class=string>"org/mybatis/builder/BlogMapper.xml"</span>/></span></span><br><span class=line>  <span class=tag><<span class=name>mapper</span> <span class=attr>resource</span>=<span class=string>"org/mybatis/builder/PostMapper.xml"</span>/></span></span><br><span class=line><span class=tag>&LT/<span class=name>mappers</span>></span></span><br></pre></table></figure><h3 id=4-9-2、完全限定资源定位符><a class=headerlink href=#4-9-2、完全限定资源定位符 title=4.9.2、完全限定资源定位符></a>4.9.2、完全限定资源定位符</h3><figure class="highlight xml"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br></pre><td class=code><pre><span class=line><span class=comment>&LT!-- 使用完全限定资源定位符（URL） --></span></span><br><span class=line><span class=tag><<span class=name>mappers</span>></span></span><br><span class=line>  <span class=tag><<span class=name>mapper</span> <span class=attr>url</span>=<span class=string>"file:///var/mappers/AuthorMapper.xml"</span>/></span></span><br><span class=line>  <span class=tag><<span class=name>mapper</span> <span class=attr>url</span>=<span class=string>"file:///var/mappers/BlogMapper.xml"</span>/></span></span><br><span class=line>  <span class=tag><<span class=name>mapper</span> <span class=attr>url</span>=<span class=string>"file:///var/mappers/PostMapper.xml"</span>/></span></span><br><span class=line><span class=tag>&LT/<span class=name>mappers</span>></span></span><br></pre></table></figure><h3 id=4-9-3、映射器接口实现类的完全限定类名><a class=headerlink href=#4-9-3、映射器接口实现类的完全限定类名 title=4.9.3、映射器接口实现类的完全限定类名></a>4.9.3、映射器接口实现类的完全限定类名</h3><figure class="highlight xml"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br></pre><td class=code><pre><span class=line><span class=comment>&LT!-- 使用映射器接口实现类的完全限定类名 --></span></span><br><span class=line><span class=tag><<span class=name>mappers</span>></span></span><br><span class=line>  <span class=tag><<span class=name>mapper</span> <span class=attr>class</span>=<span class=string>"org.mybatis.builder.AuthorMapper"</span>/></span></span><br><span class=line>  <span class=tag><<span class=name>mapper</span> <span class=attr>class</span>=<span class=string>"org.mybatis.builder.BlogMapper"</span>/></span></span><br><span class=line>  <span class=tag><<span class=name>mapper</span> <span class=attr>class</span>=<span class=string>"org.mybatis.builder.PostMapper"</span>/></span></span><br><span class=line><span class=tag>&LT/<span class=name>mappers</span>></span></span><br></pre></table></figure><h3 id=4-9-4、映射器接口实现-注册为映射器><a title="4.9.4、映射器接口实现 注册为映射器" class=headerlink href=#4-9-4、映射器接口实现-注册为映射器></a>4.9.4、映射器接口实现 注册为映射器</h3><figure class="highlight xml"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br></pre><td class=code><pre><span class=line><span class=comment>&LT!-- 将包内的映射器接口实现全部注册为映射器 --></span></span><br><span class=line><span class=tag><<span class=name>mappers</span>></span></span><br><span class=line>  <span class=tag><<span class=name>package</span> <span class=attr>name</span>=<span class=string>"org.mybatis.builder"</span>/></span></span><br><span class=line><span class=tag>&LT/<span class=name>mappers</span>></span></span><br></pre></table></figure><h1 id=5、XML映射文件><a class=headerlink href=#5、XML映射文件 title=5、XML映射文件></a>5、XML映射文件</h1><h2 id=5-1、前言><a class=headerlink href=#5-1、前言 title=5.1、前言></a>5.1、前言</h2><p>MyBatis 的真正强大在于它的语句映射，这是它的魔力所在。由于它的异常强大，映射器的 XML 文件就显得相对简单。如果拿它跟具有相同功能的 JDBC 代码进行对比，你会立即发现省掉了将近 95% 的代码。MyBatis 致力于减少使用成本，让用户能更专注于 SQL 代码。<p>SQL 映射文件只有很少的几个顶级元素（按照应被定义的顺序列出）：<ul><li><code>cache</code> – 该命名空间的缓存配置。<li><code>cache-ref</code> – 引用其它命名空间的缓存配置。<li><code>resultMap</code> – 描述如何从数据库结果集中加载对象，是最复杂也是最强大的元素。<li><code>parameterMap</code> – 老式风格的参数映射。此元素已被废弃，并可能在将来被移除！请使用行内参数映射。文档中不会介绍此元素。（已废弃，不做讨论）<li><code>sql</code> – 可被其它语句引用的可重用语句块。<li><code>insert</code> – 映射插入语句。<li><code>update</code> – 映射更新语句。<li><code>delete</code> – 映射删除语句。<li><code>select</code> – 映射查询语句。</ul><h2 id=5-2、Cache（缓存）><a class=headerlink href=#5-2、Cache（缓存） title=5.2、Cache（缓存）></a>5.2、Cache（缓存）</h2><p>MyBatis 内置了一个强大的事务性查询缓存机制，它可以非常方便地配置和定制。 默认情况下，只启用了本地的会话缓存，它仅仅对一个会话中的数据进行缓存。 要启用全局的二级缓存，只需要在你的 SQL 映射文件中添加一行：<figure class="highlight xml"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line><span class=tag><<span class=name>cache</span>/></span></span><br></pre></table></figure><p>基本上就是这样。这个简单语句的效果如下:<ul><li>映射语句文件中的所有 select 语句的结果将会被缓存。<li>映射语句文件中的所有 insert、update 和 delete 语句会刷新缓存。<li>缓存会使用最近最少使用算法（LRU, Least Recently Used）算法来清除不需要的缓存。<li>缓存不会定时进行刷新（也就是说，没有刷新间隔）。<li>缓存会保存列表或对象（无论查询方法返回哪种）的 1024 个引用。<li>缓存会被视为读/写缓存，这意味着获取到的对象并不是共享的，可以安全地被调用者修改，而不干扰其他调用者或线程所做的潜在修改。</ul><p><strong>注意：</strong> 缓存只作用于 cache 标签所在的映射文件中的语句。如果你混合使用 Java API 和 XML 映射文件，在共用接口中的语句将不会被默认缓存。你需要使用 @CacheNamespaceRef 注解指定缓存作用域。<p>这些属性可以通过 cache 元素的属性来修改。比如：<figure class="highlight xml"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br></pre><td class=code><pre><span class=line><span class=tag><<span class=name>cache</span></span></span><br><span class=line><span class=tag>  <span class=attr>eviction</span>=<span class=string>"FIFO"</span></span></span><br><span class=line><span class=tag>  <span class=attr>flushInterval</span>=<span class=string>"60000"</span></span></span><br><span class=line><span class=tag>  <span class=attr>size</span>=<span class=string>"512"</span></span></span><br><span class=line><span class=tag>  <span class=attr>readOnly</span>=<span class=string>"true"</span>/></span></span><br></pre></table></figure><p>这个更高级的配置创建了一个 FIFO 缓存，每隔 60 秒刷新，最多可以存储结果对象或列表的 512 个引用，而且返回的对象被认为是只读的，因此对它们进行修改可能会在不同线程中的调用者产生冲突。<p>可用的清除策略有：<ul><li><code>LRU</code> – 最近最少使用：移除最长时间不被使用的对象。<li><code>FIFO</code> – 先进先出：按对象进入缓存的顺序来移除它们。<li><code>SOFT</code> – 软引用：基于垃圾回收器状态和软引用规则移除对象。<li><code>WEAK</code> – 弱引用：更积极地基于垃圾收集器状态和弱引用规则移除对象。</ul><p>默认的清除策略是 LRU。<h2 id=5-3、Cache-ref><a class=headerlink href=#5-3、Cache-ref title=5.3、Cache-ref></a>5.3、Cache-ref</h2><p>回想一下上一节的内容，对某一命名空间的语句，只会使用该命名空间的缓存进行缓存或刷新。 但你可能会想要在多个命名空间中共享相同的缓存配置和实例。要实现这种需求，你可以使用 cache-ref 元素来引用另一个缓存。<figure class="highlight xml"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line><span class=tag><<span class=name>cache-ref</span> <span class=attr>namespace</span>=<span class=string>"com.someone.application.data.SomeMapper"</span>/></span></span><br></pre></table></figure><h2 id=5-4、ResultMap（结果映射）><a class=headerlink href=#5-4、ResultMap（结果映射） title=5.4、ResultMap（结果映射）></a>5.4、ResultMap（结果映射）</h2><p><code>resultMap</code> 元素是 MyBatis 中最重要最强大的元素。它可以让你从 90% 的 JDBC <code>ResultSets</code> 数据提取代码中解放出来，并在一些情形下允许你进行一些 JDBC 不支持的操作。实际上，在为一些比如连接的复杂语句编写映射代码的时候，一份 <code>resultMap</code> 能够代替实现同等功能的数千行代码。ResultMap 的设计思想是，对简单的语句做到零配置，对于复杂一点的语句，只需要描述语句之间的关系就行了。<p>之前你已经见过简单映射语句的示例，它们没有显式指定 <code>resultMap</code>。比如：<figure class="highlight xml"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br></pre><td class=code><pre><span class=line><span class=tag><<span class=name>select</span> <span class=attr>id</span>=<span class=string>"selectUsers"</span> <span class=attr>resultType</span>=<span class=string>"map"</span>></span></span><br><span class=line>  select id, username, hashedPassword</span><br><span class=line>  from some_table</span><br><span class=line>  where id = #{id}</span><br><span class=line><span class=tag>&LT/<span class=name>select</span>></span></span><br></pre></table></figure><p>上述语句只是简单地将所有的列映射到 <code>HashMap</code> 的键上，这由 <code>resultType</code> 属性指定。虽然在大部分情况下都够用，但是 HashMap 并不是一个很好的领域模型。你的程序更可能会使用 JavaBean 或 POJO（Plain Old Java Objects，普通老式 Java 对象）作为领域模型。MyBatis 对两者都提供了支持。看看下面这个 JavaBean：<figure class="highlight java"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br></pre><td class=code><pre><span class=line><span class=keyword>public</span> <span class=keyword>class</span> <span class="title class_">User</span> {</span><br><span class=line>    <span class=keyword>private</span> <span class=type>int</span> id;</span><br><span class=line>    <span class=keyword>private</span> String username;</span><br><span class=line>    <span class=keyword>private</span> String hashedPassword;</span><br><span class=line>    </span><br><span class=line>	<span class=comment>//get and set method...</span></span><br><span class=line>}</span><br></pre></table></figure><p>这样的一个 JavaBean 可以被映射到 <code>ResultSet</code>，就像映射到 <code>HashMap</code> 一样简单。<figure class="highlight xml"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br></pre><td class=code><pre><span class=line><span class=tag><<span class=name>select</span> <span class=attr>id</span>=<span class=string>"selectUsers"</span> <span class=attr>resultType</span>=<span class=string>"com.someapp.model.User"</span>></span></span><br><span class=line>  select id, username, hashedPassword</span><br><span class=line>  from some_table</span><br><span class=line>  where id = #{id}</span><br><span class=line><span class=tag>&LT/<span class=name>select</span>></span></span><br></pre></table></figure><p>类型别名是你的好帮手。使用它们，你就可以不用输入类的全限定名了。比如：<figure class="highlight xml"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br></pre><td class=code><pre><span class=line><span class=comment>&LT!-- mybatis-config.xml 中 --></span></span><br><span class=line><span class=tag><<span class=name>typeAlias</span> <span class=attr>type</span>=<span class=string>"com.someapp.model.User"</span> <span class=attr>alias</span>=<span class=string>"User"</span>/></span></span><br><span class=line></span><br><span class=line><span class=comment>&LT!-- SQL 映射 XML 中 --></span></span><br><span class=line><span class=tag><<span class=name>select</span> <span class=attr>id</span>=<span class=string>"selectUsers"</span> <span class=attr>resultType</span>=<span class=string>"User"</span>></span></span><br><span class=line>  select id, username, hashedPassword</span><br><span class=line>  from some_table</span><br><span class=line>  where id = #{id}</span><br><span class=line><span class=tag>&LT/<span class=name>select</span>></span></span><br></pre></table></figure><p>你会发现上面的例子没有一个需要显式配置 <code>ResultMap</code>，这就是 <code>ResultMap</code> 的优秀之处——你完全可以不用显式地配置它们。我们来看看如果在刚刚的示例中，显式使用外部的 <code>resultMap</code> 会怎样，这也是解决列名不匹配的另外一种方式。<figure class="highlight xml"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br></pre><td class=code><pre><span class=line><span class=tag><<span class=name>resultMap</span> <span class=attr>id</span>=<span class=string>"userResultMap"</span> <span class=attr>type</span>=<span class=string>"User"</span>></span></span><br><span class=line>  <span class=tag><<span class=name>id</span> <span class=attr>property</span>=<span class=string>"id"</span> <span class=attr>column</span>=<span class=string>"user_id"</span> /></span></span><br><span class=line>  <span class=tag><<span class=name>result</span> <span class=attr>property</span>=<span class=string>"username"</span> <span class=attr>column</span>=<span class=string>"user_name"</span>/></span></span><br><span class=line>  <span class=tag><<span class=name>result</span> <span class=attr>property</span>=<span class=string>"password"</span> <span class=attr>column</span>=<span class=string>"hashed_password"</span>/></span></span><br><span class=line><span class=tag>&LT/<span class=name>resultMap</span>></span></span><br></pre></table></figure><p>然后在引用它的语句中设置 <code>resultMap</code> 属性就行了（注意我们去掉了 <code>resultType</code> 属性）。比如:<figure class="highlight xml"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br></pre><td class=code><pre><span class=line><span class=tag><<span class=name>select</span> <span class=attr>id</span>=<span class=string>"selectUsers"</span> <span class=attr>resultMap</span>=<span class=string>"userResultMap"</span>></span></span><br><span class=line>  select user_id, user_name, hashed_password</span><br><span class=line>  from some_table</span><br><span class=line>  where id = #{id}</span><br><span class=line><span class=tag>&LT/<span class=name>select</span>></span></span><br></pre></table></figure><h3 id=5-4-1、高级结果映射><a class=headerlink href=#5-4-1、高级结果映射 title=5.4.1、高级结果映射></a>5.4.1、高级结果映射</h3><figure class="highlight xml"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br></pre><td class=code><pre><span class=line><span class=comment>&LT!-- 非常复杂的语句 --></span></span><br><span class=line><span class=tag><<span class=name>select</span> <span class=attr>id</span>=<span class=string>"selectBlogDetails"</span> <span class=attr>resultMap</span>=<span class=string>"detailedBlogResultMap"</span>></span></span><br><span class=line>  select</span><br><span class=line>       B.id as blog_id,</span><br><span class=line>       B.title as blog_title,</span><br><span class=line>       B.author_id as blog_author_id,</span><br><span class=line>       A.id as author_id,</span><br><span class=line>       A.username as author_username,</span><br><span class=line>       A.password as author_password,</span><br><span class=line>       A.email as author_email,</span><br><span class=line>       A.bio as author_bio,</span><br><span class=line>       A.favourite_section as author_favourite_section,</span><br><span class=line>       P.id as post_id,</span><br><span class=line>       P.blog_id as post_blog_id,</span><br><span class=line>       P.author_id as post_author_id,</span><br><span class=line>       P.created_on as post_created_on,</span><br><span class=line>       P.section as post_section,</span><br><span class=line>       P.subject as post_subject,</span><br><span class=line>       P.draft as draft,</span><br><span class=line>       P.body as post_body,</span><br><span class=line>       C.id as comment_id,</span><br><span class=line>       C.post_id as comment_post_id,</span><br><span class=line>       C.name as comment_name,</span><br><span class=line>       C.comment as comment_text,</span><br><span class=line>       T.id as tag_id,</span><br><span class=line>       T.name as tag_name</span><br><span class=line>  from Blog B</span><br><span class=line>       left outer join Author A on B.author_id = A.id</span><br><span class=line>       left outer join Post P on B.id = P.blog_id</span><br><span class=line>       left outer join Comment C on P.id = C.post_id</span><br><span class=line>       left outer join Post_Tag PT on PT.post_id = P.id</span><br><span class=line>       left outer join Tag T on PT.tag_id = T.id</span><br><span class=line>  where B.id = #{id}</span><br><span class=line><span class=tag>&LT/<span class=name>select</span>></span></span><br></pre></table></figure><figure class="highlight xml"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br></pre><td class=code><pre><span class=line><span class=comment>&LT!-- 非常复杂的结果映射 --></span></span><br><span class=line><span class=tag><<span class=name>resultMap</span> <span class=attr>id</span>=<span class=string>"detailedBlogResultMap"</span> <span class=attr>type</span>=<span class=string>"Blog"</span>></span></span><br><span class=line>  <span class=tag><<span class=name>constructor</span>></span></span><br><span class=line>    <span class=tag><<span class=name>idArg</span> <span class=attr>column</span>=<span class=string>"blog_id"</span> <span class=attr>javaType</span>=<span class=string>"int"</span>/></span></span><br><span class=line>  <span class=tag>&LT/<span class=name>constructor</span>></span></span><br><span class=line>  <span class=tag><<span class=name>result</span> <span class=attr>property</span>=<span class=string>"title"</span> <span class=attr>column</span>=<span class=string>"blog_title"</span>/></span></span><br><span class=line>  <span class=tag><<span class=name>association</span> <span class=attr>property</span>=<span class=string>"author"</span> <span class=attr>javaType</span>=<span class=string>"Author"</span>></span></span><br><span class=line>    <span class=tag><<span class=name>id</span> <span class=attr>property</span>=<span class=string>"id"</span> <span class=attr>column</span>=<span class=string>"author_id"</span>/></span></span><br><span class=line>    <span class=tag><<span class=name>result</span> <span class=attr>property</span>=<span class=string>"username"</span> <span class=attr>column</span>=<span class=string>"author_username"</span>/></span></span><br><span class=line>    <span class=tag><<span class=name>result</span> <span class=attr>property</span>=<span class=string>"password"</span> <span class=attr>column</span>=<span class=string>"author_password"</span>/></span></span><br><span class=line>    <span class=tag><<span class=name>result</span> <span class=attr>property</span>=<span class=string>"email"</span> <span class=attr>column</span>=<span class=string>"author_email"</span>/></span></span><br><span class=line>    <span class=tag><<span class=name>result</span> <span class=attr>property</span>=<span class=string>"bio"</span> <span class=attr>column</span>=<span class=string>"author_bio"</span>/></span></span><br><span class=line>    <span class=tag><<span class=name>result</span> <span class=attr>property</span>=<span class=string>"favouriteSection"</span> <span class=attr>column</span>=<span class=string>"author_favourite_section"</span>/></span></span><br><span class=line>  <span class=tag>&LT/<span class=name>association</span>></span></span><br><span class=line>  <span class=tag><<span class=name>collection</span> <span class=attr>property</span>=<span class=string>"posts"</span> <span class=attr>ofType</span>=<span class=string>"Post"</span>></span></span><br><span class=line>    <span class=tag><<span class=name>id</span> <span class=attr>property</span>=<span class=string>"id"</span> <span class=attr>column</span>=<span class=string>"post_id"</span>/></span></span><br><span class=line>    <span class=tag><<span class=name>result</span> <span class=attr>property</span>=<span class=string>"subject"</span> <span class=attr>column</span>=<span class=string>"post_subject"</span>/></span></span><br><span class=line>    <span class=tag><<span class=name>association</span> <span class=attr>property</span>=<span class=string>"author"</span> <span class=attr>javaType</span>=<span class=string>"Author"</span>/></span></span><br><span class=line>    <span class=tag><<span class=name>collection</span> <span class=attr>property</span>=<span class=string>"comments"</span> <span class=attr>ofType</span>=<span class=string>"Comment"</span>></span></span><br><span class=line>      <span class=tag><<span class=name>id</span> <span class=attr>property</span>=<span class=string>"id"</span> <span class=attr>column</span>=<span class=string>"comment_id"</span>/></span></span><br><span class=line>    <span class=tag>&LT/<span class=name>collection</span>></span></span><br><span class=line>    <span class=tag><<span class=name>collection</span> <span class=attr>property</span>=<span class=string>"tags"</span> <span class=attr>ofType</span>=<span class=string>"Tag"</span> ></span></span><br><span class=line>      <span class=tag><<span class=name>id</span> <span class=attr>property</span>=<span class=string>"id"</span> <span class=attr>column</span>=<span class=string>"tag_id"</span>/></span></span><br><span class=line>    <span class=tag>&LT/<span class=name>collection</span>></span></span><br><span class=line>    <span class=tag><<span class=name>discriminator</span> <span class=attr>javaType</span>=<span class=string>"int"</span> <span class=attr>column</span>=<span class=string>"draft"</span>></span></span><br><span class=line>      <span class=tag><<span class=name>case</span> <span class=attr>value</span>=<span class=string>"1"</span> <span class=attr>resultType</span>=<span class=string>"DraftPost"</span>/></span></span><br><span class=line>    <span class=tag>&LT/<span class=name>discriminator</span>></span></span><br><span class=line>  <span class=tag>&LT/<span class=name>collection</span>></span></span><br><span class=line><span class=tag>&LT/<span class=name>resultMap</span>></span></span><br></pre></table></figure><h3 id=5-4-2、鉴别器><a class=headerlink href=#5-4-2、鉴别器 title=5.4.2、鉴别器></a>5.4.2、鉴别器</h3><p>有时候，一个数据库查询可能会返回多个不同的结果集（但总体上还是有一定的联系的）。 鉴别器（discriminator）元素就是被设计来应对这种情况的，另外也能处理其它情况，例如类的继承层次结构。 鉴别器的概念很好理解——它很像 Java 语言中的 switch 语句。<p>一个鉴别器的定义需要指定 column 和 javaType 属性。column 指定了 MyBatis 查询被比较值的地方。 而 javaType 用来确保使用正确的相等测试（虽然很多情况下字符串的相等测试都可以工作）。例如：<figure class="highlight xml"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br></pre><td class=code><pre><span class=line><span class=tag><<span class=name>resultMap</span> <span class=attr>id</span>=<span class=string>"vehicleResult"</span> <span class=attr>type</span>=<span class=string>"Vehicle"</span>></span></span><br><span class=line>  <span class=tag><<span class=name>id</span> <span class=attr>property</span>=<span class=string>"id"</span> <span class=attr>column</span>=<span class=string>"id"</span> /></span></span><br><span class=line>  <span class=tag><<span class=name>result</span> <span class=attr>property</span>=<span class=string>"vin"</span> <span class=attr>column</span>=<span class=string>"vin"</span>/></span></span><br><span class=line>  <span class=tag><<span class=name>result</span> <span class=attr>property</span>=<span class=string>"year"</span> <span class=attr>column</span>=<span class=string>"year"</span>/></span></span><br><span class=line>  <span class=tag><<span class=name>result</span> <span class=attr>property</span>=<span class=string>"make"</span> <span class=attr>column</span>=<span class=string>"make"</span>/></span></span><br><span class=line>  <span class=tag><<span class=name>result</span> <span class=attr>property</span>=<span class=string>"model"</span> <span class=attr>column</span>=<span class=string>"model"</span>/></span></span><br><span class=line>  <span class=tag><<span class=name>result</span> <span class=attr>property</span>=<span class=string>"color"</span> <span class=attr>column</span>=<span class=string>"color"</span>/></span></span><br><span class=line>  <span class=tag><<span class=name>discriminator</span> <span class=attr>javaType</span>=<span class=string>"int"</span> <span class=attr>column</span>=<span class=string>"vehicle_type"</span>></span></span><br><span class=line>    <span class=tag><<span class=name>case</span> <span class=attr>value</span>=<span class=string>"1"</span> <span class=attr>resultMap</span>=<span class=string>"carResult"</span>/></span></span><br><span class=line>    <span class=tag><<span class=name>case</span> <span class=attr>value</span>=<span class=string>"2"</span> <span class=attr>resultMap</span>=<span class=string>"truckResult"</span>/></span></span><br><span class=line>    <span class=tag><<span class=name>case</span> <span class=attr>value</span>=<span class=string>"3"</span> <span class=attr>resultMap</span>=<span class=string>"vanResult"</span>/></span></span><br><span class=line>    <span class=tag><<span class=name>case</span> <span class=attr>value</span>=<span class=string>"4"</span> <span class=attr>resultMap</span>=<span class=string>"suvResult"</span>/></span></span><br><span class=line>  <span class=tag>&LT/<span class=name>discriminator</span>></span></span><br><span class=line><span class=tag>&LT/<span class=name>resultMap</span>></span></span><br></pre></table></figure><p>在这个示例中，MyBatis 会从结果集中得到每条记录，然后比较它的 vehicle type 值。 如果它匹配任意一个鉴别器的 case，就会使用这个 case 指定的结果映射。 这个过程是互斥的，也就是说，剩余的结果映射将被忽略（除非它是扩展的，我们将在稍后讨论它）。 如果不能匹配任何一个 case，MyBatis 就只会使用鉴别器块外定义的结果映射。<h3 id=5-4-3、自动映射><a class=headerlink href=#5-4-3、自动映射 title=5.4.3、自动映射></a>5.4.3、自动映射</h3><p>在下面的例子中，<em>id</em> 和 <em>userName</em> 列将被自动映射，<em>hashed_password</em> 列将根据配置进行映射。<figure class="highlight xml"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br></pre><td class=code><pre><span class=line><span class=tag><<span class=name>select</span> <span class=attr>id</span>=<span class=string>"selectUsers"</span> <span class=attr>resultMap</span>=<span class=string>"userResultMap"</span>></span></span><br><span class=line>  select</span><br><span class=line>    user_id as "id",</span><br><span class=line>    user_name as "userName",</span><br><span class=line>    hashed_password</span><br><span class=line>  from some_table</span><br><span class=line>  where id = #{id}</span><br><span class=line><span class=tag>&LT/<span class=name>select</span>></span></span><br><span class=line></span><br><span class=line><span class=tag><<span class=name>resultMap</span> <span class=attr>id</span>=<span class=string>"userResultMap"</span> <span class=attr>type</span>=<span class=string>"User"</span>></span></span><br><span class=line>  <span class=tag><<span class=name>result</span> <span class=attr>property</span>=<span class=string>"password"</span> <span class=attr>column</span>=<span class=string>"hashed_password"</span>/></span></span><br><span class=line><span class=tag>&LT/<span class=name>resultMap</span>></span></span><br></pre></table></figure><p>有三种自动映射等级：<ul><li><code>NONE</code> - 禁用自动映射。仅对手动映射的属性进行映射。<li><code>PARTIAL</code> - 对除在内部定义了嵌套结果映射（也就是连接的属性）以外的属性进行映射<li><code>FULL</code> - 自动映射所有属性。</ul><p>默认值是 <code>PARTIAL</code>，这是有原因的。当对连接查询的结果使用 <code>FULL</code> 时，连接查询会在同一行中获取多个不同实体的数据，因此可能导致非预期的映射。 下面的例子将展示这种风险：<figure class="highlight xml"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br></pre><td class=code><pre><span class=line><span class=tag><<span class=name>select</span> <span class=attr>id</span>=<span class=string>"selectBlog"</span> <span class=attr>resultMap</span>=<span class=string>"blogResult"</span>></span></span><br><span class=line>  select</span><br><span class=line>    B.id,</span><br><span class=line>    B.title,</span><br><span class=line>    A.username,</span><br><span class=line>  from Blog B left outer join Author A on B.author_id = A.id</span><br><span class=line>  where B.id = #{id}</span><br><span class=line><span class=tag>&LT/<span class=name>select</span>></span></span><br><span class=line></span><br><span class=line><span class=tag><<span class=name>resultMap</span> <span class=attr>id</span>=<span class=string>"blogResult"</span> <span class=attr>type</span>=<span class=string>"Blog"</span>></span></span><br><span class=line>  <span class=tag><<span class=name>association</span> <span class=attr>property</span>=<span class=string>"author"</span> <span class=attr>resultMap</span>=<span class=string>"authorResult"</span>/></span></span><br><span class=line><span class=tag>&LT/<span class=name>resultMap</span>></span></span><br><span class=line></span><br><span class=line><span class=tag><<span class=name>resultMap</span> <span class=attr>id</span>=<span class=string>"authorResult"</span> <span class=attr>type</span>=<span class=string>"Author"</span>></span></span><br><span class=line>  <span class=tag><<span class=name>result</span> <span class=attr>property</span>=<span class=string>"username"</span> <span class=attr>column</span>=<span class=string>"author_username"</span>/></span></span><br><span class=line><span class=tag>&LT/<span class=name>resultMap</span>></span></span><br></pre></table></figure><p>在该结果映射中，Blog 和 Author 均将被自动映射。但是注意 Author 有一个 id 属性，在 ResultSet 中也有一个名为 id 的列，所以 Author 的 id 将填入 Blog 的 id，这可不是你期望的行为。 所以，要谨慎使用 <code>FULL</code>。<p>无论设置的自动映射等级是哪种，你都可以通过在结果映射上设置 <code>autoMapping</code> 属性来为指定的结果映射设置启用/禁用自动映射。<figure class="highlight xml"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br></pre><td class=code><pre><span class=line><span class=tag><<span class=name>resultMap</span> <span class=attr>id</span>=<span class=string>"userResultMap"</span> <span class=attr>type</span>=<span class=string>"User"</span> <span class=attr>autoMapping</span>=<span class=string>"false"</span>></span></span><br><span class=line>  <span class=tag><<span class=name>result</span> <span class=attr>property</span>=<span class=string>"password"</span> <span class=attr>column</span>=<span class=string>"hashed_password"</span>/></span></span><br><span class=line><span class=tag>&LT/<span class=name>resultMap</span>></span></span><br></pre></table></figure><h2 id=5-5、ParameterMap（参数）><a class=headerlink href=#5-5、ParameterMap（参数） title=5.5、ParameterMap（参数）></a>5.5、ParameterMap（参数）</h2><p>之前见到的所有语句都使用了简单的参数形式。但实际上，参数是 MyBatis 非常强大的元素。对于大多数简单的使用场景，你都不需要使用复杂的参数，比如：<figure class="highlight xml"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br></pre><td class=code><pre><span class=line><span class=tag><<span class=name>select</span> <span class=attr>id</span>=<span class=string>"selectUsers"</span> <span class=attr>resultType</span>=<span class=string>"User"</span>></span></span><br><span class=line>  select id, username, password</span><br><span class=line>  from users</span><br><span class=line>  where id = #{id}</span><br><span class=line><span class=tag>&LT/<span class=name>select</span>></span></span><br></pre></table></figure><p>上面的这个示例说明了一个非常简单的命名参数映射。鉴于参数类型（parameterType）会被自动设置为 <code>int</code>，这个参数可以随意命名。原始类型或简单数据类型（比如 <code>Integer</code> 和 <code>String</code>）因为没有其它属性，会用它们的值来作为参数。 然而，如果传入一个复杂的对象，行为就会有点不一样了。比如：<figure class="highlight xml"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br></pre><td class=code><pre><span class=line><span class=tag><<span class=name>insert</span> <span class=attr>id</span>=<span class=string>"insertUser"</span> <span class=attr>parameterType</span>=<span class=string>"User"</span>></span></span><br><span class=line>  insert into users (id, username, password)</span><br><span class=line>  values (#{id}, #{username}, #{password})</span><br><span class=line><span class=tag>&LT/<span class=name>insert</span>></span></span><br></pre></table></figure><p>如果 User 类型的参数对象传递到了语句中，会查找 id、username 和 password 属性，然后将它们的值传入预处理语句的参数中。<p>MyBatis 也支持很多高级的数据类型，比如结构体（structs），但是当使用 out 参数时，你必须显式设置类型的名称。比如（再次提示，在实际中要像这样不能换行）：<figure class="highlight xml"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line>#{middleInitial, mode=OUT, jdbcType=STRUCT, jdbcTypeName=MY_TYPE, resultMap=departmentResultMap}</span><br></pre></table></figure><p>尽管上面这些选项很强大，但大多时候，你只须简单指定属性名，顶多要为可能为空的列指定 <code>jdbcType</code>，其他的事情交给 MyBatis 自己去推断就行了。<ul><li><p>字符串替换</p> <p>默认情况下，使用 <code>#{}</code> 参数语法时，MyBatis 会创建 <code>PreparedStatement</code> 参数占位符，并通过占位符安全地设置参数（就像使用 ? 一样）。 这样做更安全，更迅速，通常也是首选做法，不过有时你就是想直接在 SQL 语句中直接插入一个不转义的字符串。 比如 ORDER BY 子句，这时候你可以：</p> <figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line>ORDER BY ${columnName}</span><br></pre></table></figure> <p>这样，MyBatis 就不会修改或转义该字符串了。</p> <p>当 SQL 语句中的元数据（如表名或列名）是动态生成的时候，字符串替换将会非常有用。 举个例子，如果你想 <code>select</code> 一个表任意一列的数据时，不需要这样写：</p> <figure class="highlight java"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br></pre><td class=code><pre><span class=line><span class=meta>@Select("select * from user where id = #{id}")</span></span><br><span class=line>User <span class="title function_">findById</span><span class=params>(<span class=meta>@Param("id")</span> <span class=type>long</span> id)</span>;</span><br><span class=line></span><br><span class=line><span class=meta>@Select("select * from user where name = #{name}")</span></span><br><span class=line>User <span class="title function_">findByName</span><span class=params>(<span class=meta>@Param("name")</span> String name)</span>;</span><br><span class=line></span><br><span class=line><span class=meta>@Select("select * from user where email = #{email}")</span></span><br><span class=line>User <span class="title function_">findByEmail</span><span class=params>(<span class=meta>@Param("email")</span> String email)</span>;</span><br><span class=line></span><br><span class=line><span class=comment>// 其它的 "findByXxx" 方法</span></span><br></pre></table></figure> <p>而是可以只写这样一个方法：</p> <figure class="highlight java"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br></pre><td class=code><pre><span class=line><span class=meta>@Select("select * from user where ${column} = #{value}")</span></span><br><span class=line>User <span class="title function_">findByColumn</span><span class=params>(<span class=meta>@Param("column")</span> String column, <span class=meta>@Param("value")</span> String value)</span>;</span><br></pre></table></figure> <p>其中 <code>${column}</code> 会被直接替换，而 <code>#{value}</code> 会使用 <code>?</code> 预处理。 这样，就能完成同样的任务：</p> <figure class="highlight java"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br></pre><td class=code><pre><span class=line><span class=type>User</span> <span class=variable>userOfId1</span> <span class=operator>=</span> userMapper.findByColumn(<span class=string>"id"</span>, <span class=number>1L</span>);</span><br><span class=line><span class=type>User</span> <span class=variable>userOfNameKid</span> <span class=operator>=</span> userMapper.findByColumn(<span class=string>"name"</span>, <span class=string>"kid"</span>);</span><br><span class=line><span class=type>User</span> <span class=variable>userOfEmail</span> <span class=operator>=</span> userMapper.findByColumn(<span class=string>"email"</span>, <span class=string>"noone@nowhere.com"</span>);</span><br></pre></table></figure> <p>这种方式也同样适用于替换表名的情况。</p> <p><strong>注意：</strong>用这种方式接受用户的输入，并用作语句参数是不安全的，会导致潜在的 SQL 注入攻击。因此，要么不允许用户输入这些字段，要么自行转义并检验这些参数。</p></ul><h2 id=5-6、SQL><a class=headerlink href=#5-6、SQL title=5.6、SQL></a>5.6、SQL</h2><p>这个元素可以用来定义可重用的 SQL 代码片段，以便在其它语句中使用。 参数可以静态地（在加载的时候）确定下来，并且可以在不同的 include 元素中定义不同的参数值。比如：<figure class="highlight xml"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line><span class=tag><<span class=name>sql</span> <span class=attr>id</span>=<span class=string>"userColumns"</span>></span> ${alias}.id,${alias}.username,${alias}.password <span class=tag>&LT/<span class=name>sql</span>></span></span><br></pre></table></figure><p>这个 SQL 片段可以在其它语句中使用，例如：<figure class="highlight xml"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br></pre><td class=code><pre><span class=line><span class=tag><<span class=name>select</span> <span class=attr>id</span>=<span class=string>"selectUsers"</span> <span class=attr>resultType</span>=<span class=string>"map"</span>></span></span><br><span class=line>  select</span><br><span class=line>    <span class=tag><<span class=name>include</span> <span class=attr>refid</span>=<span class=string>"userColumns"</span>></span><span class=tag><<span class=name>property</span> <span class=attr>name</span>=<span class=string>"alias"</span> <span class=attr>value</span>=<span class=string>"t1"</span>/></span><span class=tag>&LT/<span class=name>include</span>></span>,</span><br><span class=line>    <span class=tag><<span class=name>include</span> <span class=attr>refid</span>=<span class=string>"userColumns"</span>></span><span class=tag><<span class=name>property</span> <span class=attr>name</span>=<span class=string>"alias"</span> <span class=attr>value</span>=<span class=string>"t2"</span>/></span><span class=tag>&LT/<span class=name>include</span>></span></span><br><span class=line>  from some_table t1</span><br><span class=line>    cross join some_table t2</span><br><span class=line><span class=tag>&LT/<span class=name>select</span>></span></span><br></pre></table></figure><p>也可以在 include 元素的 refid 属性或内部语句中使用属性值，例如：<figure class="highlight xml"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br></pre><td class=code><pre><span class=line><span class=tag><<span class=name>sql</span> <span class=attr>id</span>=<span class=string>"sometable"</span>></span></span><br><span class=line>  ${prefix}Table</span><br><span class=line><span class=tag>&LT/<span class=name>sql</span>></span></span><br><span class=line></span><br><span class=line><span class=tag><<span class=name>sql</span> <span class=attr>id</span>=<span class=string>"someinclude"</span>></span></span><br><span class=line>  from <span class=tag><<span class=name>include</span> <span class=attr>refid</span>=<span class=string>"${include_target}"</span>/></span></span><br><span class=line><span class=tag>&LT/<span class=name>sql</span>></span></span><br><span class=line></span><br><span class=line><span class=tag><<span class=name>select</span> <span class=attr>id</span>=<span class=string>"select"</span> <span class=attr>resultType</span>=<span class=string>"map"</span>></span></span><br><span class=line>  select field1, field2, field3</span><br><span class=line>  <span class=tag><<span class=name>include</span> <span class=attr>refid</span>=<span class=string>"someinclude"</span>></span></span><br><span class=line>    <span class=tag><<span class=name>property</span> <span class=attr>name</span>=<span class=string>"prefix"</span> <span class=attr>value</span>=<span class=string>"Some"</span>/></span></span><br><span class=line>    <span class=tag><<span class=name>property</span> <span class=attr>name</span>=<span class=string>"include_target"</span> <span class=attr>value</span>=<span class=string>"sometable"</span>/></span></span><br><span class=line>  <span class=tag>&LT/<span class=name>include</span>></span></span><br><span class=line><span class=tag>&LT/<span class=name>select</span>></span></span><br></pre></table></figure><h2 id=5-7、Insert、Update-和-Delete><a title="5.7、Insert、Update 和 Delete" class=headerlink href=#5-7、Insert、Update-和-Delete></a>5.7、Insert、Update 和 Delete</h2><p>insert，update 和 delete 的实现非常接近：<figure class="highlight xml"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br></pre><td class=code><pre><span class=line><span class=tag><<span class=name>insert</span></span></span><br><span class=line><span class=tag>  <span class=attr>id</span>=<span class=string>"insertAuthor"</span></span></span><br><span class=line><span class=tag>  <span class=attr>parameterType</span>=<span class=string>"domain.blog.Author"</span></span></span><br><span class=line><span class=tag>  <span class=attr>flushCache</span>=<span class=string>"true"</span></span></span><br><span class=line><span class=tag>  <span class=attr>statementType</span>=<span class=string>"PREPARED"</span></span></span><br><span class=line><span class=tag>  <span class=attr>keyProperty</span>=<span class=string>""</span></span></span><br><span class=line><span class=tag>  <span class=attr>keyColumn</span>=<span class=string>""</span></span></span><br><span class=line><span class=tag>  <span class=attr>useGeneratedKeys</span>=<span class=string>""</span></span></span><br><span class=line><span class=tag>  <span class=attr>timeout</span>=<span class=string>"20"</span>></span></span><br><span class=line></span><br><span class=line><span class=tag><<span class=name>update</span></span></span><br><span class=line><span class=tag>  <span class=attr>id</span>=<span class=string>"updateAuthor"</span></span></span><br><span class=line><span class=tag>  <span class=attr>parameterType</span>=<span class=string>"domain.blog.Author"</span></span></span><br><span class=line><span class=tag>  <span class=attr>flushCache</span>=<span class=string>"true"</span></span></span><br><span class=line><span class=tag>  <span class=attr>statementType</span>=<span class=string>"PREPARED"</span></span></span><br><span class=line><span class=tag>  <span class=attr>timeout</span>=<span class=string>"20"</span>></span></span><br><span class=line></span><br><span class=line><span class=tag><<span class=name>delete</span></span></span><br><span class=line><span class=tag>  <span class=attr>id</span>=<span class=string>"deleteAuthor"</span></span></span><br><span class=line><span class=tag>  <span class=attr>parameterType</span>=<span class=string>"domain.blog.Author"</span></span></span><br><span class=line><span class=tag>  <span class=attr>flushCache</span>=<span class=string>"true"</span></span></span><br><span class=line><span class=tag>  <span class=attr>statementType</span>=<span class=string>"PREPARED"</span></span></span><br><span class=line><span class=tag>  <span class=attr>timeout</span>=<span class=string>"20"</span>></span></span><br></pre></table></figure><p>各个参数详解如下：<table><thead><tr><th align=left>属性<th align=left>描述<tbody><tr><td align=left><code>id</code><td align=left>在命名空间中唯一的标识符，可以被用来引用这条语句。<tr><td align=left><code>parameterType</code><td align=left>将会传入这条语句的参数的类全限定名或别名。这个属性是可选的，因为 MyBatis 可以通过类型处理器（TypeHandler）推断出具体传入语句的参数，默认值为未设置（unset）。<tr><td align=left><code>parameterMap</code><td align=left>用于引用外部 parameterMap 的属性，目前已被废弃。请使用行内参数映射和 parameterType 属性。<tr><td align=left><code>flushCache</code><td align=left>将其设置为 true 后，只要语句被调用，都会导致本地缓存和二级缓存被清空，默认值：（对 insert、update 和 delete 语句）true。<tr><td align=left><code>timeout</code><td align=left>这个设置是在抛出异常之前，驱动程序等待数据库返回请求结果的秒数。默认值为未设置（unset）（依赖数据库驱动）。<tr><td align=left><code>statementType</code><td align=left>可选 STATEMENT，PREPARED 或 CALLABLE。这会让 MyBatis 分别使用 Statement，PreparedStatement 或 CallableStatement，默认值：PREPARED。<tr><td align=left><code>useGeneratedKeys</code><td align=left>（仅适用于 insert 和 update）这会令 MyBatis 使用 JDBC 的 getGeneratedKeys 方法来取出由数据库内部生成的主键（比如：像 MySQL 和 SQL Server 这样的关系型数据库管理系统的自动递增字段），默认值：false。<tr><td align=left><code>keyProperty</code><td align=left>（仅适用于 insert 和 update）指定能够唯一识别对象的属性，MyBatis 会使用 getGeneratedKeys 的返回值或 insert 语句的 selectKey 子元素设置它的值，默认值：未设置（<code>unset</code>）。如果生成列不止一个，可以用逗号分隔多个属性名称。<tr><td align=left><code>keyColumn</code><td align=left>（仅适用于 insert 和 update）设置生成键值在表中的列名，在某些数据库（像 PostgreSQL）中，当主键列不是表中的第一列的时候，是必须设置的。如果生成列不止一个，可以用逗号分隔多个属性名称。<tr><td align=left><code>databaseId</code><td align=left>如果配置了数据库厂商标识（databaseIdProvider），MyBatis 会加载所有不带 databaseId 或匹配当前 databaseId 的语句；如果带和不带的语句都有，则不带的会被忽略。</table><p>对于不支持自动生成主键列的数据库和可能不支持自动生成主键的 JDBC 驱动，MyBatis 有另外一种方法来生成主键。<p>这里有一个简单（也很傻）的示例，它可以生成一个随机 ID（不建议实际使用，这里只是为了展示 MyBatis 处理问题的灵活性和宽容度）：<figure class="highlight xml"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br></pre><td class=code><pre><span class=line><span class=tag><<span class=name>insert</span> <span class=attr>id</span>=<span class=string>"insertAuthor"</span>></span></span><br><span class=line>  <span class=tag><<span class=name>selectKey</span> <span class=attr>keyProperty</span>=<span class=string>"id"</span> <span class=attr>resultType</span>=<span class=string>"int"</span> <span class=attr>order</span>=<span class=string>"BEFORE"</span>></span></span><br><span class=line>    select CAST(RANDOM()*1000000 as INTEGER) a from SYSIBM.SYSDUMMY1</span><br><span class=line>  <span class=tag>&LT/<span class=name>selectKey</span>></span></span><br><span class=line>  insert into Author</span><br><span class=line>    (id, username, password, email,bio, favourite_section)</span><br><span class=line>  values</span><br><span class=line>    (#{id}, #{username}, #{password}, #{email}, #{bio}, #{favouriteSection,jdbcType=VARCHAR})</span><br><span class=line><span class=tag>&LT/<span class=name>insert</span>></span></span><br></pre></table></figure><p>selectKey元素描述如下：<figure class="highlight xml"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br></pre><td class=code><pre><span class=line><span class=tag><<span class=name>selectKey</span></span></span><br><span class=line><span class=tag>  <span class=attr>keyProperty</span>=<span class=string>"id"</span></span></span><br><span class=line><span class=tag>  <span class=attr>resultType</span>=<span class=string>"int"</span></span></span><br><span class=line><span class=tag>  <span class=attr>order</span>=<span class=string>"BEFORE"</span></span></span><br><span class=line><span class=tag>  <span class=attr>statementType</span>=<span class=string>"PREPARED"</span>></span></span><br></pre></table></figure><p>各个参数详解如下：<table><thead><tr><th align=left>属性<th align=left>描述<tbody><tr><td align=left><code>keyProperty</code><td align=left><code>selectKey</code> 语句结果应该被设置到的目标属性。如果生成列不止一个，可以用逗号分隔多个属性名称。<tr><td align=left><code>keyColumn</code><td align=left>返回结果集中生成列属性的列名。如果生成列不止一个，可以用逗号分隔多个属性名称。<tr><td align=left><code>resultType</code><td align=left>结果的类型。通常 MyBatis 可以推断出来，但是为了更加准确，写上也不会有什么问题。MyBatis 允许将任何简单类型用作主键的类型，包括字符串。如果生成列不止一个，则可以使用包含期望属性的 Object 或 Map。<tr><td align=left><code>order</code><td align=left>可以设置为 <code>BEFORE</code> 或 <code>AFTER</code>。如果设置为 <code>BEFORE</code>，那么它首先会生成主键，设置 <code>keyProperty</code> 再执行插入语句。如果设置为 <code>AFTER</code>，那么先执行插入语句，然后是 <code>selectKey</code> 中的语句 - 这和 Oracle 数据库的行为相似，在插入语句内部可能有嵌入索引调用。<tr><td align=left><code>statementType</code><td align=left>和前面一样，MyBatis 支持 <code>STATEMENT</code>，<code>PREPARED</code> 和 <code>CALLABLE</code> 类型的映射语句，分别代表 <code>Statement</code>, <code>PreparedStatement</code> 和 <code>CallableStatement</code> 类型。</table><h2 id=5-8、Select><a class=headerlink href=#5-8、Select title=5.8、Select></a>5.8、Select</h2><p>一个简单查询的 select 元素是非常简单的。比如：<figure class="highlight xml"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br></pre><td class=code><pre><span class=line><span class=tag><<span class=name>select</span> <span class=attr>id</span>=<span class=string>"selectPerson"</span> <span class=attr>parameterType</span>=<span class=string>"int"</span> <span class=attr>resultType</span>=<span class=string>"hashmap"</span>></span></span><br><span class=line>  SELECT * FROM PERSON WHERE ID = #{id}</span><br><span class=line><span class=tag>&LT/<span class=name>select</span>></span></span><br></pre></table></figure><p>select 元素允许你配置很多属性来配置每条语句的行为细节。<figure class="highlight xml"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br></pre><td class=code><pre><span class=line><span class=tag><<span class=name>select</span></span></span><br><span class=line><span class=tag>  <span class=attr>id</span>=<span class=string>"selectPerson"</span></span></span><br><span class=line><span class=tag>  <span class=attr>parameterType</span>=<span class=string>"int"</span></span></span><br><span class=line><span class=tag>  <span class=attr>parameterMap</span>=<span class=string>"deprecated"</span></span></span><br><span class=line><span class=tag>  <span class=attr>resultType</span>=<span class=string>"hashmap"</span></span></span><br><span class=line><span class=tag>  <span class=attr>resultMap</span>=<span class=string>"personResultMap"</span></span></span><br><span class=line><span class=tag>  <span class=attr>flushCache</span>=<span class=string>"false"</span></span></span><br><span class=line><span class=tag>  <span class=attr>useCache</span>=<span class=string>"true"</span></span></span><br><span class=line><span class=tag>  <span class=attr>timeout</span>=<span class=string>"10"</span></span></span><br><span class=line><span class=tag>  <span class=attr>fetchSize</span>=<span class=string>"256"</span></span></span><br><span class=line><span class=tag>  <span class=attr>statementType</span>=<span class=string>"PREPARED"</span></span></span><br><span class=line><span class=tag>  <span class=attr>resultSetType</span>=<span class=string>"FORWARD_ONLY"</span>></span></span><br></pre></table></figure><p>各个参数详解如下：<table><thead><tr><th align=left>属性<th align=left>描述<tbody><tr><td align=left><code>id</code><td align=left>在命名空间中唯一的标识符，可以被用来引用这条语句。<tr><td align=left><code>parameterType</code><td align=left>将会传入这条语句的参数的类全限定名或别名。这个属性是可选的，因为 MyBatis 可以通过类型处理器（TypeHandler）推断出具体传入语句的参数，默认值为未设置（unset）。<tr><td align=left>parameterMap<td align=left>用于引用外部 parameterMap 的属性，目前已被废弃。请使用行内参数映射和 parameterType 属性。<tr><td align=left><code>resultType</code><td align=left>期望从这条语句中返回结果的类全限定名或别名。 注意，如果返回的是集合，那应该设置为集合包含的类型，而不是集合本身的类型。 resultType 和 resultMap 之间只能同时使用一个。<tr><td align=left><code>resultMap</code><td align=left>对外部 resultMap 的命名引用。结果映射是 MyBatis 最强大的特性，如果你对其理解透彻，许多复杂的映射问题都能迎刃而解。 resultType 和 resultMap 之间只能同时使用一个。<tr><td align=left><code>flushCache</code><td align=left>将其设置为 true 后，只要语句被调用，都会导致本地缓存和二级缓存被清空，默认值：false。<tr><td align=left><code>useCache</code><td align=left>将其设置为 true 后，将会导致本条语句的结果被二级缓存缓存起来，默认值：对 select 元素为 true。<tr><td align=left><code>timeout</code><td align=left>这个设置是在抛出异常之前，驱动程序等待数据库返回请求结果的秒数。默认值为未设置（unset）（依赖数据库驱动）。<tr><td align=left><code>fetchSize</code><td align=left>这是一个给驱动的建议值，尝试让驱动程序每次批量返回的结果行数等于这个设置值。 默认值为未设置（unset）（依赖驱动）。<tr><td align=left><code>statementType</code><td align=left>可选 STATEMENT，PREPARED 或 CALLABLE。这会让 MyBatis 分别使用 Statement，PreparedStatement 或 CallableStatement，默认值：PREPARED。<tr><td align=left><code>resultSetType</code><td align=left>FORWARD_ONLY，SCROLL_SENSITIVE, SCROLL_INSENSITIVE 或 DEFAULT（等价于 unset） 中的一个，默认值为 unset （依赖数据库驱动）。<tr><td align=left><code>databaseId</code><td align=left>如果配置了数据库厂商标识（databaseIdProvider），MyBatis 会加载所有不带 databaseId 或匹配当前 databaseId 的语句；如果带和不带的语句都有，则不带的会被忽略。<tr><td align=left><code>resultOrdered</code><td align=left>这个设置仅针对嵌套结果 select 语句：如果为 true，将会假设包含了嵌套结果集或是分组，当返回一个主结果行时，就不会产生对前面结果集的引用。 这就使得在获取嵌套结果集的时候不至于内存不够用。默认值：<code>false</code>。<tr><td align=left><code>resultSets</code><td align=left>这个设置仅适用于多结果集的情况。它将列出语句执行后返回的结果集并赋予每个结果集一个名称，多个名称之间以逗号分隔。</table><h1 id=6、日志><a class=headerlink href=#6、日志 title=6、日志></a>6、日志</h1><h2 id=6-1、前言><a class=headerlink href=#6-1、前言 title=6.1、前言></a>6.1、前言</h2><p>Mybatis 通过使用内置的日志工厂提供日志功能。内置日志工厂将会把日志工作委托给下面的实现之一：<ul><li>SLF4J<li>Apache Commons Logging<li>Log4j2<li>Log4j<li>JDK logging</ul><p>MyBatis 内置日志工厂会基于运行时检测信息选择日志委托实现。它会（按上面罗列的顺序）使用第一个查找到的实现。当没有找到这些实现时，将会禁用日志功能。<h2 id=6-2、日志配置><a class=headerlink href=#6-2、日志配置 title=6.2、日志配置></a>6.2、日志配置</h2><h4 id=步骤-1：添加-Log4J-的-jar-包><a title="步骤 1：添加 Log4J 的 jar 包" class=headerlink href=#步骤-1：添加-Log4J-的-jar-包></a>步骤 1：添加 Log4J 的 jar 包</h4><p>由于我们使用的是 Log4J，我们要确保它的 jar 包可以被应用使用。为此，需要将 jar 包添加到应用的类路径中。<p>对于 web 应用或企业级应用，你可以将 <code>log4j.jar</code> 添加到 <code>WEB-INF/lib</code> 目录下；对于独立应用，可以将它添加到 JVM 的 <code>-classpath</code> 启动参数中。<h4 id=步骤-2：配置-Log4J><a title="步骤 2：配置 Log4J" class=headerlink href=#步骤-2：配置-Log4J></a>步骤 2：配置 Log4J</h4><p>配置 Log4J 比较简单。假设你需要记录这个映射器的日志：<figure class="highlight java"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br></pre><td class=code><pre><span class=line><span class=keyword>package</span> org.mybatis.example;</span><br><span class=line><span class=keyword>public</span> <span class=keyword>interface</span> <span class="title class_">BlogMapper</span> {</span><br><span class=line>  <span class=meta>@Select("SELECT * FROM blog WHERE id = #{id}")</span></span><br><span class=line>  Blog <span class="title function_">selectBlog</span><span class=params>(<span class=type>int</span> id)</span>;</span><br><span class=line>}</span><br></pre></table></figure><p>在应用的类路径中创建一个名为 <code>log4j.properties</code> 的文件，文件的具体内容如下：<figure class="highlight properties"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br></pre><td class=code><pre><span class=line><span class=comment># 全局日志配置</span></span><br><span class=line><span class=attr>log4j.rootLogger</span>=<span class=string>ERROR, stdout</span></span><br><span class=line><span class=comment># MyBatis 日志配置</span></span><br><span class=line><span class=attr>log4j.logger.org.mybatis.example.BlogMapper</span>=<span class=string>TRACE</span></span><br><span class=line><span class=comment># 控制台输出</span></span><br><span class=line><span class=attr>log4j.appender.stdout</span>=<span class=string>org.apache.log4j.ConsoleAppender</span></span><br><span class=line><span class=attr>log4j.appender.stdout.layout</span>=<span class=string>org.apache.log4j.PatternLayout</span></span><br><span class=line><span class=attr>log4j.appender.stdout.layout.ConversionPattern</span>=<span class=string>%5p [%t] - %m%n</span></span><br></pre></table></figure><p>上述配置将使 Log4J 详细打印 <code>org.mybatis.example.BlogMapper</code> 的日志，对于应用的其它部分，只打印错误信息。<p>为了实现更细粒度的日志输出，你也可以只打印特定语句的日志。以下配置将只打印语句 <code>selectBlog</code> 的日志：<figure class="highlight properties"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line><span class=attr>log4j.logger.org.mybatis.example.BlogMapper.selectBlog</span>=<span class=string>TRACE</span></span><br></pre></table></figure><p>或者，你也可以打印一组映射器的日志，只需要打开映射器所在的包的日志功能即可：<figure class="highlight properties"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line><span class=attr>log4j.logger.org.mybatis.example</span>=<span class=string>TRACE</span></span><br></pre></table></figure><p>某些查询可能会返回庞大的结果集。这时，你可能只想查看 SQL 语句，而忽略返回的结果集。为此，SQL 语句将会在 DEBUG 日志级别下记录（JDK 日志则为 FINE）。返回的结果集则会在 TRACE 日志级别下记录（JDK 日志则为 FINER)。因此，只要将日志级别调整为 DEBUG 即可：<figure class="highlight properties"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line><span class=attr>log4j.logger.org.mybatis.example</span>=<span class=string>DEBUG</span></span><br></pre></table></figure><p>但如果你要为下面的映射器 XML 文件打印日志，又该怎么办呢？<figure class="highlight xml"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br></pre><td class=code><pre><span class=line><span class=meta>&LT?xml version=<span class=string>"1.0"</span> encoding=<span class=string>"UTF-8"</span> ?></span></span><br><span class=line><span class=meta>&LT!DOCTYPE <span class=keyword>mapper</span></span></span><br><span class=line><span class=meta>  <span class=keyword>PUBLIC</span> <span class=string>"-//mybatis.org//DTD Mapper 3.0//EN"</span></span></span><br><span class=line><span class=meta>  <span class=string>"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span>></span></span><br><span class=line><span class=tag><<span class=name>mapper</span> <span class=attr>namespace</span>=<span class=string>"org.mybatis.example.BlogMapper"</span>></span></span><br><span class=line>  <span class=tag><<span class=name>select</span> <span class=attr>id</span>=<span class=string>"selectBlog"</span> <span class=attr>resultType</span>=<span class=string>"Blog"</span>></span></span><br><span class=line>    select * from Blog where id = #{id}</span><br><span class=line>  <span class=tag>&LT/<span class=name>select</span>></span></span><br><span class=line><span class=tag>&LT/<span class=name>mapper</span>></span></span><br></pre></table></figure><p>这时，你可以通过打开命名空间的日志功能来对整个 XML 记录日志：<figure class="highlight properties"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line><span class=attr>log4j.logger.org.mybatis.example.BlogMapper</span>=<span class=string>TRACE</span></span><br></pre></table></figure><p>而要记录具体语句的日志，可以这样做：<figure class="highlight properties"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line><span class=attr>log4j.logger.org.mybatis.example.BlogMapper.selectBlog</span>=<span class=string>TRACE</span></span><br></pre></table></figure><p>你应该会发现，为映射器和 XML 文件打开日志功能的语句毫无差别。<p><strong>注意：</strong> 如果你使用的是 SLF4J 或 Log4j 2，MyBatis 会设置 tag 为 MYBATIS。<p>配置文件 <code>log4j.properties</code> 的余下内容用来配置输出器（appender）。<h1 id=7、分页插件><a class=headerlink href=#7、分页插件 title=7、分页插件></a>7、分页插件</h1><h2 id=7-1、添加依赖><a class=headerlink href=#7-1、添加依赖 title=7.1、添加依赖></a>7.1、添加依赖</h2><figure class="highlight xml"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br></pre><td class=code><pre><span class=line><span class=comment>&LT!-- https://mvnrepository.com/artifact/com.github.pagehelper/pagehelper --></span></span><br><span class=line><span class=tag><<span class=name>dependency</span>></span></span><br><span class=line>	<span class=tag><<span class=name>groupId</span>></span>com.github.pagehelper<span class=tag>&LT/<span class=name>groupId</span>></span></span><br><span class=line>	<span class=tag><<span class=name>artifactId</span>></span>pagehelper<span class=tag>&LT/<span class=name>artifactId</span>></span></span><br><span class=line>	<span class=tag><<span class=name>version</span>></span>5.2.0<span class=tag>&LT/<span class=name>version</span>></span></span><br><span class=line><span class=tag>&LT/<span class=name>dependency</span>></span></span><br></pre></table></figure><h2 id=7-2、配置分页插件><a class=headerlink href=#7-2、配置分页插件 title=7.2、配置分页插件></a>7.2、配置分页插件</h2><p>在MyBatis的核心配置文件（mybatis-config.xml）中配置插件：<figure class="highlight xml"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br></pre><td class=code><pre><span class=line><span class=tag><<span class=name>plugins</span>></span></span><br><span class=line>	<span class=comment>&LT!--设置分页插件--></span></span><br><span class=line>	<span class=tag><<span class=name>plugin</span> <span class=attr>interceptor</span>=<span class=string>"com.github.pagehelper.PageInterceptor"</span>></span><span class=tag>&LT/<span class=name>plugin</span>></span></span><br><span class=line><span class=tag>&LT/<span class=name>plugins</span>></span></span><br></pre></table></figure><h2 id=7-3、使用分页插件><a class=headerlink href=#7-3、使用分页插件 title=7.3、使用分页插件></a>7.3、使用分页插件</h2><h3 id=7-3-1、开启分页功能><a class=headerlink href=#7-3-1、开启分页功能 title=7.3.1、开启分页功能></a>7.3.1、开启分页功能</h3><p>在执行查询方法前调用<code>PageHelper.startPage(int pageNum, int pageSize)</code>方法来开启分页功能。<figure class="highlight java"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br></pre><td class=code><pre><span class=line><span class=meta>@Test</span></span><br><span class=line><span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">testPageHelper</span><span class=params>()</span> <span class=keyword>throws</span> IOException {</span><br><span class=line>	<span class=type>InputStream</span> <span class=variable>is</span> <span class=operator>=</span> Resources.getResourceAsStream(<span class=string>"mybatis-config.xml"</span>);</span><br><span class=line>	<span class=type>SqlSessionFactoryBuilder</span> <span class=variable>sqlSessionFactoryBuilder</span> <span class=operator>=</span> <span class=keyword>new</span> <span class="title class_">SqlSessionFactoryBuilder</span>();</span><br><span class=line>	<span class=type>SqlSessionFactory</span> <span class=variable>sqlSessionFactory</span> <span class=operator>=</span> sqlSessionFactoryBuilder.build(is);</span><br><span class=line>	<span class=type>SqlSession</span> <span class=variable>sqlSession</span> <span class=operator>=</span> sqlSessionFactory.openSession(<span class=literal>true</span>);</span><br><span class=line>	<span class=type>EmpMapper</span> <span class=variable>mapper</span> <span class=operator>=</span> sqlSession.getMapper(EmpMapper.class);</span><br><span class=line>	<span class=comment>//访问第一页，每页四条数据</span></span><br><span class=line>	PageHelper.startPage(<span class=number>1</span>,<span class=number>4</span>);</span><br><span class=line>	List&LTEmp> emps = mapper.selectByExample(<span class=literal>null</span>);</span><br><span class=line>	emps.forEach(System.out::println);</span><br><span class=line>}</span><br></pre></table></figure><h3 id=7-3-2、常用操作><a class=headerlink href=#7-3-2、常用操作 title=7.3.2、常用操作></a>7.3.2、常用操作</h3><h4 id=7-3-2-1、直接输出><a class=headerlink href=#7-3-2-1、直接输出 title=7.3.2.1、直接输出></a>7.3.2.1、直接输出</h4><figure class="highlight java"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br></pre><td class=code><pre><span class=line><span class=meta>@Test</span></span><br><span class=line><span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">testPageHelper</span><span class=params>()</span> <span class=keyword>throws</span> IOException {</span><br><span class=line>	<span class=type>InputStream</span> <span class=variable>is</span> <span class=operator>=</span> Resources.getResourceAsStream(<span class=string>"mybatis-config.xml"</span>);</span><br><span class=line>	<span class=type>SqlSessionFactoryBuilder</span> <span class=variable>sqlSessionFactoryBuilder</span> <span class=operator>=</span> <span class=keyword>new</span> <span class="title class_">SqlSessionFactoryBuilder</span>();</span><br><span class=line>	<span class=type>SqlSessionFactory</span> <span class=variable>sqlSessionFactory</span> <span class=operator>=</span> sqlSessionFactoryBuilder.build(is);</span><br><span class=line>	<span class=type>SqlSession</span> <span class=variable>sqlSession</span> <span class=operator>=</span> sqlSessionFactory.openSession(<span class=literal>true</span>);</span><br><span class=line>	<span class=type>EmpMapper</span> <span class=variable>mapper</span> <span class=operator>=</span> sqlSession.getMapper(EmpMapper.class);</span><br><span class=line>	<span class=comment>//访问第一页，每页四条数据</span></span><br><span class=line>	Page&LTObject> page = PageHelper.startPage(<span class=number>1</span>, <span class=number>4</span>);</span><br><span class=line>	List&LTEmp> emps = mapper.selectByExample(<span class=literal>null</span>);</span><br><span class=line>	<span class=comment>//在查询到List集合后，打印分页数据</span></span><br><span class=line>	System.out.println(page);</span><br><span class=line>}</span><br></pre></table></figure><h4 id=7-3-2-2、使用PageInfo><a class=headerlink href=#7-3-2-2、使用PageInfo title=7.3.2.2、使用PageInfo></a>7.3.2.2、使用PageInfo</h4><figure class="highlight java"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br></pre><td class=code><pre><span class=line><span class=meta>@Test</span></span><br><span class=line><span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">testPageHelper</span><span class=params>()</span> <span class=keyword>throws</span> IOException {</span><br><span class=line>	<span class=type>InputStream</span> <span class=variable>is</span> <span class=operator>=</span> Resources.getResourceAsStream(<span class=string>"mybatis-config.xml"</span>);</span><br><span class=line>	<span class=type>SqlSessionFactoryBuilder</span> <span class=variable>sqlSessionFactoryBuilder</span> <span class=operator>=</span> <span class=keyword>new</span> <span class="title class_">SqlSessionFactoryBuilder</span>();</span><br><span class=line>	<span class=type>SqlSessionFactory</span> <span class=variable>sqlSessionFactory</span> <span class=operator>=</span> sqlSessionFactoryBuilder.build(is);</span><br><span class=line>	<span class=type>SqlSession</span> <span class=variable>sqlSession</span> <span class=operator>=</span> sqlSessionFactory.openSession(<span class=literal>true</span>);</span><br><span class=line>	<span class=type>EmpMapper</span> <span class=variable>mapper</span> <span class=operator>=</span> sqlSession.getMapper(EmpMapper.class);</span><br><span class=line>	PageHelper.startPage(<span class=number>1</span>, <span class=number>4</span>);</span><br><span class=line>	List&LTEmp> emps = mapper.selectByExample(<span class=literal>null</span>);</span><br><span class=line>	PageInfo&LTEmp> page = <span class=keyword>new</span> <span class="title class_">PageInfo</span><>(emps,<span class=number>5</span>);</span><br><span class=line>	System.out.println(page);</span><br><span class=line>}</span><br></pre></table></figure><h2 id=7-4、常见字段><a class=headerlink href=#7-4、常见字段 title=7.4、常见字段></a>7.4、常见字段</h2><ul><li>pageNum：当前页的页码 。<li>pageSize：每页显示的条数 。<li>size：当前页显示的真实条数。<li>total：总记录数。<li>pages：总页数。<li>prePage：上一页的页码。<li>nextPage：下一页的页码。<li>isFirstPage/isLastPage：是否为第一页/最后一页。<li>hasPreviousPage/hasNextPage：是否存在上一页/下一页。<li>navigatePages：导航分页的页码数。<li>navigatepageNums：导航分页的页码，[1,2,3,4,5]。</ul></div><footer class=post-footer><div class=post-tags><a href=/tags/MyBatis/ rel=tag># MyBatis</a><a href=/tags/MyBatis%E5%9F%BA%E7%A1%80/ rel=tag># MyBatis基础</a></div><div class=post-nav><div class=post-nav-item><a href=/2024/08/21/MyBatis%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/ rel=prev title=MyBatis系列-MyBatis原理解析> <i class="fa fa-angle-left"></i> MyBatis系列-MyBatis原理解析 </a></div><div class=post-nav-item><a href=/2024/08/21/MyBatis%E5%9F%BA%E7%A1%80%E5%BA%94%E7%94%A82/ rel=next title=MyBatis系列-MyBatis基础应用（二）> MyBatis系列-MyBatis基础应用（二） <i class="fa fa-angle-right"></i> </a></div></div></footer></article></div></div></main><footer class=footer><div class=footer-inner><div class=copyright>© <span itemprop=copyrightYear>2024</span><span class=with-love> <i class="fa fa-heart"></i> </span><span class=author itemprop=copyrightHolder>豪哥</span></div></div></footer><div class="toggle sidebar-toggle" role=button><span class=toggle-line></span><span class=toggle-line></span><span class=toggle-line></span></div><div class=sidebar-dimmer></div><div aria-label=返回顶部 class=back-to-top role=button><i class="fa fa-arrow-up fa-lg"></i><span>0%</span></div><noscript><div class=noscript-warning>Theme NexT works best with JavaScript enabled</div></noscript><script crossorigin=anonymous integrity=sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY= src=https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js></script><script src=/js/comments.js></script><script src=/js/utils.js></script><script src=/js/motion.js></script><script src=/js/sidebar.js></script><script src=/js/next-boot.js></script><script crossorigin=anonymous integrity=sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc= src=https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js></script><script src=/js/third-party/search/local-search.js></script>