<!doctypehtml><html lang=zh-CN><meta charset=UTF-8><meta content=width=device-width name=viewport><meta media="(prefers-color-scheme: light)" content=#222 name=theme-color><meta media="(prefers-color-scheme: dark)" content=#222 name=theme-color><meta content="Hexo 7.3.0" name=generator><link href=/images/apple-touch-icon-next.png rel=apple-touch-icon sizes=180x180><link href=/images/favicon-32x32-next.png rel=icon sizes=32x32 type=image/png><link href=/images/favicon-16x16-next.png rel=icon sizes=16x16 type=image/png><link color=#222 href=/images/logo.svg rel=mask-icon><link href=/css/main.css rel=stylesheet><link crossorigin=anonymous href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css integrity=sha256-XOqroi11tY4EFQMR9ZYwZWKj5ZXiftSx36RRuC3anlA= rel=stylesheet><link crossorigin=anonymous href=https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css integrity=sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE= rel=stylesheet><script class=next-config data-name=main type=application/json>{"hostname":"hshz21.gitee.io","root":"/","images":"/images","scheme":"Gemini","darkmode":true,"version":"8.20.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":false}}</script><script src=/js/config.js></script><meta content="1、Redis主从集群本集群模式为一主二从。 1.1、准备3台服务器三台服务器信息如下：    IP PORT    192.168.2.23 6379   192.168.2.24 6379   192.168.2.25 6379   1.2、Redis配置三台服务器的Redis配置相同，这里仅展示一份配置信息。 在redis.conf配置文件中加入如下配置： 12345678910111213" name=description><meta content=article property=og:type><meta content=Redis系列-Redis集群搭建 property=og:title><meta content=https://hshz21.gitee.io/2024/08/21/Redis%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA/index.html property=og:url><meta content=豪哥博客 property=og:site_name><meta content="1、Redis主从集群本集群模式为一主二从。 1.1、准备3台服务器三台服务器信息如下：    IP PORT    192.168.2.23 6379   192.168.2.24 6379   192.168.2.25 6379   1.2、Redis配置三台服务器的Redis配置相同，这里仅展示一份配置信息。 在redis.conf配置文件中加入如下配置： 12345678910111213" property=og:description><meta content=zh_CN property=og:locale><meta content=2024-08-21T13:39:14.488Z property=article:published_time><meta content=2023-08-07T01:24:39.367Z property=article:modified_time><meta content=豪哥 property=article:author><meta content=Redis property=article:tag><meta content=Redis集群 property=article:tag><meta content=summary name=twitter:card><link href=https://hshz21.gitee.io/2024/08/21/Redis%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA/ rel=canonical><script class=next-config data-name=page type=application/json>{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://hshz21.gitee.io/2024/08/21/Redis%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA/","path":"2024/08/21/Redis集群搭建/","title":"Redis系列-Redis集群搭建"}</script><script class=next-config data-name=calendar type=application/json>""</script><title>Redis系列-Redis集群搭建 | 豪哥博客</title><noscript><link href=/css/noscript.css rel=stylesheet></noscript><body class=use-motion itemscope itemtype=http://schema.org/WebPage><div class=headband></div><main class=main><div class=column><header class=header itemscope itemtype=http://schema.org/WPHeader><div class=site-brand-container><div class=site-nav-toggle><div aria-label=切换导航栏 class=toggle role=button><span class=toggle-line></span><span class=toggle-line></span><span class=toggle-line></span></div></div><div class=site-meta><a class=brand href=/ rel=start> <i class=logo-line></i> <p class=site-title>豪哥博客</p> <i class=logo-line></i> </a><p class=site-subtitle itemprop=description>豪哥博客</div><div class=site-nav-right><div class="toggle popup-trigger" aria-label=搜索 role=button><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class=site-nav><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href=/ rel=section><i class="fa fa-home fa-fw"></i>首页</a><li class="menu-item menu-item-tags"><a href=/tags/ rel=section><i class="fa fa-tags fa-fw"></i>标签</a><li class="menu-item menu-item-categories"><a href=/categories/ rel=section><i class="fa fa-th fa-fw"></i>分类</a><li class="menu-item menu-item-archives"><a href=/archives/ rel=section><i class="fa fa-archive fa-fw"></i>归档</a><li class="menu-item menu-item-search"><a class=popup-trigger role=button><i class="fa fa-search fa-fw"></i>搜索 </a></ul></nav><div class=search-pop-overlay><div class="popup search-popup"><div class=search-header><span class=search-icon> <i class="fa fa-search"></i> </span><div class=search-input-container><input autocapitalize=off autocomplete=off class=search-input maxlength=80 placeholder=搜索... spellcheck=false type=search></div><span class=popup-btn-close role=button> <i class="fa fa-times-circle"></i> </span></div><div class=search-result-container><div class=search-result-icon><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></header><aside class=sidebar><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class=sidebar-nav><li class=sidebar-nav-toc>文章目录<li class=sidebar-nav-overview>站点概览</ul><div class=sidebar-panel-container><!--noindex--><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class=nav><li class="nav-item nav-level-1"><a class=nav-link href=#1%E3%80%81Redis%E4%B8%BB%E4%BB%8E%E9%9B%86%E7%BE%A4><span class=nav-number>1.</span> <span class=nav-text>1、Redis主从集群</span></a><ol class=nav-child><li class="nav-item nav-level-2"><a class=nav-link href=#1-1%E3%80%81%E5%87%86%E5%A4%873%E5%8F%B0%E6%9C%8D%E5%8A%A1%E5%99%A8><span class=nav-number>1.1.</span> <span class=nav-text>1.1、准备3台服务器</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#1-2%E3%80%81Redis%E9%85%8D%E7%BD%AE><span class=nav-number>1.2.</span> <span class=nav-text>1.2、Redis配置</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#1-3%E3%80%81%E5%90%AF%E5%8A%A83%E5%8F%B0Redis%E6%9C%8D%E5%8A%A1><span class=nav-number>1.3.</span> <span class=nav-text>1.3、启动3台Redis服务</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#1-4%E3%80%81%E5%BC%80%E5%90%AF%E4%B8%BB%E4%BB%8E%E5%85%B3%E7%B3%BB><span class=nav-number>1.4.</span> <span class=nav-text>1.4、开启主从关系</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#1-5%E3%80%81%E6%B5%8B%E8%AF%95%E6%95%88%E6%9E%9C><span class=nav-number>1.5.</span> <span class=nav-text>1.5、测试效果</span></a></ol><li class="nav-item nav-level-1"><a class=nav-link href=#2%E3%80%81Redis%E5%93%A8%E5%85%B5%E9%9B%86%E7%BE%A4><span class=nav-number>2.</span> <span class=nav-text>2、Redis哨兵集群</span></a><ol class=nav-child><li class="nav-item nav-level-2"><a class=nav-link href=#2-1%E3%80%81%E5%87%86%E5%A4%87%E4%B8%89%E5%8F%B0%E6%9C%8D%E5%8A%A1%E5%99%A8><span class=nav-number>2.1.</span> <span class=nav-text>2.1、准备三台服务器</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#2-2%E3%80%81%E9%85%8D%E7%BD%AE><span class=nav-number>2.2.</span> <span class=nav-text>2.2、配置</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#2-3%E3%80%81%E5%90%AF%E5%8A%A8Redis%E6%9C%8D%E5%8A%A1><span class=nav-number>2.3.</span> <span class=nav-text>2.3、启动Redis服务</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#2-4%E3%80%81%E6%B5%8B%E8%AF%95><span class=nav-number>2.4.</span> <span class=nav-text>2.4、测试</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#2-5%E3%80%81SpringBoot%E9%9B%86%E6%88%90><span class=nav-number>2.5.</span> <span class=nav-text>2.5、SpringBoot集成</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#2-5-1%E3%80%81%E9%85%8D%E7%BD%AE><span class=nav-number>2.5.1.</span> <span class=nav-text>2.5.1、配置</span></a></ol></ol><li class="nav-item nav-level-1"><a class=nav-link href=#3%E3%80%81Redis%E5%88%86%E7%89%87%E9%9B%86%E7%BE%A4><span class=nav-number>3.</span> <span class=nav-text>3、Redis分片集群</span></a><ol class=nav-child><li class="nav-item nav-level-2"><a class=nav-link href=#3-1%E3%80%81%E5%87%86%E5%A4%87%E6%9C%8D%E5%8A%A1%E5%99%A8><span class=nav-number>3.1.</span> <span class=nav-text>3.1、准备服务器</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#3-2%E3%80%81%E5%AE%9E%E4%BE%8B%E5%88%9B%E5%BB%BA%E4%B8%8E%E9%85%8D%E7%BD%AE><span class=nav-number>3.2.</span> <span class=nav-text>3.2、实例创建与配置</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#3-3%E3%80%81%E5%90%AF%E5%8A%A8%E6%9C%8D%E5%8A%A1><span class=nav-number>3.3.</span> <span class=nav-text>3.3、启动服务</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#3-4%E3%80%81%E5%88%9B%E5%BB%BA%E9%9B%86%E7%BE%A4><span class=nav-number>3.4.</span> <span class=nav-text>3.4、创建集群</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#3-4-1%E3%80%81Redis5-0%E5%89%8D><span class=nav-number>3.4.1.</span> <span class=nav-text>3.4.1、Redis5.0前</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#3-4-2%E3%80%81Redis5-0%E5%90%8E><span class=nav-number>3.4.2.</span> <span class=nav-text>3.4.2、Redis5.0后</span></a></ol><li class="nav-item nav-level-2"><a class=nav-link href=#3-5%E3%80%81%E6%B5%8B%E8%AF%95><span class=nav-number>3.5.</span> <span class=nav-text>3.5、测试</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#3-7%E3%80%81%E6%89%A9%E5%AE%B9%E7%BC%A9%E5%AE%B9><span class=nav-number>3.6.</span> <span class=nav-text>3.7、扩容缩容</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#3-7-1%E3%80%81%E6%89%A9%E5%AE%B9><span class=nav-number>3.6.1.</span> <span class=nav-text>3.7.1、扩容</span></a><ol class=nav-child><li class="nav-item nav-level-4"><a class=nav-link href=#3-7-1-1%E3%80%81%E5%AE%9E%E4%BE%8B%E5%87%86%E5%A4%87%E4%B8%8E%E9%85%8D%E7%BD%AE><span class=nav-number>3.6.1.1.</span> <span class=nav-text>3.7.1.1、实例准备与配置</span></a><li class="nav-item nav-level-4"><a class=nav-link href=#3-7-1-2%E3%80%81%E5%90%AF%E5%8A%A87004%E8%8A%82%E7%82%B9><span class=nav-number>3.6.1.2.</span> <span class=nav-text>3.7.1.2、启动7004节点</span></a><li class="nav-item nav-level-4"><a class=nav-link href=#3-7-1-3%E3%80%81%E5%B0%867004%E8%8A%82%E7%82%B9%E5%8A%A0%E5%85%A5%E9%9B%86%E7%BE%A4><span class=nav-number>3.6.1.3.</span> <span class=nav-text>3.7.1.3、将7004节点加入集群</span></a><li class="nav-item nav-level-4"><a class=nav-link href=#3-7-1-4%E3%80%81%E4%B8%BA7004%E8%8A%82%E7%82%B9%E5%88%86%E9%85%8D%E6%8F%92%E6%A7%BD><span class=nav-number>3.6.1.4.</span> <span class=nav-text>3.7.1.4、为7004节点分配插槽</span></a></ol><li class="nav-item nav-level-3"><a class=nav-link href=#3-7-2%E3%80%81%E7%BC%A9%E5%AE%B9><span class=nav-number>3.6.2.</span> <span class=nav-text>3.7.2、缩容</span></a><ol class=nav-child><li class="nav-item nav-level-4"><a class=nav-link href=#3-7-2-1%E3%80%81%E8%BF%81%E7%A7%BB7004%E8%8A%82%E7%82%B9%E6%A7%BD%E4%BD%8D%E5%88%B07001%E8%8A%82%E7%82%B9><span class=nav-number>3.6.2.1.</span> <span class=nav-text>3.7.2.1、迁移7004节点槽位到7001节点</span></a><li class="nav-item nav-level-4"><a class=nav-link href=#3-7-2-2%E3%80%81%E5%88%A0%E9%99%A47004%E8%8A%82%E7%82%B9><span class=nav-number>3.6.2.2.</span> <span class=nav-text>3.7.2.2、删除7004节点</span></a></ol></ol><li class="nav-item nav-level-2"><a class=nav-link href=#3-8%E3%80%81%E6%95%85%E9%9A%9C%E8%BD%AC%E7%A7%BB><span class=nav-number>3.7.</span> <span class=nav-text>3.8、故障转移</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#3-8-1%E3%80%81%E5%9C%BA%E6%99%AF%E6%8F%8F%E8%BF%B0><span class=nav-number>3.7.1.</span> <span class=nav-text>3.8.1、场景描述</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#3-8-2%E3%80%81%E6%A8%A1%E6%8B%9F%E5%AE%95%E6%9C%BA><span class=nav-number>3.7.2.</span> <span class=nav-text>3.8.2、模拟宕机</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#3-8-3%E3%80%81%E8%8A%82%E7%82%B9%E5%8D%87%E7%BA%A7><span class=nav-number>3.7.3.</span> <span class=nav-text>3.8.3、节点升级</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#3-8-4%E3%80%81%E5%AE%95%E6%9C%BA%E6%81%A2%E5%A4%8D><span class=nav-number>3.7.4.</span> <span class=nav-text>3.8.4、宕机恢复</span></a></ol><li class="nav-item nav-level-2"><a class=nav-link href=#3-9%E3%80%81SpringBoot%E9%9B%86%E6%88%90><span class=nav-number>3.8.</span> <span class=nav-text>3.9、SpringBoot集成</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#3-9-1%E3%80%81%E9%85%8D%E7%BD%AE><span class=nav-number>3.8.1.</span> <span class=nav-text>3.9.1、配置</span></a></ol></ol></ol></div></div><!--/noindex--><div class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop=author itemscope itemtype=http://schema.org/Person><img alt=豪哥 class=site-author-image itemprop=image src=/static/imgs/avatar.png><p class=site-author-name itemprop=name>豪哥<div class=site-description itemprop=description>豪哥博客</div></div><div class="site-state-wrap animated"><nav class=site-state><div class="site-state-item site-state-posts"><a href=/archives/> <span class=site-state-item-count>109</span> <span class=site-state-item-name>日志</span> </a></div><div class="site-state-item site-state-categories"><a href=/categories/> <span class=site-state-item-count>33</span> <span class=site-state-item-name>分类</span></a></div><div class="site-state-item site-state-tags"><a href=/tags/> <span class=site-state-item-count>126</span> <span class=site-state-item-name>标签</span></a></div></nav></div></div></div></div></aside></div><div class="main-inner post posts-expand"><div class=post-block><article class=post-content itemscope itemtype=http://schema.org/Article lang=zh-CN><link href=https://hshz21.gitee.io/2024/08/21/Redis%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA/ itemprop=mainEntityOfPage><span hidden itemprop=author itemscope itemtype=http://schema.org/Person> <meta content=/static/imgs/avatar.png itemprop=image> <meta content=豪哥 itemprop=name> </span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization> <meta content=豪哥博客 itemprop=name> <meta content=豪哥博客 itemprop=description> </span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork> <meta content="Redis系列-Redis集群搭建 | 豪哥博客" itemprop=name> <meta itemprop=description> </span><header class=post-header><h1 itemprop="name headline" class=post-title>Redis系列-Redis集群搭建</h1><div class=post-meta-container><div class=post-meta><span class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-calendar"></i> </span> <span class=post-meta-item-text>发表于</span> <time itemprop="dateCreated datePublished" title="创建时间：2024-08-21 21:39:14" datetime=2024-08-21T21:39:14+08:00>2024-08-21</time> </span><span class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-calendar-check"></i> </span> <span class=post-meta-item-text>更新于</span> <time title="修改时间：2023-08-07 09:24:39" datetime=2023-08-07T09:24:39+08:00 itemprop=dateModified>2023-08-07</time> </span><span class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-folder"></i> </span> <span class=post-meta-item-text>分类于</span> <span itemprop=about itemscope itemtype=http://schema.org/Thing> <a href=/categories/Redis/ itemprop=url rel=index><span itemprop=name>Redis</span></a> </span> </span></div></div></header><div class=post-body itemprop=articleBody><h1 id=1、Redis主从集群><a class=headerlink href=#1、Redis主从集群 title=1、Redis主从集群></a>1、Redis主从集群</h1><p>本集群模式为一主二从。<h2 id=1-1、准备3台服务器><a class=headerlink href=#1-1、准备3台服务器 title=1.1、准备3台服务器></a>1.1、准备3台服务器</h2><p>三台服务器信息如下：<table><thead><tr><th align=center>IP<th align=center>PORT<tbody><tr><td align=center>192.168.2.23<td align=center>6379<tr><td align=center>192.168.2.24<td align=center>6379<tr><td align=center>192.168.2.25<td align=center>6379</table><h2 id=1-2、Redis配置><a class=headerlink href=#1-2、Redis配置 title=1.2、Redis配置></a>1.2、Redis配置</h2><p>三台服务器的Redis配置相同，这里仅展示一份配置信息。<p>在redis.conf配置文件中加入如下配置：<figure class="highlight properties"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br></pre><td class=code><pre><span class=line><span class=comment># 绑定地址，默认是127.0.0.1，会导致只能在本地访问。修改为0.0.0.0则可以在任意IP访问</span></span><br><span class=line><span class=attr>bind</span> <span class=string>0.0.0.0</span></span><br><span class=line><span class=comment></span></span><br><span class=line><span class=comment># 数据库数量，设置为1</span></span><br><span class=line><span class=attr>databases</span> <span class=string>1</span></span><br><span class=line><span class=comment></span></span><br><span class=line><span class=comment># 开启RDB</span></span><br><span class=line><span class=comment># save ""</span></span><br><span class=line><span class=attr>save</span> <span class=string>3600 1</span></span><br><span class=line><span class=attr>save</span> <span class=string>300 100</span></span><br><span class=line><span class=attr>save</span> <span class=string>60 10000</span></span><br><span class=line><span class=comment></span></span><br><span class=line><span class=comment># 关闭AOF</span></span><br><span class=line><span class=attr>appendonly</span> <span class=string>no</span></span><br></pre></table></figure><h2 id=1-3、启动3台Redis服务><a class=headerlink href=#1-3、启动3台Redis服务 title=1.3、启动3台Redis服务></a>1.3、启动3台Redis服务</h2><p>分别在三台服务器中执行如下命令：<figure class="highlight bash"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line>redis-server redis.conf</span><br></pre></table></figure><h2 id=1-4、开启主从关系><a class=headerlink href=#1-4、开启主从关系 title=1.4、开启主从关系></a>1.4、开启主从关系</h2><p>将服务器<code>192.168.2.23</code>作为 master节点，剩下2台服务器作为 slave节点。所以只需在slave节点中执行如下命令：<figure class="highlight bash"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br></pre><td class=code><pre><span class=line><span class=comment># 192.168.2.24</span></span><br><span class=line>redis-cli -p 6379</span><br><span class=line>slaveof 192.168.2.23 6379</span><br><span class=line></span><br><span class=line><span class=comment># 192.168.2.25</span></span><br><span class=line>redis-cli -p 6379</span><br><span class=line>slaveof 192.168.2.23 6379</span><br></pre></table></figure><p>执行完上述命令后，若没有什么错误，则表示配置成功。然后可以在master节点中查看集群状态：<figure class="highlight bash"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br></pre><td class=code><pre><span class=line><span class=comment># 192.168.2.23</span></span><br><span class=line>redis-cli -p 6379</span><br><span class=line>info replication</span><br></pre></table></figure><h2 id=1-5、测试效果><a class=headerlink href=#1-5、测试效果 title=1.5、测试效果></a>1.5、测试效果</h2><p>执行如下命令，若一切正常则表示 一主二从集群 搭建成功。<figure class="highlight bash"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br></pre><td class=code><pre><span class=line><span class=comment># master节点（192.168.2.23）</span></span><br><span class=line><span class=built_in>set</span> k1 v1</span><br><span class=line><span class=comment># slave节点（192.168.2.24）：</span></span><br><span class=line>get k1</span><br><span class=line><span class=built_in>set</span> k1 v2</span><br><span class=line><span class=comment># slave节点（192.168.2.25）：</span></span><br><span class=line>get k1</span><br><span class=line><span class=built_in>set</span> k1 v2</span><br></pre></table></figure><h1 id=2、Redis哨兵集群><a class=headerlink href=#2、Redis哨兵集群 title=2、Redis哨兵集群></a>2、Redis哨兵集群</h1><h2 id=2-1、准备三台服务器><a class=headerlink href=#2-1、准备三台服务器 title=2.1、准备三台服务器></a>2.1、准备三台服务器</h2><p>这里以Redis集群服务器为例。<h2 id=2-2、配置><a class=headerlink href=#2-2、配置 title=2.2、配置></a>2.2、配置</h2><p>三台服务器的Redis配置相同，这里仅展示一份配置信息。<p>在<code>sentinel.conf</code>配置文件中修改如下配置：<figure class="highlight properties"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br></pre><td class=code><pre><span class=line><span class=attr>port</span> <span class=string>27001</span></span><br><span class=line><span class=attr>sentinel</span> <span class=string>monitor mymaster 192.168.2.4 6379 2</span></span><br><span class=line><span class=attr>sentinel</span> <span class=string>down-after-milliseconds mymaster 5000</span></span><br><span class=line><span class=attr>sentinel</span> <span class=string>failover-timeout mymaster 60000</span></span><br><span class=line><span class=attr>dir</span> <span class=string>"/opt/redis/data"</span></span><br></pre></table></figure><h2 id=2-3、启动Redis服务><a class=headerlink href=#2-3、启动Redis服务 title=2.3、启动Redis服务></a>2.3、启动Redis服务</h2><p>分别在三台服务器中执行如下命令：<figure class="highlight bash"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line>redis-sentinel sentinel.conf</span><br></pre></table></figure><h2 id=2-4、测试><a class=headerlink href=#2-4、测试 title=2.4、测试></a>2.4、测试</h2><p>关闭master节点服务，查看两个slave节点的状态，其中有一个会升级为master节点。<h2 id=2-5、SpringBoot集成><a class=headerlink href=#2-5、SpringBoot集成 title=2.5、SpringBoot集成></a>2.5、SpringBoot集成</h2><h3 id=2-5-1、配置><a class=headerlink href=#2-5-1、配置 title=2.5.1、配置></a>2.5.1、配置</h3><p>application.yml文件：<figure class="highlight yml"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br></pre><td class=code><pre><span class=line><span class=attr>spring:</span></span><br><span class=line>  <span class=attr>redis:</span></span><br><span class=line>    <span class=attr>sentinel:</span></span><br><span class=line>      <span class=attr>master:</span> <span class=string>mymaster</span></span><br><span class=line>      <span class=attr>nodes:</span></span><br><span class=line>        <span class=bullet>-</span> <span class=number>192.168</span><span class=number>.2</span><span class=number>.4</span><span class=string>:27001</span></span><br><span class=line>        <span class=bullet>-</span> <span class=number>192.168</span><span class=number>.2</span><span class=number>.4</span><span class=string>:27002</span></span><br><span class=line>        <span class=bullet>-</span> <span class=number>192.168</span><span class=number>.2</span><span class=number>.4</span><span class=string>:27003</span></span><br></pre></table></figure><p>配置类：<figure class="highlight java"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br></pre><td class=code><pre><span class=line><span class=comment>/**</span></span><br><span class=line><span class=comment> * RedisTemplate哨兵模式 - 配置主从读写分离</span></span><br><span class=line><span class=comment> *</span></span><br><span class=line><span class=comment> * ReadFrom是配置Redis的读取策略，可选值如下：</span></span><br><span class=line><span class=comment> *      - MASTER                从master节点读取</span></span><br><span class=line><span class=comment> *      - MASTER_PREFERRED      优先读取master节点，master不可用再读取replica</span></span><br><span class=line><span class=comment> *      - REPLICA               从slave节点读取</span></span><br><span class=line><span class=comment> *      - REPLICA_PREFERRED     优先读取slave节点，slave不可用再读取master</span></span><br><span class=line><span class=comment> *</span></span><br><span class=line><span class=comment> * <span class=doctag>@return</span></span></span><br><span class=line><span class=comment>*/</span></span><br><span class=line><span class=meta>@Bean</span></span><br><span class=line><span class=keyword>public</span> LettuceClientConfigurationBuilderCustomizer <span class="title function_">configurationBuilderCustomizer</span><span class=params>()</span>{</span><br><span class=line>    <span class=keyword>return</span> config -> config.readFrom(ReadFrom.REPLICA_PREFERRED);</span><br><span class=line>}</span><br></pre></table></figure><h1 id=3、Redis分片集群><a class=headerlink href=#3、Redis分片集群 title=3、Redis分片集群></a>3、Redis分片集群</h1><h2 id=3-1、准备服务器><a class=headerlink href=#3-1、准备服务器 title=3.1、准备服务器></a>3.1、准备服务器</h2><p>在同一台虚拟机中开启6个redis实例，模拟分片集群，信息如下：<table><thead><tr><th align=center>IP<th align=center>PORT<th align=center>角色<tbody><tr><td align=center>192.168.150.101<td align=center>7001<td align=center>master<tr><td align=center>192.168.150.101<td align=center>7002<td align=center>master<tr><td align=center>192.168.150.101<td align=center>7003<td align=center>master<tr><td align=center>192.168.150.101<td align=center>8001<td align=center>slave<tr><td align=center>192.168.150.101<td align=center>8002<td align=center>slave<tr><td align=center>192.168.150.101<td align=center>8003<td align=center>slave</table><h2 id=3-2、实例创建与配置><a class=headerlink href=#3-2、实例创建与配置 title=3.2、实例创建与配置></a>3.2、实例创建与配置</h2><p>创建7001、7002、7003、8001、8002、8003目录：<figure class="highlight sh"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br></pre><td class=code><pre><span class=line><span class=comment># 进入/tmp目录</span></span><br><span class=line><span class=built_in>cd</span> /tmp</span><br><span class=line><span class=comment># 删除旧的，避免配置干扰</span></span><br><span class=line><span class=built_in>rm</span> -rf 7001 7002 7003</span><br><span class=line><span class=comment># 创建目录</span></span><br><span class=line><span class=built_in>mkdir</span> 7001 7002 7003 8001 8002 8003</span><br></pre></table></figure><p>在/tmp下准备一个新的redis.conf文件，内容如下：<figure class="highlight ini"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br></pre><td class=code><pre><span class=line>port 6379</span><br><span class=line><span class=comment># 开启集群功能</span></span><br><span class=line>cluster-enabled yes</span><br><span class=line><span class=comment># 集群的配置文件名称，不需要我们创建，由redis自己维护</span></span><br><span class=line>cluster-config-file /tmp/6379/nodes.conf</span><br><span class=line><span class=comment># 节点心跳失败的超时时间</span></span><br><span class=line>cluster-node-timeout 5000</span><br><span class=line><span class=comment># 持久化文件存放目录</span></span><br><span class=line>dir /tmp/6379</span><br><span class=line><span class=comment># 绑定地址</span></span><br><span class=line>bind 0.0.0.0</span><br><span class=line><span class=comment># 让redis后台运行</span></span><br><span class=line>daemonize yes</span><br><span class=line><span class=comment># 注册的实例ip</span></span><br><span class=line>replica-announce-ip 192.168.2.21</span><br><span class=line><span class=comment># 保护模式</span></span><br><span class=line>protected-mode no</span><br><span class=line><span class=comment># 数据库数量</span></span><br><span class=line>databases 1</span><br><span class=line><span class=comment># 日志</span></span><br><span class=line>logfile /tmp/6379/run.log</span><br></pre></table></figure><p>将这个文件拷贝到每个目录下：<figure class="highlight sh"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br></pre><td class=code><pre><span class=line><span class=comment># 进入/tmp目录</span></span><br><span class=line><span class=built_in>cd</span> /tmp</span><br><span class=line><span class=comment># 执行拷贝</span></span><br><span class=line><span class=built_in>echo</span> 7001 7002 7003 8001 8002 8003 | xargs -t -n 1 <span class=built_in>cp</span> redis.conf</span><br></pre></table></figure><p>修改每个目录下的redis.conf，将其中的6379修改为与所在目录一致：<figure class="highlight sh"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br></pre><td class=code><pre><span class=line><span class=comment># 进入/tmp目录</span></span><br><span class=line><span class=built_in>cd</span> /tmp</span><br><span class=line><span class=comment># 修改配置文件</span></span><br><span class=line><span class=built_in>printf</span> <span class=string>'%s\n'</span> 7001 7002 7003 8001 8002 8003 | xargs -I{} -t sed -i <span class=string>'s/6379/{}/g'</span> {}/redis.conf</span><br></pre></table></figure><h2 id=3-3、启动服务><a class=headerlink href=#3-3、启动服务 title=3.3、启动服务></a>3.3、启动服务</h2><p>因为已经配置了后台启动模式，所以可以直接启动服务：<figure class="highlight sh"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br></pre><td class=code><pre><span class=line><span class=comment># 进入/tmp目录</span></span><br><span class=line><span class=built_in>cd</span> /tmp</span><br><span class=line><span class=comment># 一键启动所有服务</span></span><br><span class=line><span class=built_in>printf</span> <span class=string>'%s\n'</span> 7001 7002 7003 8001 8002 8003 | xargs -I{} -t redis-server {}/redis.conf</span><br></pre></table></figure><p>通过ps查看状态：<figure class="highlight sh"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line>ps -ef | grep redis</span><br></pre></table></figure><p>如果要关闭所有进程，可以执行命令：<figure class="highlight sh"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line>ps -ef | grep redis | awk <span class=string>'{print $2}'</span> | xargs <span class=built_in>kill</span></span><br></pre></table></figure><p>或者（推荐这种方式）：<figure class="highlight sh"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line><span class=built_in>printf</span> <span class=string>'%s\n'</span> 7001 7002 7003 8001 8002 8003 | xargs -I{} -t redis-cli -p {} shutdown</span><br></pre></table></figure><h2 id=3-4、创建集群><a class=headerlink href=#3-4、创建集群 title=3.4、创建集群></a>3.4、创建集群</h2><p>虽然服务启动了，但是目前每个服务之间都是独立的，没有任何关联。<p>我们需要执行命令来创建集群，在Redis5.0之前创建集群比较麻烦，5.0之后集群管理命令都集成到了redis-cli中。<h3 id=3-4-1、Redis5-0前><a class=headerlink href=#3-4-1、Redis5-0前 title=3.4.1、Redis5.0前></a>3.4.1、Redis5.0前</h3><p>Redis5.0之前集群命令都是用redis安装包下的src/redis-trib.rb来实现的。因为redis-trib.rb是有ruby语言编写的所以需要安装ruby环境。<figure class="highlight sh"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br></pre><td class=code><pre><span class=line><span class=comment># 安装依赖</span></span><br><span class=line>yum -y install zlib ruby rubygems</span><br><span class=line>gem install redis</span><br></pre></table></figure><p>然后通过命令来管理集群：<figure class="highlight sh"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br></pre><td class=code><pre><span class=line><span class=comment># 进入redis的src目录</span></span><br><span class=line><span class=built_in>cd</span> /tmp/redis-6.2.4/src</span><br><span class=line><span class=comment># 创建集群</span></span><br><span class=line>./redis-trib.rb create --replicas 1 192.168.150.101:7001 192.168.150.101:7002 192.168.150.101:7003 192.168.150.101:8001 192.168.150.101:8002 192.168.150.101:8003</span><br></pre></table></figure><h3 id=3-4-2、Redis5-0后><a class=headerlink href=#3-4-2、Redis5-0后 title=3.4.2、Redis5.0后></a>3.4.2、Redis5.0后</h3><p>我们使用的是Redis6.2.4版本，集群管理已经集成到了redis-cli中，格式如下：<figure class="highlight sh"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line>redis-cli --cluster create --cluster-replicas 1 192.168.2.21:7001 192.168.2.21:7002 192.168.2.21:7003 192.168.2.21:8001 192.168.2.21:8002 192.168.2.21:8003</span><br></pre></table></figure><p>命令说明：<ul><li><code>redis-cli --cluster</code>或者<code>./redis-trib.rb</code>：代表集群操作命令<li><code>create</code>：代表是创建集群<li><code>--replicas 1</code>或者<code>--cluster-replicas 1</code> ：指定集群中每个master的副本个数为1，此时<code>节点总数 ÷ (replicas + 1)</code> 得到的就是master的数量。因此节点列表中的前n个就是master，其它节点都是slave节点，随机分配到不同master</ul><p>通过命令可以查看集群状态：<figure class="highlight sh"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line>redis-cli -p 7001 cluster nodes</span><br></pre></table></figure><h2 id=3-5、测试><a class=headerlink href=#3-5、测试 title=3.5、测试></a>3.5、测试</h2><p>集群操作时，需要给<code>redis-cli</code>加上<code>-c</code>参数才可以：<figure class="highlight sh"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br></pre><td class=code><pre><span class=line>redis-cli -c -p 7001</span><br><span class=line><span class=built_in>set</span> num 123</span><br><span class=line>get num</span><br><span class=line><span class=built_in>set</span> a 1</span><br></pre></table></figure><p>测试成功。<h2 id=3-7、扩容缩容><a class=headerlink href=#3-7、扩容缩容 title=3.7、扩容缩容></a>3.7、扩容缩容</h2><h3 id=3-7-1、扩容><a class=headerlink href=#3-7-1、扩容 title=3.7.1、扩容></a>3.7.1、扩容</h3><p>在原有7001、7002、7003、8001、8002、8003的基础上，增加一个7004节点。<h4 id=3-7-1-1、实例准备与配置><a class=headerlink href=#3-7-1-1、实例准备与配置 title=3.7.1.1、实例准备与配置></a>3.7.1.1、实例准备与配置</h4><figure class="highlight sh"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br></pre><td class=code><pre><span class=line><span class=built_in>cd</span> /tmp</span><br><span class=line><span class=built_in>mkdir</span> 7004</span><br><span class=line><span class=built_in>cp</span> redis.conf 7004</span><br></pre></table></figure><p>修改配置，将其中的6379改为7004：<figure class="highlight sh"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line>sed -i s/6379/7004/g 7004/redis.conf</span><br></pre></table></figure><h4 id=3-7-1-2、启动7004节点><a class=headerlink href=#3-7-1-2、启动7004节点 title=3.7.1.2、启动7004节点></a>3.7.1.2、启动7004节点</h4><figure class="highlight sh"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line>redis-server 7004/redis.conf</span><br></pre></table></figure><h4 id=3-7-1-3、将7004节点加入集群><a class=headerlink href=#3-7-1-3、将7004节点加入集群 title=3.7.1.3、将7004节点加入集群></a>3.7.1.3、将7004节点加入集群</h4><figure class="highlight sh"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line>redis-cli --cluster add-node 192.168.2.23:7004 192.168.2.23:7001</span><br></pre></table></figure><p>查看集群状态：<figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line>redis-cli -p 7001 cluster nodes</span><br></pre></table></figure><p>查看输出信息，发现7004节点中没有任何插槽，接下来要将其他节点中的插槽分给7004节点一部分。<h4 id=3-7-1-4、为7004节点分配插槽><a class=headerlink href=#3-7-1-4、为7004节点分配插槽 title=3.7.1.4、为7004节点分配插槽></a>3.7.1.4、为7004节点分配插槽</h4><p>执行如下命令来分配插槽：<figure class="highlight sh"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line>redis-cli --cluster reshard 192.168.2.23:7001</span><br></pre></table></figure><p>上述命令执行过程中会提示四次，每次都需要输入：<ul><li>第一个值：表示需要移动多少的槽位？该值最好是(16384 / master节点数量)计算结果。<li>第二个值：将这些槽位分配给哪个节点，这里填写要分配给的节点ID。节点ID可通过查看集群状态信息来获得。（查看命令：<code> redis-cli -p 7001 cluster nodes</code>）<li>第三个值：从哪个节点抽取插槽来分配要分配的节点，这里以7001节点为例，填写7001节点ID即可。<li>第四个值：填写<code>done</code>，然后回车即可。</ul><p>等待插槽分配完毕后，通过如下命令查看集群状态：<figure class="highlight sh"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line>redis-cli -p 7001 cluster nodes</span><br></pre></table></figure><p>通过输出信息，发现7004节点中已经拥有了刚刚分配的插槽。<h3 id=3-7-2、缩容><a class=headerlink href=#3-7-2、缩容 title=3.7.2、缩容></a>3.7.2、缩容</h3><h4 id=3-7-2-1、迁移7004节点槽位到7001节点><a class=headerlink href=#3-7-2-1、迁移7004节点槽位到7001节点 title=3.7.2.1、迁移7004节点槽位到7001节点></a>3.7.2.1、迁移7004节点槽位到7001节点</h4><figure class="highlight sh"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line>redis-cli --cluster reshard 192.168.2.23:7004</span><br></pre></table></figure><p>上述命令执行期间，需要输入五个值：<ul><li>How many slots do you want to move (from 1 to 16384)?<br>需要移动的槽位数量，这些槽位来自 节点7004。<li>What is the receiving node ID?<br>将移动的槽位分配给哪个节点，这里填写节点ID。比如分配给节点7001，那么就写节点7001的ID值。<li>Source node #1:<br>从哪个节点中移动槽位。比如填写节点7004的ID值，那么就表示从节点7004中移动槽位到其它节点。<li>Source node #2:<br>输入done即可。<li>Do you want to proceed with the proposed reshard plan (yes/no)?<br>输入yes即可。</ul><h4 id=3-7-2-2、删除7004节点><a class=headerlink href=#3-7-2-2、删除7004节点 title=3.7.2.2、删除7004节点></a>3.7.2.2、删除7004节点</h4><figure class="highlight sh"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line>redis-cli --cluster del-node 192.168.2.23:7004 7004节点的ID号</span><br></pre></table></figure><p>删除7004节点后，通过如下命令查看集群状态：<figure class="highlight sh"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line>redis-cli -p 7001 cluster nodes</span><br></pre></table></figure><p>通过输出信息，发现7004节点已经不在集群，证明删除成功。<h2 id=3-8、故障转移><a class=headerlink href=#3-8、故障转移 title=3.8、故障转移></a>3.8、故障转移</h2><h3 id=3-8-1、场景描述><a class=headerlink href=#3-8-1、场景描述 title=3.8.1、场景描述></a>3.8.1、场景描述</h3><p>假如 master节点6381机器 宕机，那么跟随其的 slave节点6386 是否会升级为master节点呢？下面一一验证。<h3 id=3-8-2、模拟宕机><a class=headerlink href=#3-8-2、模拟宕机 title=3.8.2、模拟宕机></a>3.8.2、模拟宕机</h3><p>这里通过 关闭master节点6381 来模拟真实的宕机。<h3 id=3-8-3、节点升级><a class=headerlink href=#3-8-3、节点升级 title=3.8.3、节点升级></a>3.8.3、节点升级</h3><p>master节点6381 宕机后，跟随其的slave节点8386会升级为master节点。这个升级过程是自动完成的。<h3 id=3-8-4、宕机恢复><a class=headerlink href=#3-8-4、宕机恢复 title=3.8.4、宕机恢复></a>3.8.4、宕机恢复</h3><p>master节点宕机后再次恢复时只会作为slave节点 跟随 master节点6386。<p>详情信息可通过 集群查看命令 来查看。<h2 id=3-9、SpringBoot集成><a class=headerlink href=#3-9、SpringBoot集成 title=3.9、SpringBoot集成></a>3.9、SpringBoot集成</h2><h3 id=3-9-1、配置><a class=headerlink href=#3-9-1、配置 title=3.9.1、配置></a>3.9.1、配置</h3><p>application.yml文件：<figure class="highlight yml"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br></pre><td class=code><pre><span class=line><span class=attr>spring:</span></span><br><span class=line>  <span class=attr>redis:</span></span><br><span class=line>    <span class=attr>cluster:</span></span><br><span class=line>      <span class=attr>nodes:</span></span><br><span class=line>        <span class=bullet>-</span> <span class=number>192.168</span><span class=number>.2</span><span class=number>.4</span><span class=string>:7001</span></span><br><span class=line>        <span class=bullet>-</span> <span class=number>192.168</span><span class=number>.2</span><span class=number>.4</span><span class=string>:7002</span></span><br><span class=line>        <span class=bullet>-</span> <span class=number>192.168</span><span class=number>.2</span><span class=number>.4</span><span class=string>:7003</span></span><br><span class=line>        <span class=bullet>-</span> <span class=number>192.168</span><span class=number>.2</span><span class=number>.4</span><span class=string>:7004</span></span><br><span class=line>        <span class=bullet>-</span> <span class=number>192.168</span><span class=number>.2</span><span class=number>.4</span><span class=string>:7005</span></span><br><span class=line>        <span class=bullet>-</span> <span class=number>192.168</span><span class=number>.2</span><span class=number>.4</span><span class=string>:7006</span></span><br></pre></table></figure><p>配置类：<figure class="highlight java"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br></pre><td class=code><pre><span class=line><span class=meta>@Bean</span></span><br><span class=line><span class=keyword>public</span> LettuceClientConfigurationBuilderCustomizer <span class="title function_">configurationBuilderCustomizer</span><span class=params>()</span>{</span><br><span class=line>    <span class=keyword>return</span> config -> config.readFrom(ReadFrom.REPLICA_PREFERRED);</span><br><span class=line>}</span><br></pre></table></figure></div><footer class=post-footer><div class=post-tags><a href=/tags/Redis/ rel=tag># Redis</a><a href=/tags/Redis%E9%9B%86%E7%BE%A4/ rel=tag># Redis集群</a></div><div class=post-nav><div class=post-nav-item><a href=/2024/08/21/Redis%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/ rel=prev title=Redis系列-Redis基础应用> <i class="fa fa-angle-left"></i> Redis系列-Redis基础应用 </a></div><div class=post-nav-item><a href=/2024/08/21/Redis%E9%9D%A2%E8%AF%95%E9%A2%98%E7%AC%AC%E4%B8%80%E7%AF%87/ rel=next title=Redis系列-Redis模拟面试题第一篇> Redis系列-Redis模拟面试题第一篇 <i class="fa fa-angle-right"></i> </a></div></div></footer></article></div></div></main><footer class=footer><div class=footer-inner><div class=copyright>© <span itemprop=copyrightYear>2024</span><span class=with-love> <i class="fa fa-heart"></i> </span><span class=author itemprop=copyrightHolder>豪哥</span></div></div></footer><div class="toggle sidebar-toggle" role=button><span class=toggle-line></span><span class=toggle-line></span><span class=toggle-line></span></div><div class=sidebar-dimmer></div><div aria-label=返回顶部 class=back-to-top role=button><i class="fa fa-arrow-up fa-lg"></i><span>0%</span></div><noscript><div class=noscript-warning>Theme NexT works best with JavaScript enabled</div></noscript><script crossorigin=anonymous integrity=sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY= src=https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js></script><script src=/js/comments.js></script><script src=/js/utils.js></script><script src=/js/motion.js></script><script src=/js/sidebar.js></script><script src=/js/next-boot.js></script><script crossorigin=anonymous integrity=sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc= src=https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js></script><script src=/js/third-party/search/local-search.js></script>